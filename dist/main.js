parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r},p.cache={};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"Ebwv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}();function r(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var t=function(){function t(e,n){r(this,t),this.Classifier=e,this.options=n,this.json=null}return e(t,[{key:"testPartition",value:function(e,r,t){var n=new this.Classifier(this.options),o=Date.now(),i=n.train(r,e),s=Date.now(),a=n.test(t),u=Date.now();return Object.assign({},a,{trainTime:s-o,testTime:u-s,iterations:i.iterations,error:i.error,total:a.total,learningRate:n.trainOpts.learningRate,hiddenLayers:n.hiddenLayers,network:n.toJSON()})}},{key:"shuffleArray",value:function(e){for(var r=e.length-1;r>0;r--){var t=Math.floor(Math.random()*(r+1)),n=e[r];e[r]=e[t],e[t]=n}return e}},{key:"train",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;if(e.length<t)throw new Error("Training set size is too small for "+e.length+" k folds of "+t);var n=e.length/t;if(e.constructor===Array)this.shuffleArray(e);else{var o={};this.shuffleArray(Object.keys(e)).forEach(function(r){o[r]=e[r]}),e=o}for(var i={trainTime:0,testTime:0,iterations:0,error:0},s={total:0},a={total:0,truePos:0,trueNeg:0,falsePos:0,falseNeg:0},u=[],l=void 0,f=null,h=0;h<t;h++){var c=e.slice(0),v=c.splice(h*n,n),y=c,g=this.testPartition(r,y,v);for(l in null===f&&(f=g.hasOwnProperty("falseNeg")&&g.hasOwnProperty("falsePos")&&g.hasOwnProperty("trueNeg")&&g.hasOwnProperty("truePos"))&&Object.assign(s,a),i)l in i&&(i[l]+=g[l]);for(l in s)l in s&&(s[l]+=g[l]);u.push(g)}for(l in i)l in i&&(i[l]/=t);return f&&(s.precision=s.truePos/(s.truePos+s.falsePos),s.recall=s.truePos/(s.truePos+s.falseNeg),s.accuracy=(s.trueNeg+s.truePos)/s.total),s.testSize=n,s.trainSize=e.length-n,this.json={avgs:i,stats:s,sets:u}}},{key:"toNeuralNetwork",value:function(){return this.fromJSON(this.json)}},{key:"toJSON",value:function(){return this.json}},{key:"fromJSON",value:function(e){var r=this.Classifier,t=e.sets.reduce(function(e,r){return e.error<r.error?e:r},{error:1/0}).network;if(r.fromJSON)return r.fromJSON(t);var n=new r;return n.fromJSON(t),n}}]),t}();exports.default=t;
},{}],"qNqL":[function(require,module,exports) {
"use strict";function e(e,r){var t=r.run(e),u=null,n=-1;for(var o in t){var a=t[o];a>n&&(u=o,n=a)}return u}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"yeLe":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},t=function(){function r(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}();function e(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function n(){e(this,n)}return t(n,null,[{key:"toTable",value:function(r){var t=r.reduce(function(r,t){return Object.assign(r,t)},{});return n.toHash(t)}},{key:"toTable2D",value:function(r){for(var t={},e=0,n=0;n<r.length;n++)for(var o=r[n],a=0;a<o.length;a++){var u=o[a];for(var f in u)u.hasOwnProperty(f)&&!t.hasOwnProperty(f)&&(t[f]=e++)}return t}},{key:"toInputTable",value:function(r){for(var t={},e=0,n=0;n<r.length;n++)for(var o in r[n].input)t.hasOwnProperty(o)||(t[o]=e++);return t}},{key:"toInputTable2D",value:function(r){for(var t={},e=0,n=0;n<r.length;n++)for(var o=r[n].input,a=0;a<o.length;a++){var u=o[a];for(var f in u)t.hasOwnProperty(f)||(t[f]=e++)}return t}},{key:"toOutputTable",value:function(r){for(var t={},e=0,n=0;n<r.length;n++)for(var o in r[n].output)t.hasOwnProperty(o)||(t[o]=e++);return t}},{key:"toOutputTable2D",value:function(r){for(var t={},e=0,n=0;n<r.length;n++)for(var o=r[n].output,a=0;a<o.length;a++){var u=o[a];for(var f in u)t.hasOwnProperty(f)||(t[f]=e++)}return t}},{key:"toHash",value:function(r){var t={},e=0;for(var n in r)t[n]=e++;return t}},{key:"toArray",value:function(r,t,e){var n=new Float32Array(e);for(var o in r)n[r[o]]=t.hasOwnProperty(o)?t[o]:0;return n}},{key:"toArrayShort",value:function(r,t){var e=[];for(var n in r){if(!t.hasOwnProperty(n))break;e[r[n]]=t[n]}return Float32Array.from(e)}},{key:"toArrays",value:function(r,t,e){for(var n=[],o=0;o<t.length;o++)n.push(this.toArray(r,t[o],e));return n}},{key:"toObject",value:function(r,t){var e={};for(var n in r)e[n]=t[r[n]];return e}},{key:"toObjectPartial",value:function(r,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o={},a=0;for(var u in r)e>0&&a++<e||n>0&&a++>=n||(o[u]=t[r[u]-e]);return o}},{key:"lookupFromArray",value:function(r){for(var t={},e=0,n=r.length;n-- >0;)t[r[n]]=e++;return t}},{key:"dataShape",value:function(t){var e=[];t.input?(e.push("datum"),t=t.input):Array.isArray(t)&&(t[0].input?(e.push("array","datum"),t=t[0].input):(e.push("array"),t=t[0]));for(var n=void 0;t;){for(n in t)break;if(!t.hasOwnProperty(n))break;if(Array.isArray(t)||t.buffer instanceof ArrayBuffer)e.push("array"),t=t[n];else{if("object"!==(void 0===t?"undefined":r(t)))throw new Error("unhandled signature");e.push("object"),t=t[n]}}return e.push(void 0===t?"undefined":r(t)),e}},{key:"addKeys",value:function(r,t){if(!Array.isArray(r)){t=t||{};var e=Object.keys(t).length;for(var n in r)r.hasOwnProperty(n)&&(t.hasOwnProperty(n)||(t[n]=e++));return t}}}]),n}();exports.default=n;
},{}],"rMvD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},i=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}();function e(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}exports.thaw=a;var n=!1,r=[],s=function(){function s(i){var a=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,s);var u=t({},this.constructor.defaultSettings,o),h=u.each,l=u.done;this.items=i,this.i=0,this.options=o;var c=this.tick=function(){if(!(a.i<0||(a.timeout=setTimeout(c,0),n))){var t=i[a.i];if(a.i>=i.length)return null!==l&&(n=!0,l(t,a.i),n=!1),a.i=-1,void clearTimeout(a.timeout);null!==h?(n=!0,h(t,a.i),n=!1):void 0!==t&&t(),a.i++}};r.push(this),o.delay||c()}return i(s,null,[{key:"stopAll",value:function(){for(var t=0;t<r.length;t++)r[t].stop()}},{key:"defaultSettings",get:function(){return{each:null,done:null}}},{key:"isThawing",get:function(){return n}}]),i(s,[{key:"makeReady",value:function(){return this.i<0&&(this.i=this.items.length,!0)}},{key:"add",value:function(t){var i=this.makeReady();return this.items.push(t),i&&this.tick(),this}},{key:"insert",value:function(t){var i=this.makeReady();return this.items.splice(this.i,0,t),i&&this.tick(),this}},{key:"addArray",value:function(t){var i=this.makeReady();return this.items=this.items.concat(t),i&&this.tick(),this}},{key:"insertArray",value:function(t){var i=this.makeReady(),e=this.items,n=t,r=this.items.splice(this.i,this.items.length-this.i+1);return this.items=e.concat(n,r),i&&this.tick(),this}},{key:"stop",value:function(){return this.i=-1,clearTimeout(this.timeout),this.options.done&&this.options.done(),this}}]),s}();function a(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new s(t,i)}exports.default=s;
},{}],"HI/m":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),e=require("./"),n=i(e);function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(t,n){r(this,e),this.index=0,this.thaws=[],this.count=n||200,this.options=t}return t(e,[{key:"add",value:function(t){return this._next().add(t),this}},{key:"addArray",value:function(t){return this._next().addArray(t),this}},{key:"insert",value:function(t){return this._next().insert(t),this}},{key:"insertArray",value:function(t){return this._next().insertArray(t),this}},{key:"stop",value:function(){for(var t=0;t<this.thaws.length;t++)this.thaws[t].stop();return this}},{key:"_next",value:function(){var t=null,e=this.thaws;return e.length<this.count?e.push(t=new n.default([],this.options)):t=e[this.index],this.index++,this.index>=this.count&&(this.index=0),t}}]),e}();exports.default=s;
},{"./":"a+hJ"}],"a+hJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Block=void 0;var e=require("./thaw"),t=u(e),o=require("./block"),d=u(o);function u(e){return e&&e.__esModule?e:{default:e}}exports.default=t.default,exports.Block=d.default,"undefined"!=typeof window&&(window.Thaw=t.default,window.Thaw.Block=d.default);
},{"./thaw":"rMvD","./block":"HI/m"}],"p2fr":[function(require,module,exports) {
"use strict";function r(r){if(Array.isArray(r))return r;var e=Object.keys(r),t=new Float32Array(e.length);for(var a in e)t[a]=r[e[a]];return t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=r;
},{}],"ZRo8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=require("./to-array"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}function u(e){return Math.max.apply(Math,(0,t.default)(e))}
},{"./to-array":"p2fr"}],"Ukn7":[function(require,module,exports) {
"use strict";function e(e){for(var t=0,r=0;r<e.length;r++)t+=e[r]*e[r];return t/e.length}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"lbYT":[function(require,module,exports) {
"use strict";function e(){return.4*Math.random()-.2}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"wZ0Y":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=require("./random-weight"),r=t(e);function t(e){return e&&e.__esModule?e:{default:e}}function u(e){for(var t=new Float32Array(e),u=0;u<e;u++)t[u]=(0,r.default)();return t}
},{"./random-weight":"lbYT"}],"zU45":[function(require,module,exports) {
"use strict";function e(e,r){for(var t=[];e<r;e++)t.push(e);return t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"+tZN":[function(require,module,exports) {
"use strict";function e(e){return new Float32Array(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"0FXz":[function(require,module,exports) {
"use strict";function r(r,t){if(this.length=0,t){this.prop=t;for(var e=this.table={},a=0;a<r.length;a++){var h=r[a][t];for(var s in h)e.hasOwnProperty(s)||(e[s]=this.length++)}}else if(Array.isArray(r[0]))for(var i=this.table={},n=0;n<r.length;n++)for(var l=r[n],o=0;o<l.length;o++){var f=l[o];for(var v in f)i.hasOwnProperty(v)||(i[v]=this.length++)}else for(var g=this.table={},p=0;p<r.length;p++){var y=r[p];for(var u in y)g.hasOwnProperty(u)||(g[u]=this.length++)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=r;
},{}],"e5ew":[function(require,module,exports) {
"use strict";function r(r){for(var o=[],t=0;t<r.length;t++)o.push(Float32Array.from(r[t]));return o}function o(r){for(var o=[],t=0;t<r.length;t++)o.push(Float32Array.from([r[t]]));return o}function t(r){return Float32Array.from(r)}function a(r,o,t){for(var a=[],e=0;e<r.length;e++){var n=r[e],s=new Float32Array(t);for(var u in n)n.hasOwnProperty(u)&&(s[o[u]]=n[u]);a.push(s)}return a}function e(r){var o=[];for(var t in r)o.push(Float32Array.from([r[t]]));return o}function n(r,o,t){var a=new Float32Array(t);for(var e in r)r.hasOwnProperty(e)&&(a[o[e]]=r[e]);return a}Object.defineProperty(exports,"__esModule",{value:!0}),exports.arraysToFloat32Arrays=r,exports.arrayToFloat32Arrays=o,exports.arrayToFloat32Array=t,exports.objectsToFloat32Arrays=a,exports.objectToFloat32Arrays=e,exports.objectToFloat32Array=n;
},{}],"23dQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),i=require("thaw.js"),e=b(i),s=require("./lookup"),r=b(s),u=require("./utilities/max"),a=b(u),n=require("./utilities/mse"),o=b(n),h=require("./utilities/randos"),l=b(h),p=require("./utilities/range"),c=b(p),f=require("./utilities/to-array"),g=b(f),v=require("./utilities/zeros"),y=b(v),k=require("./utilities/lookup-table"),d=b(k),L=require("./utilities/cast");function b(t){return t&&t.__esModule?t:{default:t}}function w(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var O=function(){function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};w(this,i),Object.assign(this,this.constructor.defaults,t),this.trainOpts={},this.updateTrainingOptions(Object.assign({},this.constructor.trainDefaults,t)),this.sizes=null,this.outputLayer=null,this.biases=null,this.weights=null,this.outputs=null,this.deltas=null,this.changes=null,this.errors=null,this.errorCheckInterval=1,this.constructor.prototype.hasOwnProperty("runInput")||(this.runInput=null),this.constructor.prototype.hasOwnProperty("calculateDeltas")||(this.calculateDeltas=null),this.inputLookup=null,this.inputLookupLength=null,this.outputLookup=null,this.outputLookupLength=null}return t(i,null,[{key:"trainDefaults",get:function(){return{iterations:2e4,errorThresh:.005,log:!1,logPeriod:10,learningRate:.3,momentum:.1,callback:null,callbackPeriod:10,timeout:1/0,praxis:null,beta1:.9,beta2:.999,epsilon:1e-8}}},{key:"defaults",get:function(){return{leakyReluAlpha:.01,binaryThresh:.5,hiddenLayers:null,activation:"sigmoid"}}}]),t(i,[{key:"initialize",value:function(){if(!this.sizes)throw new Error("Sizes must be set before initializing");this.outputLayer=this.sizes.length-1,this.biases=[],this.weights=[],this.outputs=[],this.deltas=[],this.changes=[],this.errors=[];for(var t=0;t<=this.outputLayer;t++){var i=this.sizes[t];if(this.deltas[t]=(0,y.default)(i),this.errors[t]=(0,y.default)(i),this.outputs[t]=(0,y.default)(i),t>0){this.biases[t]=(0,l.default)(i),this.weights[t]=new Array(i),this.changes[t]=new Array(i);for(var e=0;e<i;e++){var s=this.sizes[t-1];this.weights[t][e]=(0,l.default)(s),this.changes[t][e]=(0,y.default)(s)}}}this.setActivation(),"adam"===this.trainOpts.praxis&&this._setupAdam()}},{key:"setActivation",value:function(t){switch(this.activation=t||this.activation,this.activation){case"sigmoid":this.runInput=this.runInput||this._runInputSigmoid,this.calculateDeltas=this.calculateDeltas||this._calculateDeltasSigmoid;break;case"relu":this.runInput=this.runInput||this._runInputRelu,this.calculateDeltas=this.calculateDeltas||this._calculateDeltasRelu;break;case"leaky-relu":this.runInput=this.runInput||this._runInputLeakyRelu,this.calculateDeltas=this.calculateDeltas||this._calculateDeltasLeakyRelu;break;case"tanh":this.runInput=this.runInput||this._runInputTanh,this.calculateDeltas=this.calculateDeltas||this._calculateDeltasTanh;break;default:throw new Error("unknown activation "+this.activation+", The activation should be one of ['sigmoid', 'relu', 'leaky-relu', 'tanh']")}}},{key:"run",value:function(t){if(!this.isRunnable)return null;this.inputLookup&&(t=r.default.toArray(this.inputLookup,t,this.inputLookupLength));var i=this.runInput(t).slice(0);return this.outputLookup&&(i=r.default.toObject(this.outputLookup,i)),i}},{key:"_runInputSigmoid",value:function(t){this.outputs[0]=t;for(var i=null,e=1;e<=this.outputLayer;e++){for(var s=0;s<this.sizes[e];s++){for(var r=this.weights[e][s],u=this.biases[e][s],a=0;a<r.length;a++)u+=r[a]*t[a];this.outputs[e][s]=1/(1+Math.exp(-u))}i=t=this.outputs[e]}return i}},{key:"_runInputRelu",value:function(t){this.outputs[0]=t;for(var i=null,e=1;e<=this.outputLayer;e++){for(var s=0;s<this.sizes[e];s++){for(var r=this.weights[e][s],u=this.biases[e][s],a=0;a<r.length;a++)u+=r[a]*t[a];this.outputs[e][s]=u<0?0:u}i=t=this.outputs[e]}return i}},{key:"_runInputLeakyRelu",value:function(t){this.outputs[0]=t;for(var i=this.leakyReluAlpha,e=null,s=1;s<=this.outputLayer;s++){for(var r=0;r<this.sizes[s];r++){for(var u=this.weights[s][r],a=this.biases[s][r],n=0;n<u.length;n++)a+=u[n]*t[n];this.outputs[s][r]=a<0?0:i*a}e=t=this.outputs[s]}return e}},{key:"_runInputTanh",value:function(t){this.outputs[0]=t;for(var i=null,e=1;e<=this.outputLayer;e++){for(var s=0;s<this.sizes[e];s++){for(var r=this.weights[e][s],u=this.biases[e][s],a=0;a<r.length;a++)u+=r[a]*t[a];this.outputs[e][s]=Math.tanh(u)}i=t=this.outputs[e]}return i}},{key:"verifyIsInitialized",value:function(t){var i=this;this.sizes||(this.sizes=[],this.sizes.push(t[0].input.length),this.hiddenLayers?this.hiddenLayers.forEach(function(t){i.sizes.push(t)}):this.sizes.push(Math.max(3,Math.floor(t[0].input.length/2))),this.sizes.push(t[0].output.length),this.initialize())}},{key:"updateTrainingOptions",value:function(t){var i=this.constructor.trainDefaults;for(var e in i)i.hasOwnProperty(e)&&(this.trainOpts[e]=t.hasOwnProperty(e)?t[e]:i[e]);this.validateTrainingOptions(this.trainOpts),this.setLogMethod(t.log||this.trainOpts.log),this.activation=t.activation||this.activation}},{key:"validateTrainingOptions",value:function(t){var i={iterations:function(t){return"number"==typeof t&&t>0},errorThresh:function(t){return"number"==typeof t&&t>0&&t<1},log:function(t){return"function"==typeof t||"boolean"==typeof t},logPeriod:function(t){return"number"==typeof t&&t>0},learningRate:function(t){return"number"==typeof t&&t>0&&t<1},momentum:function(t){return"number"==typeof t&&t>0&&t<1},callback:function(t){return"function"==typeof t||null===t},callbackPeriod:function(t){return"number"==typeof t&&t>0},timeout:function(t){return"number"==typeof t&&t>0}};for(var e in i)if(i.hasOwnProperty(e)&&t.hasOwnProperty(e)&&!i[e](t[e]))throw new Error("["+e+", "+t[e]+"] is out of normal training range, your network will probably not train.")}},{key:"getTrainOptsJSON",value:function(){var t=this;return Object.keys(this.constructor.trainDefaults).reduce(function(i,e){return"timeout"===e&&t.trainOpts[e]===1/0?i:"callback"===e?i:(t.trainOpts[e]&&(i[e]=t.trainOpts[e]),"log"===e&&(i.log="function"==typeof i.log),i)},{})}},{key:"setLogMethod",value:function(t){this.trainOpts.log="function"==typeof t?t:!!t&&console.log}},{key:"calculateTrainingError",value:function(t){for(var i=0,e=0;e<t.length;++e)i+=this.trainPattern(t[e],!0);return i/t.length}},{key:"trainPatterns",value:function(t){for(var i=0;i<t.length;++i)this.trainPattern(t[i])}},{key:"trainingTick",value:function(t,i,e){return!(i.iterations>=this.trainOpts.iterations||i.error<=this.trainOpts.errorThresh||Date.now()>=e)&&(i.iterations++,this.trainOpts.log&&i.iterations%this.trainOpts.logPeriod==0?(i.error=this.calculateTrainingError(t),this.trainOpts.log("iterations: "+i.iterations+", training error: "+i.error)):i.iterations%this.errorCheckInterval==0?i.error=this.calculateTrainingError(t):this.trainPatterns(t),this.trainOpts.callback&&i.iterations%this.trainOpts.callbackPeriod==0&&this.trainOpts.callback({iterations:i.iterations,error:i.error}),!0)}},{key:"prepTraining",value:function(t,i){this.updateTrainingOptions(i),t=this.formatData(t);var e=Date.now()+this.trainOpts.timeout;return this.verifyIsInitialized(t),{data:t,status:{error:1,iterations:0},endTime:e}}},{key:"train",value:function(t){var i,e,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.prepTraining(t,s);for(t=r.data,i=r.status,e=r.endTime;this.trainingTick(t,i,e););return i}},{key:"trainAsync",value:function(t){var i,s,r=this,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.prepTraining(t,u);return t=a.data,i=a.status,s=a.endTime,new Promise(function(u,a){try{var n=new e.default(new Array(r.trainOpts.iterations),{delay:!0,each:function(){return r.trainingTick(t,i,s)||n.stop()},done:function(){return u(i)}});n.tick()}catch(o){a({trainError:o,status:i})}})}},{key:"trainPattern",value:function(t,i){return this.runInput(t.input),this.calculateDeltas(t.output),this.adjustWeights(),i?(0,o.default)(this.errors[this.outputLayer]):null}},{key:"_calculateDeltasSigmoid",value:function(t){for(var i=this.outputLayer;i>=0;i--)for(var e=0;e<this.sizes[i];e++){var s=this.outputs[i][e],r=0;if(i===this.outputLayer)r=t[e]-s;else for(var u=this.deltas[i+1],a=0;a<u.length;a++)r+=u[a]*this.weights[i+1][a][e];this.errors[i][e]=r,this.deltas[i][e]=r*s*(1-s)}}},{key:"_calculateDeltasRelu",value:function(t){for(var i=this.outputLayer;i>=0;i--)for(var e=0;e<this.sizes[i];e++){var s=this.outputs[i][e],r=0;if(i===this.outputLayer)r=t[e]-s;else for(var u=this.deltas[i+1],a=0;a<u.length;a++)r+=u[a]*this.weights[i+1][a][e];this.errors[i][e]=r,this.deltas[i][e]=s>0?r:0}}},{key:"_calculateDeltasLeakyRelu",value:function(t){for(var i=this.leakyReluAlpha,e=this.outputLayer;e>=0;e--)for(var s=0;s<this.sizes[e];s++){var r=this.outputs[e][s],u=0;if(e===this.outputLayer)u=t[s]-r;else for(var a=this.deltas[e+1],n=0;n<a.length;n++)u+=a[n]*this.weights[e+1][n][s];this.errors[e][s]=u,this.deltas[e][s]=r>0?u:i*u}}},{key:"_calculateDeltasTanh",value:function(t){for(var i=this.outputLayer;i>=0;i--)for(var e=0;e<this.sizes[i];e++){var s=this.outputs[i][e],r=0;if(i===this.outputLayer)r=t[e]-s;else for(var u=this.deltas[i+1],a=0;a<u.length;a++)r+=u[a]*this.weights[i+1][a][e];this.errors[i][e]=r,this.deltas[i][e]=(1-s*s)*r}}},{key:"adjustWeights",value:function(){for(var t=1;t<=this.outputLayer;t++)for(var i=this.outputs[t-1],e=0;e<this.sizes[t];e++){for(var s=this.deltas[t][e],r=0;r<i.length;r++){var u=this.changes[t][e][r];u=this.trainOpts.learningRate*s*i[r]+this.trainOpts.momentum*u,this.changes[t][e][r]=u,this.weights[t][e][r]+=u}this.biases[t][e]+=this.trainOpts.learningRate*s}}},{key:"_setupAdam",value:function(){this.biasChangesLow=[],this.biasChangesHigh=[],this.changesLow=[],this.changesHigh=[],this.iterations=0;for(var t=0;t<=this.outputLayer;t++){var i=this.sizes[t];if(t>0){this.biasChangesLow[t]=(0,y.default)(i),this.biasChangesHigh[t]=(0,y.default)(i),this.changesLow[t]=new Array(i),this.changesHigh[t]=new Array(i);for(var e=0;e<i;e++){var s=this.sizes[t-1];this.changesLow[t][e]=(0,y.default)(s),this.changesHigh[t][e]=(0,y.default)(s)}}}this.adjustWeights=this._adjustWeightsAdam}},{key:"_adjustWeightsAdam",value:function(){var t=this.trainOpts;this.iterations++;for(var i=1;i<=this.outputLayer;i++)for(var e=this.outputs[i-1],s=0;s<this.sizes[i];s++){for(var r=this.deltas[i][s],u=0;u<e.length;u++){var a=r*e[u],n=this.changesLow[i][s][u]*t.beta1+(1-t.beta1)*a,o=this.changesHigh[i][s][u]*t.beta2+(1-t.beta2)*a*a,h=n/(1-Math.pow(t.beta1,this.iterations)),l=o/(1-Math.pow(t.beta2,this.iterations));this.changesLow[i][s][u]=n,this.changesHigh[i][s][u]=o,this.weights[i][s][u]+=this.trainOpts.learningRate*h/(Math.sqrt(l)+t.epsilon)}var p=this.deltas[i][s],c=this.biasChangesLow[i][s]*t.beta1+(1-t.beta1)*p,f=this.biasChangesHigh[i][s]*t.beta2+(1-t.beta2)*p*p,g=this.biasChangesLow[i][s]/(1-Math.pow(t.beta1,this.iterations)),v=this.biasChangesHigh[i][s]/(1-Math.pow(t.beta2,this.iterations));this.biasChangesLow[i][s]=c,this.biasChangesHigh[i][s]=f,this.biases[i][s]+=t.learningRate*g/(Math.sqrt(v)+t.epsilon)}}},{key:"formatData",value:function(t){if(Array.isArray(t)||(t=[t]),!Array.isArray(t[0].input))if(this.inputLookup)this.inputLookupLength=Object.keys(this.inputLookup).length;else{var i=new d.default(t,"input");this.inputLookup=i.table,this.inputLookupLength=i.length}if(!Array.isArray(t[0].output))if(this.outputLookup)this.outputLookupLength=Object.keys(this.outputLookup).length;else{var e=new d.default(t,"output");this.outputLookup=e.table,this.outputLookupLength=e.length}if(void 0===this._formatInput&&(this._formatInput=m(t[0].input,this.inputLookup),this._formatOutput=m(t[0].output,this.outputLookup)),this._formatInput&&this._formatOutput){for(var s=[],r=0;r<t.length;r++)s.push({input:this._formatInput(t[r].input),output:this._formatOutput(t[r].output)});return s}if(this._formatInput){for(var u=[],a=0;a<t.length;a++)u.push({input:this._formatInput(t[a].input),output:t[a].output});return u}if(this._formatOutput){for(var n=[],o=0;o<t.length;o++)n.push({input:t[o].input,output:this._formatOutput(t[o].output)});return n}return t}},{key:"addFormat",value:function(t){this.inputLookup=r.default.addKeys(t.input,this.inputLookup),this.inputLookup&&(this.inputLookupLength=Object.keys(this.inputLookup).length),this.outputLookup=r.default.addKeys(t.output,this.outputLookup),this.outputLookup&&(this.outputLookupLength=Object.keys(this.outputLookup).length)}},{key:"test",value:function(t){var i=this,e=1===(t=this.formatData(t))[0].output.length,s=[],r=0;if(e){for(var u=0,n=0,h=0,l=0,p=function(e){var a=i.runInput(t[e].input),p=t[e].output,c=a[0]>i.binaryThresh?1:0,f=p[0];if(c!==f){var g=t[e];s.push({input:g.input,output:g.output,actual:c,expected:f})}0===c&&0===f?l++:1===c&&1===f?h++:0===c&&1===f?n++:1===c&&0===f&&u++,r+=(0,o.default)(a.map(function(t,i){return p[i]-t}))},c=0;c<t.length;c++)p(c);return{error:r/t.length,misclasses:s,total:t.length,trueNeg:l,truePos:h,falseNeg:n,falsePos:u,precision:h>0?h/(h+u):0,recall:h>0?h/(h+n):0,accuracy:(l+h)/t.length}}var f=function(e){var u=i.runInput(t[e].input),n=t[e].output,h=u.indexOf((0,a.default)(u)),l=n.indexOf((0,a.default)(n));if(h!==l){var p=t[e];s.push({input:p.input,output:p.output,actual:h,expected:l})}r+=(0,o.default)(u.map(function(t,i){return n[i]-t}))};for(c=0;c<t.length;c++)f(c);return{error:r/t.length,misclasses:s,total:t.length}}},{key:"toJSON",value:function(){for(var t=[],i=0;i<=this.outputLayer;i++){t[i]={};var e=void 0;e=0===i&&this.inputLookup?Object.keys(this.inputLookup):this.outputLookup&&i===this.outputLayer?Object.keys(this.outputLookup):(0,c.default)(0,this.sizes[i]);for(var s=0;s<e.length;s++){var r=e[s];if(t[i][r]={},i>0)for(var u in t[i][r].bias=this.biases[i][s],t[i][r].weights={},t[i-1]){var a=u;1===i&&this.inputLookup&&(a=this.inputLookup[u]),t[i][r].weights[u]=this.weights[i][s][a]}}}return{sizes:this.sizes.slice(0),layers:t,outputLookup:null!==this.outputLookup,inputLookup:null!==this.inputLookup,activation:this.activation,trainOpts:this.getTrainOptsJSON()}}},{key:"fromJSON",value:function(t){Object.assign(this,this.constructor.defaults,t),this.sizes=t.sizes,this.initialize();for(var i=0;i<=this.outputLayer;i++){var e=t.layers[i];if(0!==i||e[0]&&!t.inputLookup?i!==this.outputLayer||e[0]&&!t.outputLookup||(this.outputLookup=r.default.toHash(e)):(this.inputLookup=r.default.toHash(e),this.inputLookupLength=Object.keys(this.inputLookup).length),i>0){var s=Object.keys(e);for(var u in this.sizes[i]=s.length,s){var a=s[u];this.biases[i][u]=e[a].bias,this.weights[i][u]=(0,g.default)(e[a].weights)}}}return t.hasOwnProperty("trainOpts")&&this.updateTrainingOptions(t.trainOpts),this}},{key:"toFunction",value:function(){var t=this.activation,i=this.leakyReluAlpha,e=!1;function s(r,u,a){if(0===u)return"string"==typeof a?"input['"+a+"']":"input["+a+"]";var n=r[u][a],o=["(",n.bias];for(var h in n.weights)n.weights[h]<0?o.push(n.weights[h]+"*"+s(r,u-1,h)):o.push("+"+n.weights[h]+"*"+s(r,u-1,h));switch(o.push(")"),t){case"sigmoid":return"1/(1+1/Math.exp("+o.join("")+"))";case"relu":return e=!0,"((v="+o.join("")+")<0?0:v)";case"leaky-relu":return e=!0,"((v="+o.join("")+")<0?0:"+i+"*v)";case"tanh":return"Math.tanh("+o.join("")+")";default:throw new Error("unknown activation type "+t)}}var r=this.toJSON().layers,u=[],a=void 0;for(var n in r[r.length-1])u.push(s(r,r.length-1,n));return a=this.outputLookup?"{"+Object.keys(this.outputLookup).map(function(t,i){return"'"+t+"':"+u[i]})+"}":"["+u.join(",")+"]",new Function("input",(e?"var v;":"")+"return "+a+";")}},{key:"isRunnable",get:function(){var t=this;if(!this.runInput)return console.error("Activation function has not been initialized, did you run train()?"),!1;var i=["sizes","outputLayer","biases","weights","outputs","deltas","changes","errors"].filter(function(i){return null===t[i]});return!(i.length>0)||(console.error("Some settings have not been initialized correctly, did you run train()? Found issues with: "+i.join(", ")),!1)}}]),i}();function m(t,i){if(t.buffer instanceof ArrayBuffer)return null;if(Array.isArray(t))return L.arrayToFloat32Array;var e=Object.keys(i).length;return function(t){var s=new Float32Array(e);for(var r in i)s[i[r]]=t[r]||0;return s}}exports.default=O;
},{"thaw.js":"a+hJ","./lookup":"yeLe","./utilities/max":"ZRo8","./utilities/mse":"Ukn7","./utilities/randos":"wZ0Y","./utilities/range":"zU45","./utilities/to-array":"p2fr","./utilities/zeros":"+tZN","./utilities/lookup-table":"0FXz","./utilities/cast":"e5ew"}],"jPkF":[function(require,module,exports) {
"use strict";var e=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var t=function(){function t(){n(this,t)}return e(t,null,[{key:"isCanvas",value:function(e){return null!==e&&(e.nodeName&&e.getContext&&"CANVAS"===e.nodeName.toUpperCase()||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}},{key:"isCanvasSupported",value:function(){return r}},{key:"initCanvas",value:function(){if(!r)return null;var e="undefined"!=typeof document?document.createElement("canvas"):new OffscreenCanvas(0,0);return e.width=2,e.height=2,e}},{key:"isWebGl",value:function(e){return e&&"function"==typeof e.getExtension}},{key:"isWebGl2",value:function(e){return e&&"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext}},{key:"isWebGlSupported",value:function(){return u}},{key:"isWebGl2Supported",value:function(){return o}},{key:"isWebGlDrawBuffersSupported",value:function(){return l}},{key:"initWebGlDefaultOptions",value:function(){return{alpha:!1,depth:!1,antialias:!1}}},{key:"initWebGl",value:function(e){if((void 0!==r||null===e)&&!r)return null;if(!t.isCanvas(e))throw new Error("Invalid canvas object - "+e);var n=null,i=t.initWebGlDefaultOptions();try{n=e.getContext("experimental-webgl",i)}catch(a){}return null===n&&(n=e.getContext("webgl2",i)||e.getContext("webgl",i)),n&&(n.OES_texture_float=n.getExtension("OES_texture_float"),n.OES_texture_float_linear=n.getExtension("OES_texture_float_linear"),n.OES_element_index_uint=n.getExtension("OES_element_index_uint")),n}},{key:"initWebGl2",value:function(e){if((void 0!==r||null===e)&&!r)return null;if(!t.isCanvas(e))throw new Error("Invalid canvas object - "+e);return e.getContext("webgl2",t.initWebGlDefaultOptions())}},{key:"checkOutput",value:function(e){if(!e||!Array.isArray(e))throw new Error("kernel.output not an array");for(var n=0;n<e.length;n++)if(isNaN(e[n])||e[n]<1)throw new Error("kernel.output["+n+"] incorrectly defined as `"+e[n]+"`, needs to be numeric, and greater than 0")}}]),t}(),r="undefined"!=typeof document?t.isCanvas(document.createElement("canvas")):"undefined"!=typeof OffscreenCanvas,i=t.initWebGl(t.initCanvas()),a=t.initWebGl2(t.initCanvas()),u=t.isWebGl(i),o=t.isWebGl2(a),l=u&&Boolean(i.getExtension("WEBGL_draw_buffers"));u?(t.OES_texture_float=i.OES_texture_float,t.OES_texture_float_linear=i.OES_texture_float_linear,t.OES_element_index_uint=i.OES_element_index_uint):(t.OES_texture_float=!1,t.OES_texture_float_linear=!1,t.OES_element_index_uint=!1),module.exports=t;
},{}],"mMKb":[function(require,module,exports) {
"use strict";function s(s,i){if(!(s instanceof i))throw new TypeError("Cannot call a class as a function")}module.exports=function i(t,e){if(s(this,i),this.value=t,Array.isArray(e)){this.size=[];for(var h=0;h<e.length;h++)this.size[h]=e[h];for(;this.size.length<3;)this.size.push(1)}else e.z?this.size=[e.x,e.y,e.z]:e.y?this.size=[e.x,e.y,1]:this.size=[e.x,1,1]};
},{}],"ByaE":[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}module.exports=function(){function r(e,n,i,u,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NumberTexture";t(this,r),this.texture=e,this.size=n,this.dimensions=i,this.output=u,this.webGl=o,this.kernel=null,this.type=s}return e(r,[{key:"toArray",value:function(e){if(!e)throw new Error("You need to pass the GPU object for toArray to work.");return this.kernel?this.kernel(this):(this.kernel=e.createKernel(function(e){return e[this.thread.z][this.thread.y][this.thread.x]}).setOutput(this.output),this.kernel(this))}},{key:"delete",value:function(){return this.webGl.deleteTexture(this.texture)}}]),r}();
},{}],"hsMx":[function(require,module,exports) {
"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=require("./utils-core"),i=require("./input"),a=require("./texture"),l=/function ([^(]*)/,f=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,c=/([^\s,]+)/g,s=function(){var e=new ArrayBuffer(4),t=new Uint32Array(e),n=new Uint8Array(e);if(t[0]=3735928559,239===n[0])return"LE";if(222===n[0])return"BE";throw new Error("unknown endianness")}(),y=null,p=null,v=function(){try{return new Function("let i = 1; const j = 1;")(),!0}catch(e){return!1}}(),d=null,h=function(h){function m(){return n(this,m),r(this,(m.__proto__||Object.getPrototypeOf(m)).apply(this,arguments))}return o(m,u),t(m,null,[{key:"systemEndianness",value:function(){return s}},{key:"isFunction",value:function(e){return"function"==typeof e}},{key:"isFunctionString",value:function(e){return null!==e&&"function"===e.toString().slice(0,"function".length).toLowerCase()}},{key:"getFunctionNameFromString",value:function(e){return l.exec(e)[1]}},{key:"getFunctionBodyFromString",value:function(e){return e.substring(e.indexOf("{")+1,e.lastIndexOf("}"))}},{key:"getParamNamesFromString",value:function(e){var t=e.toString().replace(f,""),n=t.slice(t.indexOf("(")+1,t.indexOf(")")).match(c);return null===n&&(n=[]),n}},{key:"clone",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":e(t))||t.hasOwnProperty("isActiveClone"))return t;var n=t.constructor();for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(t.isActiveClone=null,n[r]=m.clone(t[r]),delete t.isActiveClone);return n}},{key:"newPromise",value:function(e){var t=Promise||small_promise;if(null===t)throw TypeError("Browser is missing Promise implementation. Consider adding small_promise.js polyfill");return new t(e)}},{key:"functionBinder",value:function(e,t){return e.bind?e.bind(t):function(){var n=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);return e.apply(t,n)}}},{key:"isArray",value:function(e){return!isNaN(e.length)}},{key:"getArgumentType",value:function(e){return m.isArray(e)?"IMG"===e[0].nodeName?"HTMLImageArray":"Array":"number"==typeof e?Number.isInteger(e)?"Integer":"Float":e instanceof a?e.type:e instanceof i?"Input":"IMG"===e.nodeName?"HTMLImage":"Unknown"}},{key:"isFloatReadPixelsSupported",value:function(){if(null!==y)return y;var e=new(require("../index"))({mode:"webgl-validator"}),t=e.createKernel(function(){return 1},{output:[2],floatTextures:!0,floatOutput:!0,floatOutputForce:!0})();return y=1===t[0],e.destroy(),y}},{key:"isFloatReadPixelsSupportedWebGL2",value:function(){if(null!==p)return p;var e=new(require("../index"))({mode:"webgl2-validator"}),t=e.createKernel(function(){return 1},{output:[2],floatTextures:!0,floatOutput:!0,floatOutputForce:!0})();return p=1===t[0],e.destroy(),p}},{key:"hasIntegerDivisionAccuracyBug",value:function(){if(null!==d)return d;var e=new(require("../index"))({mode:"webgl-validator"}),t=e.createKernel(function(e,t){return e[this.thread.x]/t[this.thread.x]},{output:[1]})([6,6030401],[3,3991]);return d=2!==t[0]||1511!==t[1],e.destroy(),d}},{key:"isMixedIdentifiersSupported",value:function(){return v}},{key:"dimToTexSize",value:function(e,t,n){for(var r=t[0],o=t[0],u=t[1],i=1;i<t.length;i++)r*=t[i];if(!e.floatTextures||n&&!e.floatOutput||(o=r=Math.ceil(r/4)),u>1&&o*u===r)return[o,u];for(var a=Math.sqrt(r),l=Math.ceil(a),f=Math.floor(a);l*f>r;)l--,f=Math.ceil(r/l);return[o=f,u=Math.ceil(r/o)]}},{key:"getDimensions",value:function(e,t){var n=void 0;if(m.isArray(e)){for(var r=[],o=e;m.isArray(o);)r.push(o.length),o=o[0];n=r.reverse()}else if(e instanceof a)n=e.output;else{if(!(e instanceof i))throw"Unknown dimensions of "+e;n=e.size}if(t)for(n=m.clone(n);n.length<3;)n.push(1);return new Int32Array(n)}},{key:"pad",value:function(e,t){function n(e){return Array.apply(null,new Array(e)).map(Number.prototype.valueOf,0)}for(var r=e.length+2*t,o=e.map(function(e){return[].concat(n(t),e,n(t))}),u=0;u<t;u++)o=[].concat([n(r)],o,[n(r)]);return o}},{key:"flatten2dArrayTo",value:function(e,t){for(var n=0,r=0;r<e.length;r++)t.set(e[r],n),n+=e[r].length}},{key:"flatten3dArrayTo",value:function(e,t){for(var n=0,r=0;r<e.length;r++)for(var o=0;o<e[r].length;o++)t.set(e[r][o],n),n+=e[r][o].length}},{key:"flattenTo",value:function(e,t){m.isArray(e[0])?m.isArray(e[0][0])?m.flatten3dArrayTo(e,t):m.flatten2dArrayTo(e,t):t.set(e)}},{key:"splitArray",value:function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(new e.constructor(e.buffer,4*r+e.byteOffset,t));return n}},{key:"getAstString",value:function(e,t){var n=Array.isArray(e)?e:e.split(/\r?\n/g),r=t.loc.start,o=t.loc.end,u=[];u.push(n[r.line-1].slice(r.column));for(var i=r.line;i<o.line-1;i++)u.push(n[i]);return u.push(n[o.line-1].slice(0,o.column)),u.join("\n")}},{key:"allPropertiesOf",value:function(e){var t=[];do{t.push.apply(t,Object.getOwnPropertyNames(e))}while(e=Object.getPrototypeOf(e));return t}}]),m}();Object.assign(h,u),module.exports=h;
},{"./utils-core":"jPkF","./input":"mMKb","./texture":"ByaE","../index":"ieip"}],"Ar/k":[function(require,module,exports) {
"use strict";var n=require("../core/utils");module.exports=function(e){var r=function(){return e.run.apply(e,arguments)};return n.allPropertiesOf(e).forEach(function(n){"_"===n[0]&&"_"===n[1]||("function"==typeof e[n]?r[n]="add"===n.substring(0,3)||"set"===n.substring(0,3)?function(){return e[n].apply(e,arguments),r}:e[n].bind(e):(r.__defineGetter__(n,function(){return e[n]}),r.__defineSetter__(n,function(r){e[n]=r})))}),r.kernel=e,r};
},{"../core/utils":"hsMx"}],"6CY0":[function(require,module,exports) {
"use strict";var e=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var t=require("../core/utils"),r=require("./kernel-run-shortcut");module.exports=function(){function i(e,r){n(this,i),r=r||{},this.kernel=r.kernel,this.canvas=r.canvas,this.webGl=r.webGl,this.fn=null,this.functionBuilder=e,this.fnString=null,this.endianness=t.systemEndianness()}return e(i,[{key:"textureToArray",value:function(e){return this.createKernel(function(e){return e[this.thread.z][this.thread.y][this.thread.x]})(e)}},{key:"deleteTexture",value:function(e){this.webGl.deleteTexture(e.texture)}},{key:"buildPromiseKernel",value:function(){throw new Error("not yet implemented")}},{key:"getMode",value:function(){throw new Error('"mode" not implemented on BaseRunner')}},{key:"buildKernel",value:function(e,n){n=Object.assign({},n||{});var t=e.toString();return n.functionBuilder||(n.functionBuilder=this.functionBuilder),n.canvas||(n.canvas=this.canvas),n.webGl||(n.webGl=this.webgl),r(new this.Kernel(t,n))}}]),i}();
},{"../core/utils":"hsMx","./kernel-run-shortcut":"Ar/k"}],"ZzEd":[function(require,module,exports) {
"use strict";var t=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}();function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=require("../core/utils"),s=require("../core/input");module.exports=function(){function u(t,s){for(var i in e(this,u),this.paramNames=n.getParamNamesFromString(t),this.fnString=t,this.output=null,this.debug=!1,this.graphical=!1,this.loopMaxIterations=0,this.constants=null,this.wraparound=null,this.hardcodeConstants=null,this.outputToTexture=null,this.outputImmutable=null,this.texSize=null,this._canvas=null,this._webGl=null,this.threadDim=null,this.floatTextures=null,this.floatOutput=null,this.floatOutputForce=null,this.addFunction=null,this.functions=null,this.nativeFunctions=null,this.subKernels=null,this.subKernelProperties=null,this.subKernelNames=null,this.subKernelOutputVariableNames=null,this.functionBuilder=null,this.paramTypes=null,this.paramSizes=null,this.constantTypes=null,this.fixIntegerDivisionAccuracy=null,s)s.hasOwnProperty(i)&&this.hasOwnProperty(i)&&(this[i]=s[i]);s.hasOwnProperty("canvas")&&(this._canvas=s.canvas),s.hasOwnProperty("webGl")&&(this._webGl=s.webGl),s.hasOwnProperty("output")&&this.setOutput(s.output),this._canvas||(this._canvas=n.initCanvas())}return t(u,[{key:"build",value:function(){throw new Error('"build" not defined on Base')}},{key:"setupParams",value:function(t){this.paramTypes=[],this.paramSizes=[];for(var e=0;e<t.length;e++){var u=t[e];this.paramTypes.push(n.getArgumentType(u)),this.paramSizes.push(u.constructor===s?u.size:null)}}},{key:"setupConstants",value:function(){if(this.constantTypes={},this.constants)for(var t in this.constants)this.constantTypes[t]=n.getArgumentType(this.constants[t])}},{key:"setFunctions",value:function(t){return this.functions=t,this}},{key:"setOutput",value:function(t){return t.hasOwnProperty("x")?t.hasOwnProperty("y")?t.hasOwnProperty("z")?this.output=[t.x,t.y,t.z]:this.output=[t.x,t.y]:this.output=[t.x]:this.output=t,this}},{key:"setDebug",value:function(t){return this.debug=t,this}},{key:"setGraphical",value:function(t){return this.graphical=t,this}},{key:"setLoopMaxIterations",value:function(t){return this.loopMaxIterations=t,this}},{key:"setFixIntegerDivisionAccuracy",value:function(t){return this.fixIntegerDivisionAccuracy=t,this}},{key:"setConstants",value:function(t){return this.constants=t,this}},{key:"setWraparound",value:function(t){return console.warn("Wraparound mode is not supported and undocumented."),this.wraparound=t,this}},{key:"setHardcodeConstants",value:function(t){return this.hardcodeConstants=t,this}},{key:"setOutputToTexture",value:function(t){return this.outputToTexture=t,this}},{key:"setOutputImmutable",value:function(t){return this.outputImmutable=t,this}},{key:"setFloatTextures",value:function(t){return this.floatTextures=t,this}},{key:"setFloatOutput",value:function(t){return this.floatOutput=t,this}},{key:"setFloatOutputForce",value:function(t){return this.floatOutputForce=t,this}},{key:"setCanvas",value:function(t){return this._canvas=t,this}},{key:"setWebGl",value:function(t){return this._webGl=t,this}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getWebGl",value:function(){return this._webGl}},{key:"validateOptions",value:function(){throw new Error("validateOptions not defined")}},{key:"exec",value:function(){return this.execute.apply(this,arguments)}},{key:"execute",value:function(){var t=this,e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);return n.newPromise(function(n,s){try{n(t.run.apply(t,e))}catch(u){s(u)}})}},{key:"addSubKernel",value:function(t){return null===this.subKernels&&(this.subKernels=[],this.subKernelNames=[]),this.subKernels.push(t),this.subKernelNames.push(n.getFunctionNameFromString(t)),this}},{key:"addSubKernelProperty",value:function(t,e){if(null===this.subKernelProperties&&(this.subKernelProperties={},this.subKernelNames=[]),this.subKernelProperties.hasOwnProperty(t))throw new Error("cannot add sub kernel "+t+", already defined");return this.subKernelProperties[t]=e,this.subKernelNames.push(n.getFunctionNameFromString(e)),this}},{key:"addNativeFunction",value:function(t,e){this.functionBuilder.addNativeFunction(t,e)}},{key:"destroy",value:function(){}}]),u}();
},{"../core/utils":"hsMx","../core/input":"mMKb"}],"r8Fr":[function(require,module,exports) {
"use strict";module.exports="__HEADER__;\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nconst float LOOP_MAX = __LOOP_MAX__;\n\n__CONSTANTS__;\n\nvarying vec2 vTexCoord;\n\nvec4 round(vec4 x) {\n  return floor(x + 0.5);\n}\n\nfloat round(float x) {\n  return floor(x + 0.5);\n}\n\nvec2 integerMod(vec2 x, float y) {\n  vec2 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec3 integerMod(vec3 x, float y) {\n  vec3 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec4 integerMod(vec4 x, vec4 y) {\n  vec4 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nfloat integerMod(float x, float y) {\n  float res = floor(mod(x, y));\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n}\n\nint integerMod(int x, int y) {\n  return x - (y * int(x / y));\n}\n\n__DIVIDE_WITH_INTEGER_CHECK__;\n\n// Here be dragons!\n// DO NOT OPTIMIZE THIS CODE\n// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\nfloat decode32(vec4 rgba) {\n  __DECODE32_ENDIANNESS__;\n  rgba *= 255.0;\n  vec2 gte128;\n  gte128.x = rgba.b >= 128.0 ? 1.0 : 0.0;\n  gte128.y = rgba.a >= 128.0 ? 1.0 : 0.0;\n  float exponent = 2.0 * rgba.a - 127.0 + dot(gte128, MAGIC_VEC);\n  float res = exp2(round(exponent));\n  rgba.b = rgba.b - 128.0 * gte128.x;\n  res = dot(rgba, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\n  res *= gte128.y * -2.0 + 1.0;\n  return res;\n}\n\nvec4 encode32(float f) {\n  float F = abs(f);\n  float sign = f < 0.0 ? 1.0 : 0.0;\n  float exponent = floor(log2(F));\n  float mantissa = (exp2(-exponent) * F);\n  // exponent += floor(log2(mantissa));\n  vec4 rgba = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n  rgba.rg = integerMod(rgba.rg, 256.0);\n  rgba.b = integerMod(rgba.b, 128.0);\n  rgba.a = exponent*0.5 + 63.5;\n  rgba.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n  rgba = floor(rgba);\n  rgba *= 0.003921569; // 1/255\n  __ENCODE32_ENDIANNESS__;\n  return rgba;\n}\n// Dragons end here\n\nfloat decode(vec4 rgba, int x, int bitRatio) {\n  if (bitRatio == 1) {\n    return decode32(rgba);\n  }\n  __DECODE32_ENDIANNESS__;\n  int channel = integerMod(x, bitRatio);\n  if (bitRatio == 4) {\n    if (channel == 0) return rgba.r * 255.0;\n    if (channel == 1) return rgba.g * 255.0;\n    if (channel == 2) return rgba.b * 255.0;\n    if (channel == 3) return rgba.a * 255.0;\n  }\n  else {\n    if (channel == 0) return rgba.r * 255.0 + rgba.g * 65280.0;\n    if (channel == 1) return rgba.b * 255.0 + rgba.a * 65280.0;\n  }\n}\n\nint index;\nivec3 threadId;\n\nivec3 indexTo3D(int idx, ivec3 texDim) {\n  int z = int(idx / (texDim.x * texDim.y));\n  idx -= z * int(texDim.x * texDim.y);\n  int y = int(idx / texDim.x);\n  int x = int(integerMod(idx, texDim.x));\n  return ivec3(x, y, z);\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio,  int z, int y, int x) {\n  ivec3 xyz = ivec3(x, y, z);\n  __GET_WRAPAROUND__;\n  int index = xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z);\n  __GET_TEXTURE_CHANNEL__;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  vec4 texel = texture2D(tex, st / vec2(texSize));\n  __GET_RESULT__;\n  \n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  ivec3 xyz = ivec3(x, y, z);\n  __GET_WRAPAROUND__;\n  int index = xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z);\n  __GET_TEXTURE_CHANNEL__;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  return texture2D(tex, st / vec2(texSize));\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, int y, int x) {\n  return get(tex, texSize, texDim, bitRatio, int(0), y, x);\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int y, int x) {\n  return getImage2D(tex, texSize, texDim, int(0), y, x);\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, int x) {\n  return get(tex, texSize, texDim, bitRatio, int(0), int(0), x);\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int x) {\n  return getImage2D(tex, texSize, texDim, int(0), int(0), x);\n}\n\n\nvec4 actualColor;\nvoid color(float r, float g, float b, float a) {\n  actualColor = vec4(r,g,b,a);\n}\n\nvoid color(float r, float g, float b) {\n  color(r,g,b,1.0);\n}\n\nvoid color(sampler2D image) {\n  actualColor = texture2D(image, vTexCoord);\n}\n\n__MAIN_PARAMS__;\n__MAIN_CONSTANTS__;\n__KERNEL__;\n\nvoid main(void) {\n  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n  __MAIN_RESULT__;\n}";
},{}],"40l2":[function(require,module,exports) {
"use strict";module.exports="precision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nattribute vec2 aPos;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\nuniform vec2 ratio;\n\nvoid main(void) {\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n  vTexCoord = aTexCoord;\n}";
},{}],"MHbP":[function(require,module,exports) {
"use strict";var t=require("../../core/utils"),n=require("../kernel-run-shortcut"),e=require("../../core/input"),r=require("../../core/texture");function i(t){return/^function /.test(t)&&(t=t.substring(9)),t.replace(/[_]typeof/g,"typeof")}function s(t){return t.replace(/[_]typeof/g,"typeof")}module.exports=function(e,r){return"() => {\n    "+n.toString()+";\n    const utils = {\n      allPropertiesOf: "+s(t.allPropertiesOf.toString())+",\n      clone: "+s(t.clone.toString())+",\n      splitArray: "+s(t.splitArray.toString())+",\n      getArgumentType: "+s(t.getArgumentType.toString())+",\n      getDimensions: "+s(t.getDimensions.toString())+",\n      dimToTexSize: "+s(t.dimToTexSize.toString())+",\n      flattenTo: "+s(t.flattenTo.toString())+",\n      flatten2dArrayTo: "+s(t.flatten2dArrayTo.toString())+",\n      flatten3dArrayTo: "+s(t.flatten3dArrayTo.toString())+",\n      systemEndianness: '"+s(t.systemEndianness())+"',\n      initWebGl: "+s(t.initWebGl.toString())+",\n      isArray: "+s(t.isArray.toString())+",\n      checkOutput: "+s(t.checkOutput.toString())+"\n    };\n    const Utils = utils;\n    const canvases = [];\n    const maxTexSizes = {};\n    let Texture = function() {};\n    let Input = function() {}; \n    class "+(r||"Kernel")+" {\n      constructor() {\n        this.maxTexSize = null;\n        this.argumentsLength = 0;\n        this.constantsLength = 0;\n        this._canvas = null;\n        this._webGl = null;\n        this.program = null;\n        this.outputToTexture = "+(e.outputToTexture?"true":"false")+";\n        this.paramNames = "+JSON.stringify(e.paramNames)+";\n        this.paramTypes = "+JSON.stringify(e.paramTypes)+";\n        this.texSize = "+JSON.stringify(e.texSize)+";\n        this.output = "+JSON.stringify(e.output)+";\n        this.compiledFragShaderString = `"+e.compiledFragShaderString+"`;\n\t\t    this.compiledVertShaderString = `"+e.compiledVertShaderString+"`;\n\t\t    this.programUniformLocationCache = {};\n\t\t    this.textureCache = {};\n\t\t    this.subKernelOutputTextures = null;\n\t\t    this.subKernelOutputVariableNames = null;\n\t\t    this.uniform1fCache = {};\n\t\t    this.uniform1iCache = {};\n\t\t    this.uniform2fCache = {};\n\t\t    this.uniform2fvCache = {};\n\t\t    this.uniform2ivCache = {};\n\t\t    this.uniform3fvCache = {};\n\t\t    this.uniform3ivCache = {};\n      }\n      _getFragShaderString() { return this.compiledFragShaderString; }\n      _getVertShaderString() { return this.compiledVertShaderString; }\n      validateOptions() {}\n      setupParams() {}\n      setupConstants() {}\n      setCanvas(canvas) { this._canvas = canvas; return this; }\n      setWebGl(webGl) { this._webGl = webGl; return this; }\n      setTexture(Type) { Texture = Type; }\n      setInput(Type) { Input = Type; }\n      "+i(e.getUniformLocation.toString())+"\n      "+i(e.build.toString())+"\n\t\t  "+i(e.run.toString())+"\n\t\t  "+i(e._addArgument.toString())+"\n\t\t  "+i(e._formatArrayTransfer.toString())+"\n\t\t  "+i(e.getArgumentTexture.toString())+"\n\t\t  "+i(e.getTextureCache.toString())+"\n\t\t  "+i(e.getOutputTexture.toString())+"\n\t\t  "+i(e.renderOutput.toString())+"\n\t\t  "+i(e.updateMaxTexSize.toString())+"\n\t\t  "+i(e._setupOutputTexture.toString())+"\n\t\t  "+i(e.detachTextureCache.toString())+"\n\t\t  "+i(e.setUniform1f.toString())+"\n\t\t  "+i(e.setUniform1i.toString())+"\n\t\t  "+i(e.setUniform2f.toString())+"\n\t\t  "+i(e.setUniform2fv.toString())+"\n\t\t  "+i(e.setUniform2iv.toString())+"\n\t\t  "+i(e.setUniform3fv.toString())+"\n\t\t  "+i(e.setUniform3iv.toString())+"\n    };\n    return kernelRunShortcut(new Kernel());\n  };"};
},{"../../core/utils":"hsMx","../kernel-run-shortcut":"Ar/k","../../core/input":"mMKb","../../core/texture":"ByaE"}],"9TKN":[function(require,module,exports) {
"use strict";var t=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(i):void 0},e=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}();function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=require("../kernel-base"),s=require("../../core/utils"),u=require("../../core/texture"),o=require("./shader-frag"),h=require("./shader-vert"),l=require("./kernel-string"),f=[],T={};module.exports=function(c){function E(t,e){r(this,E);var n=i(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,t,e));return n.textureCache={},n.threadDim={},n.programUniformLocationCache={},n.framebuffer=null,n.buffer=null,n.program=null,n.outputToTexture=e.outputToTexture,n.endianness=s.systemEndianness(),n.subKernelOutputTextures=null,n.subKernelOutputVariableNames=null,n.argumentsLength=0,n.constantsLength=0,n.compiledFragShaderString=null,n.compiledVertShaderString=null,n.fragShader=null,n.vertShader=null,n.drawBuffersMap=null,n.outputTexture=null,n.maxTexSize=null,n.uniform1fCache={},n.uniform1iCache={},n.uniform2fCache={},n.uniform2fvCache={},n.uniform2ivCache={},n.uniform3fvCache={},n.uniform3ivCache={},n._webGl||(n._webGl=n.initWebGl()),n}return n(E,a),e(E,null,[{key:"fragShaderString",get:function(){return o}},{key:"vertShaderString",get:function(){return h}}]),e(E,[{key:"initWebGl",value:function(){return s.initWebGl(this.getCanvas())}},{key:"validateOptions",value:function(){var t=s.isFloatReadPixelsSupported();if(!0===this.floatTextures&&!s.OES_texture_float)throw new Error("Float textures are not supported on this browser");if(!0===this.floatOutput&&!0!==this.floatOutputForce&&!t)throw new Error("Float texture outputs are not supported on this browser");void 0===this.floatTextures&&s.OES_texture_float&&(this.floatTextures=!0,this.floatOutput=t);var e=s.hasIntegerDivisionAccuracyBug();if(null===this.fixIntegerDivisionAccuracy?this.fixIntegerDivisionAccuracy=e:this.fixIntegerDivisionAccuracy&&!e&&(this.fixIntegerDivisionAccuracy=!1),s.checkOutput(this.output),!this.output||0===this.output.length){if(1!==arguments.length)throw new Error("Auto output only supported for kernels with only one input");var r=s.getArgumentType(arguments[0]);if("Array"===r)this.output=s.getDimensions(r);else{if("NumberTexture"!==r&&"ArrayTexture(4)"!==r)throw new Error("Auto output not supported for input type: "+r);this.output=arguments[0].output}}if(this.texSize=s.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0),this.graphical){if(2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");this.floatOutput&&(this.floatOutput=!1,console.warn("Cannot use graphical mode and float output at the same time")),this.texSize=s.clone(this.output)}else void 0===this.floatOutput&&s.OES_texture_float&&(this.floatOutput=!0)}},{key:"updateMaxTexSize",value:function(){var t=this.texSize,e=this._canvas;if(null===this.maxTexSize){var r=f.indexOf(e);-1===r&&(r=f.length,f.push(e),T[r]=[t[0],t[1]]),this.maxTexSize=T[r]}this.maxTexSize[0]<t[0]&&(this.maxTexSize[0]=t[0]),this.maxTexSize[1]<t[1]&&(this.maxTexSize[1]=t[1])}},{key:"build",value:function(){this.validateOptions(),this.setupConstants(),this.setupParams(arguments),this.updateMaxTexSize();var t=this.texSize,e=this._webGl,r=this._canvas;e.enable(e.SCISSOR_TEST),e.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),r.width=this.maxTexSize[0],r.height=this.maxTexSize[1];for(var i=this.threadDim=s.clone(this.output);i.length<3;)i.push(1);this.functionBuilder&&this._addKernels();var n=this._getVertShaderString(arguments),a=e.createShader(e.VERTEX_SHADER);e.shaderSource(a,n),e.compileShader(a),this.vertShader=a;var u=this._getFragShaderString(arguments),o=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(o,u),e.compileShader(o),this.fragShader=o,!e.getShaderParameter(a,e.COMPILE_STATUS))throw console.log(n),console.error("An error occurred compiling the shaders: "+e.getShaderInfoLog(a)),new Error("Error compiling vertex shader");if(!e.getShaderParameter(o,e.COMPILE_STATUS))throw console.log(u),console.error("An error occurred compiling the shaders: "+e.getShaderInfoLog(o)),new Error("Error compiling fragment shader");this.debug&&(console.log("Options:"),console.dir(this),console.log("GLSL Shader Output:"),console.log(u));var h=this.program=e.createProgram();e.attachShader(h,a),e.attachShader(h,o),e.linkProgram(h),this.framebuffer=e.createFramebuffer(),this.framebuffer.width=t[0],this.framebuffer.height=t[1];var l=new Float32Array([-1,-1,1,-1,-1,1,1,1]),f=new Float32Array([0,0,1,0,0,1,1,1]),T=l.byteLength,c=this.buffer;c?e.bindBuffer(e.ARRAY_BUFFER,c):(c=this.buffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,c),e.bufferData(e.ARRAY_BUFFER,l.byteLength+f.byteLength,e.STATIC_DRAW)),e.bufferSubData(e.ARRAY_BUFFER,0,l),e.bufferSubData(e.ARRAY_BUFFER,T,f);var E=e.getAttribLocation(this.program,"aPos");e.enableVertexAttribArray(E),e.vertexAttribPointer(E,2,e.FLOAT,e.FALSE,0,0);var _=e.getAttribLocation(this.program,"aTexCoord");for(var m in e.enableVertexAttribArray(_),e.vertexAttribPointer(_,2,e.FLOAT,e.FALSE,0,T),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),this.constants){var g=this.constants[m],p=s.getArgumentType(g);"Float"!==p&&"Integer"!==p&&(e.useProgram(this.program),this._addConstant(this.constants[m],p,m),this.constantsLength++)}this.outputImmutable||(this._setupOutputTexture(),null!==this.subKernelOutputVariableNames&&this.subKernelOutputVariableNames.length>0&&this._setupSubOutputTextures(this.subKernelOutputVariableNames.length))}},{key:"run",value:function(){null===this.program&&this.build.apply(this,arguments);var t=this.paramNames,e=this.paramTypes,r=this.texSize,i=this._webGl;i.useProgram(this.program),i.scissor(0,0,r[0],r[1]),this.hardcodeConstants||(this.setUniform3iv("uOutputDim",this.threadDim),this.setUniform2iv("uTexSize",r)),this.setUniform2f("ratio",r[0]/this.maxTexSize[0],r[1]/this.maxTexSize[1]),this.argumentsLength=0;for(var n=0;n<t.length;n++)this._addArgument(arguments[n],e[n],t[n]);if(this.graphical)return this.outputToTexture?(i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer),this.outputTexture&&!this.outputImmutable||this._setupOutputTexture(),i.drawArrays(i.TRIANGLE_STRIP,0,4),new u(this.outputTexture,r,this.threadDim,this.output,this._webGl,"ArrayTexture(4)")):(i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),void i.drawArrays(i.TRIANGLE_STRIP,0,4));i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer),this.outputImmutable&&this._setupOutputTexture();var a=this.outputTexture;if(null!==this.subKernelOutputVariableNames&&(this.outputImmutable&&(this.subKernelOutputTextures=[],this._setupSubOutputTextures(this.subKernelOutputVariableNames.length)),this.drawBuffers.drawBuffersWEBGL(this.drawBuffersMap)),i.drawArrays(i.TRIANGLE_STRIP,0,4),null!==this.subKernelOutputTextures){if(null!==this.subKernels){var s=[];s.result=this.renderOutput(a);for(var o=0;o<this.subKernels.length;o++)s.push(new u(this.subKernelOutputTextures[o],r,this.threadDim,this.output,this._webGl));return s}if(null!==this.subKernelProperties){var h={result:this.renderOutput(a)},l=0;for(var f in this.subKernelProperties)this.subKernelProperties.hasOwnProperty(f)&&(h[f]=new u(this.subKernelOutputTextures[l],r,this.threadDim,this.output,this._webGl),l++);return h}}return this.renderOutput(a)}},{key:"renderOutput",value:function(t){var e=this.texSize,r=this._webGl,i=this.threadDim,n=this.output;if(this.outputToTexture)return new u(t,e,this.threadDim,n,this._webGl);var a=void 0;if(this.floatOutput){var o=e[0],h=Math.ceil(e[1]/4);a=new Float32Array(o*h*4),r.readPixels(0,0,o,h,r.RGBA,r.FLOAT,a)}else{var l=new Uint8Array(e[0]*e[1]*4);r.readPixels(0,0,e[0],e[1],r.RGBA,r.UNSIGNED_BYTE,l),a=new Float32Array(l.buffer)}return a=a.subarray(0,i[0]*i[1]*i[2]),1===n.length?a:2===n.length?s.splitArray(a,n[0]):3===n.length?s.splitArray(a,n[0]*n[1]).map(function(t){return s.splitArray(t,n[0])}):void 0}},{key:"getOutputTexture",value:function(){return this.outputTexture}},{key:"_setupOutputTexture",value:function(){var t=this._webGl,e=this.texSize,r=this.outputTexture=this._webGl.createTexture();t.activeTexture(t.TEXTURE0+this.constantsLength+this.paramNames.length),t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),this.floatOutput?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e[0],e[1],0,t.RGBA,t.FLOAT,null):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e[0],e[1],0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0)}},{key:"_setupSubOutputTextures",value:function(t){for(var e=this._webGl,r=this.texSize,i=this.drawBuffersMap=[e.COLOR_ATTACHMENT0],n=this.subKernelOutputTextures=[],a=0;a<t;a++){var s=this._webGl.createTexture();n.push(s),i.push(e.COLOR_ATTACHMENT0+a+1),e.activeTexture(e.TEXTURE0+this.constantsLength+this.paramNames.length+a),e.bindTexture(e.TEXTURE_2D,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),this.floatOutput?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r[0],r[1],0,e.RGBA,e.FLOAT,null):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r[0],r[1],0,e.RGBA,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+a+1,e.TEXTURE_2D,s,0)}}},{key:"getArgumentTexture",value:function(t){return this.getTextureCache("ARGUMENT_"+t)}},{key:"getTextureCache",value:function(t){return this.textureCache.hasOwnProperty(t)?this.textureCache[t]:this.textureCache[t]=this._webGl.createTexture()}},{key:"detachTextureCache",value:function(t){delete this.textureCache[t]}},{key:"setUniform1f",value:function(t,e){if(this.uniform1fCache.hasOwnProperty(t)&&e===this.uniform1fCache[t])return;this.uniform1fCache[t]=e;var r=this.getUniformLocation(t);this._webGl.uniform1f(r,e)}},{key:"setUniform1i",value:function(t,e){if(this.uniform1iCache.hasOwnProperty(t)&&e===this.uniform1iCache[t])return;this.uniform1iCache[t]=e;var r=this.getUniformLocation(t);this._webGl.uniform1i(r,e)}},{key:"setUniform2f",value:function(t,e,r){if(this.uniform2fCache.hasOwnProperty(t)){var i=this.uniform2fCache[t];if(e===i[0]&&r===i[1])return}this.uniform2fCache[t]=[e,r];var n=this.getUniformLocation(t);this._webGl.uniform2f(n,e,r)}},{key:"setUniform2fv",value:function(t,e){if(this.uniform2fvCache.hasOwnProperty(t)){var r=this.uniform2fvCache[t];if(e[0]===r[0]&&e[1]===r[1])return}this.uniform2fvCache[t]=e;var i=this.getUniformLocation(t);this._webGl.uniform2fv(i,e)}},{key:"setUniform2iv",value:function(t,e){if(this.uniform2ivCache.hasOwnProperty(t)){var r=this.uniform2ivCache[t];if(e[0]===r[0]&&e[1]===r[1])return}this.uniform2ivCache[t]=e;var i=this.getUniformLocation(t);this._webGl.uniform2iv(i,e)}},{key:"setUniform3fv",value:function(t,e){if(this.uniform3fvCache.hasOwnProperty(t)){var r=this.uniform3fvCache[t];if(e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2])return}this.uniform3fvCache[t]=e;var i=this.getUniformLocation(t);this._webGl.uniform3fv(i,e)}},{key:"setUniform3iv",value:function(t,e){if(this.uniform3ivCache.hasOwnProperty(t)){var r=this.uniform3ivCache[t];if(e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2])return}this.uniform3ivCache[t]=e;var i=this.getUniformLocation(t);this._webGl.uniform3iv(i,e)}},{key:"getUniformLocation",value:function(t){return this.programUniformLocationCache.hasOwnProperty(t)?this.programUniformLocationCache[t]:this.programUniformLocationCache[t]=this._webGl.getUniformLocation(this.program,t)}},{key:"_getFragShaderArtifactMap",value:function(t){return{HEADER:this._getHeaderString(),LOOP_MAX:this._getLoopMaxString(),CONSTANTS:this._getConstantsString(),DECODE32_ENDIANNESS:this._getDecode32EndiannessString(),ENCODE32_ENDIANNESS:this._getEncode32EndiannessString(),DIVIDE_WITH_INTEGER_CHECK:this._getDivideWithIntegerCheckString(),GET_WRAPAROUND:this._getGetWraparoundString(),GET_TEXTURE_CHANNEL:this._getGetTextureChannelString(),GET_TEXTURE_INDEX:this._getGetTextureIndexString(),GET_RESULT:this._getGetResultString(),MAIN_PARAMS:this._getMainParamsString(t),MAIN_CONSTANTS:this._getMainConstantsString(),KERNEL:this._getKernelString(),MAIN_RESULT:this._getMainResultString()}}},{key:"_addArgument",value:function(t,e,r){var i=this._webGl,n=this.getArgumentTexture(r);switch(t instanceof u&&(e=t.type),e){case"Array":case"Array(2)":case"Array(3)":case"Array(4)":case"Array2D":case"Array3D":var a=s.getDimensions(t,!0),o=s.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},a);i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var h=o[0]*o[1],l=this._formatArrayTransfer(t,h),f=l.valuesFlat,T=l.bitRatio,c=void 0;this.floatTextures?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o[0],o[1],0,i.RGBA,i.FLOAT,f):(c=new Uint8Array(f.buffer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o[0]/T,o[1],0,i.RGBA,i.UNSIGNED_BYTE,c)),this.hardcodeConstants||(this.setUniform3iv("user_"+r+"Dim",a),this.setUniform2iv("user_"+r+"Size",o)),this.setUniform1i("user_"+r+"BitRatio",T),this.setUniform1i("user_"+r,this.argumentsLength);break;case"Integer":case"Float":case"Number":this.setUniform1f("user_"+r,t);break;case"Input":var E=t.size,_=s.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},E);i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var m=_[0]*_[1],g=this._formatArrayTransfer(t.value,m),p=g.valuesFlat,d=g.bitRatio;if(this.floatTextures)i.texImage2D(i.TEXTURE_2D,0,i.RGBA,_[0],_[1],0,i.RGBA,i.FLOAT,inputArray);else{var x=new Uint8Array(p.buffer);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,_[0]/d,_[1],0,i.RGBA,i.UNSIGNED_BYTE,x)}this.hardcodeConstants||(this.setUniform3iv("user_"+r+"Dim",E),this.setUniform2iv("user_"+r+"Size",_)),this.setUniform1i("user_"+r+"BitRatio",d),this.setUniform1i("user_"+r,this.argumentsLength);break;case"HTMLImage":var R=t,v=[R.width,R.height,1],b=[R.width,R.height];i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var A=i.RGBA,S=i.RGBA,U=i.UNSIGNED_BYTE;i.texImage2D(i.TEXTURE_2D,0,A,S,U,R),this.setUniform3iv("user_"+r+"Dim",v),this.setUniform2iv("user_"+r+"Size",b),this.setUniform1i("user_"+r,this.argumentsLength);break;case"ArrayTexture(4)":case"NumberTexture":var y=t,D=y.dimensions,O=y.size;i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,y.texture),this.setUniform3iv("user_"+r+"Dim",D),this.setUniform2iv("user_"+r+"Size",O),this.setUniform1i("user_"+r+"BitRatio",1),this.setUniform1i("user_"+r,this.argumentsLength);break;default:throw new Error("Input type not supported (WebGL): "+t)}this.argumentsLength++}},{key:"_addConstant",value:function(t,e,r){var i=this._webGl,n=this.getArgumentTexture(r);switch(t instanceof u&&(e=t.type),e){case"Array":var a=s.getDimensions(t,!0),o=s.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},a);i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var h=o[0]*o[1],l=this._formatArrayTransfer(t,h),f=l.valuesFlat,T=l.bitRatio,c=void 0;this.floatTextures?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o[0],o[1],0,i.RGBA,i.FLOAT,f):(c=new Uint8Array(f.buffer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o[0]/T,o[1],0,i.RGBA,i.UNSIGNED_BYTE,c)),this.hardcodeConstants||(this.setUniform3iv("constants_"+r+"Dim",a),this.setUniform2iv("constants_"+r+"Size",o)),this.setUniform1i("constants_"+r+"BitRatio",T),this.setUniform1i("constants_"+r,this.constantsLength);break;case"Input":var E=t.size,_=s.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},E);i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var m=_[0]*_[1],g=this._formatArrayTransfer(t.value,m),p=g.valuesFlat,d=g.bitRatio;if(this.floatTextures)i.texImage2D(i.TEXTURE_2D,0,i.RGBA,_[0],_[1],0,i.RGBA,i.FLOAT,inputArray);else{var x=new Uint8Array(p.buffer);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,_[0]/d,_[1],0,i.RGBA,i.UNSIGNED_BYTE,x)}this.hardcodeConstants||(this.setUniform3iv("constants_"+r+"Dim",E),this.setUniform2iv("constants_"+r+"Size",_)),this.setUniform1i("constants_"+r+"BitRatio",d),this.setUniform1i("constants_"+r,this.constantsLength);break;case"HTMLImage":var R=t,v=[R.width,R.height,1],b=[R.width,R.height];i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var A=i.RGBA,S=i.RGBA,U=i.UNSIGNED_BYTE;i.texImage2D(i.TEXTURE_2D,0,A,S,U,R),this.setUniform3iv("constants_"+r+"Dim",v),this.setUniform2iv("constants_"+r+"Size",b),this.setUniform1i("constants_"+r,this.constantsLength);break;case"ArrayTexture(4)":case"NumberTexture":var y=t,D=y.dimensions,O=y.size;i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,y.texture),this.setUniform3iv("constants_"+r+"Dim",D),this.setUniform2iv("constants_"+r+"Size",O),this.setUniform1i("constants_"+r+"BitRatio",1),this.setUniform1i("constants_"+r,this.constantsLength);break;case"Integer":case"Float":default:throw new Error("Input type not supported (WebGL): "+t)}}},{key:"_formatArrayTransfer",value:function(t,e){var r=1,i=t;if(s.isArray(t[0])||this.floatTextures)i=new Float32Array(e),s.flattenTo(t,i);else switch(t.constructor){case Uint8Array:case Int8Array:r=4;break;case Uint16Array:case Int16Array:r=2;case Float32Array:case Int32Array:break;default:i=new Float32Array(e),s.flattenTo(t,i)}return{bitRatio:r,valuesFlat:i}}},{key:"_getHeaderString",value:function(){return null!==this.subKernels||null!==this.subKernelProperties?"#extension GL_EXT_draw_buffers : require\n":""}},{key:"_getLoopMaxString",value:function(){return this.loopMaxIterations?" "+parseInt(this.loopMaxIterations)+".0;\n":" 1000.0;\n"}},{key:"_getConstantsString",value:function(){var t=[],e=this.threadDim,r=this.texSize;return this.hardcodeConstants?t.push("ivec3 uOutputDim = ivec3("+e[0]+","+e[1]+", "+e[2]+")","ivec2 uTexSize = ivec2("+r[0]+", "+r[1]+")"):t.push("uniform ivec3 uOutputDim","uniform ivec2 uTexSize"),this._linesToString(t)}},{key:"_getTextureCoordinate",value:function(){var t=this.subKernelOutputVariableNames;return null===t||t.length<1?"varying vec2 vTexCoord;\n":"out vec2 vTexCoord;\n"}},{key:"_getDecode32EndiannessString",value:function(){return"LE"===this.endianness?"":"  rgba.rgba = rgba.abgr;\n"}},{key:"_getEncode32EndiannessString",value:function(){return"LE"===this.endianness?"":"  rgba.rgba = rgba.abgr;\n"}},{key:"_getDivideWithIntegerCheckString",value:function(){return this.fixIntegerDivisionAccuracy?"\n\t\t\t  float div_with_int_check(float x, float y) {\n\t\t\t  if (floor(x) == x && floor(y) == y && integerMod(x, y) == 0.0) {\n\t\t\t    return float(int(x)/int(y));\n\t\t\t  }\n\t\t\t  return x / y;\n\t\t\t}\n\t\t\t":""}},{key:"_getGetWraparoundString",value:function(){return this.wraparound?"  xyz = mod(xyz, texDim);\n":""}},{key:"_getGetTextureChannelString",value:function(){return this.floatTextures?this._linesToString(["  int channel = integerMod(index, 4)","  index = index / 4"]):""}},{key:"_getGetTextureIndexString",value:function(){return this.floatTextures?"  index = index / 4;\n":""}},{key:"_getGetResultString",value:function(){return this.floatTextures?this._linesToString(["  if (channel == 0) return texel.r","  if (channel == 1) return texel.g","  if (channel == 2) return texel.b","  if (channel == 3) return texel.a"]):"  return decode(texel, x, bitRatio);"}},{key:"_getMainParamsString",value:function(t){for(var e=[],r=this.paramTypes,i=this.paramNames,n=0;n<i.length;n++){var a=t[n],u=i[n],o=r[n];if(this.hardcodeConstants)if("Array"===o||"NumberTexture"===o||"ArrayTexture(4)"===o){var h=s.getDimensions(a,!0),l=s.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},h);e.push("uniform sampler2D user_"+u,"ivec2 user_"+u+"Size = ivec2("+l[0]+", "+l[1]+")","ivec3 user_"+u+"Dim = ivec3("+h[0]+", "+h[1]+", "+h[2]+")","uniform int user_"+u+"BitRatio")}else"Integer"===o?e.push("float user_"+u+" = "+a+".0"):"Float"===o&&e.push("float user_"+u+" = "+a);else if("Array"===o||"NumberTexture"===o||"ArrayTexture(4)"===o||"Input"===o||"HTMLImage"===o)e.push("uniform sampler2D user_"+u,"uniform ivec2 user_"+u+"Size","uniform ivec3 user_"+u+"Dim"),"HTMLImage"!==o&&e.push("uniform int user_"+u+"BitRatio");else{if("Integer"!==o&&"Float"!==o)throw new Error("Param type "+o+" not supported in WebGL, only WebGL2");e.push("uniform float user_"+u)}}return this._linesToString(e)}},{key:"_getMainConstantsString",value:function(){var t=[];if(this.constants)for(var e in this.constants)if(this.constants.hasOwnProperty(e)){var r=this.constants[e],i=s.getArgumentType(r);switch(i){case"Integer":t.push("const float constants_"+e+" = "+parseInt(r)+".0");break;case"Float":t.push("const float constants_"+e+" = "+parseFloat(r));break;case"Array":case"Input":case"HTMLImage":case"NumberTexture":case"ArrayTexture(4)":t.push("uniform sampler2D constants_"+e,"uniform ivec2 constants_"+e+"Size","uniform ivec3 constants_"+e+"Dim","uniform int constants_"+e+"BitRatio");break;default:throw new Error("Unsupported constant "+e+" type "+i)}}return this._linesToString(t)}},{key:"_getKernelString",value:function(){var t=[],e=this.subKernelOutputVariableNames;if(null!==e){t.push("float kernelResult = 0.0");for(var r=0;r<e.length;r++)t.push("float "+e[r]+" = 0.0")}else t.push("float kernelResult = 0.0");return this._linesToString(t)+this.functionBuilder.getPrototypeString("kernel")}},{key:"_getMainResultString",value:function(){var t=this.subKernelOutputVariableNames,e=[];if(this.floatOutput&&e.push("  index *= 4"),this.graphical)e.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragColor = actualColor");else if(this.floatOutput)for(var r=["r","g","b","a"],i=0;i<r.length;++i){if(e.push("  threadId = indexTo3D(index, uOutputDim)"),e.push("  kernel()"),t){e.push("  gl_FragData[0]."+r[i]+" = kernelResult");for(var n=0;n<t.length;++n)e.push("  gl_FragData["+(n+1)+"]."+r[i]+" = "+t[n])}else e.push("  gl_FragColor."+r[i]+" = kernelResult");i<r.length-1&&e.push("  index += 1")}else if(null!==t){e.push("  threadId = indexTo3D(index, uOutputDim)"),e.push("  kernel()"),e.push("  gl_FragData[0] = encode32(kernelResult)");for(var a=0;a<t.length;a++)e.push("  gl_FragData["+(a+1)+"] = encode32("+t[a]+")")}else e.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragColor = encode32(kernelResult)");return this._linesToString(e)}},{key:"_linesToString",value:function(t){return t.length>0?t.join(";\n")+";\n":"\n"}},{key:"_replaceArtifacts",value:function(t,e){return t.replace(/[ ]*__([A-Z]+[0-9]*([_]?[A-Z])*)__;\n/g,function(t,r){if(e.hasOwnProperty(r))return e[r];throw"unhandled artifact "+r})}},{key:"_addKernels",value:function(){var t=this,e=this.functionBuilder,r=this._webGl;if(e.addFunctions(this.functions,{constants:this.constants,output:this.output}),e.addNativeFunctions(this.nativeFunctions),e.addKernel(this.fnString,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations,paramNames:this.paramNames,paramTypes:this.paramTypes,constantTypes:this.constantTypes,fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy}),null!==this.subKernels){if(!(this.drawBuffers=r.getExtension("WEBGL_draw_buffers")))throw new Error("could not instantiate draw buffers extension");this.subKernelOutputVariableNames=[],this.subKernels.forEach(function(e){return t._addSubKernel(e)})}else if(null!==this.subKernelProperties){if(!(this.drawBuffers=r.getExtension("WEBGL_draw_buffers")))throw new Error("could not instantiate draw buffers extension");this.subKernelOutputVariableNames=[],Object.keys(this.subKernelProperties).forEach(function(e){return t._addSubKernel(t.subKernelProperties[e])})}}},{key:"_addSubKernel",value:function(t){this.functionBuilder.addSubKernel(t,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations,fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy}),this.subKernelOutputVariableNames.push(t.name+"Result")}},{key:"_getFragShaderString",value:function(t){return null!==this.compiledFragShaderString?this.compiledFragShaderString:this.compiledFragShaderString=this._replaceArtifacts(this.constructor.fragShaderString,this._getFragShaderArtifactMap(t))}},{key:"_getVertShaderString",value:function(t){return null!==this.compiledVertShaderString?this.compiledVertShaderString:this.compiledVertShaderString=this.constructor.vertShaderString}},{key:"toString",value:function(){return l(this)}},{key:"addFunction",value:function(t){this.functionBuilder.addFunction(null,t)}},{key:"destroy",value:function(e){t(E.prototype.__proto__||Object.getPrototypeOf(E.prototype),"destroy",this).call(this),this.outputTexture&&this._webGl.deleteTexture(this.outputTexture),this.buffer&&this._webGl.deleteBuffer(this.buffer),this.framebuffer&&this._webGl.deleteFramebuffer(this.framebuffer),this.vertShader&&this._webGl.deleteShader(this.vertShader),this.fragShader&&this._webGl.deleteShader(this.fragShader),this.program&&this._webGl.deleteProgram(this.program);for(var r=Object.keys(this.textureCache),i=0;i<r.length;i++){var n=r[i];this._webGl.deleteTexture(this.textureCache[n])}if(this.subKernelOutputTextures)for(var a=0;a<this.subKernelOutputTextures.length;a++)this._webGl.deleteTexture(this.subKernelOutputTextures[a]);if(e){var s=f.indexOf(this._canvas);s>=0&&(f[s]=null,T[s]=null)}delete this._webGl}}]),E}();
},{"../kernel-base":"ZzEd","../../core/utils":"hsMx","../../core/texture":"ByaE","./shader-frag":"r8Fr","./shader-vert":"40l2","./kernel-string":"MHbP"}],"KoGT":[function(require,module,exports) {
"use strict";var t=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}();function n(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}module.exports=function(){function e(t){n(this,e),this.nodeMap={},this.nativeFunctions={},this.gpu=t,this.rootKernel=null,this.Node=null}return t(e,[{key:"addNativeFunction",value:function(t,n){this.nativeFunctions[t]=n}},{key:"addFunction",value:function(t,n,e){this.addFunctionNode(new this.Node(t,n,e).setBuilder(this))}},{key:"addFunctions",value:function(t,n){if(t)if(Array.isArray(t))for(var e=0;e<t.length;e++)this.addFunction(null,t[e],n);else for(var i in t)this.addFunction(i,t[i],n)}},{key:"addNativeFunctions",value:function(t){for(var n in t)t.hasOwnProperty(n)&&this.addNativeFunction(n,t[n])}},{key:"addFunctionNode",value:function(t){this.nodeMap[t.functionName]=t,t.isRootKernel&&(this.rootKernel=t)}},{key:"traceFunctionCalls",value:function(t,n,e){t=t||"kernel",n=n||[];var i=this.nodeMap[t];if(i){var o=n.indexOf(t);if(-1===o){n.push(t),e&&(i.parent=e),i.getFunctionString();for(var r=0;r<i.calledFunctions.length;++r)this.traceFunctionCalls(i.calledFunctions[r],n,i)}else{var u=n.splice(o,1)[0];n.push(u)}}return this.nativeFunctions[t]&&(n.indexOf(t)>=0||n.push(t)),n}},{key:"addKernel",value:function(t,n){var e=new this.Node("kernel",t,n);return e.setBuilder(this),e.isRootKernel=!0,this.addFunctionNode(e),e}},{key:"addSubKernel",value:function(t,n){var e=new this.Node(null,t,n);return e.setBuilder(this),e.isSubKernel=!0,this.addFunctionNode(e),e}},{key:"getPrototypeString",value:function(t){return this.getPrototypes(t).join("\n")}},{key:"getPrototypes",value:function(t){return this.rootKernel.generate(),t?this.getPrototypesFromFunctionNames(this.traceFunctionCalls(t,[]).reverse()):this.getPrototypesFromFunctionNames(Object.keys(this.nodeMap))}},{key:"getStringFromFunctionNames",value:function(t){for(var n=[],e=0;e<t.length;++e){this.nodeMap[t[e]]&&n.push(this.nodeMap[t[e]].getFunctionString())}return n.join("\n")}},{key:"getPrototypesFromFunctionNames",value:function(t,n){for(var e=[],i=0;i<t.length;++i){var o=t[i],r=this.nodeMap[o];r?e.push(r.getFunctionPrototypeString(n)):this.nativeFunctions[o]&&e.push(this.nativeFunctions[o])}return e}},{key:"getPrototypeStringFromFunctionNames",value:function(t,n){return this.getPrototypesFromFunctionNames(t,n).toString()}},{key:"getString",value:function(t,n){return void 0===n&&(n={}),t?this.getStringFromFunctionNames(this.traceFunctionCalls(t,[],n).reverse(),n):this.getStringFromFunctionNames(Object.keys(this.nodeMap),n)}}]),e}();
},{}],"8W3y":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.parse=It,exports.parseExpressionAt=Pt,exports.tokenizer=Lt,exports.addLooseExports=Nt,exports.getLineInfo=T,exports.isIdentifierChar=l,exports.isIdentifierStart=u,exports.isNewLine=k,exports.nonASCIIwhitespace=exports.lineBreakG=exports.lineBreak=exports.Token=exports.tokContexts=exports.TokContext=exports.keywordTypes=exports.tokTypes=exports.TokenType=exports.Node=exports.SourceLocation=exports.Position=exports.defaultOptions=exports.plugins=exports.Parser=exports.pluginsLoose=exports.LooseParser=exports.parse_dammit=exports.version=void 0;var t={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},e="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",i={5:e,6:e+" const class extends export import super"},s=/^in(stanceof)?$/,r="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࢠ-ࢴࢶ-ࢽऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿯ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞹꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭥꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",a="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛࣓-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ංඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ູົຼ່-ໍ໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠐-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭ᳲ-᳴᳷-᳹᷀-᷹᷻-᷿‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿",n=new RegExp("["+r+"]"),o=new RegExp("["+r+a+"]");r=a=null;var h=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,477,28,11,0,9,21,190,52,76,44,33,24,27,35,30,0,12,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,54,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,86,26,230,43,117,63,32,0,257,0,11,39,8,0,22,0,12,39,3,3,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,270,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,68,12,0,67,12,65,1,31,6129,15,754,9486,286,82,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,4149,196,60,67,1213,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,15,7472,3104,541],p=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,525,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,4,9,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,280,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1016,45,17,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,2214,6,110,6,6,9,792487,239];function c(t,e){for(var i=65536,s=0;s<e.length;s+=2){if((i+=e[s])>t)return!1;if((i+=e[s+1])>=t)return!0}}function u(t,e){return t<65?36===t:t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&n.test(String.fromCharCode(t)):!1!==e&&c(t,h)))}function l(t,e){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&o.test(String.fromCharCode(t)):!1!==e&&(c(t,h)||c(t,p)))))}var d=function(t,e){void 0===e&&(e={}),this.label=t,this.keyword=e.keyword,this.beforeExpr=!!e.beforeExpr,this.startsExpr=!!e.startsExpr,this.isLoop=!!e.isLoop,this.isAssign=!!e.isAssign,this.prefix=!!e.prefix,this.postfix=!!e.postfix,this.binop=e.binop||null,this.updateContext=null};function f(t,e){return new d(t,{beforeExpr:!0,binop:e})}exports.TokenType=d;var m={beforeExpr:!0},x={startsExpr:!0},g={};function v(t,e){return void 0===e&&(e={}),e.keyword=t,g[t]=new d(t,e)}exports.keywordTypes=g;var y={num:new d("num",x),regexp:new d("regexp",x),string:new d("string",x),name:new d("name",x),eof:new d("eof"),bracketL:new d("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new d("]"),braceL:new d("{",{beforeExpr:!0,startsExpr:!0}),braceR:new d("}"),parenL:new d("(",{beforeExpr:!0,startsExpr:!0}),parenR:new d(")"),comma:new d(",",m),semi:new d(";",m),colon:new d(":",m),dot:new d("."),question:new d("?",m),arrow:new d("=>",m),template:new d("template"),invalidTemplate:new d("invalidTemplate"),ellipsis:new d("...",m),backQuote:new d("`",x),dollarBraceL:new d("${",{beforeExpr:!0,startsExpr:!0}),eq:new d("=",{beforeExpr:!0,isAssign:!0}),assign:new d("_=",{beforeExpr:!0,isAssign:!0}),incDec:new d("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new d("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:f("||",1),logicalAND:f("&&",2),bitwiseOR:f("|",3),bitwiseXOR:f("^",4),bitwiseAND:f("&",5),equality:f("==/!=/===/!==",6),relational:f("</>/<=/>=",7),bitShift:f("<</>>/>>>",8),plusMin:new d("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:f("%",10),star:f("*",10),slash:f("/",10),starstar:new d("**",{beforeExpr:!0}),_break:v("break"),_case:v("case",m),_catch:v("catch"),_continue:v("continue"),_debugger:v("debugger"),_default:v("default",m),_do:v("do",{isLoop:!0,beforeExpr:!0}),_else:v("else",m),_finally:v("finally"),_for:v("for",{isLoop:!0}),_function:v("function",x),_if:v("if"),_return:v("return",m),_switch:v("switch"),_throw:v("throw",m),_try:v("try"),_var:v("var"),_const:v("const"),_while:v("while",{isLoop:!0}),_with:v("with"),_new:v("new",{beforeExpr:!0,startsExpr:!0}),_this:v("this",x),_super:v("super",x),_class:v("class",x),_extends:v("extends",m),_export:v("export"),_import:v("import"),_null:v("null",x),_true:v("true",x),_false:v("false",x),_in:v("in",{beforeExpr:!0,binop:7}),_instanceof:v("instanceof",{beforeExpr:!0,binop:7}),_typeof:v("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:v("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:v("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})};exports.tokTypes=y;var _=/\r\n?|\n|\u2028|\u2029/;exports.lineBreak=_;var b=new RegExp(_.source,"g");function k(t,e){return 10===t||13===t||!e&&(8232===t||8233===t)}exports.lineBreakG=b;var C=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/;exports.nonASCIIwhitespace=C;var S=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,E=Object.prototype,w=E.hasOwnProperty,A=E.toString;function I(t,e){return w.call(t,e)}var P=Array.isArray||function(t){return"[object Array]"===A.call(t)},L=function(t,e){this.line=t,this.column=e};exports.Position=L,L.prototype.offset=function(t){return new L(this.line,this.column+t)};var N=function(t,e,i){this.start=e,this.end=i,null!==t.sourceFile&&(this.source=t.sourceFile)};function T(t,e){for(var i=1,s=0;;){b.lastIndex=s;var r=b.exec(t);if(!(r&&r.index<e))return new L(i,e-s);++i,s=r.index+r[0].length}}exports.SourceLocation=N;var V={ecmaVersion:7,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1,plugins:{}};function R(t){var e={};for(var i in V)e[i]=t&&I(t,i)?t[i]:V[i];if(e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),null==e.allowReserved&&(e.allowReserved=e.ecmaVersion<5),P(e.onToken)){var s=e.onToken;e.onToken=function(t){return s.push(t)}}return P(e.onComment)&&(e.onComment=D(e,e.onComment)),e}function D(t,e){return function(i,s,r,a,n,o){var h={type:i?"Block":"Line",value:s,start:r,end:a};t.locations&&(h.loc=new N(this,n,o)),t.ranges&&(h.range=[r,a]),e.push(h)}}exports.defaultOptions=V;var O={};function B(t){return new RegExp("^(?:"+t.replace(/ /g,"|")+")$")}exports.plugins=O;var M=function(e,s,r){this.options=e=R(e),this.sourceFile=e.sourceFile,this.keywords=B(i[e.ecmaVersion>=6?6:5]);var a="";if(!e.allowReserved){for(var n=e.ecmaVersion;!(a=t[n]);n--);"module"===e.sourceType&&(a+=" await")}this.reservedWords=B(a);var o=(a?a+" ":"")+t.strict;this.reservedWordsStrict=B(o),this.reservedWordsStrictBind=B(o+" "+t.strictBind),this.input=String(s),this.containsEsc=!1,this.loadPlugins(e.plugins),r?(this.pos=r,this.lineStart=this.input.lastIndexOf("\n",r-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(_).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=y.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.inFunction=this.inGenerator=this.inAsync=!1,this.yieldPos=this.awaitPos=0,this.labels=[],0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterFunctionScope(),this.regexpState=null};exports.Parser=M,M.prototype.isKeyword=function(t){return this.keywords.test(t)},M.prototype.isReservedWord=function(t){return this.reservedWords.test(t)},M.prototype.extend=function(t,e){this[t]=e(this[t])},M.prototype.loadPlugins=function(t){for(var e in t){var i=O[e];if(!i)throw new Error("Plugin '"+e+"' not found");i(this,t[e])}},M.prototype.parse=function(){var t=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(t)};var F=M.prototype,U=/^(?:'((?:\\.|[^'])*?)'|"((?:\\.|[^"])*?)"|;)/;function G(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}F.strictDirective=function(t){for(;;){S.lastIndex=t,t+=S.exec(this.input)[0].length;var e=U.exec(this.input.slice(t));if(!e)return!1;if("use strict"===(e[1]||e[2]))return!0;t+=e[0].length}},F.eat=function(t){return this.type===t&&(this.next(),!0)},F.isContextual=function(t){return this.type===y.name&&this.value===t&&!this.containsEsc},F.eatContextual=function(t){return!!this.isContextual(t)&&(this.next(),!0)},F.expectContextual=function(t){this.eatContextual(t)||this.unexpected()},F.canInsertSemicolon=function(){return this.type===y.eof||this.type===y.braceR||_.test(this.input.slice(this.lastTokEnd,this.start))},F.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},F.semicolon=function(){this.eat(y.semi)||this.insertSemicolon()||this.unexpected()},F.afterTrailingComma=function(t,e){if(this.type===t)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0},F.expect=function(t){this.eat(t)||this.unexpected()},F.unexpected=function(t){this.raise(null!=t?t:this.start,"Unexpected token")},F.checkPatternErrors=function(t,e){if(t){t.trailingComma>-1&&this.raiseRecoverable(t.trailingComma,"Comma is not permitted after the rest element");var i=e?t.parenthesizedAssign:t.parenthesizedBind;i>-1&&this.raiseRecoverable(i,"Parenthesized pattern")}},F.checkExpressionErrors=function(t,e){if(!t)return!1;var i=t.shorthandAssign,s=t.doubleProto;if(!e)return i>=0||s>=0;i>=0&&this.raise(i,"Shorthand property assignments are valid only in destructuring patterns"),s>=0&&this.raiseRecoverable(s,"Redefinition of __proto__ property")},F.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},F.isSimpleAssignTarget=function(t){return"ParenthesizedExpression"===t.type?this.isSimpleAssignTarget(t.expression):"Identifier"===t.type||"MemberExpression"===t.type};var q=M.prototype;q.parseTopLevel=function(t){var e={};for(t.body||(t.body=[]);this.type!==y.eof;){var i=this.parseStatement(!0,!0,e);t.body.push(i)}return this.adaptDirectivePrologue(t.body),this.next(),this.options.ecmaVersion>=6&&(t.sourceType=this.options.sourceType),this.finishNode(t,"Program")};var H={kind:"loop"},W={kind:"switch"};q.isLet=function(){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;S.lastIndex=this.pos;var t=S.exec(this.input),e=this.pos+t[0].length,i=this.input.charCodeAt(e);if(91===i||123===i)return!0;if(u(i,!0)){for(var r=e+1;l(this.input.charCodeAt(r),!0);)++r;var a=this.input.slice(e,r);if(!s.test(a))return!0}return!1},q.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;S.lastIndex=this.pos;var t=S.exec(this.input),e=this.pos+t[0].length;return!(_.test(this.input.slice(this.pos,e))||"function"!==this.input.slice(e,e+8)||e+8!==this.input.length&&l(this.input.charAt(e+8)))},q.parseStatement=function(t,e,i){var s,r=this.type,a=this.startNode();switch(this.isLet()&&(r=y._var,s="let"),r){case y._break:case y._continue:return this.parseBreakContinueStatement(a,r.keyword);case y._debugger:return this.parseDebuggerStatement(a);case y._do:return this.parseDoStatement(a);case y._for:return this.parseForStatement(a);case y._function:return!t&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(a,!1);case y._class:return t||this.unexpected(),this.parseClass(a,!0);case y._if:return this.parseIfStatement(a);case y._return:return this.parseReturnStatement(a);case y._switch:return this.parseSwitchStatement(a);case y._throw:return this.parseThrowStatement(a);case y._try:return this.parseTryStatement(a);case y._const:case y._var:return s=s||this.value,t||"var"===s||this.unexpected(),this.parseVarStatement(a,s);case y._while:return this.parseWhileStatement(a);case y._with:return this.parseWithStatement(a);case y.braceL:return this.parseBlock();case y.semi:return this.parseEmptyStatement(a);case y._export:case y._import:return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),r===y._import?this.parseImport(a):this.parseExport(a,i);default:if(this.isAsyncFunction())return t||this.unexpected(),this.next(),this.parseFunctionStatement(a,!0);var n=this.value,o=this.parseExpression();return r===y.name&&"Identifier"===o.type&&this.eat(y.colon)?this.parseLabeledStatement(a,n,o):this.parseExpressionStatement(a,o)}},q.parseBreakContinueStatement=function(t,e){var i="break"===e;this.next(),this.eat(y.semi)||this.insertSemicolon()?t.label=null:this.type!==y.name?this.unexpected():(t.label=this.parseIdent(),this.semicolon());for(var s=0;s<this.labels.length;++s){var r=this.labels[s];if(null==t.label||r.name===t.label.name){if(null!=r.kind&&(i||"loop"===r.kind))break;if(t.label&&i)break}}return s===this.labels.length&&this.raise(t.start,"Unsyntactic "+e),this.finishNode(t,i?"BreakStatement":"ContinueStatement")},q.parseDebuggerStatement=function(t){return this.next(),this.semicolon(),this.finishNode(t,"DebuggerStatement")},q.parseDoStatement=function(t){return this.next(),this.labels.push(H),t.body=this.parseStatement(!1),this.labels.pop(),this.expect(y._while),t.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(y.semi):this.semicolon(),this.finishNode(t,"DoWhileStatement")},q.parseForStatement=function(t){this.next();var e=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(H),this.enterLexicalScope(),this.expect(y.parenL),this.type===y.semi)return e>-1&&this.unexpected(e),this.parseFor(t,null);var i=this.isLet();if(this.type===y._var||this.type===y._const||i){var s=this.startNode(),r=i?"let":this.value;return this.next(),this.parseVar(s,!0,r),this.finishNode(s,"VariableDeclaration"),!(this.type===y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))||1!==s.declarations.length||"var"!==r&&s.declarations[0].init?(e>-1&&this.unexpected(e),this.parseFor(t,s)):(this.options.ecmaVersion>=9&&(this.type===y._in?e>-1&&this.unexpected(e):t.await=e>-1),this.parseForIn(t,s))}var a=new G,n=this.parseExpression(!0,a);return this.type===y._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===y._in?e>-1&&this.unexpected(e):t.await=e>-1),this.toAssignable(n,!1,a),this.checkLVal(n),this.parseForIn(t,n)):(this.checkExpressionErrors(a,!0),e>-1&&this.unexpected(e),this.parseFor(t,n))},q.parseFunctionStatement=function(t,e){return this.next(),this.parseFunction(t,!0,!1,e)},q.parseIfStatement=function(t){return this.next(),t.test=this.parseParenExpression(),t.consequent=this.parseStatement(!this.strict&&this.type===y._function),t.alternate=this.eat(y._else)?this.parseStatement(!this.strict&&this.type===y._function):null,this.finishNode(t,"IfStatement")},q.parseReturnStatement=function(t){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(y.semi)||this.insertSemicolon()?t.argument=null:(t.argument=this.parseExpression(),this.semicolon()),this.finishNode(t,"ReturnStatement")},q.parseSwitchStatement=function(t){var e;this.next(),t.discriminant=this.parseParenExpression(),t.cases=[],this.expect(y.braceL),this.labels.push(W),this.enterLexicalScope();for(var i=!1;this.type!==y.braceR;)if(this.type===y._case||this.type===y._default){var s=this.type===y._case;e&&this.finishNode(e,"SwitchCase"),t.cases.push(e=this.startNode()),e.consequent=[],this.next(),s?e.test=this.parseExpression():(i&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),i=!0,e.test=null),this.expect(y.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(!0));return this.exitLexicalScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(t,"SwitchStatement")},q.parseThrowStatement=function(t){return this.next(),_.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),t.argument=this.parseExpression(),this.semicolon(),this.finishNode(t,"ThrowStatement")};var j=[];q.parseTryStatement=function(t){if(this.next(),t.block=this.parseBlock(),t.handler=null,this.type===y._catch){var e=this.startNode();this.next(),this.eat(y.parenL)?(e.param=this.parseBindingAtom(),this.enterLexicalScope(),this.checkLVal(e.param,"let"),this.expect(y.parenR)):(this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterLexicalScope()),e.body=this.parseBlock(!1),this.exitLexicalScope(),t.handler=this.finishNode(e,"CatchClause")}return t.finalizer=this.eat(y._finally)?this.parseBlock():null,t.handler||t.finalizer||this.raise(t.start,"Missing catch or finally clause"),this.finishNode(t,"TryStatement")},q.parseVarStatement=function(t,e){return this.next(),this.parseVar(t,!1,e),this.semicolon(),this.finishNode(t,"VariableDeclaration")},q.parseWhileStatement=function(t){return this.next(),t.test=this.parseParenExpression(),this.labels.push(H),t.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(t,"WhileStatement")},q.parseWithStatement=function(t){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),t.object=this.parseParenExpression(),t.body=this.parseStatement(!1),this.finishNode(t,"WithStatement")},q.parseEmptyStatement=function(t){return this.next(),this.finishNode(t,"EmptyStatement")},q.parseLabeledStatement=function(t,e,i){for(var s=0,r=this.labels;s<r.length;s+=1){r[s].name===e&&this.raise(i.start,"Label '"+e+"' is already declared")}for(var a=this.type.isLoop?"loop":this.type===y._switch?"switch":null,n=this.labels.length-1;n>=0;n--){var o=this.labels[n];if(o.statementStart!==t.start)break;o.statementStart=this.start,o.kind=a}return this.labels.push({name:e,kind:a,statementStart:this.start}),t.body=this.parseStatement(!0),("ClassDeclaration"===t.body.type||"VariableDeclaration"===t.body.type&&"var"!==t.body.kind||"FunctionDeclaration"===t.body.type&&(this.strict||t.body.generator||t.body.async))&&this.raiseRecoverable(t.body.start,"Invalid labeled declaration"),this.labels.pop(),t.label=i,this.finishNode(t,"LabeledStatement")},q.parseExpressionStatement=function(t,e){return t.expression=e,this.semicolon(),this.finishNode(t,"ExpressionStatement")},q.parseBlock=function(t){void 0===t&&(t=!0);var e=this.startNode();for(e.body=[],this.expect(y.braceL),t&&this.enterLexicalScope();!this.eat(y.braceR);){var i=this.parseStatement(!0);e.body.push(i)}return t&&this.exitLexicalScope(),this.finishNode(e,"BlockStatement")},q.parseFor=function(t,e){return t.init=e,this.expect(y.semi),t.test=this.type===y.semi?null:this.parseExpression(),this.expect(y.semi),t.update=this.type===y.parenR?null:this.parseExpression(),this.expect(y.parenR),this.exitLexicalScope(),t.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(t,"ForStatement")},q.parseForIn=function(t,e){var i=this.type===y._in?"ForInStatement":"ForOfStatement";return this.next(),"ForInStatement"===i&&("AssignmentPattern"===e.type||"VariableDeclaration"===e.type&&null!=e.declarations[0].init&&(this.strict||"Identifier"!==e.declarations[0].id.type))&&this.raise(e.start,"Invalid assignment in for-in loop head"),t.left=e,t.right="ForInStatement"===i?this.parseExpression():this.parseMaybeAssign(),this.expect(y.parenR),this.exitLexicalScope(),t.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(t,i)},q.parseVar=function(t,e,i){for(t.declarations=[],t.kind=i;;){var s=this.startNode();if(this.parseVarId(s,i),this.eat(y.eq)?s.init=this.parseMaybeAssign(e):"const"!==i||this.type===y._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===s.id.type||e&&(this.type===y._in||this.isContextual("of"))?s.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),t.declarations.push(this.finishNode(s,"VariableDeclarator")),!this.eat(y.comma))break}return t},q.parseVarId=function(t,e){t.id=this.parseBindingAtom(e),this.checkLVal(t.id,e,!1)},q.parseFunction=function(t,e,i,s){this.initFunction(t),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!s)&&(t.generator=this.eat(y.star)),this.options.ecmaVersion>=8&&(t.async=!!s),e&&(t.id="nullableID"===e&&this.type!==y.name?null:this.parseIdent(),t.id&&this.checkLVal(t.id,this.inModule&&!this.inFunction?"let":"var"));var r=this.inGenerator,a=this.inAsync,n=this.yieldPos,o=this.awaitPos,h=this.inFunction;return this.inGenerator=t.generator,this.inAsync=t.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),e||(t.id=this.type===y.name?this.parseIdent():null),this.parseFunctionParams(t),this.parseFunctionBody(t,i),this.inGenerator=r,this.inAsync=a,this.yieldPos=n,this.awaitPos=o,this.inFunction=h,this.finishNode(t,e?"FunctionDeclaration":"FunctionExpression")},q.parseFunctionParams=function(t){this.expect(y.parenL),t.params=this.parseBindingList(y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},q.parseClass=function(t,e){this.next(),this.parseClassId(t,e),this.parseClassSuper(t);var i=this.startNode(),s=!1;for(i.body=[],this.expect(y.braceL);!this.eat(y.braceR);){var r=this.parseClassMember(i);r&&"MethodDefinition"===r.type&&"constructor"===r.kind&&(s&&this.raise(r.start,"Duplicate constructor in the same class"),s=!0)}return t.body=this.finishNode(i,"ClassBody"),this.finishNode(t,e?"ClassDeclaration":"ClassExpression")},q.parseClassMember=function(t){var e=this;if(this.eat(y.semi))return null;var i=this.startNode(),s=function(t,s){void 0===s&&(s=!1);var r=e.start,a=e.startLoc;return!!e.eatContextual(t)&&(!(e.type===y.parenL||s&&e.canInsertSemicolon())||(i.key&&e.unexpected(),i.computed=!1,i.key=e.startNodeAt(r,a),i.key.name=t,e.finishNode(i.key,"Identifier"),!1))};i.kind="method",i.static=s("static");var r=this.eat(y.star),a=!1;r||(this.options.ecmaVersion>=8&&s("async",!0)?(a=!0,r=this.options.ecmaVersion>=9&&this.eat(y.star)):s("get")?i.kind="get":s("set")&&(i.kind="set")),i.key||this.parsePropertyName(i);var n=i.key;return i.computed||i.static||!("Identifier"===n.type&&"constructor"===n.name||"Literal"===n.type&&"constructor"===n.value)?i.static&&"Identifier"===n.type&&"prototype"===n.name&&this.raise(n.start,"Classes may not have a static property named prototype"):("method"!==i.kind&&this.raise(n.start,"Constructor can't have get/set modifier"),r&&this.raise(n.start,"Constructor can't be a generator"),a&&this.raise(n.start,"Constructor can't be an async method"),i.kind="constructor"),this.parseClassMethod(t,i,r,a),"get"===i.kind&&0!==i.value.params.length&&this.raiseRecoverable(i.value.start,"getter should have no params"),"set"===i.kind&&1!==i.value.params.length&&this.raiseRecoverable(i.value.start,"setter should have exactly one param"),"set"===i.kind&&"RestElement"===i.value.params[0].type&&this.raiseRecoverable(i.value.params[0].start,"Setter cannot use rest params"),i},q.parseClassMethod=function(t,e,i,s){e.value=this.parseMethod(i,s),t.body.push(this.finishNode(e,"MethodDefinition"))},q.parseClassId=function(t,e){t.id=this.type===y.name?this.parseIdent():!0===e?this.unexpected():null},q.parseClassSuper=function(t){t.superClass=this.eat(y._extends)?this.parseExprSubscripts():null},q.parseExport=function(t,e){if(this.next(),this.eat(y.star))return this.expectContextual("from"),this.type!==y.string&&this.unexpected(),t.source=this.parseExprAtom(),this.semicolon(),this.finishNode(t,"ExportAllDeclaration");if(this.eat(y._default)){var i;if(this.checkExport(e,"default",this.lastTokStart),this.type===y._function||(i=this.isAsyncFunction())){var s=this.startNode();this.next(),i&&this.next(),t.declaration=this.parseFunction(s,"nullableID",!1,i)}else if(this.type===y._class){var r=this.startNode();t.declaration=this.parseClass(r,"nullableID")}else t.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(t,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())t.declaration=this.parseStatement(!0),"VariableDeclaration"===t.declaration.type?this.checkVariableExport(e,t.declaration.declarations):this.checkExport(e,t.declaration.id.name,t.declaration.id.start),t.specifiers=[],t.source=null;else{if(t.declaration=null,t.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==y.string&&this.unexpected(),t.source=this.parseExprAtom();else{for(var a=0,n=t.specifiers;a<n.length;a+=1){var o=n[a];this.checkUnreserved(o.local)}t.source=null}this.semicolon()}return this.finishNode(t,"ExportNamedDeclaration")},q.checkExport=function(t,e,i){t&&(I(t,e)&&this.raiseRecoverable(i,"Duplicate export '"+e+"'"),t[e]=!0)},q.checkPatternExport=function(t,e){var i=e.type;if("Identifier"===i)this.checkExport(t,e.name,e.start);else if("ObjectPattern"===i)for(var s=0,r=e.properties;s<r.length;s+=1){var a=r[s];this.checkPatternExport(t,a)}else if("ArrayPattern"===i)for(var n=0,o=e.elements;n<o.length;n+=1){var h=o[n];h&&this.checkPatternExport(t,h)}else"Property"===i?this.checkPatternExport(t,e.value):"AssignmentPattern"===i?this.checkPatternExport(t,e.left):"RestElement"===i?this.checkPatternExport(t,e.argument):"ParenthesizedExpression"===i&&this.checkPatternExport(t,e.expression)},q.checkVariableExport=function(t,e){if(t)for(var i=0,s=e;i<s.length;i+=1){var r=s[i];this.checkPatternExport(t,r.id)}},q.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},q.parseExportSpecifiers=function(t){var e=[],i=!0;for(this.expect(y.braceL);!this.eat(y.braceR);){if(i)i=!1;else if(this.expect(y.comma),this.afterTrailingComma(y.braceR))break;var s=this.startNode();s.local=this.parseIdent(!0),s.exported=this.eatContextual("as")?this.parseIdent(!0):s.local,this.checkExport(t,s.exported.name,s.exported.start),e.push(this.finishNode(s,"ExportSpecifier"))}return e},q.parseImport=function(t){return this.next(),this.type===y.string?(t.specifiers=j,t.source=this.parseExprAtom()):(t.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),t.source=this.type===y.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(t,"ImportDeclaration")},q.parseImportSpecifiers=function(){var t=[],e=!0;if(this.type===y.name){var i=this.startNode();if(i.local=this.parseIdent(),this.checkLVal(i.local,"let"),t.push(this.finishNode(i,"ImportDefaultSpecifier")),!this.eat(y.comma))return t}if(this.type===y.star){var s=this.startNode();return this.next(),this.expectContextual("as"),s.local=this.parseIdent(),this.checkLVal(s.local,"let"),t.push(this.finishNode(s,"ImportNamespaceSpecifier")),t}for(this.expect(y.braceL);!this.eat(y.braceR);){if(e)e=!1;else if(this.expect(y.comma),this.afterTrailingComma(y.braceR))break;var r=this.startNode();r.imported=this.parseIdent(!0),this.eatContextual("as")?r.local=this.parseIdent():(this.checkUnreserved(r.imported),r.local=r.imported),this.checkLVal(r.local,"let"),t.push(this.finishNode(r,"ImportSpecifier"))}return t},q.adaptDirectivePrologue=function(t){for(var e=0;e<t.length&&this.isDirectiveCandidate(t[e]);++e)t[e].directive=t[e].expression.raw.slice(1,-1)},q.isDirectiveCandidate=function(t){return"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"string"==typeof t.expression.value&&('"'===this.input[t.start]||"'"===this.input[t.start])};var z=M.prototype;z.toAssignable=function(t,e,i){if(this.options.ecmaVersion>=6&&t)switch(t.type){case"Identifier":this.inAsync&&"await"===t.name&&this.raise(t.start,"Can not use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":t.type="ObjectPattern",i&&this.checkPatternErrors(i,!0);for(var s=0,r=t.properties;s<r.length;s+=1){var a=r[s];this.toAssignable(a,e),"RestElement"!==a.type||"ArrayPattern"!==a.argument.type&&"ObjectPattern"!==a.argument.type||this.raise(a.argument.start,"Unexpected token")}break;case"Property":"init"!==t.kind&&this.raise(t.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(t.value,e);break;case"ArrayExpression":t.type="ArrayPattern",i&&this.checkPatternErrors(i,!0),this.toAssignableList(t.elements,e);break;case"SpreadElement":t.type="RestElement",this.toAssignable(t.argument,e),"AssignmentPattern"===t.argument.type&&this.raise(t.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==t.operator&&this.raise(t.left.end,"Only '=' operator can be used for specifying default value."),t.type="AssignmentPattern",delete t.operator,this.toAssignable(t.left,e);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(t.expression,e);break;case"MemberExpression":if(!e)break;default:this.raise(t.start,"Assigning to rvalue")}else i&&this.checkPatternErrors(i,!0);return t},z.toAssignableList=function(t,e){for(var i=t.length,s=0;s<i;s++){var r=t[s];r&&this.toAssignable(r,e)}if(i){var a=t[i-1];6===this.options.ecmaVersion&&e&&a&&"RestElement"===a.type&&"Identifier"!==a.argument.type&&this.unexpected(a.argument.start)}return t},z.parseSpread=function(t){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,t),this.finishNode(e,"SpreadElement")},z.parseRestBinding=function(){var t=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==y.name&&this.unexpected(),t.argument=this.parseBindingAtom(),this.finishNode(t,"RestElement")},z.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case y.bracketL:var t=this.startNode();return this.next(),t.elements=this.parseBindingList(y.bracketR,!0,!0),this.finishNode(t,"ArrayPattern");case y.braceL:return this.parseObj(!0)}return this.parseIdent()},z.parseBindingList=function(t,e,i){for(var s=[],r=!0;!this.eat(t);)if(r?r=!1:this.expect(y.comma),e&&this.type===y.comma)s.push(null);else{if(i&&this.afterTrailingComma(t))break;if(this.type===y.ellipsis){var a=this.parseRestBinding();this.parseBindingListItem(a),s.push(a),this.type===y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(t);break}var n=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(n),s.push(n)}return s},z.parseBindingListItem=function(t){return t},z.parseMaybeDefault=function(t,e,i){if(i=i||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(y.eq))return i;var s=this.startNodeAt(t,e);return s.left=i,s.right=this.parseMaybeAssign(),this.finishNode(s,"AssignmentPattern")},z.checkLVal=function(t,e,i){switch(t.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(t.name)&&this.raiseRecoverable(t.start,(e?"Binding ":"Assigning to ")+t.name+" in strict mode"),i&&(I(i,t.name)&&this.raiseRecoverable(t.start,"Argument name clash"),i[t.name]=!0),e&&"none"!==e&&(("var"===e&&!this.canDeclareVarName(t.name)||"var"!==e&&!this.canDeclareLexicalName(t.name))&&this.raiseRecoverable(t.start,"Identifier '"+t.name+"' has already been declared"),"var"===e?this.declareVarName(t.name):this.declareLexicalName(t.name));break;case"MemberExpression":e&&this.raiseRecoverable(t.start,"Binding member expression");break;case"ObjectPattern":for(var s=0,r=t.properties;s<r.length;s+=1){var a=r[s];this.checkLVal(a,e,i)}break;case"Property":this.checkLVal(t.value,e,i);break;case"ArrayPattern":for(var n=0,o=t.elements;n<o.length;n+=1){var h=o[n];h&&this.checkLVal(h,e,i)}break;case"AssignmentPattern":this.checkLVal(t.left,e,i);break;case"RestElement":this.checkLVal(t.argument,e,i);break;case"ParenthesizedExpression":this.checkLVal(t.expression,e,i);break;default:this.raise(t.start,(e?"Binding":"Assigning to")+" rvalue")}};var Q=M.prototype;Q.checkPropClash=function(t,e,i){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===t.type||this.options.ecmaVersion>=6&&(t.computed||t.method||t.shorthand))){var s,r=t.key;switch(r.type){case"Identifier":s=r.name;break;case"Literal":s=String(r.value);break;default:return}var a=t.kind;if(this.options.ecmaVersion>=6)"__proto__"===s&&"init"===a&&(e.proto&&(i&&i.doubleProto<0?i.doubleProto=r.start:this.raiseRecoverable(r.start,"Redefinition of __proto__ property")),e.proto=!0);else{var n=e[s="$"+s];if(n)("init"===a?this.strict&&n.init||n.get||n.set:n.init||n[a])&&this.raiseRecoverable(r.start,"Redefinition of property");else n=e[s]={init:!1,get:!1,set:!1};n[a]=!0}}},Q.parseExpression=function(t,e){var i=this.start,s=this.startLoc,r=this.parseMaybeAssign(t,e);if(this.type===y.comma){var a=this.startNodeAt(i,s);for(a.expressions=[r];this.eat(y.comma);)a.expressions.push(this.parseMaybeAssign(t,e));return this.finishNode(a,"SequenceExpression")}return r},Q.parseMaybeAssign=function(t,e,i){if(this.inGenerator&&this.isContextual("yield"))return this.parseYield();var s=!1,r=-1,a=-1;e?(r=e.parenthesizedAssign,a=e.trailingComma,e.parenthesizedAssign=e.trailingComma=-1):(e=new G,s=!0);var n=this.start,o=this.startLoc;this.type!==y.parenL&&this.type!==y.name||(this.potentialArrowAt=this.start);var h=this.parseMaybeConditional(t,e);if(i&&(h=i.call(this,h,n,o)),this.type.isAssign){var p=this.startNodeAt(n,o);return p.operator=this.value,p.left=this.type===y.eq?this.toAssignable(h,!1,e):h,s||G.call(e),e.shorthandAssign=-1,this.checkLVal(h),this.next(),p.right=this.parseMaybeAssign(t),this.finishNode(p,"AssignmentExpression")}return s&&this.checkExpressionErrors(e,!0),r>-1&&(e.parenthesizedAssign=r),a>-1&&(e.trailingComma=a),h},Q.parseMaybeConditional=function(t,e){var i=this.start,s=this.startLoc,r=this.parseExprOps(t,e);if(this.checkExpressionErrors(e))return r;if(this.eat(y.question)){var a=this.startNodeAt(i,s);return a.test=r,a.consequent=this.parseMaybeAssign(),this.expect(y.colon),a.alternate=this.parseMaybeAssign(t),this.finishNode(a,"ConditionalExpression")}return r},Q.parseExprOps=function(t,e){var i=this.start,s=this.startLoc,r=this.parseMaybeUnary(e,!1);return this.checkExpressionErrors(e)?r:r.start===i&&"ArrowFunctionExpression"===r.type?r:this.parseExprOp(r,i,s,-1,t)},Q.parseExprOp=function(t,e,i,s,r){var a=this.type.binop;if(null!=a&&(!r||this.type!==y._in)&&a>s){var n=this.type===y.logicalOR||this.type===y.logicalAND,o=this.value;this.next();var h=this.start,p=this.startLoc,c=this.parseExprOp(this.parseMaybeUnary(null,!1),h,p,a,r),u=this.buildBinary(e,i,t,c,o,n);return this.parseExprOp(u,e,i,s,r)}return t},Q.buildBinary=function(t,e,i,s,r,a){var n=this.startNodeAt(t,e);return n.left=i,n.operator=r,n.right=s,this.finishNode(n,a?"LogicalExpression":"BinaryExpression")},Q.parseMaybeUnary=function(t,e){var i,s=this.start,r=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))i=this.parseAwait(),e=!0;else if(this.type.prefix){var a=this.startNode(),n=this.type===y.incDec;a.operator=this.value,a.prefix=!0,this.next(),a.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(t,!0),n?this.checkLVal(a.argument):this.strict&&"delete"===a.operator&&"Identifier"===a.argument.type?this.raiseRecoverable(a.start,"Deleting local variable in strict mode"):e=!0,i=this.finishNode(a,n?"UpdateExpression":"UnaryExpression")}else{if(i=this.parseExprSubscripts(t),this.checkExpressionErrors(t))return i;for(;this.type.postfix&&!this.canInsertSemicolon();){var o=this.startNodeAt(s,r);o.operator=this.value,o.prefix=!1,o.argument=i,this.checkLVal(i),this.next(),i=this.finishNode(o,"UpdateExpression")}}return!e&&this.eat(y.starstar)?this.buildBinary(s,r,i,this.parseMaybeUnary(null,!1),"**",!1):i},Q.parseExprSubscripts=function(t){var e=this.start,i=this.startLoc,s=this.parseExprAtom(t),r="ArrowFunctionExpression"===s.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd);if(this.checkExpressionErrors(t)||r)return s;var a=this.parseSubscripts(s,e,i);return t&&"MemberExpression"===a.type&&(t.parenthesizedAssign>=a.start&&(t.parenthesizedAssign=-1),t.parenthesizedBind>=a.start&&(t.parenthesizedBind=-1)),a},Q.parseSubscripts=function(t,e,i,s){for(var r=this.options.ecmaVersion>=8&&"Identifier"===t.type&&"async"===t.name&&this.lastTokEnd===t.end&&!this.canInsertSemicolon()&&"async"===this.input.slice(t.start,t.end),a=void 0;;)if((a=this.eat(y.bracketL))||this.eat(y.dot)){var n=this.startNodeAt(e,i);n.object=t,n.property=a?this.parseExpression():this.parseIdent(!0),n.computed=!!a,a&&this.expect(y.bracketR),t=this.finishNode(n,"MemberExpression")}else if(!s&&this.eat(y.parenL)){var o=new G,h=this.yieldPos,p=this.awaitPos;this.yieldPos=0,this.awaitPos=0;var c=this.parseExprList(y.parenR,this.options.ecmaVersion>=8,!1,o);if(r&&!this.canInsertSemicolon()&&this.eat(y.arrow))return this.checkPatternErrors(o,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=h,this.awaitPos=p,this.parseArrowExpression(this.startNodeAt(e,i),c,!0);this.checkExpressionErrors(o,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=p||this.awaitPos;var u=this.startNodeAt(e,i);u.callee=t,u.arguments=c,t=this.finishNode(u,"CallExpression")}else{if(this.type!==y.backQuote)return t;var l=this.startNodeAt(e,i);l.tag=t,l.quasi=this.parseTemplate({isTagged:!0}),t=this.finishNode(l,"TaggedTemplateExpression")}},Q.parseExprAtom=function(t){var e,i=this.potentialArrowAt===this.start;switch(this.type){case y._super:return this.inFunction||this.raise(this.start,"'super' outside of function or class"),e=this.startNode(),this.next(),this.type!==y.dot&&this.type!==y.bracketL&&this.type!==y.parenL&&this.unexpected(),this.finishNode(e,"Super");case y._this:return e=this.startNode(),this.next(),this.finishNode(e,"ThisExpression");case y.name:var s=this.start,r=this.startLoc,a=this.containsEsc,n=this.parseIdent(this.type!==y.name);if(this.options.ecmaVersion>=8&&!a&&"async"===n.name&&!this.canInsertSemicolon()&&this.eat(y._function))return this.parseFunction(this.startNodeAt(s,r),!1,!1,!0);if(i&&!this.canInsertSemicolon()){if(this.eat(y.arrow))return this.parseArrowExpression(this.startNodeAt(s,r),[n],!1);if(this.options.ecmaVersion>=8&&"async"===n.name&&this.type===y.name&&!a)return n=this.parseIdent(),!this.canInsertSemicolon()&&this.eat(y.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(s,r),[n],!0)}return n;case y.regexp:var o=this.value;return(e=this.parseLiteral(o.value)).regex={pattern:o.pattern,flags:o.flags},e;case y.num:case y.string:return this.parseLiteral(this.value);case y._null:case y._true:case y._false:return(e=this.startNode()).value=this.type===y._null?null:this.type===y._true,e.raw=this.type.keyword,this.next(),this.finishNode(e,"Literal");case y.parenL:var h=this.start,p=this.parseParenAndDistinguishExpression(i);return t&&(t.parenthesizedAssign<0&&!this.isSimpleAssignTarget(p)&&(t.parenthesizedAssign=h),t.parenthesizedBind<0&&(t.parenthesizedBind=h)),p;case y.bracketL:return e=this.startNode(),this.next(),e.elements=this.parseExprList(y.bracketR,!0,!0,t),this.finishNode(e,"ArrayExpression");case y.braceL:return this.parseObj(!1,t);case y._function:return e=this.startNode(),this.next(),this.parseFunction(e,!1);case y._class:return this.parseClass(this.startNode(),!1);case y._new:return this.parseNew();case y.backQuote:return this.parseTemplate();default:this.unexpected()}},Q.parseLiteral=function(t){var e=this.startNode();return e.value=t,e.raw=this.input.slice(this.start,this.end),this.next(),this.finishNode(e,"Literal")},Q.parseParenExpression=function(){this.expect(y.parenL);var t=this.parseExpression();return this.expect(y.parenR),t},Q.parseParenAndDistinguishExpression=function(t){var e,i=this.start,s=this.startLoc,r=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var a,n=this.start,o=this.startLoc,h=[],p=!0,c=!1,u=new G,l=this.yieldPos,d=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==y.parenR;){if(p?p=!1:this.expect(y.comma),r&&this.afterTrailingComma(y.parenR,!0)){c=!0;break}if(this.type===y.ellipsis){a=this.start,h.push(this.parseParenItem(this.parseRestBinding())),this.type===y.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}h.push(this.parseMaybeAssign(!1,u,this.parseParenItem))}var f=this.start,m=this.startLoc;if(this.expect(y.parenR),t&&!this.canInsertSemicolon()&&this.eat(y.arrow))return this.checkPatternErrors(u,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=l,this.awaitPos=d,this.parseParenArrowList(i,s,h);h.length&&!c||this.unexpected(this.lastTokStart),a&&this.unexpected(a),this.checkExpressionErrors(u,!0),this.yieldPos=l||this.yieldPos,this.awaitPos=d||this.awaitPos,h.length>1?((e=this.startNodeAt(n,o)).expressions=h,this.finishNodeAt(e,"SequenceExpression",f,m)):e=h[0]}else e=this.parseParenExpression();if(this.options.preserveParens){var x=this.startNodeAt(i,s);return x.expression=e,this.finishNode(x,"ParenthesizedExpression")}return e},Q.parseParenItem=function(t){return t},Q.parseParenArrowList=function(t,e,i){return this.parseArrowExpression(this.startNodeAt(t,e),i)};var K=[];Q.parseNew=function(){var t=this.startNode(),e=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(y.dot)){t.meta=e;var i=this.containsEsc;return t.property=this.parseIdent(!0),("target"!==t.property.name||i)&&this.raiseRecoverable(t.property.start,"The only valid meta property for new is new.target"),this.inFunction||this.raiseRecoverable(t.start,"new.target can only be used in functions"),this.finishNode(t,"MetaProperty")}var s=this.start,r=this.startLoc;return t.callee=this.parseSubscripts(this.parseExprAtom(),s,r,!0),this.eat(y.parenL)?t.arguments=this.parseExprList(y.parenR,this.options.ecmaVersion>=8,!1):t.arguments=K,this.finishNode(t,"NewExpression")},Q.parseTemplateElement=function(t){var e=t.isTagged,i=this.startNode();return this.type===y.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),i.value={raw:this.value,cooked:null}):i.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),i.tail=this.type===y.backQuote,this.finishNode(i,"TemplateElement")},Q.parseTemplate=function(t){void 0===t&&(t={});var e=t.isTagged;void 0===e&&(e=!1);var i=this.startNode();this.next(),i.expressions=[];var s=this.parseTemplateElement({isTagged:e});for(i.quasis=[s];!s.tail;)this.type===y.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(y.dollarBraceL),i.expressions.push(this.parseExpression()),this.expect(y.braceR),i.quasis.push(s=this.parseTemplateElement({isTagged:e}));return this.next(),this.finishNode(i,"TemplateLiteral")},Q.isAsyncProp=function(t){return!t.computed&&"Identifier"===t.key.type&&"async"===t.key.name&&(this.type===y.name||this.type===y.num||this.type===y.string||this.type===y.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===y.star)&&!_.test(this.input.slice(this.lastTokEnd,this.start))},Q.parseObj=function(t,e){var i=this.startNode(),s=!0,r={};for(i.properties=[],this.next();!this.eat(y.braceR);){if(s)s=!1;else if(this.expect(y.comma),this.afterTrailingComma(y.braceR))break;var a=this.parseProperty(t,e);t||this.checkPropClash(a,r,e),i.properties.push(a)}return this.finishNode(i,t?"ObjectPattern":"ObjectExpression")},Q.parseProperty=function(t,e){var i,s,r,a,n=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(y.ellipsis))return t?(n.argument=this.parseIdent(!1),this.type===y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(n,"RestElement")):(this.type===y.parenL&&e&&(e.parenthesizedAssign<0&&(e.parenthesizedAssign=this.start),e.parenthesizedBind<0&&(e.parenthesizedBind=this.start)),n.argument=this.parseMaybeAssign(!1,e),this.type===y.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(n,"SpreadElement"));this.options.ecmaVersion>=6&&(n.method=!1,n.shorthand=!1,(t||e)&&(r=this.start,a=this.startLoc),t||(i=this.eat(y.star)));var o=this.containsEsc;return this.parsePropertyName(n),!t&&!o&&this.options.ecmaVersion>=8&&!i&&this.isAsyncProp(n)?(s=!0,i=this.options.ecmaVersion>=9&&this.eat(y.star),this.parsePropertyName(n,e)):s=!1,this.parsePropertyValue(n,t,i,s,r,a,e,o),this.finishNode(n,"Property")},Q.parsePropertyValue=function(t,e,i,s,r,a,n,o){if((i||s)&&this.type===y.colon&&this.unexpected(),this.eat(y.colon))t.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,n),t.kind="init";else if(this.options.ecmaVersion>=6&&this.type===y.parenL)e&&this.unexpected(),t.kind="init",t.method=!0,t.value=this.parseMethod(i,s);else if(e||o||!(this.options.ecmaVersion>=5)||t.computed||"Identifier"!==t.key.type||"get"!==t.key.name&&"set"!==t.key.name||this.type===y.comma||this.type===y.braceR)this.options.ecmaVersion>=6&&!t.computed&&"Identifier"===t.key.type?(this.checkUnreserved(t.key),t.kind="init",e?t.value=this.parseMaybeDefault(r,a,t.key):this.type===y.eq&&n?(n.shorthandAssign<0&&(n.shorthandAssign=this.start),t.value=this.parseMaybeDefault(r,a,t.key)):t.value=t.key,t.shorthand=!0):this.unexpected();else{(i||s)&&this.unexpected(),t.kind=t.key.name,this.parsePropertyName(t),t.value=this.parseMethod(!1);var h="get"===t.kind?0:1;if(t.value.params.length!==h){var p=t.value.start;"get"===t.kind?this.raiseRecoverable(p,"getter should have no params"):this.raiseRecoverable(p,"setter should have exactly one param")}else"set"===t.kind&&"RestElement"===t.value.params[0].type&&this.raiseRecoverable(t.value.params[0].start,"Setter cannot use rest params")}},Q.parsePropertyName=function(t){if(this.options.ecmaVersion>=6){if(this.eat(y.bracketL))return t.computed=!0,t.key=this.parseMaybeAssign(),this.expect(y.bracketR),t.key;t.computed=!1}return t.key=this.type===y.num||this.type===y.string?this.parseExprAtom():this.parseIdent(!0)},Q.initFunction=function(t){t.id=null,this.options.ecmaVersion>=6&&(t.generator=!1,t.expression=!1),this.options.ecmaVersion>=8&&(t.async=!1)},Q.parseMethod=function(t,e){var i=this.startNode(),s=this.inGenerator,r=this.inAsync,a=this.yieldPos,n=this.awaitPos,o=this.inFunction;return this.initFunction(i),this.options.ecmaVersion>=6&&(i.generator=t),this.options.ecmaVersion>=8&&(i.async=!!e),this.inGenerator=i.generator,this.inAsync=i.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),this.expect(y.parenL),i.params=this.parseBindingList(y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(i,!1),this.inGenerator=s,this.inAsync=r,this.yieldPos=a,this.awaitPos=n,this.inFunction=o,this.finishNode(i,"FunctionExpression")},Q.parseArrowExpression=function(t,e,i){var s=this.inGenerator,r=this.inAsync,a=this.yieldPos,n=this.awaitPos,o=this.inFunction;return this.enterFunctionScope(),this.initFunction(t),this.options.ecmaVersion>=8&&(t.async=!!i),this.inGenerator=!1,this.inAsync=t.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,t.params=this.toAssignableList(e,!0),this.parseFunctionBody(t,!0),this.inGenerator=s,this.inAsync=r,this.yieldPos=a,this.awaitPos=n,this.inFunction=o,this.finishNode(t,"ArrowFunctionExpression")},Q.parseFunctionBody=function(t,e){var i=e&&this.type!==y.braceL,s=this.strict,r=!1;if(i)t.body=this.parseMaybeAssign(),t.expression=!0,this.checkParams(t,!1);else{var a=this.options.ecmaVersion>=7&&!this.isSimpleParamList(t.params);s&&!a||(r=this.strictDirective(this.end))&&a&&this.raiseRecoverable(t.start,"Illegal 'use strict' directive in function with non-simple parameter list");var n=this.labels;this.labels=[],r&&(this.strict=!0),this.checkParams(t,!s&&!r&&!e&&this.isSimpleParamList(t.params)),t.body=this.parseBlock(!1),t.expression=!1,this.adaptDirectivePrologue(t.body.body),this.labels=n}this.exitFunctionScope(),this.strict&&t.id&&this.checkLVal(t.id,"none"),this.strict=s},Q.isSimpleParamList=function(t){for(var e=0,i=t;e<i.length;e+=1){if("Identifier"!==i[e].type)return!1}return!0},Q.checkParams=function(t,e){for(var i={},s=0,r=t.params;s<r.length;s+=1){var a=r[s];this.checkLVal(a,"var",e?null:i)}},Q.parseExprList=function(t,e,i,s){for(var r=[],a=!0;!this.eat(t);){if(a)a=!1;else if(this.expect(y.comma),e&&this.afterTrailingComma(t))break;var n=void 0;i&&this.type===y.comma?n=null:this.type===y.ellipsis?(n=this.parseSpread(s),s&&this.type===y.comma&&s.trailingComma<0&&(s.trailingComma=this.start)):n=this.parseMaybeAssign(!1,s),r.push(n)}return r},Q.checkUnreserved=function(t){var e=t.start,i=t.end,s=t.name;(this.inGenerator&&"yield"===s&&this.raiseRecoverable(e,"Can not use 'yield' as identifier inside a generator"),this.inAsync&&"await"===s&&this.raiseRecoverable(e,"Can not use 'await' as identifier inside an async function"),this.isKeyword(s)&&this.raise(e,"Unexpected keyword '"+s+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(e,i).indexOf("\\"))||(this.strict?this.reservedWordsStrict:this.reservedWords).test(s)&&(this.inAsync||"await"!==s||this.raiseRecoverable(e,"Can not use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+s+"' is reserved"))},Q.parseIdent=function(t,e){var i=this.startNode();return t&&"never"===this.options.allowReserved&&(t=!1),this.type===y.name?i.name=this.value:this.type.keyword?(i.name=this.type.keyword,"class"!==i.name&&"function"!==i.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(),this.finishNode(i,"Identifier"),t||this.checkUnreserved(i),i},Q.parseYield=function(){this.yieldPos||(this.yieldPos=this.start);var t=this.startNode();return this.next(),this.type===y.semi||this.canInsertSemicolon()||this.type!==y.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(y.star),t.argument=this.parseMaybeAssign()),this.finishNode(t,"YieldExpression")},Q.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var t=this.startNode();return this.next(),t.argument=this.parseMaybeUnary(null,!0),this.finishNode(t,"AwaitExpression")};var X=M.prototype;X.raise=function(t,e){var i=T(this.input,t);e+=" ("+i.line+":"+i.column+")";var s=new SyntaxError(e);throw s.pos=t,s.loc=i,s.raisedAt=this.pos,s},X.raiseRecoverable=X.raise,X.curPosition=function(){if(this.options.locations)return new L(this.curLine,this.pos-this.lineStart)};var Y=M.prototype,Z=Object.assign||function(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];for(var s=0,r=e;s<r.length;s+=1){var a=r[s];for(var n in a)I(a,n)&&(t[n]=a[n])}return t};Y.enterFunctionScope=function(){this.scopeStack.push({var:{},lexical:{},childVar:{},parentLexical:{}})},Y.exitFunctionScope=function(){this.scopeStack.pop()},Y.enterLexicalScope=function(){var t=this.scopeStack[this.scopeStack.length-1],e={var:{},lexical:{},childVar:{},parentLexical:{}};this.scopeStack.push(e),Z(e.parentLexical,t.lexical,t.parentLexical)},Y.exitLexicalScope=function(){var t=this.scopeStack.pop(),e=this.scopeStack[this.scopeStack.length-1];Z(e.childVar,t.var,t.childVar)},Y.canDeclareVarName=function(t){var e=this.scopeStack[this.scopeStack.length-1];return!I(e.lexical,t)&&!I(e.parentLexical,t)},Y.canDeclareLexicalName=function(t){var e=this.scopeStack[this.scopeStack.length-1];return!I(e.lexical,t)&&!I(e.var,t)&&!I(e.childVar,t)},Y.declareVarName=function(t){this.scopeStack[this.scopeStack.length-1].var[t]=!0},Y.declareLexicalName=function(t){this.scopeStack[this.scopeStack.length-1].lexical[t]=!0};var $=function(t,e,i){this.type="",this.start=e,this.end=0,t.options.locations&&(this.loc=new N(t,i)),t.options.directSourceFile&&(this.sourceFile=t.options.directSourceFile),t.options.ranges&&(this.range=[e,0])};exports.Node=$;var J=M.prototype;function tt(t,e,i,s){return t.type=e,t.end=i,this.options.locations&&(t.loc.end=s),this.options.ranges&&(t.range[1]=i),t}J.startNode=function(){return new $(this,this.start,this.startLoc)},J.startNodeAt=function(t,e){return new $(this,t,e)},J.finishNode=function(t,e){return tt.call(this,t,e,this.lastTokEnd,this.lastTokEndLoc)},J.finishNodeAt=function(t,e,i,s){return tt.call(this,t,e,i,s)};var et=function(t,e,i,s,r){this.token=t,this.isExpr=!!e,this.preserveSpace=!!i,this.override=s,this.generator=!!r};exports.TokContext=et;var it={b_stat:new et("{",!1),b_expr:new et("{",!0),b_tmpl:new et("${",!1),p_stat:new et("(",!1),p_expr:new et("(",!0),q_tmpl:new et("`",!0,!0,function(t){return t.tryReadTemplateToken()}),f_stat:new et("function",!1),f_expr:new et("function",!0),f_expr_gen:new et("function",!0,!1,null,!0),f_gen:new et("function",!1,!1,null,!0)};exports.tokContexts=it;var st=M.prototype;st.initialContext=function(){return[it.b_stat]},st.braceIsBlock=function(t){var e=this.curContext();return e===it.f_expr||e===it.f_stat||(t!==y.colon||e!==it.b_stat&&e!==it.b_expr?t===y._return||t===y.name&&this.exprAllowed?_.test(this.input.slice(this.lastTokEnd,this.start)):t===y._else||t===y.semi||t===y.eof||t===y.parenR||t===y.arrow||(t===y.braceL?e===it.b_stat:t!==y._var&&t!==y.name&&!this.exprAllowed):!e.isExpr)},st.inGeneratorContext=function(){for(var t=this.context.length-1;t>=1;t--){var e=this.context[t];if("function"===e.token)return e.generator}return!1},st.updateContext=function(t){var e,i=this.type;i.keyword&&t===y.dot?this.exprAllowed=!1:(e=i.updateContext)?e.call(this,t):this.exprAllowed=i.beforeExpr},y.parenR.updateContext=y.braceR.updateContext=function(){if(1!==this.context.length){var t=this.context.pop();t===it.b_stat&&"function"===this.curContext().token&&(t=this.context.pop()),this.exprAllowed=!t.isExpr}else this.exprAllowed=!0},y.braceL.updateContext=function(t){this.context.push(this.braceIsBlock(t)?it.b_stat:it.b_expr),this.exprAllowed=!0},y.dollarBraceL.updateContext=function(){this.context.push(it.b_tmpl),this.exprAllowed=!0},y.parenL.updateContext=function(t){var e=t===y._if||t===y._for||t===y._with||t===y._while;this.context.push(e?it.p_stat:it.p_expr),this.exprAllowed=!0},y.incDec.updateContext=function(){},y._function.updateContext=y._class.updateContext=function(t){t.beforeExpr&&t!==y.semi&&t!==y._else&&(t!==y.colon&&t!==y.braceL||this.curContext()!==it.b_stat)?this.context.push(it.f_expr):this.context.push(it.f_stat),this.exprAllowed=!1},y.backQuote.updateContext=function(){this.curContext()===it.q_tmpl?this.context.pop():this.context.push(it.q_tmpl),this.exprAllowed=!1},y.star.updateContext=function(t){if(t===y._function){var e=this.context.length-1;this.context[e]===it.f_expr?this.context[e]=it.f_expr_gen:this.context[e]=it.f_gen}this.exprAllowed=!0},y.name.updateContext=function(t){var e=!1;this.options.ecmaVersion>=6&&t!==y.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var rt={$LONE:["ASCII","ASCII_Hex_Digit","AHex","Alphabetic","Alpha","Any","Assigned","Bidi_Control","Bidi_C","Bidi_Mirrored","Bidi_M","Case_Ignorable","CI","Cased","Changes_When_Casefolded","CWCF","Changes_When_Casemapped","CWCM","Changes_When_Lowercased","CWL","Changes_When_NFKC_Casefolded","CWKCF","Changes_When_Titlecased","CWT","Changes_When_Uppercased","CWU","Dash","Default_Ignorable_Code_Point","DI","Deprecated","Dep","Diacritic","Dia","Emoji","Emoji_Component","Emoji_Modifier","Emoji_Modifier_Base","Emoji_Presentation","Extender","Ext","Grapheme_Base","Gr_Base","Grapheme_Extend","Gr_Ext","Hex_Digit","Hex","IDS_Binary_Operator","IDSB","IDS_Trinary_Operator","IDST","ID_Continue","IDC","ID_Start","IDS","Ideographic","Ideo","Join_Control","Join_C","Logical_Order_Exception","LOE","Lowercase","Lower","Math","Noncharacter_Code_Point","NChar","Pattern_Syntax","Pat_Syn","Pattern_White_Space","Pat_WS","Quotation_Mark","QMark","Radical","Regional_Indicator","RI","Sentence_Terminal","STerm","Soft_Dotted","SD","Terminal_Punctuation","Term","Unified_Ideograph","UIdeo","Uppercase","Upper","Variation_Selector","VS","White_Space","space","XID_Continue","XIDC","XID_Start","XIDS"],General_Category:["Cased_Letter","LC","Close_Punctuation","Pe","Connector_Punctuation","Pc","Control","Cc","cntrl","Currency_Symbol","Sc","Dash_Punctuation","Pd","Decimal_Number","Nd","digit","Enclosing_Mark","Me","Final_Punctuation","Pf","Format","Cf","Initial_Punctuation","Pi","Letter","L","Letter_Number","Nl","Line_Separator","Zl","Lowercase_Letter","Ll","Mark","M","Combining_Mark","Math_Symbol","Sm","Modifier_Letter","Lm","Modifier_Symbol","Sk","Nonspacing_Mark","Mn","Number","N","Open_Punctuation","Ps","Other","C","Other_Letter","Lo","Other_Number","No","Other_Punctuation","Po","Other_Symbol","So","Paragraph_Separator","Zp","Private_Use","Co","Punctuation","P","punct","Separator","Z","Space_Separator","Zs","Spacing_Mark","Mc","Surrogate","Cs","Symbol","S","Titlecase_Letter","Lt","Unassigned","Cn","Uppercase_Letter","Lu"],Script:["Adlam","Adlm","Ahom","Anatolian_Hieroglyphs","Hluw","Arabic","Arab","Armenian","Armn","Avestan","Avst","Balinese","Bali","Bamum","Bamu","Bassa_Vah","Bass","Batak","Batk","Bengali","Beng","Bhaiksuki","Bhks","Bopomofo","Bopo","Brahmi","Brah","Braille","Brai","Buginese","Bugi","Buhid","Buhd","Canadian_Aboriginal","Cans","Carian","Cari","Caucasian_Albanian","Aghb","Chakma","Cakm","Cham","Cherokee","Cher","Common","Zyyy","Coptic","Copt","Qaac","Cuneiform","Xsux","Cypriot","Cprt","Cyrillic","Cyrl","Deseret","Dsrt","Devanagari","Deva","Duployan","Dupl","Egyptian_Hieroglyphs","Egyp","Elbasan","Elba","Ethiopic","Ethi","Georgian","Geor","Glagolitic","Glag","Gothic","Goth","Grantha","Gran","Greek","Grek","Gujarati","Gujr","Gurmukhi","Guru","Han","Hani","Hangul","Hang","Hanunoo","Hano","Hatran","Hatr","Hebrew","Hebr","Hiragana","Hira","Imperial_Aramaic","Armi","Inherited","Zinh","Qaai","Inscriptional_Pahlavi","Phli","Inscriptional_Parthian","Prti","Javanese","Java","Kaithi","Kthi","Kannada","Knda","Katakana","Kana","Kayah_Li","Kali","Kharoshthi","Khar","Khmer","Khmr","Khojki","Khoj","Khudawadi","Sind","Lao","Laoo","Latin","Latn","Lepcha","Lepc","Limbu","Limb","Linear_A","Lina","Linear_B","Linb","Lisu","Lycian","Lyci","Lydian","Lydi","Mahajani","Mahj","Malayalam","Mlym","Mandaic","Mand","Manichaean","Mani","Marchen","Marc","Masaram_Gondi","Gonm","Meetei_Mayek","Mtei","Mende_Kikakui","Mend","Meroitic_Cursive","Merc","Meroitic_Hieroglyphs","Mero","Miao","Plrd","Modi","Mongolian","Mong","Mro","Mroo","Multani","Mult","Myanmar","Mymr","Nabataean","Nbat","New_Tai_Lue","Talu","Newa","Nko","Nkoo","Nushu","Nshu","Ogham","Ogam","Ol_Chiki","Olck","Old_Hungarian","Hung","Old_Italic","Ital","Old_North_Arabian","Narb","Old_Permic","Perm","Old_Persian","Xpeo","Old_South_Arabian","Sarb","Old_Turkic","Orkh","Oriya","Orya","Osage","Osge","Osmanya","Osma","Pahawh_Hmong","Hmng","Palmyrene","Palm","Pau_Cin_Hau","Pauc","Phags_Pa","Phag","Phoenician","Phnx","Psalter_Pahlavi","Phlp","Rejang","Rjng","Runic","Runr","Samaritan","Samr","Saurashtra","Saur","Sharada","Shrd","Shavian","Shaw","Siddham","Sidd","SignWriting","Sgnw","Sinhala","Sinh","Sora_Sompeng","Sora","Soyombo","Soyo","Sundanese","Sund","Syloti_Nagri","Sylo","Syriac","Syrc","Tagalog","Tglg","Tagbanwa","Tagb","Tai_Le","Tale","Tai_Tham","Lana","Tai_Viet","Tavt","Takri","Takr","Tamil","Taml","Tangut","Tang","Telugu","Telu","Thaana","Thaa","Thai","Tibetan","Tibt","Tifinagh","Tfng","Tirhuta","Tirh","Ugaritic","Ugar","Vai","Vaii","Warang_Citi","Wara","Yi","Yiii","Zanabazar_Square","Zanb"]};Array.prototype.push.apply(rt.$LONE,rt.General_Category),rt.gc=rt.General_Category,rt.sc=rt.Script_Extensions=rt.scx=rt.Script;var at=M.prototype,nt=function(t){this.parser=t,this.validFlags="gim"+(t.options.ecmaVersion>=6?"uy":"")+(t.options.ecmaVersion>=9?"s":""),this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function ot(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}function ht(t){return 36===t||t>=40&&t<=43||46===t||63===t||t>=91&&t<=94||t>=123&&t<=125}function pt(t){return u(t,!0)||36===t||95===t}function ct(t){return l(t,!0)||36===t||95===t||8204===t||8205===t}function ut(t){return t>=65&&t<=90||t>=97&&t<=122}function lt(t){return t>=0&&t<=1114111}function dt(t){return 100===t||68===t||115===t||83===t||119===t||87===t}function ft(t){return ut(t)||95===t}function mt(t){return ft(t)||xt(t)}function xt(t){return t>=48&&t<=57}function gt(t){return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102}function vt(t){return t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:t-48}function yt(t){return t>=48&&t<=55}nt.prototype.reset=function(t,e,i){var s=-1!==i.indexOf("u");this.start=0|t,this.source=e+"",this.flags=i,this.switchU=s&&this.parser.options.ecmaVersion>=6,this.switchN=s&&this.parser.options.ecmaVersion>=9},nt.prototype.raise=function(t){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+t)},nt.prototype.at=function(t){var e=this.source,i=e.length;if(t>=i)return-1;var s=e.charCodeAt(t);return!this.switchU||s<=55295||s>=57344||t+1>=i?s:(s<<10)+e.charCodeAt(t+1)-56613888},nt.prototype.nextIndex=function(t){var e=this.source,i=e.length;if(t>=i)return i;var s=e.charCodeAt(t);return!this.switchU||s<=55295||s>=57344||t+1>=i?t+1:t+2},nt.prototype.current=function(){return this.at(this.pos)},nt.prototype.lookahead=function(){return this.at(this.nextIndex(this.pos))},nt.prototype.advance=function(){this.pos=this.nextIndex(this.pos)},nt.prototype.eat=function(t){return this.current()===t&&(this.advance(),!0)},at.validateRegExpFlags=function(t){for(var e=t.validFlags,i=t.flags,s=0;s<i.length;s++){var r=i.charAt(s);-1===e.indexOf(r)&&this.raise(t.start,"Invalid regular expression flag"),i.indexOf(r,s+1)>-1&&this.raise(t.start,"Duplicate regular expression flag")}},at.validateRegExpPattern=function(t){this.regexp_pattern(t),!t.switchN&&this.options.ecmaVersion>=9&&t.groupNames.length>0&&(t.switchN=!0,this.regexp_pattern(t))},at.regexp_pattern=function(t){t.pos=0,t.lastIntValue=0,t.lastStringValue="",t.lastAssertionIsQuantifiable=!1,t.numCapturingParens=0,t.maxBackReference=0,t.groupNames.length=0,t.backReferenceNames.length=0,this.regexp_disjunction(t),t.pos!==t.source.length&&(t.eat(41)&&t.raise("Unmatched ')'"),(t.eat(93)||t.eat(125))&&t.raise("Lone quantifier brackets")),t.maxBackReference>t.numCapturingParens&&t.raise("Invalid escape");for(var e=0,i=t.backReferenceNames;e<i.length;e+=1){var s=i[e];-1===t.groupNames.indexOf(s)&&t.raise("Invalid named capture referenced")}},at.regexp_disjunction=function(t){for(this.regexp_alternative(t);t.eat(124);)this.regexp_alternative(t);this.regexp_eatQuantifier(t,!0)&&t.raise("Nothing to repeat"),t.eat(123)&&t.raise("Lone quantifier brackets")},at.regexp_alternative=function(t){for(;t.pos<t.source.length&&this.regexp_eatTerm(t););},at.regexp_eatTerm=function(t){return this.regexp_eatAssertion(t)?(t.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(t)&&t.switchU&&t.raise("Invalid quantifier"),!0):!(t.switchU?!this.regexp_eatAtom(t):!this.regexp_eatExtendedAtom(t))&&(this.regexp_eatQuantifier(t),!0)},at.regexp_eatAssertion=function(t){var e=t.pos;if(t.lastAssertionIsQuantifiable=!1,t.eat(94)||t.eat(36))return!0;if(t.eat(92)){if(t.eat(66)||t.eat(98))return!0;t.pos=e}if(t.eat(40)&&t.eat(63)){var i=!1;if(this.options.ecmaVersion>=9&&(i=t.eat(60)),t.eat(61)||t.eat(33))return this.regexp_disjunction(t),t.eat(41)||t.raise("Unterminated group"),t.lastAssertionIsQuantifiable=!i,!0}return t.pos=e,!1},at.regexp_eatQuantifier=function(t,e){return void 0===e&&(e=!1),!!this.regexp_eatQuantifierPrefix(t,e)&&(t.eat(63),!0)},at.regexp_eatQuantifierPrefix=function(t,e){return t.eat(42)||t.eat(43)||t.eat(63)||this.regexp_eatBracedQuantifier(t,e)},at.regexp_eatBracedQuantifier=function(t,e){var i=t.pos;if(t.eat(123)){var s=0,r=-1;if(this.regexp_eatDecimalDigits(t)&&(s=t.lastIntValue,t.eat(44)&&this.regexp_eatDecimalDigits(t)&&(r=t.lastIntValue),t.eat(125)))return-1!==r&&r<s&&!e&&t.raise("numbers out of order in {} quantifier"),!0;t.switchU&&!e&&t.raise("Incomplete quantifier"),t.pos=i}return!1},at.regexp_eatAtom=function(t){return this.regexp_eatPatternCharacters(t)||t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)},at.regexp_eatReverseSolidusAtomEscape=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatAtomEscape(t))return!0;t.pos=e}return!1},at.regexp_eatUncapturingGroup=function(t){var e=t.pos;if(t.eat(40)){if(t.eat(63)&&t.eat(58)){if(this.regexp_disjunction(t),t.eat(41))return!0;t.raise("Unterminated group")}t.pos=e}return!1},at.regexp_eatCapturingGroup=function(t){if(t.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(t):63===t.current()&&t.raise("Invalid group"),this.regexp_disjunction(t),t.eat(41))return t.numCapturingParens+=1,!0;t.raise("Unterminated group")}return!1},at.regexp_eatExtendedAtom=function(t){return t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)||this.regexp_eatInvalidBracedQuantifier(t)||this.regexp_eatExtendedPatternCharacter(t)},at.regexp_eatInvalidBracedQuantifier=function(t){return this.regexp_eatBracedQuantifier(t,!0)&&t.raise("Nothing to repeat"),!1},at.regexp_eatSyntaxCharacter=function(t){var e=t.current();return!!ht(e)&&(t.lastIntValue=e,t.advance(),!0)},at.regexp_eatPatternCharacters=function(t){for(var e=t.pos,i=0;-1!==(i=t.current())&&!ht(i);)t.advance();return t.pos!==e},at.regexp_eatExtendedPatternCharacter=function(t){var e=t.current();return!(-1===e||36===e||e>=40&&e<=43||46===e||63===e||91===e||94===e||124===e)&&(t.advance(),!0)},at.regexp_groupSpecifier=function(t){if(t.eat(63)){if(this.regexp_eatGroupName(t))return-1!==t.groupNames.indexOf(t.lastStringValue)&&t.raise("Duplicate capture group name"),void t.groupNames.push(t.lastStringValue);t.raise("Invalid group")}},at.regexp_eatGroupName=function(t){if(t.lastStringValue="",t.eat(60)){if(this.regexp_eatRegExpIdentifierName(t)&&t.eat(62))return!0;t.raise("Invalid capture group name")}return!1},at.regexp_eatRegExpIdentifierName=function(t){if(t.lastStringValue="",this.regexp_eatRegExpIdentifierStart(t)){for(t.lastStringValue+=ot(t.lastIntValue);this.regexp_eatRegExpIdentifierPart(t);)t.lastStringValue+=ot(t.lastIntValue);return!0}return!1},at.regexp_eatRegExpIdentifierStart=function(t){var e=t.pos,i=t.current();return t.advance(),92===i&&this.regexp_eatRegExpUnicodeEscapeSequence(t)&&(i=t.lastIntValue),pt(i)?(t.lastIntValue=i,!0):(t.pos=e,!1)},at.regexp_eatRegExpIdentifierPart=function(t){var e=t.pos,i=t.current();return t.advance(),92===i&&this.regexp_eatRegExpUnicodeEscapeSequence(t)&&(i=t.lastIntValue),ct(i)?(t.lastIntValue=i,!0):(t.pos=e,!1)},at.regexp_eatAtomEscape=function(t){return!!(this.regexp_eatBackReference(t)||this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)||t.switchN&&this.regexp_eatKGroupName(t))||(t.switchU&&(99===t.current()&&t.raise("Invalid unicode escape"),t.raise("Invalid escape")),!1)},at.regexp_eatBackReference=function(t){var e=t.pos;if(this.regexp_eatDecimalEscape(t)){var i=t.lastIntValue;if(t.switchU)return i>t.maxBackReference&&(t.maxBackReference=i),!0;if(i<=t.numCapturingParens)return!0;t.pos=e}return!1},at.regexp_eatKGroupName=function(t){if(t.eat(107)){if(this.regexp_eatGroupName(t))return t.backReferenceNames.push(t.lastStringValue),!0;t.raise("Invalid named reference")}return!1},at.regexp_eatCharacterEscape=function(t){return this.regexp_eatControlEscape(t)||this.regexp_eatCControlLetter(t)||this.regexp_eatZero(t)||this.regexp_eatHexEscapeSequence(t)||this.regexp_eatRegExpUnicodeEscapeSequence(t)||!t.switchU&&this.regexp_eatLegacyOctalEscapeSequence(t)||this.regexp_eatIdentityEscape(t)},at.regexp_eatCControlLetter=function(t){var e=t.pos;if(t.eat(99)){if(this.regexp_eatControlLetter(t))return!0;t.pos=e}return!1},at.regexp_eatZero=function(t){return 48===t.current()&&!xt(t.lookahead())&&(t.lastIntValue=0,t.advance(),!0)},at.regexp_eatControlEscape=function(t){var e=t.current();return 116===e?(t.lastIntValue=9,t.advance(),!0):110===e?(t.lastIntValue=10,t.advance(),!0):118===e?(t.lastIntValue=11,t.advance(),!0):102===e?(t.lastIntValue=12,t.advance(),!0):114===e&&(t.lastIntValue=13,t.advance(),!0)},at.regexp_eatControlLetter=function(t){var e=t.current();return!!ut(e)&&(t.lastIntValue=e%32,t.advance(),!0)},at.regexp_eatRegExpUnicodeEscapeSequence=function(t){var e=t.pos;if(t.eat(117)){if(this.regexp_eatFixedHexDigits(t,4)){var i=t.lastIntValue;if(t.switchU&&i>=55296&&i<=56319){var s=t.pos;if(t.eat(92)&&t.eat(117)&&this.regexp_eatFixedHexDigits(t,4)){var r=t.lastIntValue;if(r>=56320&&r<=57343)return t.lastIntValue=1024*(i-55296)+(r-56320)+65536,!0}t.pos=s,t.lastIntValue=i}return!0}if(t.switchU&&t.eat(123)&&this.regexp_eatHexDigits(t)&&t.eat(125)&&lt(t.lastIntValue))return!0;t.switchU&&t.raise("Invalid unicode escape"),t.pos=e}return!1},at.regexp_eatIdentityEscape=function(t){if(t.switchU)return!!this.regexp_eatSyntaxCharacter(t)||!!t.eat(47)&&(t.lastIntValue=47,!0);var e=t.current();return!(99===e||t.switchN&&107===e)&&(t.lastIntValue=e,t.advance(),!0)},at.regexp_eatDecimalEscape=function(t){t.lastIntValue=0;var e=t.current();if(e>=49&&e<=57){do{t.lastIntValue=10*t.lastIntValue+(e-48),t.advance()}while((e=t.current())>=48&&e<=57);return!0}return!1},at.regexp_eatCharacterClassEscape=function(t){var e=t.current();if(dt(e))return t.lastIntValue=-1,t.advance(),!0;if(t.switchU&&this.options.ecmaVersion>=9&&(80===e||112===e)){if(t.lastIntValue=-1,t.advance(),t.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(t)&&t.eat(125))return!0;t.raise("Invalid property name")}return!1},at.regexp_eatUnicodePropertyValueExpression=function(t){var e=t.pos;if(this.regexp_eatUnicodePropertyName(t)&&t.eat(61)){var i=t.lastStringValue;if(this.regexp_eatUnicodePropertyValue(t)){var s=t.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(t,i,s),!0}}if(t.pos=e,this.regexp_eatLoneUnicodePropertyNameOrValue(t)){var r=t.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(t,r),!0}return!1},at.regexp_validateUnicodePropertyNameAndValue=function(t,e,i){rt.hasOwnProperty(e)&&-1!==rt[e].indexOf(i)||t.raise("Invalid property name")},at.regexp_validateUnicodePropertyNameOrValue=function(t,e){-1===rt.$LONE.indexOf(e)&&t.raise("Invalid property name")},at.regexp_eatUnicodePropertyName=function(t){var e=0;for(t.lastStringValue="";ft(e=t.current());)t.lastStringValue+=ot(e),t.advance();return""!==t.lastStringValue},at.regexp_eatUnicodePropertyValue=function(t){var e=0;for(t.lastStringValue="";mt(e=t.current());)t.lastStringValue+=ot(e),t.advance();return""!==t.lastStringValue},at.regexp_eatLoneUnicodePropertyNameOrValue=function(t){return this.regexp_eatUnicodePropertyValue(t)},at.regexp_eatCharacterClass=function(t){if(t.eat(91)){if(t.eat(94),this.regexp_classRanges(t),t.eat(93))return!0;t.raise("Unterminated character class")}return!1},at.regexp_classRanges=function(t){for(;this.regexp_eatClassAtom(t);){var e=t.lastIntValue;if(t.eat(45)&&this.regexp_eatClassAtom(t)){var i=t.lastIntValue;!t.switchU||-1!==e&&-1!==i||t.raise("Invalid character class"),-1!==e&&-1!==i&&e>i&&t.raise("Range out of order in character class")}}},at.regexp_eatClassAtom=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatClassEscape(t))return!0;if(t.switchU){var i=t.current();(99===i||yt(i))&&t.raise("Invalid class escape"),t.raise("Invalid escape")}t.pos=e}var s=t.current();return 93!==s&&(t.lastIntValue=s,t.advance(),!0)},at.regexp_eatClassEscape=function(t){var e=t.pos;if(t.eat(98))return t.lastIntValue=8,!0;if(t.switchU&&t.eat(45))return t.lastIntValue=45,!0;if(!t.switchU&&t.eat(99)){if(this.regexp_eatClassControlLetter(t))return!0;t.pos=e}return this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)},at.regexp_eatClassControlLetter=function(t){var e=t.current();return!(!xt(e)&&95!==e)&&(t.lastIntValue=e%32,t.advance(),!0)},at.regexp_eatHexEscapeSequence=function(t){var e=t.pos;if(t.eat(120)){if(this.regexp_eatFixedHexDigits(t,2))return!0;t.switchU&&t.raise("Invalid escape"),t.pos=e}return!1},at.regexp_eatDecimalDigits=function(t){var e=t.pos,i=0;for(t.lastIntValue=0;xt(i=t.current());)t.lastIntValue=10*t.lastIntValue+(i-48),t.advance();return t.pos!==e},at.regexp_eatHexDigits=function(t){var e=t.pos,i=0;for(t.lastIntValue=0;gt(i=t.current());)t.lastIntValue=16*t.lastIntValue+vt(i),t.advance();return t.pos!==e},at.regexp_eatLegacyOctalEscapeSequence=function(t){if(this.regexp_eatOctalDigit(t)){var e=t.lastIntValue;if(this.regexp_eatOctalDigit(t)){var i=t.lastIntValue;e<=3&&this.regexp_eatOctalDigit(t)?t.lastIntValue=64*e+8*i+t.lastIntValue:t.lastIntValue=8*e+i}else t.lastIntValue=e;return!0}return!1},at.regexp_eatOctalDigit=function(t){var e=t.current();return yt(e)?(t.lastIntValue=e-48,t.advance(),!0):(t.lastIntValue=0,!1)},at.regexp_eatFixedHexDigits=function(t,e){var i=t.pos;t.lastIntValue=0;for(var s=0;s<e;++s){var r=t.current();if(!gt(r))return t.pos=i,!1;t.lastIntValue=16*t.lastIntValue+vt(r),t.advance()}return!0};var _t=function(t){this.type=t.type,this.value=t.value,this.start=t.start,this.end=t.end,t.options.locations&&(this.loc=new N(t,t.startLoc,t.endLoc)),t.options.ranges&&(this.range=[t.start,t.end])};exports.Token=_t;var bt=M.prototype;function kt(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}bt.next=function(){this.options.onToken&&this.options.onToken(new _t(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},bt.getToken=function(){return this.next(),new _t(this)},"undefined"!=typeof Symbol&&(bt[Symbol.iterator]=function(){var t=this;return{next:function(){var e=t.getToken();return{done:e.type===y.eof,value:e}}}}),bt.curContext=function(){return this.context[this.context.length-1]},bt.nextToken=function(){var t=this.curContext();return t&&t.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(y.eof):t.override?t.override(this):void this.readToken(this.fullCharCodeAtPos())},bt.readToken=function(t){return u(t,this.options.ecmaVersion>=6)||92===t?this.readWord():this.getTokenFromCode(t)},bt.fullCharCodeAtPos=function(){var t=this.input.charCodeAt(this.pos);return t<=55295||t>=57344?t:(t<<10)+this.input.charCodeAt(this.pos+1)-56613888},bt.skipBlockComment=function(){var t,e=this.options.onComment&&this.curPosition(),i=this.pos,s=this.input.indexOf("*/",this.pos+=2);if(-1===s&&this.raise(this.pos-2,"Unterminated comment"),this.pos=s+2,this.options.locations)for(b.lastIndex=i;(t=b.exec(this.input))&&t.index<this.pos;)++this.curLine,this.lineStart=t.index+t[0].length;this.options.onComment&&this.options.onComment(!0,this.input.slice(i+2,s),i,this.pos,e,this.curPosition())},bt.skipLineComment=function(t){for(var e=this.pos,i=this.options.onComment&&this.curPosition(),s=this.input.charCodeAt(this.pos+=t);this.pos<this.input.length&&!k(s);)s=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(e+t,this.pos),e,this.pos,i,this.curPosition())},bt.skipSpace=function(){t:for(;this.pos<this.input.length;){var t=this.input.charCodeAt(this.pos);switch(t){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break t}break;default:if(!(t>8&&t<14||t>=5760&&C.test(String.fromCharCode(t))))break t;++this.pos}}},bt.finishToken=function(t,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var i=this.type;this.type=t,this.value=e,this.updateContext(i)},bt.readToken_dot=function(){var t=this.input.charCodeAt(this.pos+1);if(t>=48&&t<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===t&&46===e?(this.pos+=3,this.finishToken(y.ellipsis)):(++this.pos,this.finishToken(y.dot))},bt.readToken_slash=function(){var t=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===t?this.finishOp(y.assign,2):this.finishOp(y.slash,1)},bt.readToken_mult_modulo_exp=function(t){var e=this.input.charCodeAt(this.pos+1),i=1,s=42===t?y.star:y.modulo;return this.options.ecmaVersion>=7&&42===t&&42===e&&(++i,s=y.starstar,e=this.input.charCodeAt(this.pos+2)),61===e?this.finishOp(y.assign,i+1):this.finishOp(s,i)},bt.readToken_pipe_amp=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?this.finishOp(124===t?y.logicalOR:y.logicalAND,2):61===e?this.finishOp(y.assign,2):this.finishOp(124===t?y.bitwiseOR:y.bitwiseAND,1)},bt.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(y.assign,2):this.finishOp(y.bitwiseXOR,1)},bt.readToken_plus_min=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?45!==e||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!_.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(y.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===e?this.finishOp(y.assign,2):this.finishOp(y.plusMin,1)},bt.readToken_lt_gt=function(t){var e=this.input.charCodeAt(this.pos+1),i=1;return e===t?(i=62===t&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+i)?this.finishOp(y.assign,i+1):this.finishOp(y.bitShift,i)):33!==e||60!==t||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===e&&(i=2),this.finishOp(y.relational,i)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},bt.readToken_eq_excl=function(t){var e=this.input.charCodeAt(this.pos+1);return 61===e?this.finishOp(y.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===t&&62===e&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(y.arrow)):this.finishOp(61===t?y.eq:y.prefix,1)},bt.getTokenFromCode=function(t){switch(t){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(y.parenL);case 41:return++this.pos,this.finishToken(y.parenR);case 59:return++this.pos,this.finishToken(y.semi);case 44:return++this.pos,this.finishToken(y.comma);case 91:return++this.pos,this.finishToken(y.bracketL);case 93:return++this.pos,this.finishToken(y.bracketR);case 123:return++this.pos,this.finishToken(y.braceL);case 125:return++this.pos,this.finishToken(y.braceR);case 58:return++this.pos,this.finishToken(y.colon);case 63:return++this.pos,this.finishToken(y.question);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(y.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(120===e||88===e)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===e||79===e)return this.readRadixNumber(8);if(98===e||66===e)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(t);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(t);case 124:case 38:return this.readToken_pipe_amp(t);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(t);case 60:case 62:return this.readToken_lt_gt(t);case 61:case 33:return this.readToken_eq_excl(t);case 126:return this.finishOp(y.prefix,1)}this.raise(this.pos,"Unexpected character '"+kt(t)+"'")},bt.finishOp=function(t,e){var i=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(t,i)},bt.readRegexp=function(){for(var t,e,i=this.pos;;){this.pos>=this.input.length&&this.raise(i,"Unterminated regular expression");var s=this.input.charAt(this.pos);if(_.test(s)&&this.raise(i,"Unterminated regular expression"),t)t=!1;else{if("["===s)e=!0;else if("]"===s&&e)e=!1;else if("/"===s&&!e)break;t="\\"===s}++this.pos}var r=this.input.slice(i,this.pos);++this.pos;var a=this.pos,n=this.readWord1();this.containsEsc&&this.unexpected(a);var o=this.regexpState||(this.regexpState=new nt(this));o.reset(i,r,n),this.validateRegExpFlags(o),this.validateRegExpPattern(o);var h=null;try{h=new RegExp(r,n)}catch(p){}return this.finishToken(y.regexp,{pattern:r,flags:n,value:h})},bt.readInt=function(t,e){for(var i=this.pos,s=0,r=0,a=null==e?1/0:e;r<a;++r){var n=this.input.charCodeAt(this.pos),o=void 0;if((o=n>=97?n-97+10:n>=65?n-65+10:n>=48&&n<=57?n-48:1/0)>=t)break;++this.pos,s=s*t+o}return this.pos===i||null!=e&&this.pos-i!==e?null:s},bt.readRadixNumber=function(t){this.pos+=2;var e=this.readInt(t);return null==e&&this.raise(this.start+2,"Expected number in radix "+t),u(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(y.num,e)},bt.readNumber=function(t){var e=this.pos;t||null!==this.readInt(10)||this.raise(e,"Invalid number");var i=this.pos-e>=2&&48===this.input.charCodeAt(e);i&&this.strict&&this.raise(e,"Invalid number"),i&&/[89]/.test(this.input.slice(e,this.pos))&&(i=!1);var s=this.input.charCodeAt(this.pos);46!==s||i||(++this.pos,this.readInt(10),s=this.input.charCodeAt(this.pos)),69!==s&&101!==s||i||(43!==(s=this.input.charCodeAt(++this.pos))&&45!==s||++this.pos,null===this.readInt(10)&&this.raise(e,"Invalid number")),u(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var r=this.input.slice(e,this.pos),a=i?parseInt(r,8):parseFloat(r);return this.finishToken(y.num,a)},bt.readCodePoint=function(){var t;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var e=++this.pos;t=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,t>1114111&&this.invalidStringToken(e,"Code point out of bounds")}else t=this.readHexChar(4);return t},bt.readString=function(t){for(var e="",i=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var s=this.input.charCodeAt(this.pos);if(s===t)break;92===s?(e+=this.input.slice(i,this.pos),e+=this.readEscapedChar(!1),i=this.pos):(k(s,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return e+=this.input.slice(i,this.pos++),this.finishToken(y.string,e)};var Ct={};bt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(t){if(t!==Ct)throw t;this.readInvalidTemplateToken()}this.inTemplateElement=!1},bt.invalidStringToken=function(t,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ct;this.raise(t,e)},bt.readTmplToken=function(){for(var t="",e=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var i=this.input.charCodeAt(this.pos);if(96===i||36===i&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==y.template&&this.type!==y.invalidTemplate?(t+=this.input.slice(e,this.pos),this.finishToken(y.template,t)):36===i?(this.pos+=2,this.finishToken(y.dollarBraceL)):(++this.pos,this.finishToken(y.backQuote));if(92===i)t+=this.input.slice(e,this.pos),t+=this.readEscapedChar(!0),e=this.pos;else if(k(i)){switch(t+=this.input.slice(e,this.pos),++this.pos,i){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:t+="\n";break;default:t+=String.fromCharCode(i)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),e=this.pos}else++this.pos}},bt.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(y.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},bt.readEscapedChar=function(t){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return kt(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";default:if(e>=48&&e<=55){var i=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],s=parseInt(i,8);return s>255&&(i=i.slice(0,-1),s=parseInt(i,8)),this.pos+=i.length-1,e=this.input.charCodeAt(this.pos),"0"===i&&56!==e&&57!==e||!this.strict&&!t||this.invalidStringToken(this.pos-1-i.length,t?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(s)}return String.fromCharCode(e)}},bt.readHexChar=function(t){var e=this.pos,i=this.readInt(16,t);return null===i&&this.invalidStringToken(e,"Bad character escape sequence"),i},bt.readWord1=function(){this.containsEsc=!1;for(var t="",e=!0,i=this.pos,s=this.options.ecmaVersion>=6;this.pos<this.input.length;){var r=this.fullCharCodeAtPos();if(l(r,s))this.pos+=r<=65535?1:2;else{if(92!==r)break;this.containsEsc=!0,t+=this.input.slice(i,this.pos);var a=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var n=this.readCodePoint();(e?u:l)(n,s)||this.invalidStringToken(a,"Invalid Unicode escape"),t+=kt(n),i=this.pos}e=!1}return t+this.input.slice(i,this.pos)},bt.readWord=function(){var t=this.readWord1(),e=y.name;return this.keywords.test(t)&&(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+t),e=g[t]),this.finishToken(e,t)};var St,Et,wt,At="5.7.3";function It(t,e){return new M(e,t).parse()}function Pt(t,e,i){var s=new M(i,t,e);return s.nextToken(),s.parseExpression()}function Lt(t,e){return new M(e,t)}function Nt(t,e,i){exports.parse_dammit=St=t,exports.LooseParser=Et=e,exports.pluginsLoose=wt=i}exports.version=At,exports.parse_dammit=St,exports.LooseParser=Et,exports.pluginsLoose=wt;
},{}],"BHBn":[function(require,module,exports) {
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var utils=require("../core/utils"),acorn=require("acorn");module.exports=function(){function BaseFunctionNode(t,e,n){_classCallCheck(this,BaseFunctionNode),this.calledFunctions=[],this.calledFunctionsArguments={},this.builder=null,this.isRootKernel=!1,this.isSubKernel=!1,this.parent=null,this.debug=null,this.prototypeOnly=null,this.constants=null,this.output=null,this.declarations={},this.states=[],this.fixIntegerDivisionAccuracy=null;var r=void 0,s=void 0;if(n&&(n.hasOwnProperty("debug")&&(this.debug=n.debug),n.hasOwnProperty("prototypeOnly")&&(this.prototypeOnly=n.prototypeOnly),n.hasOwnProperty("constants")&&(this.constants=n.constants),n.hasOwnProperty("output")&&(this.output=n.output),n.hasOwnProperty("loopMaxIterations")&&(this.loopMaxIterations=n.loopMaxIterations),n.hasOwnProperty("paramTypes")&&(this.paramTypes=r=n.paramTypes),n.hasOwnProperty("constantTypes")?this.constantTypes=n.constantTypes:this.constantTypes={},n.hasOwnProperty("returnType")&&(s=n.returnType),n.hasOwnProperty("fixIntegerDivisionAccuracy")&&(this.fixIntegerDivisionAccuracy=n.fixIntegerDivisionAccuracy)),!e)throw"jsFunction, parameter is missing";if(this.jsFunctionString=e.toString(),!utils.isFunctionString(this.jsFunctionString))throw console.error("jsFunction, to string conversion check failed: not a function?",this.jsFunctionString),"jsFunction, to string conversion check failed: not a function?";if(utils.isFunction(e)?this.jsFunction=e:this.jsFunction=null,this.functionName=t||e&&e.name||utils.getFunctionNameFromString(this.jsFunctionString),!this.functionName)throw"jsFunction, missing name argument or value";if(this.paramNames=utils.getParamNamesFromString(this.jsFunctionString),r){if(Array.isArray(r)){if(r.length!==this.paramNames.length)throw"Invalid argument type array length, against function length -> ("+r.length+","+this.paramNames.length+")";this.paramTypes=r}else if("object"===(void 0===r?"undefined":_typeof(r))){var i=Object.keys(r);if(r.hasOwnProperty("returns")&&(this.returnType=r.returns,i.splice(i.indexOf("returns"),1)),i.length>0&&i.length!==this.paramNames.length)throw"Invalid argument type array length, against function length -> ("+i.length+","+this.paramNames.length+")";this.paramTypes=this.paramNames.map(function(t){return r.hasOwnProperty(t)?r[t]:"Number"})}}else this.paramTypes=[];this.returnType||(this.returnType=s||"Number")}return _createClass(BaseFunctionNode,[{key:"isIdentifierConstant",value:function(t){return!!this.constants&&this.constants.hasOwnProperty(t)}},{key:"isInput",value:function(t){return"Input"===this.paramTypes[this.paramNames.indexOf(t)]}},{key:"setBuilder",value:function(t){return this.builder=t,this}},{key:"pushState",value:function(t){this.states.push(t)}},{key:"popState",value:function(t){if(this.state!==t)throw new Error("Cannot popState "+t+" when in "+this.state);this.states.pop()}},{key:"isState",value:function(t){return this.state===t}},{key:"getJsFunction",value:function getJsFunction(){if(this.jsFunction)return this.jsFunction;if(this.jsFunctionString)return this.jsFunction=eval(this.jsFunctionString),this.jsFunction;throw"Missing jsFunction, and jsFunctionString parameter"}},{key:"astMemberExpressionUnroll",value:function(t){if("Identifier"===t.type)return t.name;if("ThisExpression"===t.type)return"this";if("MemberExpression"===t.type&&t.object&&t.property)return t.object.hasOwnProperty("name")&&"_"===t.object.name[0]?this.astMemberExpressionUnroll(t.property):this.astMemberExpressionUnroll(t.object)+"."+this.astMemberExpressionUnroll(t.property);if(t.hasOwnProperty("expressions")){var e=t.expressions[0];if("Literal"===e.type&&0===e.value&&2===t.expressions.length)return this.astMemberExpressionUnroll(t.expressions[1])}throw this.astErrorOutput("Unknown CallExpression_unroll",t)}},{key:"getJsAST",value:function(t){if(this.jsFunctionAST)return this.jsFunctionAST;if(null===(t=t||acorn))throw"Missing JS to AST parser";var e=t.parse("var "+this.functionName+" = "+this.jsFunctionString+";",{locations:!0});if(null===e)throw"Failed to parse JS code";var n=e.body[0].declarations[0].init;return this.jsFunctionAST=n,n}},{key:"getFunctionString",value:function(){return this.generate(),this.functionString}},{key:"setFunctionString",value:function(t){this.functionString=t}},{key:"getParamType",value:function(t){var e=this.paramNames.indexOf(t);if(-1===e)return this.declarations.hasOwnProperty(t)?this.declarations[t]:"Number";if(this.parent){if(this.paramTypes[e])return this.paramTypes[e];for(var n=this.parent.calledFunctionsArguments[this.functionName],r=0;r<n.length;r++){var s=n[r];if(null!==s[e])return this.paramTypes[e]=s[e].type}}else if(this.paramTypes[e])return this.paramTypes[e];return"Number"}},{key:"getConstantType",value:function(t){return this.constantTypes[t]?this.constantTypes[t]:null}},{key:"getUserParamName",value:function(t){var e=this.paramNames.indexOf(t);if(-1===e)return null;if(!this.parent||!this.isSubKernel)return null;for(var n=this.parent.calledFunctionsArguments[this.functionName],r=0;r<n.length;r++){var s=n[r][e];if(null!==s&&"Integer"!==s.type)return s.name}return null}},{key:"generate",value:function(t){throw new Error("generate not defined on BaseFunctionNode")}},{key:"astGeneric",value:function(t,e){if(null===t)throw this.astErrorOutput("NULL ast",t);if(Array.isArray(t)){for(var n=0;n<t.length;n++)this.astGeneric(t[n],e);return e}switch(t.type){case"FunctionDeclaration":return this.astFunctionDeclaration(t,e);case"FunctionExpression":return this.astFunctionExpression(t,e);case"ReturnStatement":return this.astReturnStatement(t,e);case"Literal":return this.astLiteral(t,e);case"BinaryExpression":return this.astBinaryExpression(t,e);case"Identifier":return this.astIdentifierExpression(t,e);case"AssignmentExpression":return this.astAssignmentExpression(t,e);case"ExpressionStatement":return this.astExpressionStatement(t,e);case"EmptyStatement":return this.astEmptyStatement(t,e);case"BlockStatement":return this.astBlockStatement(t,e);case"IfStatement":return this.astIfStatement(t,e);case"BreakStatement":return this.astBreakStatement(t,e);case"ContinueStatement":return this.astContinueStatement(t,e);case"ForStatement":return this.astForStatement(t,e);case"WhileStatement":return this.astWhileStatement(t,e);case"DoWhileStatement":return this.astDoWhileStatement(t,e);case"VariableDeclaration":return this.astVariableDeclaration(t,e);case"VariableDeclarator":return this.astVariableDeclarator(t,e);case"ThisExpression":return this.astThisExpression(t,e);case"SequenceExpression":return this.astSequenceExpression(t,e);case"UnaryExpression":return this.astUnaryExpression(t,e);case"UpdateExpression":return this.astUpdateExpression(t,e);case"LogicalExpression":return this.astLogicalExpression(t,e);case"MemberExpression":return this.astMemberExpression(t,e);case"CallExpression":return this.astCallExpression(t,e);case"ArrayExpression":return this.astArrayExpression(t,e);case"DebuggerStatement":return this.astDebuggerStatement(t,e)}throw this.astErrorOutput("Unknown ast type : "+t.type,t)}},{key:"astErrorOutput",value:function(t,e){return console.error(utils.getAstString(this.jsFunctionString,e)),console.error(t,e,this),t}},{key:"astDebuggerStatement",value:function(t,e){return e}},{key:"astFunctionDeclaration",value:function(t,e){return e}},{key:"astFunctionExpression",value:function(t,e){return e}},{key:"astReturnStatement",value:function(t,e){return e}},{key:"astLiteral",value:function(t,e){return e}},{key:"astBinaryExpression",value:function(t,e){return e}},{key:"astIdentifierExpression",value:function(t,e){return e}},{key:"astAssignmentExpression",value:function(t,e){return e}},{key:"astExpressionStatement",value:function(t,e){return e}},{key:"astEmptyStatement",value:function(t,e){return e}},{key:"astBlockStatement",value:function(t,e){return e}},{key:"astIfStatement",value:function(t,e){return e}},{key:"astBreakStatement",value:function(t,e){return e}},{key:"astContinueStatement",value:function(t,e){return e}},{key:"astForStatement",value:function(t,e){return e}},{key:"astWhileStatement",value:function(t,e){return e}},{key:"astDoWhileStatement",value:function(t,e){return e}},{key:"astVariableDeclaration",value:function(t,e){return e}},{key:"astVariableDeclarator",value:function(t,e){return e}},{key:"astThisExpression",value:function(t,e){return e}},{key:"astSequenceExpression",value:function(t,e){return e}},{key:"astUnaryExpression",value:function(t,e){return e}},{key:"astUpdateExpression",value:function(t,e){return e}},{key:"astLogicalExpression",value:function(t,e){return e}},{key:"astMemberExpression",value:function(t,e){return e}},{key:"astCallExpression",value:function(t,e){return e}},{key:"astArrayExpression",value:function(t,e){return e}},{key:"pushParameter",value:function(t,e){this.isState("in-get-call-parameters")?t.push("int("+e+")"):t.push(e)}},{key:"state",get:function(){return this.states[this.states.length-1]}}]),BaseFunctionNode}();
},{"../core/utils":"hsMx","acorn":"8W3y"}],"dzEs":[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,s,r){return s&&e(t.prototype,s),r&&e(t,r),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=require("../function-node-base"),a=require("../../core/utils"),n="Math.",o="this.",u="this.constants.",h=/decode32\(\s+encode32\(/g,p=/encode32\(\s+decode32\(/g,c=function(){};module.exports=function(h){function p(){return t(this,p),s(this,(p.__proto__||Object.getPrototypeOf(p)).apply(this,arguments))}return r(p,i),e(p,[{key:"generate",value:function(){return this.debug&&c(this),this.prototypeOnly?this.astFunctionPrototype(this.getJsAST(),[]).join("").trim():(this.functionStringArray=this.astGeneric(this.getJsAST(),[]),this.functionString=m(this.functionStringArray.join("").trim()),this.functionString)}},{key:"astFunctionDeclaration",value:function(e,t){return this.builder.addFunction(null,a.getAstString(this.jsFunctionString,e)),t}},{key:"astFunctionPrototype",value:function(e,t){if(this.isRootKernel||this.isSubKernel)return t;var s=this.returnType,r=l[s];if(!r)throw new Error("unknown type "+s);t.push(r),t.push(" "),t.push(this.functionName),t.push("(");for(var i=0;i<this.paramNames.length;++i)i>0&&t.push(", "),t.push(this.paramTypes[i]),t.push(" "),t.push("user_"),t.push(this.paramNames[i]);return t.push(");\n"),t}},{key:"astFunctionExpression",value:function(e,t){if(this.isRootKernel)t.push("void");else{var s=this.returnType,r=l[s];if(!r)throw new Error("unknown type "+s);t.push(r)}if(t.push(" "),t.push(this.functionName),t.push("("),!this.isRootKernel)for(var i=0;i<this.paramNames.length;++i){var a=this.paramNames[i];i>0&&t.push(", ");var n=this.getParamType(a),o=l[n];if(!o)throw new Error("unknown type "+n);t.push(o),t.push(" "),t.push("user_"),t.push(a)}t.push(") {\n");for(var u=0;u<e.body.body.length;++u)this.astGeneric(e.body.body[u],t),t.push("\n");return t.push("}\n"),t}},{key:"astReturnStatement",value:function(e,t){return this.isRootKernel?(t.push("kernelResult = "),this.astGeneric(e.argument,t),t.push(";"),t.push("return;")):this.isSubKernel?(t.push(this.functionName+"Result = "),this.astGeneric(e.argument,t),t.push(";"),t.push("return "+this.functionName+"Result;")):(t.push("return "),this.astGeneric(e.argument,t),t.push(";")),t}},{key:"astLiteral",value:function(e,t){if(isNaN(e.value))throw this.astErrorOutput("Non-numeric literal not supported : "+e.value,e);t.push(e.value);var s=this.isState("in-get-call-parameters");return Number.isInteger(e.value)?s||t.push(".0"):s&&(t.pop(),t.push("int("),t.push(e.value),t.push(")")),t}},{key:"astBinaryExpression",value:function(e,t){var s=this.isState("in-get-call-parameters");return s&&(this.pushState("not-in-get-call-parameters"),t.push("int")),t.push("("),"%"===e.operator?(t.push("mod("),this.astGeneric(e.left,t),t.push(","),this.astGeneric(e.right,t),t.push(")")):"==="===e.operator?(this.astGeneric(e.left,t),t.push("=="),this.astGeneric(e.right,t)):"!=="===e.operator?(this.astGeneric(e.left,t),t.push("!="),this.astGeneric(e.right,t)):this.fixIntegerDivisionAccuracy&&"/"===e.operator?(t.push("div_with_int_check("),this.astGeneric(e.left,t),t.push(", "),this.astGeneric(e.right,t),t.push(")")):(this.astGeneric(e.left,t),t.push(e.operator),this.astGeneric(e.right,t)),t.push(")"),s&&this.popState("not-in-get-call-parameters"),t}},{key:"astIdentifierExpression",value:function(e,t){if("Identifier"!==e.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",e);var s=!this.isState("in-get-call-parameters");switch(e.name){case"gpu_threadX":s&&t.push("float("),t.push("threadId.x"),s&&t.push(")");break;case"gpu_threadY":s&&t.push("float("),t.push("threadId.y"),s&&t.push(")");break;case"gpu_threadZ":s&&t.push("float("),t.push("threadId.z"),s&&t.push(")");break;case"gpu_outputX":t.push("uOutputDim.x");break;case"gpu_outputY":t.push("uOutputDim.y");break;case"gpu_outputZ":t.push("uOutputDim.z");break;case"Infinity":t.push("3.402823466e+38");break;default:var r=this.getUserParamName(e.name);null!==r?this.pushParameter(t,"user_"+r):this.pushParameter(t,"user_"+e.name)}return t}},{key:"astForStatement",value:function(e,t){if("ForStatement"!==e.type)throw this.astErrorOutput("Invalid for statment",e);if(e.test&&"BinaryExpression"===e.test.type){if("Identifier"===e.test.right.type&&"<"===e.test.operator&&!1===this.isIdentifierConstant(e.test.right.name)){if(this.loopMaxIterations||(console.warn("Warning: loopMaxIterations is not set! Using default of 1000 which may result in unintended behavior."),console.warn("Set loopMaxIterations or use a for loop of fixed length to silence this message.")),t.push("for ("),this.astGeneric(e.init,t),this.astGeneric(e.test.left,t),t.push(e.test.operator),t.push("LOOP_MAX"),t.push(";"),this.astGeneric(e.update,t),t.push(")"),t.push("{\n"),t.push("if ("),this.astGeneric(e.test.left,t),t.push(e.test.operator),this.astGeneric(e.test.right,t),t.push(") {\n"),"BlockStatement"===e.body.type)for(var s=0;s<e.body.body.length;s++)this.astGeneric(e.body.body[s],t);else this.astGeneric(e.body,t);return t.push("\n} else {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}var r=JSON.parse(JSON.stringify(e.init.declarations)),i=e.update.argument;if(!Array.isArray(r)||r.length<1)throw c(this.jsFunctionString),new Error("Error: Incompatible for loop declaration");if(r.length>1){for(var a=null,n=0;n<r.length;n++){var o=r[n];o.id.name===i.name?(a=o,r.splice(n,1)):(t.push("float "),this.astGeneric(o,t),t.push(";"))}t.push("for (float "),this.astGeneric(a,t),t.push(";")}else t.push("for ("),this.astGeneric(e.init,t);return this.astGeneric(e.test,t),t.push(";"),this.astGeneric(e.update,t),t.push(")"),this.astGeneric(e.body,t),t}throw this.astErrorOutput("Invalid for statement",e)}},{key:"astWhileStatement",value:function(e,t){if("WhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statment",e);return t.push("for (float i = 0.0; i < LOOP_MAX; i++) {"),t.push("if ("),this.astGeneric(e.test,t),t.push(") {\n"),this.astGeneric(e.body,t),t.push("} else {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}},{key:"astDoWhileStatement",value:function(e,t){if("DoWhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statment",e);return t.push("for (float i = 0.0; i < LOOP_MAX; i++) {"),this.astGeneric(e.body,t),t.push("if (!"),this.astGeneric(e.test,t),t.push(") {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}},{key:"astAssignmentExpression",value:function(e,t){if("%="!==e.operator)return this.astGeneric(e.left,t),t.push(e.operator),this.astGeneric(e.right,t),t;this.astGeneric(e.left,t),t.push("="),t.push("mod("),this.astGeneric(e.left,t),t.push(","),this.astGeneric(e.right,t),t.push(")")}},{key:"astEmptyStatement",value:function(e,t){return t}},{key:"astBlockStatement",value:function(e,t){t.push("{\n");for(var s=0;s<e.body.length;s++)this.astGeneric(e.body[s],t);return t.push("}\n"),t}},{key:"astExpressionStatement",value:function(e,t){return this.astGeneric(e.expression,t),t.push(";"),t}},{key:"astVariableDeclaration",value:function(e,t){for(var s=0;s<e.declarations.length;s++){var r=e.declarations[s];s>0&&t.push(",");var i=[];this.astGeneric(r,i);var a="Number";if(0===s){var n=r.init;if(n)if(n.object){if("MemberExpression"===n.object.type&&n.object.object)if("ThisExpression"!==n.object.object.type||!n.object.property||"thread"!==n.object.property.name&&"output"!==n.object.property.name){if("Identifier"===n.object.object.type){var o=this.getParamType(n.object.object.name);a=b[o]}else if(n.object.object.object&&"Identifier"===n.object.object.object.type){var u=this.getParamType(n.object.object.object.name);a=b[u]}else if(n.object.object.object&&n.object.object.object.object&&"ThisExpression"===n.object.object.object.object.type&&"constants"===n.object.object.object.property.name){var h=this.getConstantType(n.object.object.property.name);a=b[h]}else if(n.object.object.object&&n.object.object.object.object&&n.object.object.object.object.object&&"ThisExpression"===n.object.object.object.object.object.type&&"constants"===n.object.object.object.object.property.name){var p=this.getConstantType(n.object.object.object.property.name);a=b[p]}}else a="Integer";if(!a)throw new Error("unknown lookup type "+b)}else if(n.name&&this.declarations[n.name])a=this.declarations[n.name];else if("ArrayExpression"===n.type)a="Array("+n.elements.length+")";else if("CallExpression"===n.type){var c=this.builder.nodeMap[n.callee.name];c&&c.returnType&&(a=c.returnType)}var m=l[a];if(!m)throw new Error("type "+a+" not handled");t.push(m+" ")}this.declarations[r.id.name]=a,t.push.apply(t,i)}return t.push(";"),t}},{key:"astVariableDeclarator",value:function(e,t){return this.astGeneric(e.id,t),null!==e.init&&(t.push("="),this.astGeneric(e.init,t)),t}},{key:"astIfStatement",value:function(e,t){return t.push("if ("),this.astGeneric(e.test,t),t.push(")"),"BlockStatement"===e.consequent.type?this.astGeneric(e.consequent,t):(t.push(" {\n"),this.astGeneric(e.consequent,t),t.push("\n}\n")),e.alternate&&(t.push("else "),"BlockStatement"===e.alternate.type?this.astGeneric(e.alternate,t):(t.push(" {\n"),this.astGeneric(e.alternate,t),t.push("\n}\n"))),t}},{key:"astBreakStatement",value:function(e,t){return t.push("break;\n"),t}},{key:"astContinueStatement",value:function(e,t){return t.push("continue;\n"),t}},{key:"astLogicalExpression",value:function(e,t){return t.push("("),this.astGeneric(e.left,t),t.push(e.operator),this.astGeneric(e.right,t),t.push(")"),t}},{key:"astUpdateExpression",value:function(e,t){return e.prefix?(t.push(e.operator),this.astGeneric(e.argument,t)):(this.astGeneric(e.argument,t),t.push(e.operator)),t}},{key:"astUnaryExpression",value:function(e,t){return e.prefix?(t.push(e.operator),this.astGeneric(e.argument,t)):(this.astGeneric(e.argument,t),t.push(e.operator)),t}},{key:"astThisExpression",value:function(e,t){return t.push("this"),t}},{key:"astMemberExpression",value:function(e,t){if(c("[in] astMemberExpression "+e.object.type),e.computed)if("Identifier"===e.object.type||"MemberExpression"===e.object.type&&e.object.object.object&&"ThisExpression"===e.object.object.object.type&&"constants"===e.object.object.property.name){var s=e.object.name,r=this.functionName||"kernel",i=!1;if(this.paramNames){var a=this.paramNames.indexOf(s);a>=0&&"Number"===this.paramTypes[a]&&(i=!0)}if(c("- astMemberExpression "+s+" "+r),i)this.astGeneric(e.object,t),t.push("[int("),this.astGeneric(e.property,t),t.push(")]");else{var n=this.isState("in-get-call-parameters"),o=this.isState("multi-member-expression");o&&this.popState("multi-member-expression"),this.pushState("not-in-get-call-parameters");var h=null;switch(e.object.name?h=this.declarations[e.object.name]?this.declarations[e.object.name]:this.getParamType(e.object.name):e.object&&e.object.object&&e.object.object.object&&"ThisExpression"===e.object.object.object.type&&(h=this.getConstantType(e.object.property.name)),h){case"Array(2)":case"Array(3)":case"Array(4)":this.astGeneric(e.object,t),t.push("["),t.push(e.property.raw),t.push("]"),o&&this.popState("not-in-get-call-parameters");break;case"HTMLImageArray":t.push("getImage3D("),this.astGeneric(e.object,t),t.push(", ivec2("),this.astGeneric(e.object,t),t.push("Size[0],"),this.astGeneric(e.object,t),t.push("Size[1]), ivec3("),this.astGeneric(e.object,t),t.push("Dim[0],"),this.astGeneric(e.object,t),t.push("Dim[1],"),this.astGeneric(e.object,t),t.push("Dim[2]"),t.push("), "),this.popState("not-in-get-call-parameters"),this.pushState("in-get-call-parameters"),this.astGeneric(e.property,t),o||this.popState("in-get-call-parameters"),t.push(")");break;case"ArrayTexture(4)":case"HTMLImage":t.push("getImage2D("),this.astGeneric(e.object,t),t.push(", ivec2("),this.astGeneric(e.object,t),t.push("Size[0],"),this.astGeneric(e.object,t),t.push("Size[1]), ivec3("),this.astGeneric(e.object,t),t.push("Dim[0],"),this.astGeneric(e.object,t),t.push("Dim[1],"),this.astGeneric(e.object,t),t.push("Dim[2]"),t.push("), "),this.popState("not-in-get-call-parameters"),this.pushState("in-get-call-parameters"),this.astGeneric(e.property,t),o||this.popState("in-get-call-parameters"),t.push(")");break;default:n&&t.push("int("),t.push("get("),this.astGeneric(e.object,t),t.push(", ivec2("),this.astGeneric(e.object,t),t.push("Size[0],"),this.astGeneric(e.object,t),t.push("Size[1]), ivec3("),this.astGeneric(e.object,t),t.push("Dim[0],"),this.astGeneric(e.object,t),t.push("Dim[1],"),this.astGeneric(e.object,t),t.push("Dim[2]"),t.push("), "),this.astGeneric(e.object,t),t.push("BitRatio"),t.push(", "),this.popState("not-in-get-call-parameters"),this.pushState("in-get-call-parameters"),this.astGeneric(e.property,t),o||this.popState("in-get-call-parameters"),t.push(")"),n&&t.push(")")}}}else{c("- astMemberExpression obj:",e.object);this.states.length;var p=this.isState("in-get-call-parameters");p||this.pushState("multi-member-expression"),this.astGeneric(e.object,t),this.isState("multi-member-expression")&&this.popState("multi-member-expression");var l=!p&&this.isState("in-get-call-parameters"),b=t.pop();t.push(","),c("- astMemberExpression prop:",e.property);var m=this.isState("should-pop-in-get-call-parameters");m&&this.popState("should-pop-in-get-call-parameters"),this.astGeneric(e.property,t),t.push(b),l?this.pushState("should-pop-in-get-call-parameters"):m&&this.popState("in-get-call-parameters")}else{var f=this.astMemberExpressionUnroll(e),y=f.toLowerCase();c("- astMemberExpression unrolled:",f),0===f.indexOf(u)&&(f="constants_"+f.slice(u.length));var j=!this.isState("in-get-call-parameters");switch(y){case"this.thread.x":j&&t.push("float("),t.push("threadId.x"),j&&t.push(")");break;case"this.thread.y":j&&t.push("float("),t.push("threadId.y"),j&&t.push(")");break;case"this.thread.z":j&&t.push("float("),t.push("threadId.z"),j&&t.push(")");break;case"this.output.x":t.push(this.output[0]+".0");break;case"this.output.y":t.push(this.output[1]+".0");break;case"this.output.z":t.push(this.output[2]+".0");break;default:e.object&&e.object.name&&this.declarations[e.object.name]&&t.push("user_"),t.push(f)}}return c("[out] astMemberExpression "+e.object.type),t}},{key:"astSequenceExpression",value:function(e,t){for(var s=0;s<e.expressions.length;s++)s>0&&t.push(","),this.astGeneric(e.expressions,t);return t}},{key:"astCallExpression",value:function(e,t){if(e.callee){var s=this.astMemberExpressionUnroll(e.callee);0===s.indexOf(n)&&(s=s.slice(n.length)),0===s.indexOf(o)&&(s=s.slice(o.length)),"atan2"===s&&(s="atan"),this.calledFunctions.indexOf(s)<0&&this.calledFunctions.push(s),this.hasOwnProperty("funcName")||(this.calledFunctionsArguments[s]=[]);var r=[];this.calledFunctionsArguments[s].push(r),t.push(s),t.push("(");for(var i=0;i<e.arguments.length;++i){var a=e.arguments[i];if(i>0&&t.push(", "),this.astGeneric(a,t),"Identifier"===a.type){var u=this.paramNames.indexOf(a.name);-1===u?r.push(null):r.push({name:a.name,type:this.paramTypes[u]||"Number"})}else r.push(null)}return t.push(")"),t}throw this.astErrorOutput("Unknown CallExpression",e)}},{key:"astArrayExpression",value:function(e,t){var s=e.elements.length;t.push("vec"+s+"(");for(var r=0;r<s;++r){r>0&&t.push(", ");var i=e.elements[r];this.astGeneric(i,t)}return t.push(")"),t}},{key:"getFunctionPrototypeString",value:function(){return this.webGlFunctionPrototypeString?this.webGlFunctionPrototypeString:this.webGlFunctionPrototypeString=this.generate()}},{key:"build",value:function(){return this.getFunctionPrototypeString().length>0}}]),p}();var l={Array:"sampler2D","Array(2)":"vec2","Array(3)":"vec3","Array(4)":"vec4",Array2D:"sampler2D",Array3D:"sampler2D",Float:"float",Input:"sampler2D",Integer:"float",Number:"float",NumberTexture:"sampler2D","ArrayTexture(4)":"sampler2D"},b={Array:"Number",Array2D:"Number",Array3D:"Number",HTMLImage:"Array(4)",HTMLImageArray:"Array(4)",NumberTexture:"Number","ArrayTexture(4)":"Array(4)"};function m(e){return e.replace(h,"((").replace(p,"((")}
},{"../function-node-base":"BHBn","../../core/utils":"hsMx"}],"J2No":[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=require("../function-builder-base"),u=require("./function-node");function i(e){return Math.floor(e+.5)}module.exports=function(c){function a(){t(this,a);var e=n(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return e.Node=u,e}return r(a,o),e(a,[{key:"polyfillStandardFunctions",value:function(){this.addFunction("round",i)}}],[{key:"round",value:function(e){return i(e)}}]),a}();
},{"../function-builder-base":"KoGT","./function-node":"dzEs"}],"J272":[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=require("../runner-base"),u=require("./kernel"),i=require("./function-builder");module.exports=function(c){function a(e){t(this,a);var n=r(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,new i,e));return n.Kernel=u,n.kernel=null,n}return n(a,o),e(a,[{key:"getMode",value:function(){return"gpu"}}]),a}();
},{"../runner-base":"6CY0","./kernel":"9TKN","./function-builder":"J2No"}],"8Uc3":[function(require,module,exports) {
"use strict";var t=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=require("../web-gl/function-node"),i=/decode32\(\s+encode32\(/g,o=/encode32\(\s+decode32\(/g;function a(t){return t.replace(i,"((").replace(o,"((")}module.exports=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,u),t(o,[{key:"generate",value:function(){return this.debug&&console.log(this),this.prototypeOnly?this.astFunctionPrototype(this.getJsAST(),[]).join("").trim():(this.functionStringArray=this.astGeneric(this.getJsAST(),[]),this.functionString=a(this.functionStringArray.join("").trim()),this.functionString)}},{key:"astIdentifierExpression",value:function(t,e){if("Identifier"!==t.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",t);var r=!this.isState("in-get-call-parameters");switch(t.name){case"gpu_threadX":r&&e.push("float("),e.push("threadId.x"),r&&e.push(")");break;case"gpu_threadY":r&&e.push("float("),e.push("threadId.y"),r&&e.push(")");break;case"gpu_threadZ":r&&e.push("float("),e.push("threadId.z"),r&&e.push(")");break;case"gpu_outputX":e.push("uOutputDim.x");break;case"gpu_outputY":e.push("uOutputDim.y");break;case"gpu_outputZ":e.push("uOutputDim.z");break;case"Infinity":e.push("intBitsToFloat(2139095039)");break;default:var n=this.getUserParamName(t.name);null!==n?this.pushParameter(e,"user_"+n):this.pushParameter(e,"user_"+t.name)}return e}}]),o}();
},{"../web-gl/function-node":"dzEs"}],"SerK":[function(require,module,exports) {
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var n=require("../function-builder-base"),r=require("./function-node");module.exports=function(i){function u(){e(this,u);var o=t(this,(u.__proto__||Object.getPrototypeOf(u)).call(this));return o.Node=r,o}return o(u,n),u}();
},{"../function-builder-base":"KoGT","./function-node":"8Uc3"}],"IoZL":[function(require,module,exports) {
"use strict";module.exports="#version 300 es\n__HEADER__;\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nconst float LOOP_MAX = __LOOP_MAX__;\n\n__CONSTANTS__;\n\nin vec2 vTexCoord;\n\nvec2 integerMod(vec2 x, float y) {\n  vec2 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec3 integerMod(vec3 x, float y) {\n  vec3 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec4 integerMod(vec4 x, vec4 y) {\n  vec4 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nfloat integerMod(float x, float y) {\n  float res = floor(mod(x, y));\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n}\n\nint integerMod(int x, int y) {\n  return x - (y * int(x/y));\n}\n\n__DIVIDE_WITH_INTEGER_CHECK__;\n\n// Here be dragons!\n// DO NOT OPTIMIZE THIS CODE\n// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\nfloat decode32(vec4 rgba) {\n  __DECODE32_ENDIANNESS__;\n  rgba *= 255.0;\n  vec2 gte128;\n  gte128.x = rgba.b >= 128.0 ? 1.0 : 0.0;\n  gte128.y = rgba.a >= 128.0 ? 1.0 : 0.0;\n  float exponent = 2.0 * rgba.a - 127.0 + dot(gte128, MAGIC_VEC);\n  float res = exp2(round(exponent));\n  rgba.b = rgba.b - 128.0 * gte128.x;\n  res = dot(rgba, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\n  res *= gte128.y * -2.0 + 1.0;\n  return res;\n}\n\nvec4 encode32(float f) {\n  float F = abs(f);\n  float sign = f < 0.0 ? 1.0 : 0.0;\n  float exponent = floor(log2(F));\n  float mantissa = (exp2(-exponent) * F);\n  // exponent += floor(log2(mantissa));\n  vec4 rgba = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n  rgba.rg = integerMod(rgba.rg, 256.0);\n  rgba.b = integerMod(rgba.b, 128.0);\n  rgba.a = exponent*0.5 + 63.5;\n  rgba.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n  rgba = floor(rgba);\n  rgba *= 0.003921569; // 1/255\n  __ENCODE32_ENDIANNESS__;\n  return rgba;\n}\n// Dragons end here\n\nfloat decode(vec4 rgba, int x, int bitRatio) {\n  if (bitRatio == 1) {\n    return decode32(rgba);\n  }\n  __DECODE32_ENDIANNESS__;\n  int channel = integerMod(x, bitRatio);\n  if (bitRatio == 4) {\n    return rgba[channel] * 255.0;\n  }\n  else {\n    return rgba[channel*2] * 255.0 + rgba[channel*2 + 1] * 65280.0;\n  }\n}\n\nint index;\nivec3 threadId;\n\nivec3 indexTo3D(int idx, ivec3 texDim) {\n  int z = int(idx / (texDim.x * texDim.y));\n  idx -= z * int(texDim.x * texDim.y);\n  int y = int(idx / texDim.x);\n  int x = int(integerMod(idx, texDim.x));\n  return ivec3(x, y, z);\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio,  int z, int y, int x) {\n  ivec3 xyz = ivec3(x, y, z);\n  __GET_WRAPAROUND__;\n  int index = xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z);\n  __GET_TEXTURE_CHANNEL__;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  vec4 texel = texture(tex, st / vec2(texSize));\n  __GET_RESULT__;\n  \n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  ivec3 xyz = ivec3(x, y, z);\n  __GET_WRAPAROUND__;\n  int index = xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z);\n  __GET_TEXTURE_CHANNEL__;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  return texture(tex, st / vec2(texSize));\n}\n\nvec4 getImage3D(sampler2DArray tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  ivec3 xyz = ivec3(x, y, z);\n  __GET_WRAPAROUND__;\n  int index = xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z);\n  __GET_TEXTURE_CHANNEL__;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  return texture(tex, vec3(st / vec2(texSize), z));\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, int y, int x) {\n  return get(tex, texSize, texDim, bitRatio, 0, y, x);\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, int x) {\n  return get(tex, texSize, texDim, bitRatio, 0, 0, x);\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int y, int x) {\n  return getImage2D(tex, texSize, texDim, 0, y, x);\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int x) {\n  return getImage2D(tex, texSize, texDim, 0, 0, x);\n}\n\nvec4 actualColor;\nvoid color(float r, float g, float b, float a) {\n  actualColor = vec4(r,g,b,a);\n}\n\nvoid color(float r, float g, float b) {\n  color(r,g,b,1.0);\n}\n\n__MAIN_PARAMS__;\n__MAIN_CONSTANTS__;\n__KERNEL__;\n\nvoid main(void) {\n  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n  __MAIN_RESULT__;\n}";
},{}],"UHdv":[function(require,module,exports) {
"use strict";module.exports="#version 300 es\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nin vec2 aPos;\nin vec2 aTexCoord;\n\nout vec2 vTexCoord;\nuniform vec2 ratio;\n\nvoid main(void) {\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n  vTexCoord = aTexCoord;\n}";
},{}],"U6r8":[function(require,module,exports) {
"use strict";var t=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}();function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=require("../web-gl/kernel"),a=require("../../core/utils"),n=require("../../core/texture"),u=require("./shader-frag"),o=require("./shader-vert");module.exports=function(h){function T(){return e(this,T),r(this,(T.__proto__||Object.getPrototypeOf(T)).apply(this,arguments))}return i(T,s),t(T,[{key:"initWebGl",value:function(){return a.initWebGl2(this.getCanvas())}},{key:"validateOptions",value:function(){var t=a.isFloatReadPixelsSupportedWebGL2();if(!0===this.floatOutput&&!0!==this.floatOutputForce&&!t)throw new Error("Float texture outputs are not supported on this browser");void 0===this.floatTextures&&(this.floatTextures=!0,this.floatOutput=t);var e=a.hasIntegerDivisionAccuracyBug();if(null===this.fixIntegerDivisionAccuracy?this.fixIntegerDivisionAccuracy=e:this.fixIntegerDivisionAccuracy&&!e&&(this.fixIntegerDivisionAccuracy=!1),a.checkOutput(this.output),!this.output||0===this.output.length){if(1!==arguments.length)throw new Error("Auto output only supported for kernels with only one input");var r=a.getArgumentType(arguments[0]);if("Array"===r)this.output=a.getDimensions(r);else{if("NumberTexture"!==r&&"ArrayTexture(4)"!==r)throw new Error("Auto output not supported for input type: "+r);this.output=arguments[0].output}}if(this.texSize=a.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0),this.graphical){if(2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");this.floatOutput&&(this.floatOutput=!1,console.warn("Cannot use graphical mode and float output at the same time")),this.texSize=a.clone(this.output)}else void 0===this.floatOutput&&(this.floatOutput=!0);(this.floatOutput||this.floatOutputForce)&&this._webGl.getExtension("EXT_color_buffer_float")}},{key:"run",value:function(){null===this.program&&this.build.apply(this,arguments);var t=this.paramNames,e=this.paramTypes,r=this.texSize,i=this._webGl;i.useProgram(this.program),i.scissor(0,0,r[0],r[1]),this.hardcodeConstants||(this.setUniform3iv("uOutputDim",new Int32Array(this.threadDim)),this.setUniform2iv("uTexSize",r)),this.setUniform2f("ratio",r[0]/this.maxTexSize[0],r[1]/this.maxTexSize[1]),this.argumentsLength=0;for(var s=0;s<t.length;s++)this._addArgument(arguments[s],e[s],t[s]);if(this.graphical)return this.outputToTexture?(i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer),this.outputTexture&&!this.outputImmutable||this._setupOutputTexture(),i.drawArrays(i.TRIANGLE_STRIP,0,4),new n(this.outputTexture,r,this.threadDim,this.output,this._webGl,"ArrayTexture(4)")):(i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),void i.drawArrays(i.TRIANGLE_STRIP,0,4));i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer),this.outputImmutable&&this._setupOutputTexture();var a=this.outputTexture;if(null!==this.subKernelOutputVariableNames&&(this.outputImmutable&&(this.subKernelOutputTextures=[],this._setupSubOutputTextures(this.subKernelOutputVariableNames.length)),i.drawBuffers(this.drawBuffersMap)),i.drawArrays(i.TRIANGLE_STRIP,0,4),null!==this.subKernelOutputTextures){if(null!==this.subKernels){var u=[];u.result=this.renderOutput(a);for(var o=0;o<this.subKernels.length;o++)u.push(new n(this.subKernelOutputTextures[o],r,this.threadDim,this.output,this._webGl));return u}if(null!==this.subKernelProperties){var h={result:this.renderOutput(a)},T=0;for(var E in this.subKernelProperties)this.subKernelProperties.hasOwnProperty(E)&&(h[E]=new n(this.subKernelOutputTextures[T],r,this.threadDim,this.output,this._webGl),T++);return h}}return this.renderOutput(a)}},{key:"getOutputTexture",value:function(){return this.outputTexture}},{key:"_setupOutputTexture",value:function(){var t=this._webGl,e=this.texSize,r=this.outputTexture=this._webGl.createTexture();t.activeTexture(t.TEXTURE0+this.constantsLength+this.paramNames.length),t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),this.floatOutput?t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,e[0],e[1],0,t.RGBA,t.FLOAT,null):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e[0],e[1],0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0)}},{key:"_setupSubOutputTextures",value:function(t){for(var e=this._webGl,r=this.texSize,i=this.drawBuffersMap=[e.COLOR_ATTACHMENT0],s=this.subKernelOutputTextures=[],a=0;a<t;a++){var n=this._webGl.createTexture();s.push(n),i.push(e.COLOR_ATTACHMENT0+a+1),e.activeTexture(e.TEXTURE0+this.constantsLength+this.paramNames.length+a),e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),this.floatOutput?e.texImage2D(e.TEXTURE_2D,0,e.RGBA32F,r[0],r[1],0,e.RGBA,e.FLOAT,null):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r[0],r[1],0,e.RGBA,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+a+1,e.TEXTURE_2D,n,0)}}},{key:"_addArgument",value:function(t,e,r){var i=this._webGl,s=this.getArgumentTexture(r);switch(t instanceof n&&(e=t.type),e){case"Array":var u=a.getDimensions(t,!0),o=a.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},u);i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var h=o[0]*o[1],T=this._formatArrayTransfer(t,h),E=T.valuesFlat,_=T.bitRatio,l=void 0;this.floatTextures?i.texImage2D(i.TEXTURE_2D,0,i.RGBA32F,o[0],o[1],0,i.RGBA,i.FLOAT,E):(l=new Uint8Array(E.buffer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o[0]/_,o[1],0,i.RGBA,i.UNSIGNED_BYTE,l)),this.hardcodeConstants||(this.setUniform3iv("user_"+r+"Dim",u),this.setUniform2iv("user_"+r+"Size",o)),this.setUniform1i("user_"+r+"BitRatio",_),this.setUniform1i("user_"+r,this.argumentsLength);break;case"Integer":case"Float":case"Number":this.setUniform1f("user_"+r,t);break;case"Input":var R=t.size,f=a.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},R);i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var p=f[0]*f[1],m=this._formatArrayTransfer(t.value,p),c=m.valuesFlat,g=m.bitRatio;if(this.floatTextures)i.texImage2D(i.TEXTURE_2D,0,i.RGBA32F,f[0],f[1],0,i.RGBA,i.FLOAT,inputArray);else{var A=new Uint8Array(c.buffer);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,f[0]/g,f[1],0,i.RGBA,i.UNSIGNED_BYTE,A)}this.hardcodeConstants||(this.setUniform3iv("user_"+r+"Dim",R),this.setUniform2iv("user_"+r+"Size",f)),this.setUniform1i("user_"+r+"BitRatio",g),this.setUniform1i("user_"+r,this.argumentsLength);break;case"HTMLImage":var x=t,U=[x.width,x.height,1],d=[x.width,x.height];i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var D=i.RGBA,v=i.RGBA,b=i.UNSIGNED_BYTE;i.texImage2D(i.TEXTURE_2D,0,D,v,b,x),this.setUniform3iv("user_"+r+"Dim",U),this.setUniform2iv("user_"+r+"Size",d),this.setUniform1i("user_"+r,this.argumentsLength);break;case"HTMLImageArray":var S=t,X=[S[0].width,S[0].height,S.length],I=[S[0].width,S[0].height];i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D_ARRAY,s),i.texParameteri(i.TEXTURE_2D_ARRAY,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D_ARRAY,i.TEXTURE_MIN_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var y=i.RGBA,L=S[0].width,O=S[0].height,P=S.length,G=i.RGBA,N=i.UNSIGNED_BYTE;i.texImage3D(i.TEXTURE_2D_ARRAY,0,y,L,O,P,0,G,N,null);for(var F=0;F<S.length;F++){i.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,F,S[F].width,S[F].height,1,G,N,S[F])}this.setUniform3iv("user_"+r+"Dim",X),this.setUniform2iv("user_"+r+"Size",I),this.setUniform1i("user_"+r,this.argumentsLength);break;case"ArrayTexture(4)":case"NumberTexture":var w=t,B=w.dimensions,M=w.size;i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,w.texture),this.setUniform3iv("user_"+r+"Dim",B),this.setUniform2iv("user_"+r+"Size",M),this.setUniform1i("user_"+r+"BitRatio",1),this.setUniform1i("user_"+r,this.argumentsLength);break;default:throw new Error("Input type not supported (WebGL): "+t)}this.argumentsLength++}},{key:"_getMainConstantsString",value:function(){var t=[];if(this.constants)for(var e in this.constants)if(this.constants.hasOwnProperty(e)){var r=this.constants[e],i=a.getArgumentType(r);switch(i){case"Integer":t.push("const float constants_"+e+" = "+parseInt(r)+".0");break;case"Float":t.push("const float constants_"+e+" = "+parseFloat(r));break;case"Array":case"Input":case"HTMLImage":case"ArrayTexture(4)":case"NumberTexture":t.push("uniform highp sampler2D constants_"+e,"uniform highp ivec2 constants_"+e+"Size","uniform highp ivec3 constants_"+e+"Dim","uniform highp int constants_"+e+"BitRatio");break;case"HTMLImageArray":t.push("uniform highp sampler2DArray constants_"+e,"uniform highp ivec2 constants_"+e+"Size","uniform highp ivec3 constants_"+e+"Dim","uniform highp int constants_"+e+"BitRatio");break;default:throw new Error("Unsupported constant "+e+" type "+i)}}return this._linesToString(t)}},{key:"_addConstant",value:function(t,e,r){var i=this._webGl,s=this.getArgumentTexture(r);switch(t instanceof n&&(e=t.type),e){case"Array":var u=a.getDimensions(t,!0),o=a.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},u);i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var h=o[0]*o[1],T=this._formatArrayTransfer(t,h),E=T.valuesFlat,_=T.bitRatio,l=void 0;this.floatTextures?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o[0],o[1],0,i.RGBA,i.FLOAT,E):(l=new Uint8Array(E.buffer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o[0]/_,o[1],0,i.RGBA,i.UNSIGNED_BYTE,l)),this.hardcodeConstants||(this.setUniform3iv("constants_"+r+"Dim",u),this.setUniform2iv("constants_"+r+"Size",o)),this.setUniform1i("constants_"+r+"BitRatio",_),this.setUniform1i("constants_"+r,this.constantsLength);break;case"Input":var R=t.size,f=a.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},R);i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var p=f[0]*f[1],m=this._formatArrayTransfer(t.value,p),c=m.valuesFlat,g=m.bitRatio;if(this.floatTextures)i.texImage2D(i.TEXTURE_2D,0,i.RGBA32F,f[0],f[1],0,i.RGBA,i.FLOAT,inputArray);else{var A=new Uint8Array(c.buffer);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,f[0]/g,f[1],0,i.RGBA,i.UNSIGNED_BYTE,A)}this.hardcodeConstants||(this.setUniform3iv("constants_"+r+"Dim",R),this.setUniform2iv("constants_"+r+"Size",f)),this.setUniform1i("constants_"+r+"BitRatio",g),this.setUniform1i("constants_"+r,this.constantsLength);break;case"HTMLImage":var x=t,U=[x.width,x.height,1],d=[x.width,x.height];i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var D=i.RGBA,v=i.RGBA,b=i.UNSIGNED_BYTE;i.texImage2D(i.TEXTURE_2D,0,D,v,b,x),this.setUniform3iv("constants_"+r+"Dim",U),this.setUniform2iv("constants_"+r+"Size",d),this.setUniform1i("constants_"+r,this.constantsLength);break;case"HTMLImageArray":var S=t,X=[S[0].width,S[0].height,S.length],I=[S[0].width,S[0].height];i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D_ARRAY,s),i.texParameteri(i.TEXTURE_2D_ARRAY,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D_ARRAY,i.TEXTURE_MIN_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var y=i.RGBA,L=S[0].width,O=S[0].height,P=S.length,G=i.RGBA,N=i.UNSIGNED_BYTE;i.texImage3D(i.TEXTURE_2D_ARRAY,0,y,L,O,P,0,G,N,null);for(var F=0;F<S.length;F++){i.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,F,S[F].width,S[F].height,1,G,N,S[F])}this.setUniform3iv("constants_"+r+"Dim",X),this.setUniform2iv("constants_"+r+"Size",I),this.setUniform1i("constants_"+r,this.constantsLength);break;case"ArrayTexture(4)":case"NumberTexture":var w=t,B=w.dimensions,M=w.size;i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,w.texture),this.setUniform3iv("constants_"+r+"Dim",B),this.setUniform2iv("constants_"+r+"Size",M),this.setUniform1i("constants_"+r+"BitRatio",1),this.setUniform1i("constants_"+r,this.constantsLength);break;case"Integer":case"Float":default:throw new Error("Input type not supported (WebGL): "+t)}}},{key:"_getGetResultString",value:function(){return this.floatTextures?"  return texel[channel];":"  return decode(texel, x, bitRatio);"}},{key:"_getHeaderString",value:function(){return""}},{key:"_getTextureCoordinate",value:function(){var t=this.subKernelOutputVariableNames;return null===t||t.length<1?"in highp vec2 vTexCoord;\n":"out highp vec2 vTexCoord;\n"}},{key:"_getMainParamsString",value:function(t){for(var e=[],r=this.paramTypes,i=this.paramNames,s=0;s<i.length;s++){var n=t[s],u=i[s],o=r[s];if(this.hardcodeConstants)if("Array"===o||"NumberTexture"===o||"ArrayTexture(4)"===o){var h=a.getDimensions(n,!0),T=a.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},h);e.push("uniform highp sampler2D user_"+u,"highp ivec2 user_"+u+"Size = ivec2("+T[0]+", "+T[1]+")","highp ivec3 user_"+u+"Dim = ivec3("+h[0]+", "+h[1]+", "+h[2]+")","uniform highp int user_"+u+"BitRatio")}else"Integer"===o?e.push("highp float user_"+u+" = "+n+".0"):"Float"===o&&e.push("highp float user_"+u+" = "+n);else"Array"===o||"NumberTexture"===o||"ArrayTexture(4)"===o||"Input"===o||"HTMLImage"===o?(e.push("uniform highp sampler2D user_"+u,"uniform highp ivec2 user_"+u+"Size","uniform highp ivec3 user_"+u+"Dim"),"HTMLImage"!==o&&e.push("uniform highp int user_"+u+"BitRatio")):"HTMLImageArray"===o?e.push("uniform highp sampler2DArray user_"+u,"uniform highp ivec2 user_"+u+"Size","uniform highp ivec3 user_"+u+"Dim"):"Integer"!==o&&"Float"!==o||e.push("uniform float user_"+u)}return this._linesToString(e)}},{key:"_getKernelString",value:function(){var t=[],e=this.subKernelOutputVariableNames;if(null!==e){t.push("float kernelResult = 0.0"),t.push("layout(location = 0) out vec4 data0");for(var r=0;r<e.length;r++)t.push("float "+e[r]+" = 0.0","layout(location = "+(r+1)+") out vec4 data"+(r+1))}else t.push("out vec4 data0"),t.push("float kernelResult = 0.0");return this._linesToString(t)+this.functionBuilder.getPrototypeString("kernel")}},{key:"_getMainResultString",value:function(){var t=this.subKernelOutputVariableNames,e=[];if(this.floatOutput&&e.push("  index *= 4"),this.graphical)e.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = actualColor");else if(this.floatOutput)for(var r=["r","g","b","a"],i=0;i<r.length;++i){if(e.push("  threadId = indexTo3D(index, uOutputDim)"),e.push("  kernel()"),t){e.push("  data0."+r[i]+" = kernelResult");for(var s=0;s<t.length;++s)e.push("  data"+(s+1)+"."+r[i]+" = "+t[s])}else e.push("  data0."+r[i]+" = kernelResult");i<r.length-1&&e.push("  index += 1")}else if(null!==t){e.push("  threadId = indexTo3D(index, uOutputDim)"),e.push("  kernel()"),e.push("  data0 = encode32(kernelResult)");for(var a=0;a<t.length;a++)e.push("  data"+(a+1)+" = encode32("+t[a]+")")}else e.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = encode32(kernelResult)");return this._linesToString(e)}},{key:"_addKernels",value:function(){var t=this,e=this.functionBuilder;this._webGl;e.addFunctions(this.functions,{constants:this.constants,output:this.output}),e.addNativeFunctions(this.nativeFunctions),e.addKernel(this.fnString,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations,paramNames:this.paramNames,paramTypes:this.paramTypes,constantTypes:this.constantTypes,fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy}),null!==this.subKernels?(this.subKernelOutputTextures=[],this.subKernelOutputVariableNames=[],this.subKernels.forEach(function(e){return t._addSubKernel(e)})):null!==this.subKernelProperties&&(this.subKernelOutputTextures=[],this.subKernelOutputVariableNames=[],Object.keys(this.subKernelProperties).forEach(function(e){return t._addSubKernel(t.subKernelProperties[e])}))}},{key:"_getFragShaderString",value:function(t){return null!==this.compiledFragShaderString?this.compiledFragShaderString:this.compiledFragShaderString=this._replaceArtifacts(this.constructor.fragShaderString,this._getFragShaderArtifactMap(t))}},{key:"_getVertShaderString",value:function(t){return null!==this.compiledVertShaderString?this.compiledVertShaderString:this.compiledVertShaderString=this.constructor.vertShaderString}}],[{key:"fragShaderString",get:function(){return u}},{key:"vertShaderString",get:function(){return o}}]),T}();
},{"../web-gl/kernel":"9TKN","../../core/utils":"hsMx","../../core/texture":"ByaE","./shader-frag":"IoZL","./shader-vert":"UHdv"}],"ueuS":[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=require("../runner-base"),u=require("./function-builder"),i=require("./kernel");module.exports=function(c){function a(e){t(this,a);var n=r(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,new u,e));return n.Kernel=i,n.kernel=null,n}return n(a,o),e(a,[{key:"getMode",value:function(){return"gpu"}}]),a}();
},{"../runner-base":"6CY0","./function-builder":"SerK","./kernel":"U6r8"}],"BSam":[function(require,module,exports) {
"use strict";var n=require("../../core/utils"),t=require("../kernel-run-shortcut");function e(n){return/^function /.test(n)&&(n=n.substring(9)),n.replace(/[_]typeof/g,"typeof")}function r(n){return n.replace(/[_]typeof/g,"typeof")}module.exports=function(i,s){return"() => {\n    "+t.toString()+";\n    const utils = {\n      allPropertiesOf: "+r(n.allPropertiesOf.toString())+",\n      clone: "+r(n.clone.toString())+",\n      checkOutput: "+r(n.checkOutput.toString())+"\n    };\n    const Utils = utils;\n    let Input = function() {};\n    class "+(s||"Kernel")+" {\n      constructor() {        \n        this.argumentsLength = 0;\n        this._canvas = null;\n        this._webGl = null;\n        this.built = false;\n        this.program = null;\n        this.paramNames = "+JSON.stringify(i.paramNames)+";\n        this.paramTypes = "+JSON.stringify(i.paramTypes)+";\n        this.texSize = "+JSON.stringify(i.texSize)+";\n        this.output = "+JSON.stringify(i.output)+";\n        this._kernelString = `"+i._kernelString+"`;\n        this.output = "+JSON.stringify(i.output)+";\n\t\t    this.run = function() {\n          this.run = null;\n          this.build();\n          return this.run.apply(this, arguments);\n        }.bind(this);\n        this.thread = {\n          x: 0,\n          y: 0,\n          z: 0\n        };\n      }\n      setCanvas(canvas) { this._canvas = canvas; return this; }\n      setWebGl(webGl) { this._webGl = webGl; return this; }\n      setInput(Type) { Input = Type; }\n      "+e(i.build.toString())+"\n      "+e(i.setupParams.toString())+"\n      "+e(i.setupConstants.toString())+"\n      run () { "+i.kernelString+" }\n      getKernelString() { return this._kernelString; }\n      "+e(i.validateOptions.toString())+"\n    };\n    return kernelRunShortcut(new Kernel());\n  };"};
},{"../../core/utils":"hsMx","../kernel-run-shortcut":"Ar/k"}],"j8q7":[function(require,module,exports) {
"use strict";var t=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=require("../kernel-base"),a=require("../../core/utils"),i=require("./kernel-string");module.exports=function(u){function o(t,n){e(this,o);var s=r(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t,n));return s._fn=null,s.run=null,s._canvasCtx=null,s._imageData=null,s._colorData=null,s._kernelString=null,s.thread={x:0,y:0,z:0},s.run=function(){return this.run=null,this.build.apply(this,arguments),this.run.apply(this,arguments)}.bind(s),s}return n(o,s),t(o,[{key:"validateOptions",value:function(){if(!this.output||0===this.output.length){if(1!==arguments.length)throw"Auto dimensions only supported for kernels with only one input";var t=a.getArgumentType(arguments[0]);if("Array"===t)this.output=a.getDimensions(t);else{if("NumberTexture"!==t&&"ArrayTexture(4)"!==t)throw"Auto dimensions not supported for input type: "+t;this.output=arguments[0].output}}a.checkOutput(this.output)}},{key:"build",value:function(){this.setupConstants(),this.setupParams(arguments),this.validateOptions();var t=this._canvas;t&&(this._canvasCtx=t.getContext("2d"));for(var e=this.threadDim=a.clone(this.output);e.length<3;)e.push(1);if(this.graphical){var r=this._canvas;if(!r)throw new Error("no canvas available for using graphical output");r.width=e[0],r.height=e[1],this._imageData=this._canvasCtx.createImageData(e[0],e[1]),this._colorData=new Uint8ClampedArray(e[0]*e[1]*4)}var n=this.getKernelString();this.debug&&(console.log("Options:"),console.dir(this),console.log("Function output:"),console.log(n)),this.kernelString=n,this.run=new Function([],n).bind(this)()}},{key:"color",value:function(t,e,r,n){void 0===n&&(n=1),t=Math.floor(255*t),e=Math.floor(255*e),r=Math.floor(255*r),n=Math.floor(255*n);var s=this.output[0],a=this.output[1],i=this.thread.x+(a-this.thread.y-1)*s;this._colorData[4*i+0]=t,this._colorData[4*i+1]=e,this._colorData[4*i+2]=r,this._colorData[4*i+3]=n}},{key:"getKernelString",value:function(){if(null!==this._kernelString)return this._kernelString;for(var t=this.functionBuilder,e=this.threadDim||(this.threadDim=a.clone(this.output));e.length<3;)e.push(1);if(t.addKernel(this.fnString,{prototypeOnly:!1,constants:this.constants,output:e,debug:this.debug,loopMaxIterations:this.loopMaxIterations,paramNames:this.paramNames,paramTypes:this.paramTypes,paramSizes:this.paramSizes,constantTypes:this.constantTypes}),t.addFunctions(this.functions,{constants:this.constants,output:e}),t.addNativeFunctions(this.nativeFunctions),null!==this.subKernels){this.subKernelOutputTextures=[],this.subKernelOutputVariableNames=[];for(var r=0;r<this.subKernels.length;r++){var n=this.subKernels[r];t.addSubKernel(n,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations}),this.subKernelOutputVariableNames.push(n.name+"Result")}}else if(null!==this.subKernelProperties){this.subKernelOutputVariableNames=[];for(var s in this.subKernelProperties)if(this.subKernelProperties.hasOwnProperty(s)){var i=this.subKernelProperties[s];t.addSubKernel(i),this.subKernelOutputVariableNames.push(i.name+"Result"),0}}var u=t.getPrototypes("kernel"),o=null;return u.length>1?u=u.filter(function(t){return/^function/.test(t)?t:(o=t,!1)}):o=u.shift(),this._kernelString="\n\t\tvar LOOP_MAX = "+this._getLoopMaxString()+"\n\t\tvar constants = this.constants;\n\t\tvar _this = this;\n    return function ("+this.paramNames.map(function(t){return"user_"+t}).join(", ")+") {\n      "+this._processConstants()+"\n      "+this._processParams()+"\n      "+this._kernelLoop(o)+"\n      if (this.graphical) {\n        this._imageData.data.set(this._colorData);\n        this._canvasCtx.putImageData(this._imageData, 0, 0);\n        return;\n      }\n      "+this._kernelOutput()+"\n      "+(u.length>0?u.join("\n"):"")+"\n    }.bind(this);"}},{key:"toString",value:function(){return i(this)}},{key:"_getLoopMaxString",value:function(){return this.loopMaxIterations?" "+parseInt(this.loopMaxIterations)+";\n":" 1000;\n"}},{key:"_processConstants",value:function(){if(!this.constants)return"";var t=[];for(var e in this.constants){switch(this.constantTypes[e]){case"HTMLImage":t.push("  var constants_"+e+" = this._imageTo2DArray(this.constants."+e+")");break;case"HTMLImageArray":t.push("  var constants_"+e+" = this._imageTo3DArray(this.constants."+e+")");break;case"Input":t.push("  var constants_"+e+" = this.constants."+e+".value");break;default:t.push("  var constants_"+e+" = this.constants."+e)}}return t.join("\n")}},{key:"_processParams",value:function(){for(var t=[],e=0;e<this.paramTypes.length;e++)switch(this.paramTypes[e]){case"HTMLImage":t.push("  user_"+this.paramNames[e]+" = this._imageTo2DArray(user_"+this.paramNames[e]+")");break;case"HTMLImageArray":t.push("  user_"+this.paramNames[e]+" = this._imageTo3DArray(user_"+this.paramNames[e]+")");break;case"Input":t.push("  user_"+this.paramNames[e]+" = user_"+this.paramNames[e]+".value")}return t.join(";\n")}},{key:"_imageTo2DArray",value:function(t){var e=this._canvas;e.width<t.width&&(e.width=t.width),e.height<t.height&&(e.height=t.height);var r=this._canvasCtx;r.drawImage(t,0,0,t.width,t.height);for(var n=r.getImageData(0,0,t.width,t.height).data,s=new Array(t.height),a=0,i=t.height-1;i>=0;i--){s[i]=new Array(t.width);for(var u=0;u<t.width;u++){var o=n[a++]/255,h=n[a++]/255,l=n[a++]/255,p=n[a++]/255,c=[o,h,l,p];c.r=o,c.g=h,c.b=l,c.a=p,s[i][u]=c}}return s}},{key:"_imageTo3DArray",value:function(t){for(var e=new Array(t.length),r=0;r<t.length;r++)e[r]=this._imageTo2DArray(t[r]);return e}},{key:"_kernelLoop",value:function(t){switch(this.output.length){case 1:return this._kernel1DLoop(t);case 2:return this._kernel2DLoop(t);case 3:return this._kernel3DLoop(t);default:throw new Error("unsupported size kernel")}}},{key:"_kernel1DLoop",value:function(t){var e=this.threadDim;return"\n    var result = new Float32Array("+e[0]+");\n    "+this._mapSubKernels(function(t){return"var result_"+t+" = new Float32Array("+e[0]+");\n"}).join("")+"\n    for (var x = 0; x < "+e[0]+"; x++) {\n      this.thread.x = x;\n      this.thread.y = 0;\n      this.thread.z = 0;\n      var kernelResult;\n      "+t+"\n      result[x] = kernelResult;\n      "+this._mapSubKernels(function(t){return"result_"+t+"[x] = "+t+";\n"}).join("")+"\n    }"}},{key:"_kernel2DLoop",value:function(t){var e=this.threadDim;return"\n    var result = new Array("+e[1]+");\n    "+this._mapSubKernels(function(t){return"var result_"+t+" = new Array("+e[1]+");\n"}).join("")+"\n    for (var y = 0; y < "+e[1]+"; y++) {\n      this.thread.z = 0;\n      this.thread.y = y;\n      var resultX = result[y] = new Float32Array("+e[0]+");\n      "+this._mapSubKernels(function(t){return"var result_"+t+"X = result_"+t+"[y] = new Float32Array("+e[0]+");\n"}).join("")+"\n      for (var x = 0; x < "+e[0]+"; x++) {\n      \tthis.thread.x = x;\n        var kernelResult;\n        "+t+"\n        resultX[x] = kernelResult;\n        "+this._mapSubKernels(function(t){return"result_"+t+"X[x] = "+t+";\n"}).join("")+"\n      }\n    }"}},{key:"_kernel3DLoop",value:function(t){var e=this.threadDim;return"\n    var result = new Array("+e[2]+");\n    "+this._mapSubKernels(function(t){return"var result_"+t+" = new Array("+e[2]+");\n"}).join("")+"\n    for (var z = 0; z < "+e[2]+"; z++) {\n      this.thread.z = z;\n      var resultY = result[z] = new Array("+e[1]+");\n      "+this._mapSubKernels(function(t){return"var result_"+t+"Y = result_"+t+"[z] = new Array("+e[1]+");\n"}).join("")+"\n      for (var y = 0; y < "+e[1]+"; y++) {\n        this.thread.y = y;\n        var resultX = resultY[y] = new Float32Array("+e[0]+");\n        "+this._mapSubKernels(function(t){return"var result_"+t+"X = result_"+t+"Y[y] = new Float32Array("+e[0]+");\n"}).join("")+"\n        for (var x = 0; x < "+e[0]+"; x++) {\n        \tthis.thread.x = x;\n          var kernelResult;\n          "+t+"\n          resultX[x] = kernelResult;\n          "+this._mapSubKernels(function(t){return"result_"+t+"X[x] = "+t+";\n"}).join("")+"\n        }\n      }\n    }"}},{key:"_kernelOutput",value:function(){var t=this;return this.subKernelOutputVariableNames?"return {\n      result: result,\n      "+Object.keys(this.subKernelProperties||this.subKernelOutputVariableNames).map(function(e,r){return e+": result_"+t.subKernelOutputVariableNames[r]}).join(",\n")+"\n    };":"return result;"}},{key:"_mapSubKernels",value:function(t){return null===this.subKernelOutputVariableNames?[""]:this.subKernelOutputVariableNames.map(t)}}]),o}();
},{"../kernel-base":"ZzEd","../../core/utils":"hsMx","./kernel-string":"BSam"}],"WJtR":[function(require,module,exports) {
"use strict";var t=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}();function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=require("../function-node-base"),r=require("../../core/utils");module.exports=function(a){function u(t,n,i){e(this,u);var r=s(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,t,n,i));return r.paramSizes=i?i.paramSizes:[],r.memberStates=[],r}return n(u,i),t(u,[{key:"pushMemberState",value:function(t){this.memberStates.push(t)}},{key:"popMemberState",value:function(t){if(this.memberState!==t)throw new Error("Cannot popMemberState "+t+" when in "+this.memberState);this.memberStates.pop()}},{key:"generate",value:function(){return this.debug&&console.log(this),this.functionStringArray=this.astGeneric(this.getJsAST(),[]),this.functionString=this.functionStringArray.join("").trim(),this.functionString}},{key:"getFunctionPrototypeString",value:function(){return this.webGlFunctionPrototypeString?this.webGlFunctionPrototypeString:this.webGlFunctionPrototypeString=this.generate()}},{key:"astFunctionDeclaration",value:function(t,e){return this.builder.addFunction(null,r.getAstString(this.jsFunctionString,t)),e}},{key:"astFunctionPrototype",value:function(t,e){if(this.isRootKernel||this.isSubKernel)return e;e.push(this.returnType),e.push(" "),e.push(this.functionName),e.push("(");for(var s=0;s<this.paramNames.length;++s)s>0&&e.push(", "),e.push("user_"),e.push(this.paramNames[s]);return e.push(");\n"),e}},{key:"astFunctionExpression",value:function(t,e){if(!this.isRootKernel){e.push("function"),e.push(" "),e.push(this.functionName),e.push("(");for(var s=0;s<this.paramNames.length;++s){var n=this.paramNames[s];s>0&&e.push(", "),e.push("user_"),e.push(n)}e.push(") {\n")}for(var i=0;i<t.body.body.length;++i)this.astGeneric(t.body.body[i],e),e.push("\n");return this.isRootKernel||e.push("}\n"),e}},{key:"astReturnStatement",value:function(t,e){return this.isRootKernel?(e.push("kernelResult = "),this.astGeneric(t.argument,e),e.push(";")):this.isSubKernel?(e.push(this.functionName+"Result = "),this.astGeneric(t.argument,e),e.push(";"),e.push("return "+this.functionName+"Result;")):(e.push("return "),this.astGeneric(t.argument,e),e.push(";")),e}},{key:"astLiteral",value:function(t,e){if(isNaN(t.value))throw this.astErrorOutput("Non-numeric literal not supported : "+t.value,t);return e.push(t.value),e}},{key:"astBinaryExpression",value:function(t,e){return e.push("("),this.astGeneric(t.left,e),e.push(t.operator),this.astGeneric(t.right,e),e.push(")"),e}},{key:"astIdentifierExpression",value:function(t,e){if("Identifier"!==t.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",t);switch(this.state){case"input-index-y":case"input-index-z":e.push("(")}switch(t.name){case"gpu_threadX":e.push("threadId.x");break;case"gpu_threadY":e.push("threadId.y");break;case"gpu_threadZ":e.push("threadId.z");break;case"gpu_outputX":e.push("uOutputDim.x");break;case"gpu_outputY":e.push("uOutputDim.y");break;case"gpu_outputZ":e.push("uOutputDim.z");break;case"Infinity":e.push("Infinity");break;default:if(this.constants&&this.constants.hasOwnProperty(t.name))e.push("constants_"+t.name);else{var s=this.getUserParamName(t.name);null!==s?e.push("user_"+s):e.push("user_"+t.name)}}switch(this.state){case"input-index-y":var n=this.paramSizes[this.paramNames.indexOf(this.memberState)];e.push(" * "+n[0]+")");break;case"input-index-z":var i=this.paramSizes[this.paramNames.indexOf(this.memberState)];e.push(" * "+i[0]*i[1]+")")}return e}},{key:"astForStatement",value:function(t,e){if("ForStatement"!==t.type)throw this.astErrorOutput("Invalid for statement",t);if(t.test&&"BinaryExpression"===t.test.type){if(("Identifier"===t.test.right.type||"Literal"===t.test.right.type)&&"<"===t.test.operator&&!1===this.isIdentifierConstant(t.test.right.name)){if(this.loopMaxIterations||(console.warn("Warning: loopMaxIterations is not set! Using default of 1000 which may result in unintended behavior."),console.warn("Set loopMaxIterations or use a for loop of fixed length to silence this message.")),e.push("for ("),this.astGeneric(t.init,e),";"!==e[e.length-1]&&e.push(";"),this.astGeneric(t.test.left,e),e.push(t.test.operator),e.push("LOOP_MAX"),e.push(";"),this.astGeneric(t.update,e),e.push(")"),e.push("{\n"),e.push("if ("),this.astGeneric(t.test.left,e),e.push(t.test.operator),this.astGeneric(t.test.right,e),e.push(") {\n"),"BlockStatement"===t.body.type)for(var s=0;s<t.body.body.length;s++)this.astGeneric(t.body.body[s],e);else this.astGeneric(t.body,e);return e.push("} else {\n"),e.push("break;\n"),e.push("}\n"),e.push("}\n"),e}if(t.init.declarations){var n=JSON.parse(JSON.stringify(t.init.declarations)),i=t.update.argument;if(!Array.isArray(n)||n.length<1)throw console.log(this.jsFunctionString),new Error("Error: Incompatible for loop declaration");if(n.length>1){for(var r=null,a=0;a<n.length;a++){var u=n[a];u.id.name===i.name?(r=u,n.splice(a,1)):(e.push("var "),this.astGeneric(u,e),e.push(";"))}e.push("for (let "),this.astGeneric(r,e),e.push(";")}else e.push("for ("),this.astGeneric(t.init,e);return this.astGeneric(t.test,e),e.push(";"),this.astGeneric(t.update,e),e.push(")"),this.astGeneric(t.body,e),e}}throw this.astErrorOutput("Invalid for statement",t)}},{key:"astWhileStatement",value:function(t,e){if("WhileStatement"!==t.type)throw this.astErrorOutput("Invalid while statement",t);return e.push("for (let i = 0; i < LOOP_MAX; i++) {"),e.push("if ("),this.astGeneric(t.test,e),e.push(") {\n"),this.astGeneric(t.body,e),e.push("} else {\n"),e.push("break;\n"),e.push("}\n"),e.push("}\n"),e}},{key:"astDoWhileStatement",value:function(t,e){if("DoWhileStatement"!==t.type)throw this.astErrorOutput("Invalid while statement",t);return e.push("for (let i = 0; i < LOOP_MAX; i++) {"),this.astGeneric(t.body,e),e.push("if (!"),this.astGeneric(t.test,e),e.push(") {\n"),e.push("break;\n"),e.push("}\n"),e.push("}\n"),e}},{key:"astAssignmentExpression",value:function(t,e){return this.astGeneric(t.left,e),e.push(t.operator),this.astGeneric(t.right,e),e}},{key:"astEmptyStatement",value:function(t,e){return e}},{key:"astBlockStatement",value:function(t,e){e.push("{\n");for(var s=0;s<t.body.length;s++)this.astGeneric(t.body[s],e);return e.push("}\n"),e}},{key:"astExpressionStatement",value:function(t,e){return this.astGeneric(t.expression,e),e.push(";"),e}},{key:"astVariableDeclaration",value:function(t,e){e.push("var ");for(var s=0;s<t.declarations.length;s++)this.declarations[t.declarations[s].id.name]="var",s>0&&e.push(","),this.astGeneric(t.declarations[s],e);return e.push(";"),e}},{key:"astVariableDeclarator",value:function(t,e){return this.astGeneric(t.id,e),null!==t.init&&(e.push("="),this.astGeneric(t.init,e)),e}},{key:"astIfStatement",value:function(t,e){return e.push("if ("),this.astGeneric(t.test,e),e.push(")"),"BlockStatement"===t.consequent.type?this.astGeneric(t.consequent,e):(e.push(" {\n"),this.astGeneric(t.consequent,e),e.push("\n}\n")),t.alternate&&(e.push("else "),"BlockStatement"===t.alternate.type?this.astGeneric(t.alternate,e):(e.push(" {\n"),this.astGeneric(t.alternate,e),e.push("\n}\n"))),e}},{key:"astBreakStatement",value:function(t,e){return e.push("break;\n"),e}},{key:"astContinueStatement",value:function(t,e){return e.push("continue;\n"),e}},{key:"astLogicalExpression",value:function(t,e){return e.push("("),this.astGeneric(t.left,e),e.push(t.operator),this.astGeneric(t.right,e),e.push(")"),e}},{key:"astUpdateExpression",value:function(t,e){return t.prefix?(e.push(t.operator),this.astGeneric(t.argument,e)):(this.astGeneric(t.argument,e),e.push(t.operator)),e}},{key:"astUnaryExpression",value:function(t,e){return t.prefix?(e.push(t.operator),this.astGeneric(t.argument,e)):(this.astGeneric(t.argument,e),e.push(t.operator)),e}},{key:"astThisExpression",value:function(t,e){return e.push("_this"),e}},{key:"astMemberExpression",value:function(t,e){if(t.computed)if("Identifier"===t.object.type||"MemberExpression"===t.object.type&&t.object.object.object&&"ThisExpression"===t.object.object.object.type&&"constants"===t.object.object.property.name)this.pushState("identifier"),this.astGeneric(t.object,e),this.popState("identifier"),e.push("["),this.isInput(t.object.name),this.astGeneric(t.property,e),e.push("]");else if(t.object.object)if(t.object.object.object&&this.isInput(t.object.object.object.name)){this.pushMemberState(t.object.object.object.name),this.pushState("input-index-z"),this.astGeneric(t.object,e);var s=e.pop();e.push(" + "),this.popState("input-index-z"),this.pushState("input-index"),this.astGeneric(t.property,e),this.popState("input-index"),e.push(s),this.popMemberState(t.object.object.object.name)}else if(this.isInput(t.object.object.name)){this.pushMemberState(t.object.object.name),this.isState("input-index-z")||this.pushState("input-index-y"),this.astGeneric(t.object,e);var n=e.pop();e.push(" + "),this.isState("input-index-z")||this.popState("input-index-y");var i=this.isState("input-index-z");i?this.pushState("input-index-y"):this.pushState("input-index"),this.astGeneric(t.property,e),i?this.popState("input-index-y"):this.popState("input-index"),e.push(n),this.popMemberState(t.object.object.name)}else{this.astGeneric(t.object,e);var r=e.pop();e.push("]["),this.astGeneric(t.property,e),e.push(r)}else{this.astGeneric(t.object,e);var a=e.pop();e.push("]["),this.astGeneric(t.property,e),e.push(a)}else{var u=this.astMemberExpressionUnroll(t);switch("Identifier"===t.property.type&&t.computed&&(u="user_"+u),0===u.indexOf("this.constants")?u="constants_"+u.substring(15):0===u.indexOf("this")&&(u="_"+u),this.state){case"input-index-y":case"input-index-z":e.push("(")}switch(u){case"_this.output.x":e.push(this.output[0]);break;case"_this.output.y":e.push(this.output[1]);break;case"_this.output.z":e.push(this.output[2]);break;default:t.object&&t.object.name&&this.declarations[t.object.name]&&e.push("user_"),e.push(u)}switch(this.state){case"input-index-y":var h=this.paramSizes[this.paramNames.indexOf(this.memberState)];e.push(" * "+h[0]+")");break;case"input-index-z":var o=this.paramSizes[this.paramNames.indexOf(this.memberState)];e.push(" * "+o[0]*o[1]+")")}}return e}},{key:"astSequenceExpression",value:function(t,e){for(var s=0;s<t.expressions.length;s++)s>0&&e.push(","),this.astGeneric(t.expressions,e);return e}},{key:"astCallExpression",value:function(t,e){if(t.callee){var s=this.astMemberExpressionUnroll(t.callee);this.calledFunctions.indexOf(s)<0&&this.calledFunctions.push(s),this.hasOwnProperty("funcName")||(this.calledFunctionsArguments[s]=[]);var n=[];this.calledFunctionsArguments[s].push(n),e.push(s),e.push("(");for(var i=0;i<t.arguments.length;++i){var r=t.arguments[i];if(i>0&&e.push(", "),this.astGeneric(r,e),"Identifier"===r.type){var a=this.paramNames.indexOf(r.name);-1===a?n.push(null):n.push({name:r.name,type:this.paramTypes[a]})}else n.push(null)}return e.push(")"),e}throw this.astErrorOutput("Unknown CallExpression",t)}},{key:"astArrayExpression",value:function(t,e){var s=t.elements.length;e.push("[");for(var n=0;n<s;++n){n>0&&e.push(", ");var i=t.elements[n];this.astGeneric(i,e)}return e.push("]"),e}},{key:"astDebuggerStatement",value:function(t,e){return e.push("debugger;"),e}},{key:"memberState",get:function(){return this.memberStates[this.memberStates.length-1]}}]),u}();
},{"../function-node-base":"BHBn","../../core/utils":"hsMx"}],"neSP":[function(require,module,exports) {
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var n=require("../function-builder-base"),r=require("./function-node");module.exports=function(i){function u(){e(this,u);var o=t(this,(u.__proto__||Object.getPrototypeOf(u)).call(this));return o.Node=r,o}return o(u,n),u}();
},{"../function-builder-base":"KoGT","./function-node":"WJtR"}],"wrgc":[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=require("../../core/utils"),u=require("../runner-base"),i=require("./kernel"),c=require("./function-builder");module.exports=function(o){function l(e){t(this,l);var n=r(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,new c,e));return n.Kernel=i,n.kernel=null,n}return n(l,u),e(l,[{key:"getMode",value:function(){return"cpu"}}]),l}();
},{"../../core/utils":"hsMx","../runner-base":"6CY0","./kernel":"j8q7","./function-builder":"neSP"}],"Ljr5":[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var n=require("./kernel"),i=require("../../core/utils");module.exports=function(u){function a(){return t(this,a),r(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return o(a,n),e(a,[{key:"validateOptions",value:function(){this.texSize=i.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0)}}]),a}();
},{"./kernel":"9TKN","../../core/utils":"hsMx"}],"2wRj":[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var n=require("./kernel"),i=require("../../core/utils");module.exports=function(u){function f(){return t(this,f),o(this,(f.__proto__||Object.getPrototypeOf(f)).apply(this,arguments))}return r(f,n),e(f,[{key:"validateOptions",value:function(){this._webGl.getExtension("EXT_color_buffer_float"),this.texSize=i.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0)}}]),f}();
},{"./kernel":"U6r8","../../core/utils":"hsMx"}],"vUCu":[function(require,module,exports) {
"use strict";var e=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}();function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var r=require("./utils-core");module.exports=function(){function r(){n(this,r)}return e(r,null,[{key:"validateKernelObj",value:function(e){if(null===e)throw"KernelObj being validated is NULL";if("string"==typeof e){try{e=JSON.parse(e)}catch(n){throw console.error(n),"Failed to convert KernelObj from JSON string"}if(null===e)throw"Invalid (NULL) KernelObj JSON string representation"}if(!0!==e.isKernelObj)throw"Failed missing isKernelObj flag check";return e}},{key:"loadKernelObj",value:function(e,n){e=validateKernelObj(e)}}]),r}();
},{"./utils-core":"jPkF"}],"701I":[function(require,module,exports) {
"use strict";var e=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}();function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function r(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function t(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}var u=require("./utils"),a=require("../backend/web-gl/runner"),o=require("../backend/web-gl2/runner"),i=require("../backend/cpu/runner"),l=require("../backend/web-gl/validator-kernel"),s=require("../backend/web-gl2/validator-kernel"),c=require("./gpu-core"),f=function(f){function p(e){n(this,p);var t=r(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,e));e=e||{},t._canvas=e.canvas||null,t._webGl=e.webGl||null;var c=e.mode,f=void 0;if(u.isWebGlSupported())if(t._webGl)if("undefined"!=typeof WebGL2RenderingContext&&t._webGl.constructor===WebGL2RenderingContext)f="webgl2";else{if("undefined"==typeof WebGLRenderingContext||t._webGl.constructor!==WebGLRenderingContext)throw new Error("unknown WebGL Context");f="webgl"}else f=c||"gpu";else{if(c&&"cpu"!==c)throw new Error('A requested mode of "'+c+'" and is not supported');console.warn("Warning: gpu not supported, falling back to cpu support"),f="cpu"}t.kernels=[];var b={canvas:t._canvas,webGl:t._webGl};switch(f){case"cpu":t._runner=new i(b);break;case"gpu":var d=t.getGPURunner();t._runner=new d(b);break;case"webgl2":t._runner=new o(b);break;case"webgl":t._runner=new a(b);break;case"webgl2-validator":t._runner=new o(b),t._runner.Kernel=s;break;case"webgl-validator":t._runner=new a(b),t._runner.Kernel=l;break;default:throw new Error('"'+c+'" mode is not defined')}return t}return t(p,c),e(p,[{key:"createKernel",value:function(e,n){if(void 0===e)throw"Missing fn parameter";if(!u.isFunction(e)&&"string"!=typeof e)throw"fn parameter not a function";var r=Object.assign({webGl:this._webGl,canvas:this._canvas},n||{}),t=this._runner.buildKernel(e,r);return this._canvas||(this._canvas=t.getCanvas()),this._runner.canvas||(this._runner.canvas=t.getCanvas()),this.kernels.push(t),t}},{key:"createKernelMap",value:function(){var e=void 0,n=void 0;"function"==typeof arguments[arguments.length-2]?(e=arguments[arguments.length-2],n=arguments[arguments.length-1]):e=arguments[arguments.length-1],u.isWebGlDrawBuffersSupported()||(this._runner=new i(n));var r=this.createKernel(e,n);if(Array.isArray(arguments[0]))for(var t=arguments[0],a=0;a<t.length;a++)r.addSubKernel(t[a]);else{var o=arguments[0];for(var l in o)o.hasOwnProperty(l)&&r.addSubKernelProperty(l,o[l])}return r}},{key:"combineKernels",value:function(){var e=arguments[arguments.length-2],n=arguments[arguments.length-1];if("cpu"===this.getMode())return n;for(var r=arguments[0].getCanvas(),t=arguments[0].getWebGl(),a=0;a<arguments.length-1;a++)arguments[a].setCanvas(r).setWebGl(t).setOutputToTexture(!0);return function(){n.apply(null,arguments);var r=e.texSize,t=e.getWebGl(),a=e.threadDim,o=void 0;if(e.floatOutput){var i=r[0],l=Math.ceil(r[1]/4);o=new Float32Array(i*l*4),t.readPixels(0,0,i,l,t.RGBA,t.FLOAT,o)}else{var s=new Uint8Array(r[0]*r[1]*4);t.readPixels(0,0,r[0],r[1],t.RGBA,t.UNSIGNED_BYTE,s),o=new Float32Array(s.buffer)}return o=o.subarray(0,a[0]*a[1]*a[2]),1===e.output.length?o:2===e.output.length?u.splitArray(o,e.output[0]):3===e.output.length?u.splitArray(o,e.output[0]*e.output[1]).map(function(n){return u.splitArray(n,e.output[0])}):void 0}}},{key:"getGPURunner",value:function(){return"undefined"!=typeof WebGL2RenderingContext&&u.isWebGl2Supported()?o:"undefined"!=typeof WebGLRenderingContext?a:void 0}},{key:"addFunction",value:function(e,n){return this._runner.functionBuilder.addFunction(null,e,n),this}},{key:"addNativeFunction",value:function(e,n){return this._runner.functionBuilder.addNativeFunction(e,n),this}},{key:"getMode",value:function(){return this._runner.getMode()}},{key:"isWebGlSupported",value:function(){return u.isWebGlSupported()}},{key:"hasIntegerDivisionAccuracyBug",value:function(){return u.hasIntegerDivisionAccuracyBug()}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getWebGl",value:function(){return this._webGl}},{key:"destroy",value:function(){var e=this;setTimeout(function(){for(var n=e.kernels,r=!e._webGl&&n.length&&n[0]._webGl,t=0;t<e.kernels.length;t++)e.kernels[t].destroy(!0);if(r){r.OES_texture_float=null,r.OES_texture_float_linear=null,r.OES_element_index_uint=null;var u=r.getExtension("WEBGL_lose_context");u&&u.loseContext()}},0)}}]),p}();Object.assign(f,c),module.exports=f;
},{"./utils":"hsMx","../backend/web-gl/runner":"J272","../backend/web-gl2/runner":"ueuS","../backend/cpu/runner":"wrgc","../backend/web-gl/validator-kernel":"Ljr5","../backend/web-gl2/validator-kernel":"2wRj","./gpu-core":"vUCu"}],"i4Hu":[function(require,module,exports) {
"use strict";var r=require("./utils");module.exports=function(t,n){var e=n.toString();return new Function("return function "+t+" ("+r.getParamNamesFromString(e).join(", ")+") {"+r.getFunctionBodyFromString(e)+"}")()};
},{"./utils":"hsMx"}],"ieip":[function(require,module,exports) {
"use strict";var e=require("./core/gpu"),n=require("./core/alias"),r=require("./core/utils"),u=require("./core/input"),i=require("./core/texture"),c=require("./backend/cpu/function-builder"),d=require("./backend/cpu/function-node"),o=require("./backend/cpu/kernel"),b=require("./backend/cpu/runner"),l=require("./backend/web-gl/function-builder"),t=require("./backend/web-gl/function-node"),a=require("./backend/web-gl/kernel"),q=require("./backend/web-gl/runner"),f=require("./backend/web-gl2/function-builder"),k=require("./backend/web-gl2/function-node"),w=require("./backend/web-gl2/kernel"),p=require("./backend/web-gl2/runner");e.alias=n,e.utils=r,e.Texture=i,e.Input=u,e.input=function(e,n){return new u(e,n)},e.CPUFunctionBuilder=c,e.CPUFunctionNode=d,e.CPUKernel=o,e.CPURunner=b,e.WebGLFunctionBuilder=l,e.WebGLFunctionNode=t,e.WebGLKernel=a,e.WebGLRunner=q,e.WebGL2FunctionBuilder=f,e.WebGL2FunctionNode=k,e.WebGL2Kernel=w,e.WebGL2Runner=p,"undefined"!=typeof module&&(module.exports=e),"undefined"!=typeof window&&(window.GPU=e),"undefined"!=typeof self&&(self.GPU=e);
},{"./core/gpu":"701I","./core/alias":"i4Hu","./core/utils":"hsMx","./core/input":"mMKb","./core/texture":"ByaE","./backend/cpu/function-builder":"neSP","./backend/cpu/function-node":"WJtR","./backend/cpu/kernel":"j8q7","./backend/cpu/runner":"wrgc","./backend/web-gl/function-builder":"J2No","./backend/web-gl/function-node":"dzEs","./backend/web-gl/kernel":"9TKN","./backend/web-gl/runner":"J272","./backend/web-gl2/function-builder":"SerK","./backend/web-gl2/function-node":"8Uc3","./backend/web-gl2/kernel":"U6r8","./backend/web-gl2/runner":"ueuS"}],"b1xI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function t(t,e){for(var s=0;s<e.length;s++){var a=e[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,s,a){return s&&t(e.prototype,s),a&&t(e,a),e}}(),e=function t(e,s,a){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,s);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,s,a)}if("value"in i)return i.value;var u=i.get;return void 0!==u?u.call(a):void 0},s=require("./neural-network"),a=o(s),i=require("./lookup"),r=o(i),u=require("gpu.js"),n=o(u);function o(t){return t&&t.__esModule?t:{default:t}}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var l=function(s){function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,i);var e=p(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.forwardPropagate=[],e.backwardPropagate=[],e.changesPropagate=[],e.biasesPropagate=[],e.biasCopies=[],e.copyBias=[],e.changesCopies=[],e.copyChanges=[],e.weightsCopies=[],e.copyWeights=[],e.errorCheckInterval=100,e.gpu=new n.default({mode:t.mode}),e}return c(i,a.default),t(i,[{key:"initialize",value:function(){e(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"initialize",this).call(this),this.buildRunInput(),this.buildCalculateDeltas(),this.buildGetChanges(),this.buildChangeBiases(),this.buildGetMSE()}},{key:"setActivation",value:function(){}},{key:"trainPattern",value:function(t,e){return this.runInput(t.input),this.calculateDeltas(t.output),this.adjustWeights(),e?this.getMSE(this.errors[this.outputLayer])[0]:null}},{key:"adjustWeights",value:function(){this.getChanges(),this.changeBiases()}},{key:"buildRunInput",value:function(){var t=null;switch(this.activation){case"sigmoid":t=d;break;case"relu":t=f;break;case"leaky-relu":t=g;break;case"tanh":t=y;break;default:throw new Error("unknown activation "+this.activation)}for(var e=1;e<=this.outputLayer;e++)this.forwardPropagate[e]=this.gpu.createKernel(t,{output:[this.sizes[e]],outputToTexture:!0,hardcodeConstants:!0,constants:{size:this.sizes[e-1]}});this.texturizeInputData=this.gpu.createKernel(function(t){return t[this.thread.x]},{output:[this.sizes[1]],outputToTexture:!0,hardcodeConstants:!0,outputImmutable:!0})}},{key:"runInput",value:function(t){var e=void 0;this.outputs[0]=t;for(var s=1;s<=this.outputLayer;s++)this.outputs[s]=this.forwardPropagate[s](this.weights[s],this.biases[s],t),e=t=this.outputs[s];return e}},{key:"buildCalculateDeltas",value:function(){var t=null;switch(this.activation){case"sigmoid":t=b;break;case"relu":t=k;break;case"leaky-relu":t=w;break;case"tanh":t=x;break;default:throw new Error("unknown activation "+this.activation)}for(var e=this.outputLayer;e>0;e--)e===this.outputLayer?this.backwardPropagate[e]=this.gpu.createKernelMap({error:n.default.alias("calcErrorOutput",v),deltas:n.default.alias("calcDeltas",t)},function(e,s){var a=e[this.thread.x];return t(v(a,s),a)},{output:[this.sizes[e]],outputToTexture:!0,hardcodeConstants:!0}):this.backwardPropagate[e]=this.gpu.createKernelMap({error:n.default.alias("calcError",C),deltas:n.default.alias("calcDeltas",t)},function(e,s,a){var i=s[this.thread.x];return t(C(e,a),i)},{output:[this.sizes[e]],outputToTexture:!0,hardcodeConstants:!0,constants:{size:this.deltas[e+1].length}})}},{key:"calculateDeltas",value:function(t){for(var e=this.outputLayer;e>0;e--){var s=void 0;s=e===this.outputLayer?this.backwardPropagate[e](this.outputs[e],t):this.backwardPropagate[e](this.weights[e+1],this.outputs[e],this.deltas[e+1]),this.deltas[e]=s.deltas,this.errors[e]=s.error}}},{key:"buildGetChanges",value:function(){for(var t=1;t<=this.outputLayer;t++)this.changesPropagate[t]=this.gpu.createKernelMap({weights:n.default.alias("addWeights",z),changes:n.default.alias("calcChanges",O)},function(t,e,s,a){return z(O(a,e,t),s)},{output:[this.sizes[t-1],this.sizes[t]],outputToTexture:!0,hardcodeConstants:!0,constants:{size:this.outputs[t-1].length,learningRate:this.trainOpts.learningRate,momentum:this.trainOpts.momentum}}),this.copyChanges[t]=this.gpu.createKernel(function(t){return t[this.thread.y][this.thread.x]},{output:this.changesPropagate[t].output,outputToTexture:!0,hardCodeConstants:!0}),this.copyWeights[t]=this.gpu.createKernel(function(t){return t[this.thread.y][this.thread.x]},{output:this.changesPropagate[t].output,outputToTexture:!0,hardCodeConstants:!0})}},{key:"getChanges",value:function(){for(var t=1;t<=this.outputLayer;t++){var e=this.changesPropagate[t](this.outputs[t-1],this.deltas[t],this.weightsCopies[t]||this.weights[t],this.changesCopies[t]||this.changes[t]);this.changes[t]=e.changes,this.weights[t]=e.weights,this.changesCopies[t]=this.copyChanges[t](e.changes),this.weightsCopies[t]=this.copyWeights[t](e.weights)}}},{key:"buildChangeBiases",value:function(){for(var t=1;t<=this.outputLayer;t++)this.biasesPropagate[t]=this.gpu.createKernel(m,{output:[this.sizes[t]],outputToTexture:!0,hardcodeConstants:!0,constants:{learningRate:this.trainOpts.learningRate}}),this.copyBias[t]=this.gpu.createKernel(function(t){return t[this.thread.x]},{output:this.biasesPropagate[t].output,outputToTexture:!0,hardCodeConstants:!0})}},{key:"changeBiases",value:function(){for(var t=1;t<=this.outputLayer;t++)this.biases[t]=this.biasesPropagate[t](this.biasCopies[t]||this.biases[t],this.deltas[t]),this.biasCopies[t]=this.copyBias[t](this.biases[t])}},{key:"buildGetMSE",value:function(){this.getMSE=this.gpu.createKernel(P,{output:[1],hardcodeConstants:!0,constants:{size:this.sizes[this.outputLayer]}})}},{key:"run",value:function(t){if(!this.isRunnable)return null;this.inputLookup&&(t=r.default.toArray(this.inputLookup,t,this.inputLookupLength));var e=this.texturizeInputData(t),s=this.runInput(e),a=void 0;return a=s.toArray?s.toArray(this.gpu):s,this.outputLookup&&(a=r.default.toObject(this.outputLookup,a)),a}},{key:"prepTraining",value:function(t,e){var s=this;this.updateTrainingOptions(e),t=this.formatData(t);var a=Date.now()+this.trainOpts.timeout;this.verifyIsInitialized(t);var i=this.gpu.createKernel(function(t){return t[this.thread.x]},{output:[t[0].output.length],outputToTexture:!0,hardcodeConstants:!0,outputImmutable:!0});return{data:t.map(function(t){return{input:s.texturizeInputData(t.input),output:i(t.output)}}),status:{error:1,iterations:0},endTime:a}}},{key:"toJSON",value:function(){var t=this;if(!this.weights[1].toArray)return e(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"toJSON",this).call(this);for(var s=[],r=[],u=1;u<=this.outputLayer;u++)s[u]=Array.from(this.weights[u].toArray(this.gpu)),r[u]=Array.from(this.biases[u].toArray(this.gpu));return a.default.prototype.toJSON.call({inputLookup:this.inputLookup,outputLookup:this.outputLookup,outputLayer:this.outputLayer,sizes:this.sizes,getTrainOptsJSON:function(){return t.getTrainOptsJSON()},weights:s,biases:r})}}]),i}();function d(t,e,s){for(var a=e[this.thread.x],i=0;i<this.constants.size;i++)a+=t[this.thread.x][i]*s[i];return 1/(1+Math.exp(-a))}function f(t,e,s){for(var a=e[this.thread.x],i=0;i<this.constants.size;i++)a+=t[this.thread.x][i]*s[i];return a<0?0:a}function g(t,e,s){for(var a=e[this.thread.x],i=0;i<this.constants.size;i++)a+=t[this.thread.x][i]*s[i];return a<0?0:.01*a}function y(t,e,s){for(var a=e[this.thread.x],i=0;i<this.constants.size;i++)a+=t[this.thread.x][i]*s[i];return Math.tanh(a)}function v(t,e){return e[this.thread.x]-t}function b(t,e){return t*e*(1-e)}function k(t,e){return e>0?t:0}function w(t,e){return e>0?t:.01*t}function x(t,e){return(1-e*e)*t}function C(t,e){for(var s=0,a=0;a<this.constants.size;a++)s+=e[a]*t[a][this.thread.x];return s}function O(t,e,s){return this.constants.learningRate*e[this.thread.y]*s[this.thread.x]+this.constants.momentum*t[this.thread.y][this.thread.x]}function z(t,e){return t+e[this.thread.y][this.thread.x]}function m(t,e){return t[this.thread.x]+e[this.thread.x]*this.constants.learningRate}function P(t){for(var e=0,s=0;s<this.constants.size;s++)e+=Math.pow(t[s],2);return e/this.constants.size}exports.default=l;
},{"./neural-network":"23dQ","./lookup":"yeLe","gpu.js":"ieip"}],"JvJJ":[function(require,module,exports) {
function e(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function t(e){return"function"==typeof e}function s(e){return"number"==typeof e}function n(e){return"object"==typeof e&&null!==e}function i(e){return void 0===e}module.exports=e,e.EventEmitter=e,e.prototype._events=void 0,e.prototype._maxListeners=void 0,e.defaultMaxListeners=10,e.prototype.setMaxListeners=function(e){if(!s(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},e.prototype.emit=function(e){var s,r,o,h,v,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((s=arguments[1])instanceof Error)throw s;var u=new Error('Uncaught, unspecified "error" event. ('+s+")");throw u.context=s,u}if(i(r=this._events[e]))return!1;if(t(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:h=Array.prototype.slice.call(arguments,1),r.apply(this,h)}else if(n(r))for(h=Array.prototype.slice.call(arguments,1),o=(l=r.slice()).length,v=0;v<o;v++)l[v].apply(this,h);return!0},e.prototype.addListener=function(s,r){var o;if(!t(r))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",s,t(r.listener)?r.listener:r),this._events[s]?n(this._events[s])?this._events[s].push(r):this._events[s]=[this._events[s],r]:this._events[s]=r,n(this._events[s])&&!this._events[s].warned&&(o=i(this._maxListeners)?e.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[s].length>o&&(this._events[s].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[s].length),"function"==typeof console.trace&&console.trace()),this},e.prototype.on=e.prototype.addListener,e.prototype.once=function(e,s){if(!t(s))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,s.apply(this,arguments))}return i.listener=s,this.on(e,i),this},e.prototype.removeListener=function(e,s){var i,r,o,h;if(!t(s))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(i=this._events[e]).length,r=-1,i===s||t(i.listener)&&i.listener===s)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,s);else if(n(i)){for(h=o;h-- >0;)if(i[h]===s||i[h].listener&&i[h].listener===s){r=h;break}if(r<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,s)}return this},e.prototype.removeAllListeners=function(e){var s,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(s in this._events)"removeListener"!==s&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events={},this}if(t(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},e.prototype.listeners=function(e){return this._events&&this._events[e]?t(this._events[e])?[this._events[e]]:this._events[e].slice():[]},e.prototype.listenerCount=function(e){if(this._events){var s=this._events[e];if(t(s))return 1;if(s)return s.length}return 0},e.listenerCount=function(e,t){return e.listenerCount(t)};
},{}],"AKC4":[function(require,module,exports) {
"function"==typeof Object.create?module.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};
},{}],"1TJ4":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"SVTs":[function(require,module,exports) {
var process = require("process");
var n=require("process");function e(e,r,t,c){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,l,u=arguments.length;switch(u){case 0:case 1:return n.nextTick(e);case 2:return n.nextTick(function(){e.call(null,r)});case 3:return n.nextTick(function(){e.call(null,r,t)});case 4:return n.nextTick(function(){e.call(null,r,t,c)});default:for(i=new Array(u-1),l=0;l<i.length;)i[l++]=arguments[l];return n.nextTick(function(){e.apply(null,i)})}}!n.version||0===n.version.indexOf("v0.")||0===n.version.indexOf("v1.")&&0!==n.version.indexOf("v1.8.")?module.exports={nextTick:e}:module.exports=n;
},{"process":"1TJ4"}],"nYdX":[function(require,module,exports) {
var r={}.toString;module.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)};
},{}],"yF8q":[function(require,module,exports) {
module.exports=require("stream");
},{"stream":"YeeV"}],"s4hx":[function(require,module,exports) {
"use strict";exports.byteLength=u,exports.toByteArray=i,exports.fromByteArray=d;for(var r=[],t=[],e="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=n.length;o<a;++o)r[o]=n[o],t[n.charCodeAt(o)]=o;function h(r){var t=r.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=r.indexOf("=");return-1===e&&(e=t),[e,e===t?0:4-e%4]}function u(r){var t=h(r),e=t[0],n=t[1];return 3*(e+n)/4-n}function c(r,t,e){return 3*(t+e)/4-e}function i(r){for(var n,o=h(r),a=o[0],u=o[1],i=new e(c(r,a,u)),f=0,A=u>0?a-4:a,d=0;d<A;d+=4)n=t[r.charCodeAt(d)]<<18|t[r.charCodeAt(d+1)]<<12|t[r.charCodeAt(d+2)]<<6|t[r.charCodeAt(d+3)],i[f++]=n>>16&255,i[f++]=n>>8&255,i[f++]=255&n;return 2===u&&(n=t[r.charCodeAt(d)]<<2|t[r.charCodeAt(d+1)]>>4,i[f++]=255&n),1===u&&(n=t[r.charCodeAt(d)]<<10|t[r.charCodeAt(d+1)]<<4|t[r.charCodeAt(d+2)]>>2,i[f++]=n>>8&255,i[f++]=255&n),i}function f(t){return r[t>>18&63]+r[t>>12&63]+r[t>>6&63]+r[63&t]}function A(r,t,e){for(var n,o=[],a=t;a<e;a+=3)n=(r[a]<<16&16711680)+(r[a+1]<<8&65280)+(255&r[a+2]),o.push(f(n));return o.join("")}function d(t){for(var e,n=t.length,o=n%3,a=[],h=0,u=n-o;h<u;h+=16383)a.push(A(t,h,h+16383>u?u:h+16383));return 1===o?(e=t[n-1],a.push(r[e>>2]+r[e<<4&63]+"==")):2===o&&(e=(t[n-2]<<8)+t[n-1],a.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),a.join("")}t["-".charCodeAt(0)]=62,t["_".charCodeAt(0)]=63;
},{}],"reMP":[function(require,module,exports) {
exports.read=function(a,o,t,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,N=t?h-1:0,n=t?-1:1,s=a[o+N];for(N+=n,M=s&(1<<-i)-1,s>>=-i,i+=w;i>0;M=256*M+a[o+N],N+=n,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+a[o+N],N+=n,i-=8);if(0===M)M=1-e;else{if(M===f)return p?NaN:1/0*(s?-1:1);p+=Math.pow(2,r),M-=e}return(s?-1:1)*p*Math.pow(2,M-r)},exports.write=function(a,o,t,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,N=i>>1,n=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,s=r?0:M-1,u=r?1:-1,l=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,p=i):(p=Math.floor(Math.log(o)/Math.LN2),o*(f=Math.pow(2,-p))<1&&(p--,f*=2),(o+=p+N>=1?n/f:n*Math.pow(2,1-N))*f>=2&&(p++,f/=2),p+N>=i?(w=0,p=i):p+N>=1?(w=(o*f-1)*Math.pow(2,h),p+=N):(w=o*Math.pow(2,N-1)*Math.pow(2,h),p=0));h>=8;a[t+s]=255&w,s+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;a[t+s]=255&p,s+=u,p/=256,e-=8);a[t+s-u]|=128*l};
},{}],"e1kl":[function(require,module,exports) {

var global = arguments[3];
var t=arguments[3],r=require("base64-js"),e=require("ieee754"),n=require("isarray");function i(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(r){return!1}}function o(){return f.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function u(t,r){if(o()<r)throw new RangeError("Invalid typed array length");return f.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(r)).__proto__=f.prototype:(null===t&&(t=new f(r)),t.length=r),t}function f(t,r,e){if(!(f.TYPED_ARRAY_SUPPORT||this instanceof f))return new f(t,r,e);if("number"==typeof t){if("string"==typeof r)throw new Error("If encoding is specified then the first argument must be a string");return c(this,t)}return s(this,t,r,e)}function s(t,r,e,n){if("number"==typeof r)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&r instanceof ArrayBuffer?g(t,r,e,n):"string"==typeof r?l(t,r,e):y(t,r)}function h(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function a(t,r,e,n){return h(r),r<=0?u(t,r):void 0!==e?"string"==typeof n?u(t,r).fill(e,n):u(t,r).fill(e):u(t,r)}function c(t,r){if(h(r),t=u(t,r<0?0:0|w(r)),!f.TYPED_ARRAY_SUPPORT)for(var e=0;e<r;++e)t[e]=0;return t}function l(t,r,e){if("string"==typeof e&&""!==e||(e="utf8"),!f.isEncoding(e))throw new TypeError('"encoding" must be a valid string encoding');var n=0|v(r,e),i=(t=u(t,n)).write(r,e);return i!==n&&(t=t.slice(0,i)),t}function p(t,r){var e=r.length<0?0:0|w(r.length);t=u(t,e);for(var n=0;n<e;n+=1)t[n]=255&r[n];return t}function g(t,r,e,n){if(r.byteLength,e<0||r.byteLength<e)throw new RangeError("'offset' is out of bounds");if(r.byteLength<e+(n||0))throw new RangeError("'length' is out of bounds");return r=void 0===e&&void 0===n?new Uint8Array(r):void 0===n?new Uint8Array(r,e):new Uint8Array(r,e,n),f.TYPED_ARRAY_SUPPORT?(t=r).__proto__=f.prototype:t=p(t,r),t}function y(t,r){if(f.isBuffer(r)){var e=0|w(r.length);return 0===(t=u(t,e)).length?t:(r.copy(t,0,0,e),t)}if(r){if("undefined"!=typeof ArrayBuffer&&r.buffer instanceof ArrayBuffer||"length"in r)return"number"!=typeof r.length||W(r.length)?u(t,0):p(t,r);if("Buffer"===r.type&&n(r.data))return p(t,r.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function w(t){if(t>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|t}function d(t){return+t!=t&&(t=0),f.alloc(+t)}function v(t,r){if(f.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var e=t.length;if(0===e)return 0;for(var n=!1;;)switch(r){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":case void 0:return $(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*e;case"hex":return e>>>1;case"base64":return K(t).length;default:if(n)return $(t).length;r=(""+r).toLowerCase(),n=!0}}function E(t,r,e){var n=!1;if((void 0===r||r<0)&&(r=0),r>this.length)return"";if((void 0===e||e>this.length)&&(e=this.length),e<=0)return"";if((e>>>=0)<=(r>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return x(this,r,e);case"utf8":case"utf-8":return Y(this,r,e);case"ascii":return L(this,r,e);case"latin1":case"binary":return D(this,r,e);case"base64":return S(this,r,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,r,e);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function b(t,r,e){var n=t[r];t[r]=t[e],t[e]=n}function R(t,r,e,n,i){if(0===t.length)return-1;if("string"==typeof e?(n=e,e=0):e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,isNaN(e)&&(e=i?0:t.length-1),e<0&&(e=t.length+e),e>=t.length){if(i)return-1;e=t.length-1}else if(e<0){if(!i)return-1;e=0}if("string"==typeof r&&(r=f.from(r,n)),f.isBuffer(r))return 0===r.length?-1:_(t,r,e,n,i);if("number"==typeof r)return r&=255,f.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,r,e):Uint8Array.prototype.lastIndexOf.call(t,r,e):_(t,[r],e,n,i);throw new TypeError("val must be string, number or Buffer")}function _(t,r,e,n,i){var o,u=1,f=t.length,s=r.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||r.length<2)return-1;u=2,f/=2,s/=2,e/=2}function h(t,r){return 1===u?t[r]:t.readUInt16BE(r*u)}if(i){var a=-1;for(o=e;o<f;o++)if(h(t,o)===h(r,-1===a?0:o-a)){if(-1===a&&(a=o),o-a+1===s)return a*u}else-1!==a&&(o-=o-a),a=-1}else for(e+s>f&&(e=f-s),o=e;o>=0;o--){for(var c=!0,l=0;l<s;l++)if(h(t,o+l)!==h(r,l)){c=!1;break}if(c)return o}return-1}function A(t,r,e,n){e=Number(e)||0;var i=t.length-e;n?(n=Number(n))>i&&(n=i):n=i;var o=r.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var u=0;u<n;++u){var f=parseInt(r.substr(2*u,2),16);if(isNaN(f))return u;t[e+u]=f}return u}function m(t,r,e,n){return Q($(r,t.length-e),t,e,n)}function P(t,r,e,n){return Q(G(r),t,e,n)}function T(t,r,e,n){return P(t,r,e,n)}function B(t,r,e,n){return Q(K(r),t,e,n)}function U(t,r,e,n){return Q(H(r,t.length-e),t,e,n)}function S(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function Y(t,r,e){e=Math.min(t.length,e);for(var n=[],i=r;i<e;){var o,u,f,s,h=t[i],a=null,c=h>239?4:h>223?3:h>191?2:1;if(i+c<=e)switch(c){case 1:h<128&&(a=h);break;case 2:128==(192&(o=t[i+1]))&&(s=(31&h)<<6|63&o)>127&&(a=s);break;case 3:o=t[i+1],u=t[i+2],128==(192&o)&&128==(192&u)&&(s=(15&h)<<12|(63&o)<<6|63&u)>2047&&(s<55296||s>57343)&&(a=s);break;case 4:o=t[i+1],u=t[i+2],f=t[i+3],128==(192&o)&&128==(192&u)&&128==(192&f)&&(s=(15&h)<<18|(63&o)<<12|(63&u)<<6|63&f)>65535&&s<1114112&&(a=s)}null===a?(a=65533,c=1):a>65535&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),i+=c}return O(n)}exports.Buffer=f,exports.SlowBuffer=d,exports.INSPECT_MAX_BYTES=50,f.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:i(),exports.kMaxLength=o(),f.poolSize=8192,f._augment=function(t){return t.__proto__=f.prototype,t},f.from=function(t,r,e){return s(null,t,r,e)},f.TYPED_ARRAY_SUPPORT&&(f.prototype.__proto__=Uint8Array.prototype,f.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&f[Symbol.species]===f&&Object.defineProperty(f,Symbol.species,{value:null,configurable:!0})),f.alloc=function(t,r,e){return a(null,t,r,e)},f.allocUnsafe=function(t){return c(null,t)},f.allocUnsafeSlow=function(t){return c(null,t)},f.isBuffer=function(t){return!(null==t||!t._isBuffer)},f.compare=function(t,r){if(!f.isBuffer(t)||!f.isBuffer(r))throw new TypeError("Arguments must be Buffers");if(t===r)return 0;for(var e=t.length,n=r.length,i=0,o=Math.min(e,n);i<o;++i)if(t[i]!==r[i]){e=t[i],n=r[i];break}return e<n?-1:n<e?1:0},f.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(t,r){if(!n(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return f.alloc(0);var e;if(void 0===r)for(r=0,e=0;e<t.length;++e)r+=t[e].length;var i=f.allocUnsafe(r),o=0;for(e=0;e<t.length;++e){var u=t[e];if(!f.isBuffer(u))throw new TypeError('"list" argument must be an Array of Buffers');u.copy(i,o),o+=u.length}return i},f.byteLength=v,f.prototype._isBuffer=!0,f.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<t;r+=2)b(this,r,r+1);return this},f.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<t;r+=4)b(this,r,r+3),b(this,r+1,r+2);return this},f.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<t;r+=8)b(this,r,r+7),b(this,r+1,r+6),b(this,r+2,r+5),b(this,r+3,r+4);return this},f.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?Y(this,0,t):E.apply(this,arguments)},f.prototype.equals=function(t){if(!f.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===f.compare(this,t)},f.prototype.inspect=function(){var t="",r=exports.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},f.prototype.compare=function(t,r,e,n,i){if(!f.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===r&&(r=0),void 0===e&&(e=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),r<0||e>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&r>=e)return 0;if(n>=i)return-1;if(r>=e)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),u=(e>>>=0)-(r>>>=0),s=Math.min(o,u),h=this.slice(n,i),a=t.slice(r,e),c=0;c<s;++c)if(h[c]!==a[c]){o=h[c],u=a[c];break}return o<u?-1:u<o?1:0},f.prototype.includes=function(t,r,e){return-1!==this.indexOf(t,r,e)},f.prototype.indexOf=function(t,r,e){return R(this,t,r,e,!0)},f.prototype.lastIndexOf=function(t,r,e){return R(this,t,r,e,!1)},f.prototype.write=function(t,r,e,n){if(void 0===r)n="utf8",e=this.length,r=0;else if(void 0===e&&"string"==typeof r)n=r,e=this.length,r=0;else{if(!isFinite(r))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");r|=0,isFinite(e)?(e|=0,void 0===n&&(n="utf8")):(n=e,e=void 0)}var i=this.length-r;if((void 0===e||e>i)&&(e=i),t.length>0&&(e<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return A(this,t,r,e);case"utf8":case"utf-8":return m(this,t,r,e);case"ascii":return P(this,t,r,e);case"latin1":case"binary":return T(this,t,r,e);case"base64":return B(this,t,r,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,t,r,e);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;function O(t){var r=t.length;if(r<=I)return String.fromCharCode.apply(String,t);for(var e="",n=0;n<r;)e+=String.fromCharCode.apply(String,t.slice(n,n+=I));return e}function L(t,r,e){var n="";e=Math.min(t.length,e);for(var i=r;i<e;++i)n+=String.fromCharCode(127&t[i]);return n}function D(t,r,e){var n="";e=Math.min(t.length,e);for(var i=r;i<e;++i)n+=String.fromCharCode(t[i]);return n}function x(t,r,e){var n=t.length;(!r||r<0)&&(r=0),(!e||e<0||e>n)&&(e=n);for(var i="",o=r;o<e;++o)i+=Z(t[o]);return i}function C(t,r,e){for(var n=t.slice(r,e),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function M(t,r,e){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+r>e)throw new RangeError("Trying to access beyond buffer length")}function k(t,r,e,n,i,o){if(!f.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>i||r<o)throw new RangeError('"value" argument is out of bounds');if(e+n>t.length)throw new RangeError("Index out of range")}function N(t,r,e,n){r<0&&(r=65535+r+1);for(var i=0,o=Math.min(t.length-e,2);i<o;++i)t[e+i]=(r&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function z(t,r,e,n){r<0&&(r=4294967295+r+1);for(var i=0,o=Math.min(t.length-e,4);i<o;++i)t[e+i]=r>>>8*(n?i:3-i)&255}function F(t,r,e,n,i,o){if(e+n>t.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range")}function j(t,r,n,i,o){return o||F(t,r,n,4,3.4028234663852886e38,-3.4028234663852886e38),e.write(t,r,n,i,23,4),n+4}function q(t,r,n,i,o){return o||F(t,r,n,8,1.7976931348623157e308,-1.7976931348623157e308),e.write(t,r,n,i,52,8),n+8}f.prototype.slice=function(t,r){var e,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(r=void 0===r?n:~~r)<0?(r+=n)<0&&(r=0):r>n&&(r=n),r<t&&(r=t),f.TYPED_ARRAY_SUPPORT)(e=this.subarray(t,r)).__proto__=f.prototype;else{var i=r-t;e=new f(i,void 0);for(var o=0;o<i;++o)e[o]=this[o+t]}return e},f.prototype.readUIntLE=function(t,r,e){t|=0,r|=0,e||M(t,r,this.length);for(var n=this[t],i=1,o=0;++o<r&&(i*=256);)n+=this[t+o]*i;return n},f.prototype.readUIntBE=function(t,r,e){t|=0,r|=0,e||M(t,r,this.length);for(var n=this[t+--r],i=1;r>0&&(i*=256);)n+=this[t+--r]*i;return n},f.prototype.readUInt8=function(t,r){return r||M(t,1,this.length),this[t]},f.prototype.readUInt16LE=function(t,r){return r||M(t,2,this.length),this[t]|this[t+1]<<8},f.prototype.readUInt16BE=function(t,r){return r||M(t,2,this.length),this[t]<<8|this[t+1]},f.prototype.readUInt32LE=function(t,r){return r||M(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},f.prototype.readUInt32BE=function(t,r){return r||M(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},f.prototype.readIntLE=function(t,r,e){t|=0,r|=0,e||M(t,r,this.length);for(var n=this[t],i=1,o=0;++o<r&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*r)),n},f.prototype.readIntBE=function(t,r,e){t|=0,r|=0,e||M(t,r,this.length);for(var n=r,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*r)),o},f.prototype.readInt8=function(t,r){return r||M(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},f.prototype.readInt16LE=function(t,r){r||M(t,2,this.length);var e=this[t]|this[t+1]<<8;return 32768&e?4294901760|e:e},f.prototype.readInt16BE=function(t,r){r||M(t,2,this.length);var e=this[t+1]|this[t]<<8;return 32768&e?4294901760|e:e},f.prototype.readInt32LE=function(t,r){return r||M(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},f.prototype.readInt32BE=function(t,r){return r||M(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},f.prototype.readFloatLE=function(t,r){return r||M(t,4,this.length),e.read(this,t,!0,23,4)},f.prototype.readFloatBE=function(t,r){return r||M(t,4,this.length),e.read(this,t,!1,23,4)},f.prototype.readDoubleLE=function(t,r){return r||M(t,8,this.length),e.read(this,t,!0,52,8)},f.prototype.readDoubleBE=function(t,r){return r||M(t,8,this.length),e.read(this,t,!1,52,8)},f.prototype.writeUIntLE=function(t,r,e,n){(t=+t,r|=0,e|=0,n)||k(this,t,r,e,Math.pow(2,8*e)-1,0);var i=1,o=0;for(this[r]=255&t;++o<e&&(i*=256);)this[r+o]=t/i&255;return r+e},f.prototype.writeUIntBE=function(t,r,e,n){(t=+t,r|=0,e|=0,n)||k(this,t,r,e,Math.pow(2,8*e)-1,0);var i=e-1,o=1;for(this[r+i]=255&t;--i>=0&&(o*=256);)this[r+i]=t/o&255;return r+e},f.prototype.writeUInt8=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,1,255,0),f.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[r]=255&t,r+1},f.prototype.writeUInt16LE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8):N(this,t,r,!0),r+2},f.prototype.writeUInt16BE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=255&t):N(this,t,r,!1),r+2},f.prototype.writeUInt32LE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[r+3]=t>>>24,this[r+2]=t>>>16,this[r+1]=t>>>8,this[r]=255&t):z(this,t,r,!0),r+4},f.prototype.writeUInt32BE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t):z(this,t,r,!1),r+4},f.prototype.writeIntLE=function(t,r,e,n){if(t=+t,r|=0,!n){var i=Math.pow(2,8*e-1);k(this,t,r,e,i-1,-i)}var o=0,u=1,f=0;for(this[r]=255&t;++o<e&&(u*=256);)t<0&&0===f&&0!==this[r+o-1]&&(f=1),this[r+o]=(t/u>>0)-f&255;return r+e},f.prototype.writeIntBE=function(t,r,e,n){if(t=+t,r|=0,!n){var i=Math.pow(2,8*e-1);k(this,t,r,e,i-1,-i)}var o=e-1,u=1,f=0;for(this[r+o]=255&t;--o>=0&&(u*=256);)t<0&&0===f&&0!==this[r+o+1]&&(f=1),this[r+o]=(t/u>>0)-f&255;return r+e},f.prototype.writeInt8=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,1,127,-128),f.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[r]=255&t,r+1},f.prototype.writeInt16LE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8):N(this,t,r,!0),r+2},f.prototype.writeInt16BE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=255&t):N(this,t,r,!1),r+2},f.prototype.writeInt32LE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,4,2147483647,-2147483648),f.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8,this[r+2]=t>>>16,this[r+3]=t>>>24):z(this,t,r,!0),r+4},f.prototype.writeInt32BE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),f.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t):z(this,t,r,!1),r+4},f.prototype.writeFloatLE=function(t,r,e){return j(this,t,r,!0,e)},f.prototype.writeFloatBE=function(t,r,e){return j(this,t,r,!1,e)},f.prototype.writeDoubleLE=function(t,r,e){return q(this,t,r,!0,e)},f.prototype.writeDoubleBE=function(t,r,e){return q(this,t,r,!1,e)},f.prototype.copy=function(t,r,e,n){if(e||(e=0),n||0===n||(n=this.length),r>=t.length&&(r=t.length),r||(r=0),n>0&&n<e&&(n=e),n===e)return 0;if(0===t.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(e<0||e>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-r<n-e&&(n=t.length-r+e);var i,o=n-e;if(this===t&&e<r&&r<n)for(i=o-1;i>=0;--i)t[i+r]=this[i+e];else if(o<1e3||!f.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+r]=this[i+e];else Uint8Array.prototype.set.call(t,this.subarray(e,e+o),r);return o},f.prototype.fill=function(t,r,e,n){if("string"==typeof t){if("string"==typeof r?(n=r,r=0,e=this.length):"string"==typeof e&&(n=e,e=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!f.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(r<0||this.length<r||this.length<e)throw new RangeError("Out of range index");if(e<=r)return this;var o;if(r>>>=0,e=void 0===e?this.length:e>>>0,t||(t=0),"number"==typeof t)for(o=r;o<e;++o)this[o]=t;else{var u=f.isBuffer(t)?t:$(new f(t,n).toString()),s=u.length;for(o=0;o<e-r;++o)this[o+r]=u[o%s]}return this};var V=/[^+\/0-9A-Za-z-_]/g;function X(t){if((t=J(t).replace(V,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}function J(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function Z(t){return t<16?"0"+t.toString(16):t.toString(16)}function $(t,r){var e;r=r||1/0;for(var n=t.length,i=null,o=[],u=0;u<n;++u){if((e=t.charCodeAt(u))>55295&&e<57344){if(!i){if(e>56319){(r-=3)>-1&&o.push(239,191,189);continue}if(u+1===n){(r-=3)>-1&&o.push(239,191,189);continue}i=e;continue}if(e<56320){(r-=3)>-1&&o.push(239,191,189),i=e;continue}e=65536+(i-55296<<10|e-56320)}else i&&(r-=3)>-1&&o.push(239,191,189);if(i=null,e<128){if((r-=1)<0)break;o.push(e)}else if(e<2048){if((r-=2)<0)break;o.push(e>>6|192,63&e|128)}else if(e<65536){if((r-=3)<0)break;o.push(e>>12|224,e>>6&63|128,63&e|128)}else{if(!(e<1114112))throw new Error("Invalid code point");if((r-=4)<0)break;o.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}}return o}function G(t){for(var r=[],e=0;e<t.length;++e)r.push(255&t.charCodeAt(e));return r}function H(t,r){for(var e,n,i,o=[],u=0;u<t.length&&!((r-=2)<0);++u)n=(e=t.charCodeAt(u))>>8,i=e%256,o.push(i),o.push(n);return o}function K(t){return r.toByteArray(X(t))}function Q(t,r,e,n){for(var i=0;i<n&&!(i+e>=r.length||i>=t.length);++i)r[i+e]=t[i];return i}function W(t){return t!=t}
},{"base64-js":"s4hx","ieee754":"reMP","isarray":"nYdX","buffer":"e1kl"}],"/++L":[function(require,module,exports) {

var r=require("buffer"),e=r.Buffer;function n(r,e){for(var n in r)e[n]=r[n]}function o(r,n,o){return e(r,n,o)}e.from&&e.alloc&&e.allocUnsafe&&e.allocUnsafeSlow?module.exports=r:(n(r,exports),exports.Buffer=o),n(e,o),o.from=function(r,n,o){if("number"==typeof r)throw new TypeError("Argument must not be a number");return e(r,n,o)},o.alloc=function(r,n,o){if("number"!=typeof r)throw new TypeError("Argument must be a number");var f=e(r);return void 0!==n?"string"==typeof o?f.fill(n,o):f.fill(n):f.fill(0),f},o.allocUnsafe=function(r){if("number"!=typeof r)throw new TypeError("Argument must be a number");return e(r)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)};
},{"buffer":"e1kl"}],"jlzx":[function(require,module,exports) {
var Buffer = require("buffer").Buffer;
var r=require("buffer").Buffer;function t(r){return Array.isArray?Array.isArray(r):"[object Array]"===a(r)}function e(r){return"boolean"==typeof r}function n(r){return null===r}function o(r){return null==r}function i(r){return"number"==typeof r}function u(r){return"string"==typeof r}function s(r){return"symbol"==typeof r}function f(r){return void 0===r}function p(r){return"[object RegExp]"===a(r)}function c(r){return"object"==typeof r&&null!==r}function l(r){return"[object Date]"===a(r)}function y(r){return"[object Error]"===a(r)||r instanceof Error}function x(r){return"function"==typeof r}function b(r){return null===r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||"symbol"==typeof r||void 0===r}function a(r){return Object.prototype.toString.call(r)}exports.isArray=t,exports.isBoolean=e,exports.isNull=n,exports.isNullOrUndefined=o,exports.isNumber=i,exports.isString=u,exports.isSymbol=s,exports.isUndefined=f,exports.isRegExp=p,exports.isObject=c,exports.isDate=l,exports.isError=y,exports.isFunction=x,exports.isPrimitive=b,exports.isBuffer=r.isBuffer;
},{"buffer":"e1kl"}],"cBGs":[function(require,module,exports) {

},{}],"53jp":[function(require,module,exports) {

"use strict";function t(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var n=require("safe-buffer").Buffer,e=require("util");function i(t,n,e){t.copy(n,e)}module.exports=function(){function e(){t(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(t){var n={data:t,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length},e.prototype.unshift=function(t){var n={data:t,next:this.head};0===this.length&&(this.tail=n),this.head=n,++this.length},e.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(t){if(0===this.length)return"";for(var n=this.head,e=""+n.data;n=n.next;)e+=t+n.data;return e},e.prototype.concat=function(t){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var e=n.allocUnsafe(t>>>0),h=this.head,a=0;h;)i(h.data,e,a),a+=h.data.length,h=h.next;return e},e}(),e&&e.inspect&&e.inspect.custom&&(module.exports.prototype[e.inspect.custom]=function(){var t=e.inspect({length:this.length});return this.constructor.name+" "+t});
},{"safe-buffer":"/++L","util":"cBGs"}],"kpLd":[function(require,module,exports) {
"use strict";var t=require("process-nextick-args");function e(e,a){var r=this,s=this._readableState&&this._readableState.destroyed,d=this._writableState&&this._writableState.destroyed;return s||d?(a?a(e):!e||this._writableState&&this._writableState.errorEmitted||t.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!a&&e?(t.nextTick(i,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):a&&a(e)}),this)}function a(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function i(t,e){t.emit("error",e)}module.exports={destroy:e,undestroy:a};
},{"process-nextick-args":"SVTs"}],"ZRnv":[function(require,module,exports) {
var global = arguments[3];
var r=arguments[3];function t(r,t){if(e("noDeprecation"))return r;var n=!1;return function(){if(!n){if(e("throwDeprecation"))throw new Error(t);e("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return r.apply(this,arguments)}}function e(t){try{if(!r.localStorage)return!1}catch(n){return!1}var e=r.localStorage[t];return null!=e&&"true"===String(e).toLowerCase()}module.exports=t;
},{}],"OY7l":[function(require,module,exports) {
var process = require("process");

var global = arguments[3];
var e=require("process"),t=arguments[3],n=require("process-nextick-args");function r(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){W(t,e)}}module.exports=g;var o,s=!e.browser&&["v0.10","v0.9."].indexOf(e.version.slice(0,5))>-1?setImmediate:n.nextTick;g.WritableState=y;var f=require("core-util-is");f.inherits=require("inherits");var u={deprecate:require("util-deprecate")},a=require("./internal/streams/stream"),c=require("safe-buffer").Buffer,d=t.Uint8Array||function(){};function l(e){return c.from(e)}function h(e){return c.isBuffer(e)||e instanceof d}var b,p=require("./internal/streams/destroy");function w(){}function y(e,t){o=o||require("./_stream_duplex"),e=e||{};var n=t instanceof o;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,s=e.writableHighWaterMark,f=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n&&(s||0===s)?s:f,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===e.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){S(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function g(e){if(o=o||require("./_stream_duplex"),!(b.call(g,this)||this instanceof o))return new g(e);this._writableState=new y(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),a.call(this)}function k(e,t){var r=new Error("write after end");e.emit("error",r),n.nextTick(t,r)}function v(e,t,r,i){var o=!0,s=!1;return null===r?s=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),n.nextTick(i,s),o=!1),o}function q(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=c.from(t,n)),t}function _(e,t,n,r,i,o){if(!n){var s=q(t,r,i);r!==s&&(n=!0,i="buffer",r=s)}var f=t.objectMode?1:r.length;t.length+=f;var u=t.length<t.highWaterMark;if(u||(t.needDrain=!0),t.writing||t.corked){var a=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},a?a.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else m(e,t,!1,f,r,i,o);return u}function m(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function x(e,t,r,i,o){--t.pendingcb,r?(n.nextTick(o,i),n.nextTick(T,e,t),e._writableState.errorEmitted=!0,e.emit("error",i)):(o(i),e._writableState.errorEmitted=!0,e.emit("error",i),T(e,t))}function R(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function S(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(R(n),t)x(e,n,r,t,i);else{var o=E(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||j(e,n),r?s(M,e,n,o,i):M(e,n,o,i)}}function M(e,t,n,r){n||B(e,t),t.pendingcb--,r(),T(e,t)}function B(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function j(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,o=new Array(r),s=t.corkedRequestsFree;s.entry=n;for(var f=0,u=!0;n;)o[f]=n,n.isBuf||(u=!1),n=n.next,f+=1;o.allBuffers=u,m(e,t,!0,t.length,o,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new i(t),t.bufferedRequestCount=0}else{for(;n;){var a=n.chunk,c=n.encoding,d=n.callback;if(m(e,t,!1,t.objectMode?1:a.length,a,c,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function E(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function C(e,t){e._final(function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),T(e,t)})}function P(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,n.nextTick(C,e,t)):(t.prefinished=!0,e.emit("prefinish")))}function T(e,t){var n=E(t);return n&&(P(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}function F(e,t,r){t.ending=!0,T(e,t),r&&(t.finished?n.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function W(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}f.inherits(g,a),y.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(y.prototype,"buffer",{get:u.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(b=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(e){return!!b.call(this,e)||this===g&&(e&&e._writableState instanceof y)}})):b=function(e){return e instanceof this},g.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},g.prototype.write=function(e,t,n){var r=this._writableState,i=!1,o=!r.objectMode&&h(e);return o&&!c.isBuffer(e)&&(e=l(e)),"function"==typeof t&&(n=t,t=null),o?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=w),r.ended?k(this,n):(o||v(this,r,e,n))&&(r.pendingcb++,i=_(this,r,o,e,t,n)),i},g.prototype.cork=function(){this._writableState.corked++},g.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||j(this,e))},g.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),g.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},g.prototype._writev=null,g.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||F(this,r,n)},Object.defineProperty(g.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),g.prototype.destroy=p.destroy,g.prototype._undestroy=p.undestroy,g.prototype._destroy=function(e,t){this.end(),t(e)};
},{"process-nextick-args":"SVTs","core-util-is":"jlzx","inherits":"AKC4","util-deprecate":"ZRnv","./internal/streams/stream":"yF8q","safe-buffer":"/++L","./internal/streams/destroy":"kpLd","./_stream_duplex":"DNpZ","process":"1TJ4"}],"DNpZ":[function(require,module,exports) {
"use strict";var e=require("process-nextick-args"),t=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};module.exports=l;var r=require("core-util-is");r.inherits=require("inherits");var i=require("./_stream_readable"),a=require("./_stream_writable");r.inherits(l,i);for(var o=t(a.prototype),s=0;s<o.length;s++){var n=o[s];l.prototype[n]||(l.prototype[n]=a.prototype[n])}function l(e){if(!(this instanceof l))return new l(e);i.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||e.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),l.prototype._destroy=function(t,r){this.push(null),this.end(),e.nextTick(r,t)};
},{"process-nextick-args":"SVTs","core-util-is":"jlzx","inherits":"AKC4","./_stream_readable":"tSr+","./_stream_writable":"OY7l"}],"0mNV":[function(require,module,exports) {

"use strict";var t=require("safe-buffer").Buffer,e=t.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}function i(i){var a=s(i);if("string"!=typeof a&&(t.isEncoding===e||!e(i)))throw new Error("Unknown encoding: "+i);return a||i}function a(e){var s;switch(this.encoding=i(e),this.encoding){case"utf16le":this.text=c,this.end=f,s=4;break;case"utf8":this.fillLast=l,s=4;break;case"base64":this.text=d,this.end=g,s=3;break;default:return this.write=N,void(this.end=v)}this.lastNeed=0,this.lastTotal=0,this.lastChar=t.allocUnsafe(s)}function r(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function n(t,e,s){var i=e.length-1;if(i<s)return 0;var a=r(e[i]);return a>=0?(a>0&&(t.lastNeed=a-1),a):--i<s||-2===a?0:(a=r(e[i]))>=0?(a>0&&(t.lastNeed=a-2),a):--i<s||-2===a?0:(a=r(e[i]))>=0?(a>0&&(2===a?a=0:t.lastNeed=a-3),a):0}function h(t,e,s){if(128!=(192&e[0]))return t.lastNeed=0,"�";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"�";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,"�"}}function l(t){var e=this.lastTotal-this.lastNeed,s=h(this,t,e);return void 0!==s?s:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function u(t,e){var s=n(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=s;var i=t.length-(s-this.lastNeed);return t.copy(this.lastChar,0,i),t.toString("utf8",e,i)}function o(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"�":e}function c(t,e){if((t.length-e)%2==0){var s=t.toString("utf16le",e);if(s){var i=s.charCodeAt(s.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],s.slice(0,-1)}return s}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function f(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var s=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,s)}return e}function d(t,e){var s=(t.length-e)%3;return 0===s?t.toString("base64",e):(this.lastNeed=3-s,this.lastTotal=3,1===s?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-s))}function g(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function N(t){return t.toString(this.encoding)}function v(t){return t&&t.length?this.write(t):""}exports.StringDecoder=a,a.prototype.write=function(t){if(0===t.length)return"";var e,s;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";s=this.lastNeed,this.lastNeed=0}else s=0;return s<t.length?e?e+this.text(t,s):this.text(t,s):e||""},a.prototype.end=o,a.prototype.text=u,a.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length};
},{"safe-buffer":"/++L"}],"tSr+":[function(require,module,exports) {

var global = arguments[3];
var process = require("process");
var e=arguments[3],t=require("process"),n=require("process-nextick-args");module.exports=_;var r,i=require("isarray");_.ReadableState=w;var a=require("events").EventEmitter,d=function(e,t){return e.listeners(t).length},o=require("./internal/streams/stream"),s=require("safe-buffer").Buffer,u=e.Uint8Array||function(){};function l(e){return s.from(e)}function h(e){return s.isBuffer(e)||e instanceof u}var p=require("core-util-is");p.inherits=require("inherits");var f=require("util"),c=void 0;c=f&&f.debuglog?f.debuglog("stream"):function(){};var g,b=require("./internal/streams/BufferList"),m=require("./internal/streams/destroy");p.inherits(_,o);var v=["error","close","destroy","pause","resume"];function y(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?i(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}function w(e,t){e=e||{};var n=t instanceof(r=r||require("./_stream_duplex"));this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,a=e.readableHighWaterMark,d=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(a||0===a)?a:d,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new b,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(g||(g=require("string_decoder/").StringDecoder),this.decoder=new g(e.encoding),this.encoding=e.encoding)}function _(e){if(r=r||require("./_stream_duplex"),!(this instanceof _))return new _(e);this._readableState=new w(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),o.call(this)}function M(e,t,n,r,i){var a,d=e._readableState;null===t?(d.reading=!1,x(e,d)):(i||(a=k(d,t)),a?e.emit("error",a):d.objectMode||t&&t.length>0?("string"==typeof t||d.objectMode||Object.getPrototypeOf(t)===s.prototype||(t=l(t)),r?d.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):S(e,d,t,!0):d.ended?e.emit("error",new Error("stream.push() after EOF")):(d.reading=!1,d.decoder&&!n?(t=d.decoder.write(t),d.objectMode||0!==t.length?S(e,d,t,!1):C(e,d)):S(e,d,t,!1))):r||(d.reading=!1));return j(d)}function S(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&q(e)),C(e,t)}function k(e,t){var n;return h(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function j(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}Object.defineProperty(_.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),_.prototype.destroy=m.destroy,_.prototype._undestroy=m.undestroy,_.prototype._destroy=function(e,t){this.push(null),t(e)},_.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=s.from(e,t),t=""),n=!0),M(this,e,t,!1,n)},_.prototype.unshift=function(e){return M(this,e,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(e){return g||(g=require("string_decoder/").StringDecoder),this._readableState.decoder=new g(e),this._readableState.encoding=e,this};var R=8388608;function E(e){return e>=R?e=R:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function L(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=E(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function x(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,q(e)}}function q(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(c("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?n.nextTick(W,e):W(e))}function W(e){c("emit readable"),e.emit("readable"),B(e)}function C(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(D,e,t))}function D(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(c("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function O(e){return function(){var t=e._readableState;c("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&d(e,"data")&&(t.flowing=!0,B(e))}}function T(e){c("readable nexttick read 0"),e.read(0)}function U(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(P,e,t))}function P(e,t){t.reading||(c("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),B(e),t.flowing&&!t.reading&&e.read(0)}function B(e){var t=e._readableState;for(c("flow",t.flowing);t.flowing&&null!==e.read(););}function H(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=I(e,t.buffer,t.decoder),n);var n}function I(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?A(e,t):F(e,t),r}function A(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var a=n.data,d=e>a.length?a.length:e;if(d===a.length?i+=a:i+=a.slice(0,e),0===(e-=d)){d===a.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=a.slice(d));break}++r}return t.length-=r,i}function F(e,t){var n=s.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var a=r.data,d=e>a.length?a.length:e;if(a.copy(n,n.length-e,0,d),0===(e-=d)){d===a.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=a.slice(d));break}++i}return t.length-=i,n}function z(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,n.nextTick(G,t,e))}function G(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function J(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}_.prototype.read=function(e){c("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return c("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?z(this):q(this),null;if(0===(e=L(e,t))&&t.ended)return 0===t.length&&z(this),null;var r,i=t.needReadable;return c("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&c("length less than watermark",i=!0),t.ended||t.reading?c("reading or ended",i=!1):i&&(c("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=L(n,t))),null===(r=e>0?H(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&z(this)),null!==r&&this.emit("data",r),r},_.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},_.prototype.pipe=function(e,r){var i=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e)}a.pipesCount+=1,c("pipe count=%d opts=%j",a.pipesCount,r);var o=(!r||!1!==r.end)&&e!==t.stdout&&e!==t.stderr?u:v;function s(t,n){c("onunpipe"),t===i&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,c("cleanup"),e.removeListener("close",b),e.removeListener("finish",m),e.removeListener("drain",l),e.removeListener("error",g),e.removeListener("unpipe",s),i.removeListener("end",u),i.removeListener("end",v),i.removeListener("data",f),h=!0,!a.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}function u(){c("onend"),e.end()}a.endEmitted?n.nextTick(o):i.once("end",o),e.on("unpipe",s);var l=O(i);e.on("drain",l);var h=!1;var p=!1;function f(t){c("ondata"),p=!1,!1!==e.write(t)||p||((1===a.pipesCount&&a.pipes===e||a.pipesCount>1&&-1!==J(a.pipes,e))&&!h&&(c("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,p=!0),i.pause())}function g(t){c("onerror",t),v(),e.removeListener("error",g),0===d(e,"error")&&e.emit("error",t)}function b(){e.removeListener("finish",m),v()}function m(){c("onfinish"),e.removeListener("close",b),v()}function v(){c("unpipe"),i.unpipe(e)}return i.on("data",f),y(e,"error",g),e.once("close",b),e.once("finish",m),e.emit("pipe",i),a.flowing||(c("pipe resume"),i.resume()),e},_.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)r[a].emit("unpipe",this,n);return this}var d=J(t.pipes,e);return-1===d?this:(t.pipes.splice(d,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},_.prototype.on=function(e,t){var r=o.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&q(this):n.nextTick(T,this))}return r},_.prototype.addListener=_.prototype.on,_.prototype.resume=function(){var e=this._readableState;return e.flowing||(c("resume"),e.flowing=!0,U(this,e)),this},_.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this},_.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",function(){if(c("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){(c("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i)||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var a=0;a<v.length;a++)e.on(v[a],this.emit.bind(this,v[a]));return this._read=function(t){c("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(_.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),_._fromList=H;
},{"process-nextick-args":"SVTs","isarray":"nYdX","events":"JvJJ","./internal/streams/stream":"yF8q","safe-buffer":"/++L","core-util-is":"jlzx","inherits":"AKC4","util":"cBGs","./internal/streams/BufferList":"53jp","./internal/streams/destroy":"kpLd","./_stream_duplex":"DNpZ","string_decoder/":"0mNV","process":"1TJ4"}],"9VbT":[function(require,module,exports) {
"use strict";module.exports=n;var t=require("./_stream_duplex"),r=require("core-util-is");function e(t,r){var e=this._transformState;e.transforming=!1;var n=e.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));e.writechunk=null,e.writecb=null,null!=r&&this.push(r),n(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function n(r){if(!(this instanceof n))return new n(r);t.call(this,r),this._transformState={afterTransform:e.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,r&&("function"==typeof r.transform&&(this._transform=r.transform),"function"==typeof r.flush&&(this._flush=r.flush)),this.on("prefinish",i)}function i(){var t=this;"function"==typeof this._flush?this._flush(function(r,e){a(t,r,e)}):a(this,null,null)}function a(t,r,e){if(r)return t.emit("error",r);if(null!=e&&t.push(e),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}r.inherits=require("inherits"),r.inherits(n,t),n.prototype.push=function(r,e){return this._transformState.needTransform=!1,t.prototype.push.call(this,r,e)},n.prototype._transform=function(t,r,e){throw new Error("_transform() is not implemented")},n.prototype._write=function(t,r,e){var n=this._transformState;if(n.writecb=e,n.writechunk=t,n.writeencoding=r,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},n.prototype._read=function(t){var r=this._transformState;null!==r.writechunk&&r.writecb&&!r.transforming?(r.transforming=!0,this._transform(r.writechunk,r.writeencoding,r.afterTransform)):r.needTransform=!0},n.prototype._destroy=function(r,e){var n=this;t.prototype._destroy.call(this,r,function(t){e(t),n.emit("close")})};
},{"./_stream_duplex":"DNpZ","core-util-is":"jlzx","inherits":"AKC4"}],"kw1i":[function(require,module,exports) {
"use strict";module.exports=i;var r=require("./_stream_transform"),e=require("core-util-is");function i(e){if(!(this instanceof i))return new i(e);r.call(this,e)}e.inherits=require("inherits"),e.inherits(i,r),i.prototype._transform=function(r,e,i){i(null,r)};
},{"./_stream_transform":"9VbT","core-util-is":"jlzx","inherits":"AKC4"}],"85Xi":[function(require,module,exports) {
exports=module.exports=require("./lib/_stream_readable.js"),exports.Stream=exports,exports.Readable=exports,exports.Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js");
},{"./lib/_stream_readable.js":"tSr+","./lib/_stream_writable.js":"OY7l","./lib/_stream_duplex.js":"DNpZ","./lib/_stream_transform.js":"9VbT","./lib/_stream_passthrough.js":"kw1i"}],"co7J":[function(require,module,exports) {
module.exports=require("./lib/_stream_writable.js");
},{"./lib/_stream_writable.js":"OY7l"}],"3aLC":[function(require,module,exports) {
module.exports=require("./lib/_stream_duplex.js");
},{"./lib/_stream_duplex.js":"DNpZ"}],"mkYa":[function(require,module,exports) {
module.exports=require("./readable").Transform;
},{"./readable":"85Xi"}],"7jlq":[function(require,module,exports) {
module.exports=require("./readable").PassThrough;
},{"./readable":"85Xi"}],"YeeV":[function(require,module,exports) {
module.exports=n;var e=require("events").EventEmitter,r=require("inherits");function n(){e.call(this)}r(n,e),n.Readable=require("readable-stream/readable.js"),n.Writable=require("readable-stream/writable.js"),n.Duplex=require("readable-stream/duplex.js"),n.Transform=require("readable-stream/transform.js"),n.PassThrough=require("readable-stream/passthrough.js"),n.Stream=n,n.prototype.pipe=function(r,n){var o=this;function t(e){r.writable&&!1===r.write(e)&&o.pause&&o.pause()}function s(){o.readable&&o.resume&&o.resume()}o.on("data",t),r.on("drain",s),r._isStdio||n&&!1===n.end||(o.on("end",a),o.on("close",u));var i=!1;function a(){i||(i=!0,r.end())}function u(){i||(i=!0,"function"==typeof r.destroy&&r.destroy())}function d(r){if(l(),0===e.listenerCount(this,"error"))throw r}function l(){o.removeListener("data",t),r.removeListener("drain",s),o.removeListener("end",a),o.removeListener("close",u),o.removeListener("error",d),r.removeListener("error",d),o.removeListener("end",l),o.removeListener("close",l),r.removeListener("close",l)}return o.on("error",d),r.on("error",d),o.on("end",l),o.on("close",l),r.on("close",l),r.emit("pipe",o),r};
},{"events":"JvJJ","inherits":"AKC4","readable-stream/readable.js":"85Xi","readable-stream/writable.js":"co7J","readable-stream/duplex.js":"3aLC","readable-stream/transform.js":"mkYa","readable-stream/passthrough.js":"7jlq"}],"ANm2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),e=require("stream");function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(a){function n(t){i(this,n);var e=r(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{objectMode:!0}));if(!(t=t||{}).neuralNetwork)throw new Error("no neural network specified");var o=t.neuralNetwork;e.neuralNetwork=o,e.dataFormatDetermined=!1,e.i=0,e.size=0,e.count=0,e.sum=0,e.floodCallback=t.floodCallback,e.doneTrainingCallback=t.doneTrainingCallback,o.updateTrainingOptions(t);var a=o.trainOpts;return e.iterations=a.iterations,e.errorThresh=a.errorThresh,e.log=a.log,e.logPeriod=a.logPeriod,e.callbackPeriod=a.callbackPeriod,e.callback=a.callback,e.on("finish",e.finishStreamIteration.bind(e)),e}return o(n,e.Writable),t(n,[{key:"endInputs",value:function(){this.write(!1)}},{key:"_write",value:function(t,e,i){if(!t)return this.emit("finish"),i();if(!this.dataFormatDetermined)return this.size++,this.neuralNetwork.addFormat(t),this.firstDatum=this.firstDatum||t,i();this.count++;var r=this.neuralNetwork.formatData(t);this.sum+=this.neuralNetwork.trainPattern(r[0],!0),i()}},{key:"finishStreamIteration",value:function(){if(this.dataFormatDetermined&&this.size!==this.count&&this.log("This iteration's data length was different from the first."),!this.dataFormatDetermined){var t=this.neuralNetwork.formatData(this.firstDatum);return this.neuralNetwork.verifyIsInitialized(t),this.dataFormatDetermined=!0,void("function"==typeof this.floodCallback&&this.floodCallback())}var e=this.sum/this.size;if(this.log&&this.i%this.logPeriod==0&&this.log("iterations: "+this.i+", training error: "+e),this.callback&&this.i%this.callbackPeriod==0&&this.callback({error:e,iterations:this.i}),this.sum=0,this.count=0,this.i++,this.i<this.iterations&&e>this.errorThresh){if("function"==typeof this.floodCallback)return this.floodCallback()}else if("function"==typeof this.doneTrainingCallback)return this.doneTrainingCallback({error:e,iterations:this.i})}}]),n}();exports.default=a;
},{"stream":"YeeV"}],"5VZ1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,s,r){return s&&e(t.prototype,s),r&&e(t,r),t}}(),t=require("../../utilities/zeros"),s=r(t);function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(e,r){i(this,t),void 0!==e&&void 0!==r&&(this.rows=e,this.columns=r,this.weights=(0,s.default)(e*r),this.deltas=(0,s.default)(e*r))}return e(t,[{key:"getWeights",value:function(e,t){var s=this.columns*e+t;if(s<0&&s>=this.weights.length)throw new Error("get accessor is skewed");return this.weights[s]}},{key:"setWeight",value:function(e,t,s){var r=this.columns*e+t;if(r<0&&r>=this.weights.length)throw new Error("set accessor is skewed");this.weights[r]=s}},{key:"setDeltas",value:function(e,t,s){var r=this.columns*e+t;if(r<0&&r>=this.weights.length)throw new Error("set accessor is skewed");this.deltas[r]=s}},{key:"toJSON",value:function(){return{rows:this.rows,columns:this.columns,weights:this.weights.slice(0)}}},{key:"weightsToArray",value:function(){for(var e=[],t=0,s=0,r=0;r<this.weights.length;r++)0===s&&e.push([]),e[t].push(this.weights[r]),++s>=this.columns&&(s=0,t++);return e}},{key:"deltasToArray",value:function(){for(var e=[],t=0,s=0,r=0;r<this.deltas.length;r++)0===s&&e.push([]),e[t].push(this.deltas[r]),++s>=this.columns&&(s=0,t++);return e}}],[{key:"fromJSON",value:function(e){for(var s=new t(e.rows,e.columns),r=0,i=e.rows*e.columns;r<i;r++)s.weights[r]=e.weights[r];return s}},{key:"fromArray",value:function(e,s){var r=e.length,i=e[0].length,n=new t(r,i);s=s||e;for(var o=0;o<r;o++)for(var u=e[o],h=s[o],a=0;a<i;a++)n.setWeight(o,a,u[a]),n.setDeltas(o,a,h[a]);return n}}]),t}();exports.default=n;
},{"../../utilities/zeros":"+tZN"}],"jP/8":[function(require,module,exports) {
"use strict";function r(r,t){return Math.random()*(t-r)+r}function t(r,t){return Math.floor(Math.random()*(t-r)+r)}function n(r,t){return r+e()*t}function e(){if(e.returnV)return e.returnV=!1,e.vVal;var r=2*Math.random()-1,t=2*Math.random()-1,n=r*r+t*t;if(0==n||n>1)return e();var a=Math.sqrt(-2*Math.log(n)/n);return e.vVal=t*a,e.returnV=!0,r*a}Object.defineProperty(exports,"__esModule",{value:!0}),exports.randomF=r,exports.randomI=t,exports.randomN=n,e.returnV=!1,e.vVal=0;
},{}],"QYqF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./"),t=o(e),r=require("../../utilities/random");function o(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(e){function o(e,t,u){n(this,o);var s=i(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e,t));s.rows=e,s.columns=t,s.std=u;for(var a=0,c=s.weights.length;a<c;a++)s.weights[a]=(0,r.randomF)(-u,u);return s}return u(o,t.default),o}();exports.default=s;
},{"./":"5VZ1","../../utilities/random":"jP/8"}],"Kn+K":[function(require,module,exports) {
"use strict";function e(e){if("undefined"!=typeof Float32Array)return new Float32Array(e).fill(1);for(var r=new Array(e),t=0;t<e;t++)r[t]=1;return r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"wGfb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./"),t=n(e),r=require("../../utilities/ones"),o=n(r);function n(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var f=function(e){function r(e,t){u(this,r);var n=i(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));return n.rows=e,n.columns=t,n.weights=(0,o.default)(e*t),n.deltas=(0,o.default)(e*t),n}return s(r,t.default),r}();exports.default=f;
},{"./":"5VZ1","../../utilities/ones":"Kn+K"}],"4+ix":[function(require,module,exports) {
"use strict";function e(e,s){e.rows=parseInt(s.rows),e.columns=parseInt(s.columns),e.weights=s.weights.slice(0),e.deltas=s.deltas.slice(0)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"r5Ow":[function(require,module,exports) {
"use strict";function e(e,s){e.rows=parseInt(s.rows),e.columns=parseInt(s.columns),e.weights=s.weights.slice(0),e.deltas=s.deltas.slice(0);for(var t=0;t<s.weights.length;t++)e.weights[t]=-s.weights[t],e.deltas[t]=0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"It6b":[function(require,module,exports) {
"use strict";function e(e,t,s){for(var i=0;i<t.weights.length;i++)e.weights[i]=t.weights[i]+s.weights[i],e.deltas[i]=0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"ukmm":[function(require,module,exports) {
"use strict";function e(e,t,s){for(var l=0;l<e.deltas.length;l++)t.deltas[l]=e.deltas[l],s.deltas[l]=e.deltas[l]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"Cxy7":[function(require,module,exports) {
"use strict";function e(e){for(var t=0;t<e.weights.length;t++)e.weights[t]=1,e.deltas[t]=0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"q4on":[function(require,module,exports) {
"use strict";function e(e,r,s){for(var t=r.rows,o=r.columns,a=s.columns,l=0;l<t;l++)for(var u=o*l,f=a*l,i=0;i<a;i++){for(var c=0,d=0;d<o;d++){var n=u+d,v=a*d+i;c+=r.weights[n]*s.weights[v],r.deltas[n]=0,s.deltas[v]=0}e.weights[f+i]=c}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"xbM8":[function(require,module,exports) {
"use strict";function e(e,r,s){for(var t=r.rows,o=r.columns,a=s.columns,l=0;l<t;l++)for(var u=o*l,d=a*l,f=0;f<a;f++)for(var c=0;c<o;c++){var i=u+c,n=a*c+f,v=e.deltas[d+f];r.deltas[i]+=s.weights[n]*v,s.deltas[n]+=r.weights[i]*v}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"P9fj":[function(require,module,exports) {
"use strict";function e(e,t,s){for(var i=t.weights,r=0;r<i.length;r++)e.weights[r]=t.weights[r]*s.weights[r],e.deltas[r]=0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"XwZJ":[function(require,module,exports) {
"use strict";function e(e,t,s){for(var l=0;l<t.weights.length;l++)t.deltas[l]=s.weights[l]*e.deltas[l],s.deltas[l]=t.weights[l]*e.deltas[l]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"o/4o":[function(require,module,exports) {
"use strict";function e(e,t){for(var s=0;s<t.weights.length;s++)e.weights[s]=Math.max(0,t.weights[s]),e.deltas[s]=0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"9k3w":[function(require,module,exports) {
"use strict";function e(e,t){for(var s=0;s<e.deltas.length;s++)t.deltas[s]=t.weights[s]>0?e.deltas[s]:0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"ehlk":[function(require,module,exports) {
"use strict";function e(e,t,s){for(var o=t.columns,r=o*s,u=0;u<o;u++)e.weights[u]=t.weights[r+u],e.deltas[u]=0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"EXc9":[function(require,module,exports) {
"use strict";function e(e,t,s){for(var o=t.columns,r=o*s,l=0;l<o;l++)t.deltas[r+l]=e.deltas[l]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"UqbN":[function(require,module,exports) {
"use strict";function e(e,t){for(var r=0;r<t.weights.length;r++)e.weights[r]=1/(1+Math.exp(-t.weights[r])),e.deltas[r]=0}function t(e){return 1/(1+Math.exp(-e))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"gRvR":[function(require,module,exports) {
"use strict";function e(e,t){for(var s=0;s<e.deltas.length;s++){var r=e.weights[s];t.deltas[s]=r*(1-r)*e.deltas[s]}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"QjJW":[function(require,module,exports) {
"use strict";function e(e,t){for(var s=0;s<t.weights.length;s++)e.weights[s]=Math.tanh(t.weights[s]),e.deltas[s]=0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"GaN/":[function(require,module,exports) {
"use strict";function e(e,t){for(var s=0;s<e.deltas.length;s++){var r=e.weights[s];t.deltas[s]=(1-r*r)*e.deltas[s]}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"/hSy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=s;var e=require("./"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}function s(e){for(var r=new t.default(e.rows,e.columns),s=-999999,i=0;i<e.weights.length;i++)e.weights[i]>s&&(s=e.weights[i]);for(var h=0,u=0;u<e.weights.length;u++)r.weights[u]=Math.exp(e.weights[u]-s),h+=r.weights[u];for(var g=0;g<e.weights.length;g++)r.weights[g]/=h;return r}
},{"./":"5VZ1"}],"+UBx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),e=require("./"),r=G(e),n=require("./ones-matrix"),a=G(n),u=require("./copy"),i=G(u),o=require("./clone-negative"),s=G(o),l=require("./add"),f=G(l),d=require("./add-b"),h=G(d),c=require("./all-ones"),p=G(c),w=require("./multiply"),g=G(w),v=require("./multiply-b"),k=G(v),m=require("./multiply-element"),y=G(m),b=require("./multiply-element-b"),F=G(b),q=require("./relu"),x=G(q),O=require("./relu-b"),E=G(O),I=require("./row-pluck"),P=G(I),M=require("./row-pluck-b"),R=G(M),T=require("./sigmoid"),_=G(T),V=require("./sigmoid-b"),j=G(V),N=require("./tanh"),C=G(N),z=require("./tanh-b"),A=G(z),B=require("./softmax"),D=G(B);function G(t){return t&&t.__esModule?t:{default:t}}function H(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var J=function(){function e(){H(this,e),this.inputRow=0,this.inputValue=null,this.states=[]}return t(e,[{key:"add",value:function(t,e){if(t.weights.length!==e.weights.length)throw new Error("misaligned matrices");var n=new r.default(t.rows,t.columns);return this.states.push({left:t,right:e,product:n,forwardFn:f.default,backpropagationFn:h.default}),n}},{key:"allOnes",value:function(t,e){var n=new r.default(t,e);return this.states.push({left:n,product:n,forwardFn:p.default}),n}},{key:"cloneNegative",value:function(t){var e=new r.default(t.rows,t.columns);return this.states.push({left:t,product:e,forwardFn:s.default}),e}},{key:"subtract",value:function(t,e){if(t.weights.length!==e.weights.length)throw new Error("misaligned matrices");return this.add(this.add(this.allOnes(t.rows,t.columns),this.cloneNegative(t)),e)}},{key:"multiply",value:function(t,e){if(t.columns!==e.rows)throw new Error("misaligned matrices");var n=new r.default(t.rows,e.columns);return this.states.push({left:t,right:e,product:n,forwardFn:g.default,backpropagationFn:k.default}),n}},{key:"multiplyElement",value:function(t,e){if(t.weights.length!==e.weights.length)throw new Error("misaligned matrices");var n=new r.default(t.rows,t.columns);return this.states.push({left:t,right:e,product:n,forwardFn:y.default,backpropagationFn:F.default}),n}},{key:"relu",value:function(t){var e=new r.default(t.rows,t.columns);return this.states.push({left:t,product:e,forwardFn:x.default,backpropagationFn:E.default}),e}},{key:"input",value:function(t){var e=this;return this.states.push({product:t,forwardFn:function(r){r.weights=t.weights=e.inputValue}}),t}},{key:"inputMatrixToRow",value:function(t){var e=this,n=new r.default(t.columns,1);return this.states.push({left:t,get right(){return e.inputRow},product:n,forwardFn:P.default,backpropagationFn:R.default}),n}},{key:"sigmoid",value:function(t){var e=new r.default(t.rows,t.columns);return this.states.push({left:t,product:e,forwardFn:_.default,backpropagationFn:j.default}),e}},{key:"tanh",value:function(t){var e=new r.default(t.rows,t.columns);return this.states.push({left:t,product:e,forwardFn:C.default,backpropagationFn:A.default}),e}},{key:"observe",value:function(t){return this.states.push({forwardFn:function(){0},backpropagationFn:function(){0}}),t}},{key:"runIndex",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.inputRow=t;for(var e=void 0,r=0,n=this.states.length;r<n;r++)(e=this.states[r]).hasOwnProperty("forwardFn")&&e.forwardFn(e.product,e.left,e.right);return e.product}},{key:"runInput",value:function(t){this.inputValue=t;for(var e=void 0,r=0,n=this.states.length;r<n;r++)(e=this.states[r]).hasOwnProperty("forwardFn")&&e.forwardFn(e.product,e.left,e.right);return e.product}},{key:"backpropagate",value:function(){for(var t=this.states.length,e=void 0;t-- >0;)(e=this.states[t]).hasOwnProperty("backpropagationFn")&&e.backpropagationFn(e.product,e.left,e.right);return e.product}},{key:"backpropagateIndex",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.inputRow=t;for(var e=this.states.length,r=void 0;e-- >0;)(r=this.states[e]).hasOwnProperty("backpropagationFn")&&r.backpropagationFn(r.product,r.left,r.right);return r.product}},{key:"predictTarget",value:function(t,e){for(var r=this.runInput(t),n=0,a=0;a<r.weights.length;a++){var u=r.weights[a]-e[a];n+=Math.abs(u),r.deltas[a]=u}return n}},{key:"predictTargetIndex",value:function(t,e){var r=this.runIndex(t),n=r,a=(0,D.default)(r);return n.deltas=a.weights.slice(0),n.deltas[e]-=1,-Math.log2(a.weights[e])}}]),e}();exports.default=J;
},{"./":"5VZ1","./ones-matrix":"wGfb","./copy":"4+ix","./clone-negative":"r5Ow","./add":"It6b","./add-b":"ukmm","./all-ones":"Cxy7","./multiply":"q4on","./multiply-b":"xbM8","./multiply-element":"P9fj","./multiply-element-b":"XwZJ","./relu":"o/4o","./relu-b":"9k3w","./row-pluck":"ehlk","./row-pluck-b":"EXc9","./sigmoid":"UqbN","./sigmoid-b":"gRvR","./tanh":"QjJW","./tanh-b":"GaN/","./softmax":"/hSy"}],"MAFD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t;var e=require("../../utilities/random"),r=e.randomF;function t(e){for(var t=r(0,1),i=0,o=0,u=e.weights;;){if((i+=u[o])>t)return o;o++}}
},{"../../utilities/random":"jP/8"}],"jQfN":[function(require,module,exports) {
"use strict";function e(e){for(var t=e.weights,r=t[0],o=0,s=1;s<t.length;s++){var u=t[s];u<r||(o=s,r=u)}return o}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"F1mg":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function t(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;r(this,n),void 0!==e&&(this.values=e,this.indexTable={},this.characterTable={},this.characters=[],this.specialIndexes=[],this.buildCharactersFromIterable(e),this.buildTables(t))}return e(n,[{key:"buildCharactersFromIterable",value:function(e){for(var t={},r=0,n=e.length;r<n;r++){var a=e[r];if(a.hasOwnProperty("length"))for(var i=0,u=a.length;i<u;i++){var o=a[i];t.hasOwnProperty(o)||(t[o]=!0,this.characters.push(o))}else{var c=e[r];if(t.hasOwnProperty(c))continue;t[r]=!0,this.characters.push(c)}}}},{key:"buildTables",value:function(e){for(var t=this.characters.length,r=0;r<t;r++){var n=this.characters[r];r>=e&&(this.indexTable[n]=r,this.characterTable[r]=n)}}},{key:"toIndexes",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=[],n=this.indexTable,a=0,i=e.length;a<i;a++){var u=e[a],o=n[u];if(void 0===o){if(!n.unrecognized)throw new Error('unrecognized character "'+u+'"');o=n.unrecognized}o<t||r.push(o)}return r}},{key:"toIndexesInputOutput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=void 0;return n="string"==typeof e?this.toIndexes(e.split("").concat(["stop-input","start-output"]),r):this.toIndexes(e.concat(["stop-input","start-output"]),r),null===t?n:"string"==typeof t?n.concat(this.toIndexes(t.split(""),r)):n.concat(this.toIndexes(t,r))}},{key:"toCharacters",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=[],n=this.characterTable,a=this.indexTable,i=0,u=e.length;i<u;i++){var o=e[i];if(!(o<t)){var c=n[o];if(void 0===c){if(!a.unrecognized)throw new Error('unrecognized index "'+o+'"');c=n[a.unrecognized]}else null!==c&&r.push(c)}}return r}},{key:"toString",value:function(e,t){return this.toCharacters(e,t).join("")}},{key:"addInputOutput",value:function(){this.addSpecial("stop-input"),this.addSpecial("start-output")}},{key:"addUnrecognized",value:function(){this.addSpecial("unrecognized")}},{key:"addSpecial",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.indexTable[e]=this.characters.length;this.characterTable[r]=t,this.specialIndexes.push(this.characters.length),this.characters.push(e)}},{key:"countSpecial",value:function(e){for(var t=0,r=0;r<this.specialIndexes;r++)for(var n=-1;n=e.indexOf(this.specialIndexes[r],n)>-1;)t++;return t}},{key:"toFunctionString",value:function(){return"\nvar characterTable = "+JSON.stringify(this.characterTable)+";\nvar indexTable = "+JSON.stringify(this.indexTable)+";\nvar characters = "+JSON.stringify(this.characters)+";\n"+this.toIndexes.toString().replace(/(let|var) indexTable = this[.]indexTable;\n/,"").replace(/this[.]/g,"")+"\n"+this.toIndexesInputOutput.toString().replace(/this[.]/g,"")+"\n"+this.toCharacters.toString().replace(/(let|var) characterTable = this[.]characterTable;\n/g,"").replace(/this[.]/,"")+"\n"}}],[{key:"fromAllPrintable",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["\n"],r=32;r<=126;r++)t.push(String.fromCharCode(r));return new n(t,e)}},{key:"fromAllPrintableInputOutput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["\n"],r=n.fromAllPrintable(e,t);return r.addInputOutput(),r}},{key:"fromStringInputOutput",value:function(e,r){var a,i=new n((a=String.prototype).concat.apply(a,t(new Set(e))),r);return i.addInputOutput(),i}},{key:"fromArrayInputOutput",value:function(e,t){var r=new n(e.filter(function(e,t,r){return r.indexOf(e)===t}).sort(),t);return r.addInputOutput(),r}},{key:"fromString",value:function(e,r){var a;return new n((a=String.prototype).concat.apply(a,t(new Set(e))),r)}},{key:"fromJSON",value:function(e){var t=new n;return t.indexTable=e.indexTable,t.characterTable=e.characterTable,t.values=e.values,t.characters=e.characters,t.specialIndexes=e.specialIndexes,t}}]),n}();exports.default=n;
},{}],"shri":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),e=require("./matrix"),n=I(e),r=require("./matrix/random-matrix"),a=I(r),i=require("./matrix/equation"),o=I(i),u=require("./matrix/sample-i"),s=I(u),l=require("./matrix/max-i"),h=I(l),d=require("./matrix/softmax"),p=I(d),f=require("./matrix/copy"),c=I(f),m=require("../utilities/random"),g=require("../utilities/zeros"),v=I(g),y=require("../utilities/data-formatter"),w=I(y),x=require("../neural-network"),O=I(x);function I(t){return t&&t.__esModule?t:{default:t}}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var k=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};b(this,e);var n=this.constructor.defaults;Object.assign(this,n,t),this.trainOpts={},this.updateTrainingOptions(Object.assign({},this.constructor.trainDefaults,t)),this.stepCache={},this.runs=0,this.ratioClipped=null,this.model=null,this.inputLookup=null,this.inputLookupLength=null,this.outputLookup=null,this.outputLookupLength=null,t.json&&this.fromJSON(t.json)}return t(e,[{key:"initialize",value:function(){this.model={input:null,hiddenLayers:[],output:null,equations:[],allMatrices:[],equationConnections:[],outputConnector:null},this.dataFormatter&&(this.inputSize=this.inputRange=this.outputSize=this.dataFormatter.characters.length),this.mapModel()}},{key:"createHiddenLayers",value:function(){this.model.hiddenLayers.push(this.getModel(this.hiddenLayers[0],this.inputSize));for(var t=this.hiddenLayers[0],e=1;e<this.hiddenLayers.length;e++){var n=this.hiddenLayers[e];this.model.hiddenLayers.push(this.getModel(n,t)),t=n}}},{key:"getModel",value:function(t,e){return{weight:new a.default(t,e,.08),transition:new a.default(t,t,.08),bias:new n.default(t,1)}}},{key:"getEquation",value:function(t,e,n,r){var a=t.relu.bind(t),i=t.add.bind(t),o=t.multiply.bind(t);return a(i(i(o(r.weight,e),o(r.transition,n)),r.bias))}},{key:"createInputMatrix",value:function(){this.model.input=new a.default(this.inputRange+1,this.inputSize,.08)}},{key:"createOutputMatrix",value:function(){var t=this.model,e=this.outputSize,r=this.hiddenLayers[this.hiddenLayers.length-1];t.outputConnector=new a.default(e+1,r,.08),t.output=new n.default(e+1,1)}},{key:"bindEquation",value:function(){var t=this.model,e=new o.default,n=[],r=t.equationConnections.length>0?t.equationConnections[t.equationConnections.length-1]:this.initialLayerInputs,a=this.getEquation(e,e.inputMatrixToRow(t.input),r[0],t.hiddenLayers[0]);n.push(a);for(var i=1,u=this.hiddenLayers.length;i<u;i++)a=this.getEquation(e,a,r[i],t.hiddenLayers[i]),n.push(a);t.equationConnections.push(n),e.add(e.multiply(t.outputConnector,a),t.output),t.equations.push(e)}},{key:"mapModel",value:function(){var t=this.model,e=t.hiddenLayers,r=t.allMatrices;if(this.initialLayerInputs=this.hiddenLayers.map(function(t){return new n.default(t,1)}),this.createInputMatrix(),!t.input)throw new Error("net.model.input not set");if(r.push(t.input),this.createHiddenLayers(),!t.hiddenLayers.length)throw new Error("net.hiddenLayers not set");for(var a=0,i=e.length;a<i;a++){var o=e[a];for(var u in o)o.hasOwnProperty(u)&&r.push(o[u])}if(this.createOutputMatrix(),!t.outputConnector)throw new Error("net.model.outputConnector not set");if(!t.output)throw new Error("net.model.output not set");r.push(t.outputConnector),r.push(t.output)}},{key:"trainPattern",value:function(t,e){var n=this.trainInput(t);if(this.backpropagate(t),this.adjustWeights(),e)return n}},{key:"trainInput",value:function(t){this.runs++;for(var e=this.model,n=t.length,r=0,a=void 0;e.equations.length<=t.length+1;)this.bindEquation();for(var i=-1,o=t.length;i<o;i++){var u=i+1;a=e.equations[u];var s=-1===i?0:t[i]+1,l=i===n-1?0:t[i+1]+1;r+=a.predictTargetIndex(s,l)}return Math.pow(2,r/(n-1))/100}},{key:"backpropagate",value:function(t){for(var e=t.length,n=this.model.equations;e>0;)n[e].backpropagateIndex(t[e-1]+1),e--;n[0].backpropagateIndex(0)}},{key:"adjustWeights",value:function(){for(var t=this.regc,e=this.clipval,n=this.model,r=this.decayRate,a=this.stepCache,i=this.smoothEps,o=this.trainOpts.learningRate,u=n.allMatrices,s=0,l=0,h=0;h<u.length;h++){var d=u[h],p=d.weights,f=d.deltas;h in a||(a[h]=(0,v.default)(d.rows*d.columns));for(var c=a[h],m=0;m<p.length;m++){var g=f[m],y=p[m];c[m]=c[m]*r+(1-r)*g*g,g>e&&(g=e,s++),g<-e&&(g=-e,s++),l++,p[m]=y+-o*g/Math.sqrt(c[m]+i)-t*y}}this.ratioClipped=s/l}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=this.maxPredictionLength+t.length+(this.dataFormatter?this.dataFormatter.specialIndexes.length:0);if(!this.isRunnable)return null;for(var i=this.formatDataIn(t),o=this.model,u=[],l=0;;){for(var d=0===l?0:l<i.length?i[l-1]+1:u[l-1];o.equations.length<=l;)this.bindEquation();var f=o.equations[l].runIndex(d),m=new n.default(o.output.rows,o.output.columns);if((0,c.default)(m,f),1!==r&&e)for(var g=0,v=m.weights.length;g<v;g++)m.weights[g]/=r;var y=(0,p.default)(m),w=e?(0,s.default)(y):(0,h.default)(y);if(l++,0===w)break;if(l>=a)break;u.push(w)}return this.formatDataOut(i,u.slice(i.length).map(function(t){return t-1}))}},{key:"verifyIsInitialized",value:function(t){this.model||this.initialize()}},{key:"updateTrainingOptions",value:function(t){var e=this;Object.keys(this.constructor.trainDefaults).forEach(function(n){return e.trainOpts[n]=t.hasOwnProperty(n)?t[n]:e.trainOpts[n]}),this.validateTrainingOptions(this.trainOpts),this.setLogMethod(t.log||this.trainOpts.log),this.activation=t.activation||this.activation}},{key:"validateTrainingOptions",value:function(t){O.default.prototype.validateTrainingOptions.call(this,t)}},{key:"setLogMethod",value:function(t){this.trainOpts.log="function"==typeof t?t:!!t&&console.log}},{key:"prepTraining",value:function(t,e){this.updateTrainingOptions(e),t=this.formatData(t);var n=Date.now()+this.trainOpts.timeout;return this.verifyIsInitialized(t),{data:t,status:{error:1,iterations:0},endTime:n}}},{key:"train",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.trainOpts=e=Object.assign({},this.constructor.trainDefaults,e);var n=e.iterations,r=e.errorThresh,a=!0===e.log?console.log:e.log,i=e.logPeriod,o=e.callback,u=e.callbackPeriod,s=1/0,l=void 0;for(this.hasOwnProperty("setupData")&&(t=this.setupData(t)),this.verifyIsInitialized(),l=0;l<n&&s>r;l++){for(var h=0,d=0;d<t.length;d++){h+=this.trainPattern(t[d],!0)}if(s=h/t.length,isNaN(s))throw new Error("network error rate is unexpected NaN, check network configurations and try again");a&&l%i==0&&a("iterations: "+l+", training error: "+s),o&&l%u==0&&o({error:s,iterations:l})}return{error:s,iterations:l}}},{key:"addFormat",value:function(){throw new Error("not yet implemented")}},{key:"toJSON",value:function(){var t=this.constructor.defaults;this.model||this.initialize();var e=this.model,n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=this[r]);return{type:this.constructor.name,options:n,input:e.input.toJSON(),hiddenLayers:e.hiddenLayers.map(function(t){var e={};for(var n in t)e[n]=t[n].toJSON();return e}),outputConnector:this.model.outputConnector.toJSON(),output:this.model.output.toJSON()}}},{key:"fromJSON",value:function(t){var e=this.constructor.defaults,r=t.options;this.model=null,this.hiddenLayers=null;var a=[],i=n.default.fromJSON(t.input);a.push(i);var o=[];(t.hiddenLayers||t.hiddenSizes).forEach(function(t){var e={};for(var r in t)e[r]=n.default.fromJSON(t[r]),a.push(e[r]);o.push(e)});var u=n.default.fromJSON(t.outputConnector);a.push(u);var s=n.default.fromJSON(t.output);a.push(s),Object.assign(this,e,r),r.hiddenSizes&&(this.hiddenLayers=r.hiddenSizes),r.dataFormatter&&(this.dataFormatter=w.default.fromJSON(r.dataFormatter)),this.model={input:i,hiddenLayers:o,output:s,allMatrices:a,outputConnector:u,equations:[],equationConnections:[]},this.initialLayerInputs=this.hiddenLayers.map(function(t){return new n.default(t,1)}),this.bindEquation()}},{key:"toFunction",value:function(){var t=this.model,e=this.model.equations,n=e[1].states,r=JSON.stringify(this.toJSON());function a(n){for(var r=t.equationConnections[0],a=e[0].states,i=0,o=a.length;i<o;i++)if(a[i].product===n)return i;return r.indexOf(n)}function i(e,r){if(!e||!e.rows||!e.columns)return"null";if(e===t.input)return"json.input";if(e===t.outputConnector)return"json.outputConnector";if(e===t.output)return"json.output";for(var i=0,o=t.hiddenLayers.length;i<o;i++){var u=t.hiddenLayers[i];for(var s in u)if(u.hasOwnProperty(s)&&u[s]===e)return"json.hiddenLayers["+i+"]."+s}return function(t,e){for(var r=0,i=n.length;r<i;r++){var o=n[r];if(r===e){var u=a(t);switch(t){case o.left:if(u>-1)return"typeof prevStates["+u+"] === 'object' ? prevStates["+u+"].product : new Matrix("+t.rows+", "+t.columns+")";case o.right:if(u>-1)return"typeof prevStates["+u+"] === 'object' ? prevStates["+u+"].product : new Matrix("+t.rows+", "+t.columns+")";case o.product:return"new Matrix("+t.rows+", "+t.columns+")";default:throw Error("unknown state")}}if(t===o.product)return"states["+r+"].product";if(t===o.right)return"states["+r+"].right";if(t===o.left)return"states["+r+"].left"}}(e,r)}function o(t){return(t=t.toString().split("{")).shift(),(t=(t=t.join("{")).split("}")).pop(),t.join("}").split("\n").join("\n        ").replace("product.deltas[i] = 0;","").replace("product.deltas[column] = 0;","").replace("left.deltas[leftIndex] = 0;","").replace("right.deltas[rightIndex] = 0;","").replace("product.deltas = left.deltas.slice(0);","")}function u(t){return"src/recurrent/matrix/"+t.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})+".js"}for(var l=[],d={},f=[],c=0,g=n.length;c<g;c++){var y=n[c];l.push("states["+c+"] = {\n      name: '"+y.forwardFn.name+"',\n      left: "+i(y.left,c)+",\n      right: "+i(y.right,c)+",\n      product: "+i(y.product,c)+"\n    }");var w=y.forwardFn.name;d[w]||(d[w]=!0,f.push("        case '"+w+"': //compiled from "+u(w)+"\n          "+o(y.forwardFn.toString())+"\n          break;"))}var x="\n  if (typeof rawInput === 'undefined') rawInput = [];\n  if (typeof isSampleI === 'undefined') isSampleI = false;\n  if (typeof temperature === 'undefined') temperature = 1;\n  "+(this.dataFormatter?this.dataFormatter.toFunctionString():"")+"\n  \n  var input = "+(this.dataFormatter&&"function"==typeof this.formatDataIn?"formatDataIn(rawInput)":"rawInput")+";\n  var json = "+r+";\n  var maxPredictionLength = input.length + "+this.maxPredictionLength+";\n  var _i = 0;\n  var output = [];\n  var states = [];\n  var prevStates;\n  while (true) {\n    var previousIndex = (_i === 0\n        ? 0\n        : _i < input.length\n          ? input[_i - 1] + 1\n          : output[_i - 1])\n          ;\n    var rowPluckIndex = previousIndex;\n    var state;\n    prevStates = states;\n    states = [];\n    "+l.join(";\n    ")+";\n    for (var stateIndex = 0, stateMax = "+l.length+"; stateIndex < stateMax; stateIndex++) {\n      state = states[stateIndex];\n      var product = state.product;\n      var left = state.left;\n      var right = state.right;\n      \n      switch (state.name) {\n"+f.join("\n")+"\n      }\n    }\n    \n    var logProbabilities = state.product;\n    if (temperature !== 1 && isSampleI) {\n      for (var q = 0, nq = logProbabilities.weights.length; q < nq; q++) {\n        logProbabilities.weights[q] /= temperature;\n      }\n    }\n\n    var probs = softmax(logProbabilities);\n    var nextIndex = isSampleI ? sampleI(probs) : maxI(probs);\n    \n    _i++;\n    if (nextIndex === 0) {\n      break;\n    }\n    if (_i >= maxPredictionLength) {\n      break;\n    }\n\n    output.push(nextIndex);\n  }\n  "+(this.dataFormatter&&"function"==typeof this.formatDataOut?"return formatDataOut(input, output.slice(input.length).map(function(value) { return value - 1; }))":"return output.slice(input.length).map(function(value) { return value - 1; })")+";\n  function Matrix(rows, columns) {\n    this.rows = rows;\n    this.columns = columns;\n    this.weights = zeros(rows * columns);\n  }\n  "+(this.dataFormatter&&"function"==typeof this.formatDataIn?"function formatDataIn(input, output) { "+o(this.formatDataIn.toString()).replace(/this[.]dataFormatter[\n\s]+[.]/g,"").replace(/this[.]dataFormatter[.]/g,"").replace(/this[.]dataFormatter/g,"true")+" }":"")+"\n  "+(null!==this.dataFormatter&&"function"==typeof this.formatDataOut?"function formatDataOut(input, output) { "+o(this.formatDataOut.toString()).replace(/this[.]dataFormatter[\n\s]+[.]/g,"").replace(/this[.]dataFormatter[.]/g,"").replace(/this[.]dataFormatter/g,"true")+" }":"")+"\n  "+v.default.toString()+"\n  "+p.default.toString().replace("_2.default","Matrix")+"\n  "+m.randomF.toString()+"\n  "+s.default.toString()+"\n  "+h.default.toString();return new Function("rawInput","isSampleI","temperature",x)}},{key:"isRunnable",get:function(){return 0!==this.model.equations.length||(console.error("No equations bound, did you run train()?"),!1)}}]),e}();exports.default=k,k.defaults={inputSize:20,inputRange:20,hiddenLayers:[20,20],outputSize:20,decayRate:.999,smoothEps:1e-8,regc:1e-6,clipval:5,maxPredictionLength:100,setupData:function(t){if(!("string"==typeof t[0]||Array.isArray(t[0])||t[0].hasOwnProperty("input")&&t[0].hasOwnProperty("output")))return t;var e=[],n=[];if("string"==typeof t[0]||Array.isArray(t[0])){if(!this.dataFormatter){for(var r=0;r<t.length;r++)e.push(t[r]);this.dataFormatter=new w.default(e)}for(var a=0,i=t.length;a<i;a++)n.push(this.formatDataIn(t[a]))}else{if(!this.dataFormatter){for(var o=0;o<t.length;o++)e.push(t[o].input),e.push(t[o].output);this.dataFormatter=w.default.fromArrayInputOutput(e),this.dataFormatter.addUnrecognized()}for(var u=0,s=t.length;u<s;u++)n.push(this.formatDataIn(t[u].input,t[u].output))}return n},formatDataIn:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.dataFormatter?this.dataFormatter.indexTable.hasOwnProperty("stop-input")?this.dataFormatter.toIndexesInputOutput(t,e):this.dataFormatter.toIndexes(t):t},formatDataOut:function(t,e){return this.dataFormatter?this.dataFormatter.toCharacters(e).join(""):e},dataFormatter:null},k.trainDefaults={iterations:2e4,errorThresh:.005,log:!1,logPeriod:10,learningRate:.01,callback:null,callbackPeriod:10};
},{"./matrix":"5VZ1","./matrix/random-matrix":"QYqF","./matrix/equation":"+UBx","./matrix/sample-i":"MAFD","./matrix/max-i":"jQfN","./matrix/softmax":"/hSy","./matrix/copy":"4+ix","../utilities/random":"jP/8","../utilities/zeros":"+tZN","../utilities/data-formatter":"F1mg","../neural-network":"23dQ"}],"HKVg":[function(require,module,exports) {
"use strict";function t(t,e){this.length=0,this.prop=e;for(var r=this.table={},o=0;o<t.length;o++)for(var s=t[o][e],h=0;h<s.length;h++)for(var n in s[h])r.hasOwnProperty(n)||(r[n]=this.length++)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t;
},{}],"YhFz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function t(t,r){for(var e=0;e<r.length;e++){var u=r[e];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(t,u.key,u)}}return function(r,e,u){return e&&t(r.prototype,e),u&&t(r,u),r}}(),r=require("./matrix"),e=j(r),u=require("./matrix/random-matrix"),n=j(u),a=require("./matrix/equation"),o=j(a),i=require("./rnn"),s=j(i),p=require("../utilities/zeros"),h=j(p),l=require("./matrix/softmax"),f=j(l),c=require("../utilities/random"),d=require("./matrix/sample-i"),g=j(d),v=require("./matrix/max-i"),y=j(v),b=require("../lookup"),k=j(b),m=require("../utilities/lookup-table"),L=j(m),w=require("../utilities/array-lookup-table"),S=j(w),O=require("../utilities/cast");function j(t){return t&&t.__esModule?t:{default:t}}function z(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function q(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?t:r}function I(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var E=function(r){function u(){return z(this,u),q(this,(u.__proto__||Object.getPrototypeOf(u)).apply(this,arguments))}return I(u,s.default),t(u,[{key:"createOutputMatrix",value:function(){var t=this.model,r=this.outputSize,e=this.hiddenLayers[this.hiddenLayers.length-1];t.outputConnector=new n.default(r,e,.08),t.output=new n.default(r,1,.08)}},{key:"bindEquation",value:function(){var t=this.model,r=this.hiddenLayers,u=t.hiddenLayers,n=new o.default,a=[],i=t.equationConnections.length>0?t.equationConnections[t.equationConnections.length-1]:this.initialLayerInputs,s=this.getEquation(n,n.input(new e.default(this.inputSize,1)),i[0],u[0]);a.push(s);for(var p=1,h=r.length;p<h;p++)s=this.getEquation(n,s,i[p],u[p]),a.push(s);t.equationConnections.push(a),n.add(n.multiply(t.outputConnector,s),t.output),t.equations.push(n)}},{key:"mapModel",value:function(){var t=this.model,r=t.hiddenLayers,u=t.allMatrices;if(this.initialLayerInputs=this.hiddenLayers.map(function(t){return new e.default(t,1)}),this.createHiddenLayers(),!t.hiddenLayers.length)throw new Error("net.hiddenLayers not set");for(var n=0,a=r.length;n<a;n++){var o=r[n];for(var i in o)o.hasOwnProperty(i)&&u.push(o[i])}if(this.createOutputMatrix(),!t.outputConnector)throw new Error("net.model.outputConnector not set");if(!t.output)throw new Error("net.model.output not set");u.push(t.outputConnector),u.push(t.output)}},{key:"backpropagate",value:function(){for(var t=this.model.equations.length-1;t>-1;t--)this.model.equations[t].backpropagate()}},{key:"run",value:function(t){return 1===this.inputSize?this.outputLookup?(this.run=this.runObject,this.runObject(t)):(this.run=this.runNumbers,this.runNumbers(t)):(this.run=this.runArrays,this.runArrays(t))}},{key:"forecast",value:function(t,r){return 1===this.inputSize?this.outputLookup?(this.forecast=this.runObject,this.runObject(t)):(this.forecast=this.forecastNumbers,this.forecastNumbers(t,r)):this.outputLookup?(this.forecast=this.forecastObjects,this.forecastObjects(t,r)):(this.forecast=this.forecastArrays,this.forecastArrays(t,r))}},{key:"train",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.trainOpts=r=Object.assign({},this.constructor.trainDefaults,r);var e=r.iterations,u=r.errorThresh,n=!0===r.log?console.log:r.log,a=r.logPeriod,o=r.callback,i=r.callbackPeriod;1!==this.inputSize&&this.inputSize||this.setSize(t),t=this.formatData(t);var s=1/0,p=void 0;for(this.verifyIsInitialized(t),p=0;p<e&&s>u;p++){for(var h=0,l=0;l<t.length;l++){h+=this.trainPattern(t[l],!0)}if(s=h/t.length,isNaN(s))throw new Error("network error rate is unexpected NaN, check network configurations and try again");n&&p%a==0&&n("iterations: "+p+", training error: "+s),o&&p%i==0&&o({error:s,iterations:p})}return{error:s,iterations:p}}},{key:"verifyIsInitialized",value:function(t){t[0].input?this.trainInput=this.trainInputOutput:t[0].length>0&&(t[0][0].length>0?this.trainInput=this.trainArrays:this.inputSize>1?this.trainInput=this.trainArrays:this.trainInput=this.trainNumbers),this.model||this.initialize()}},{key:"setSize",value:function(t){switch(k.default.dataShape(t).join(",")){case"array,array,number":case"array,object,number":case"array,datum,array,number":case"array,datum,object,number":break;case"array,array,array,number":this.inputSize=this.outputSize=t[0][0].length;break;case"array,array,object,number":this.inputSize=this.outputSize=Object.keys(k.default.toTable2D(t)).length;break;case"array,datum,array,array,number":this.inputSize=this.outputSize=t[0].input[0].length;break;case"array,datum,array,object,number":this.inputSize=Object.keys(k.default.toInputTable2D(t)).length,this.outputSize=Object.keys(k.default.toOutputTable2D(t)).length;break;default:throw new Error("unknown data shape or configuration")}}},{key:"trainNumbers",value:function(t){for(var r=this.model.equations;r.length<t.length;)this.bindEquation();for(var e=0,u=0,n=t.length-1;u<n;u++)e+=r[u].predictTarget(t[u],t[u+1]);return this.end(),e/t.length}},{key:"runNumbers",value:function(t){if(!this.isRunnable)return null;var r=this.model.equations;for(this.inputLookup&&(t=k.default.toArray(this.inputLookup,t,this.inputLookupLength));r.length<=t.length;)this.bindEquation();for(var e=void 0,u=0;u<t.length;u++)e=r[u].runInput([t[u]]);return this.end(),e.weights[0]}},{key:"forecastNumbers",value:function(t,r){if(!this.isRunnable)return null;for(var e=this.model.equations,u=t.length+r;e.length<=u;)this.bindEquation();for(var n=void 0,a=0,o=0;o<t.length;o++)n=e[a++].runInput([t[o]]);for(var i=[n.weights[0]],s=0,p=r-1;s<p;s++)n=e[a++].runInput(n.weights),i.push(n.weights[0]);return this.end(),i}},{key:"runObject",value:function(t){if(this.inputLookup===this.outputLookup){var r=k.default.toArrayShort(this.inputLookup,t);return k.default.toObjectPartial(this.outputLookup,this.forecastNumbers(r,this.outputLookupLength-r.length),r.length)}return k.default.toObject(this.outputLookup,this.forecastNumbers(k.default.toArray(this.inputLookup,t,this.inputLookupLength),this.outputLookupLength))}},{key:"forecastObjects",value:function(t,r){var e=this;return t=t.map(function(t){return k.default.toArray(e.outputLookup,t,e.outputLookupLength)}),this.forecastArrays(t,r).map(function(t){return k.default.toObject(e.outputLookup,t)})}},{key:"trainInputOutput",value:function(t){for(var r=this.model,e=t.input,u=t.output,n=e.length+u.length,a=r.equations;a.length<n;)this.bindEquation();for(var o=0,i=0,s=0,p=e.length-1;s<p;s++)o+=a[i++].predictTarget(e[s],e[s+1]);o+=a[i++].predictTarget(e[e.length-1],u[0]);for(var h=0,l=u.length-1;h<l;h++)o+=a[i++].predictTarget(u[h],u[h+1]);return this.end(),o/n}},{key:"trainArrays",value:function(t){for(var r=this.model.equations;r.length<t.length;)this.bindEquation();for(var e=0,u=0,n=t.length-1;u<n;u++)e+=r[u].predictTarget(t[u],t[u+1]);return this.end(),e/t.length}},{key:"runArrays",value:function(t){if(!this.isRunnable)return null;for(var r=this.model.equations;r.length<=t.length;)this.bindEquation();this.inputLookup&&(t=k.default.toArrays(this.inputLookup,t,this.inputLookupLength));for(var e=void 0,u=0;u<t.length;u++){e=r[u].runInput(t[u]).weights}return this.end(),this.outputLookup?k.default.toObject(this.outputLookup,e):e}},{key:"forecastArrays",value:function(t,r){if(!this.isRunnable)return null;for(var e=this.model.equations,u=t.length+r;e.length<=u;)this.bindEquation();for(var n=void 0,a=0,o=0;o<t.length;o++)n=e[a++].runInput(t[o]);for(var i=[n.weights],s=0,p=r-1;s<p;s++)n=e[a++].runInput(n.weights),i.push(n.weights.slice(0));return this.end(),i}},{key:"end",value:function(){this.model.equations[this.model.equations.length-1].runInput(new Float32Array(this.outputSize))}},{key:"formatData",value:function(t){var r=[];switch(k.default.dataShape(t).join(",")){case"array,number":if(1!==this.inputSize)throw new Error("inputSize must be 1 for this data size");if(1!==this.outputSize)throw new Error("outputSize must be 1 for this data size");for(var e=0;e<t.length;e++)r.push(Float32Array.from([t[e]]));return[r];case"array,array,number":if(1===this.inputSize&&1===this.outputSize){for(var u=0;u<t.length;u++)r.push((0,O.arrayToFloat32Arrays)(t[u]));return r}if(this.inputSize!==t[0].length)throw new Error("inputSize must match data input size");if(this.outputSize!==t[0].length)throw new Error("outputSize must match data input size");for(var n=0;n<t.length;n++)r.push(Float32Array.from(t[n]));return[r];case"array,object,number":if(1!==this.inputSize)throw new Error("inputSize must be 1 for this data size");if(1!==this.outputSize)throw new Error("outputSize must be 1 for this data size");if(!this.inputLookup){var a=new L.default(t);this.inputLookup=this.outputLookup=a.table,this.inputLookupLength=this.outputLookupLength=a.length}for(var o=0;o<t.length;o++)r.push((0,O.objectToFloat32Arrays)(t[o]));return r;case"array,datum,array,number":if(1!==this.inputSize)throw new Error("inputSize must be 1 for this data size");if(1!==this.outputSize)throw new Error("outputSize must be 1 for this data size");for(var i=0;i<t.length;i++){var s=t[i];r.push({input:(0,O.arrayToFloat32Arrays)(s.input),output:(0,O.arrayToFloat32Arrays)(s.output)})}return r;case"array,datum,object,number":if(1!==this.inputSize)throw new Error("inputSize must be 1 for this data size");if(1!==this.outputSize)throw new Error("outputSize must be 1 for this data size");if(!this.inputLookup){var p=new L.default(t,"input");this.inputLookup=p.table,this.inputLookupLength=p.length}if(!this.outputLookup){var h=new L.default(t,"output");this.outputLookup=h.table,this.outputLookupLength=h.length}for(var l=0;l<t.length;l++){var f=t[l];r.push({input:(0,O.objectToFloat32Arrays)(f.input),output:(0,O.objectToFloat32Arrays)(f.output)})}return r;case"array,array,array,number":for(var c=0;c<t.length;c++)r.push((0,O.arraysToFloat32Arrays)(t[c]));return r;case"array,array,object,number":if(!this.inputLookup){var d=new L.default(t);this.inputLookup=this.outputLookup=d.table,this.inputLookupLength=this.outputLookupLength=d.length}for(var g=0;g<t.length;g++){for(var v=[],y=0;y<t[g].length;y++)v.push((0,O.objectToFloat32Array)(t[g][y],this.inputLookup,this.inputLookupLength));r.push(v)}return r;case"array,datum,array,array,number":if(1===this.inputSize&&1===this.outputSize)for(var b=0;b<t.length;b++){var m=t[b];r.push({input:Float32Array.from(m.input),output:Float32Array.from(m.output)})}else{if(this.inputSize!==t[0].input[0].length)throw new Error("inputSize must match data input size");if(this.outputSize!==t[0].output[0].length)throw new Error("outputSize must match data output size");for(var w=0;w<t.length;w++){var j=t[w];r.push({input:(0,O.arraysToFloat32Arrays)(j.input),output:(0,O.arraysToFloat32Arrays)(j.output)})}}return r;case"array,datum,array,object,number":if(!this.inputLookup){var z=new S.default(t,"input");this.inputLookup=z.table,this.inputLookupLength=z.length}if(!this.outputLookup){var q=new S.default(t,"output");this.outputLookup=q.table,this.outputLookupLength=q.length}for(var I=0;I<t.length;I++){var E=t[I];r.push({input:(0,O.objectsToFloat32Arrays)(E.input,this.inputLookup,this.inputLookupLength),output:(0,O.objectsToFloat32Arrays)(E.output,this.outputLookup,this.outputLookupLength)})}return r;default:throw new Error("unknown data shape or configuration")}}},{key:"test",value:function(t){var r=this.formatData(t),e=[],u=0;switch(k.default.dataShape(t).join(",")){case"array,array,number":if(1===this.inputSize){for(var n=0;n<r.length;n++){var a=r[n],o=this.run(a.splice(0,a.length-1)),i=a[a.length-1][0]-o,s=i*i;if(u+=s,Math.abs(s)>this.trainOpts.errorThresh){var p=t[n];Object.assign(p,{value:a,actual:o}),e.push(p)}}break}throw new Error("unknown data shape or configuration");case"array,array,array,number":for(var h=0;h<r.length;h++){for(var l=r[h],f=this.run(l.splice(0,l.length-1)),c=l[l.length-1],d=0,g=0,v=0;v<f.length;v++){g++;var y=c[v]-f[v];d+=y*y}if(u+=d/g,Math.abs(d)>this.trainOpts.errorThresh){var b=t[h];e.push({value:b,actual:f})}}break;case"array,object,number":for(var m=0;m<r.length;m++){var L=r[m],w=this.run(k.default.toObjectPartial(this.outputLookup,L,0,L.length-1)),S=L[L.length-1],O=0,j=void 0;for(j in w);var z=S[m]-w[j];if(u+=O+=z*z,Math.abs(O)>this.trainOpts.errorThresh){var q=t[m];e.push({value:q,actual:w})}}break;case"array,array,object,number":for(var I=0;I<r.length;I++){var E=r[I],A=this.run(E.slice(0,E.length-1)),x=t[I][E.length-1],N=0,T=0;for(var F in A){var _=x[F]-A[F];N+=_*_,T++}if(u+=N/T,Math.abs(N)>this.trainOpts.errorThresh){var M=t[I];e.push({value:M,actual:A})}}break;case"array,datum,array,number":case"array,datum,object,number":for(var C=0;C<r.length;C++){for(var P=r[C],J=this.forecast(P.input,P.output.length),D=0,R=0,K=0;K<J.length;K++){var H=P.output[K][0]-J[K];D+=H*H,R++}if(u+=D/R,Math.abs(D)>this.trainOpts.errorThresh){var V=t[C];Object.assign(V,{actual:this.outputLookup?k.default.toObject(this.outputLookup,J):J}),e.push(V)}}break;case"array,datum,array,array,number":for(var Z=0;Z<r.length;Z++){for(var B=r[Z],G=this.forecast(B.input,B.output.length),Q=0,U=0;U<G.length;U++)for(var W=0;W<G[U].length;W++){var X=B.output[U][W]-G[U][W];Q+=X*X}if(u+=Q,Math.abs(Q)>this.trainOpts.errorThresh){var Y=t[Z];e.push({input:Y.input,output:Y.output,actual:G})}}break;case"array,datum,array,object,number":for(var $=0;$<r.length;$++){for(var tt=r[$],rt=this.forecast(tt.input,tt.output.length),et=0,ut=0;ut<rt.length;ut++)for(var nt in rt[ut]){var at=t[$].output[ut][nt]-rt[ut][nt];et+=at*at}if(u+=et,Math.abs(et)>this.trainOpts.errorThresh){var ot=t[$];e.push({input:ot.input,output:ot.output,actual:rt})}}break;default:throw new Error("unknown data shape or configuration")}return{error:u/r.length,misclasses:e,total:r.length}}},{key:"addFormat",value:function(t){switch(k.default.dataShape(t).join(",")){case"array,array,number":case"datum,array,array,number":case"array,number":case"datum,array,number":return;case"datum,object,number":this.inputLookup=k.default.addKeys(t.input,this.inputLookup),this.inputLookup&&(this.inputLookupLength=Object.keys(this.inputLookup).length),this.outputLookup=k.default.addKeys(t.output,this.outputLookup),this.outputLookup&&(this.outputLookupLength=Object.keys(this.outputLookup).length);break;case"object,number":this.inputLookup=this.outputLookup=k.default.addKeys(t,this.inputLookup),this.inputLookup&&(this.inputLookupLength=this.outputLookupLength=Object.keys(this.inputLookup).length);break;case"array,object,number":for(var r=0;r<t.length;r++)this.inputLookup=this.outputLookup=k.default.addKeys(t[r],this.inputLookup),this.inputLookup&&(this.inputLookupLength=this.outputLookupLength=Object.keys(this.inputLookup).length);break;case"datum,array,object,number":for(var e=0;e<t.input.length;e++)this.inputLookup=k.default.addKeys(t.input[e],this.inputLookup),this.inputLookup&&(this.inputLookupLength=Object.keys(this.inputLookup).length);for(var u=0;u<t.output.length;u++)this.outputLookup=k.default.addKeys(t.output[u],this.outputLookup),this.outputLookup&&(this.outputLookupLength=Object.keys(this.outputLookup).length);break;default:throw new Error("unknown data shape or configuration")}}},{key:"toJSON",value:function(){var t=this.constructor.defaults;this.model||this.initialize();var r=this.model,e={};for(var u in t)t.hasOwnProperty(u)&&(e[u]=this[u]);return{type:this.constructor.name,options:e,hiddenLayers:r.hiddenLayers.map(function(t){var r={};for(var e in t)r[e]=t[e].toJSON();return r}),outputConnector:this.model.outputConnector.toJSON(),output:this.model.output.toJSON()}}},{key:"fromJSON",value:function(t){var r=this.constructor.defaults,u=t.options;this.model=null,this.hiddenLayers=null;var n=[],a=[];(t.hiddenLayers||t.hiddenSizes).forEach(function(t){var r={};for(var u in t)r[u]=e.default.fromJSON(t[u]),n.push(r[u]);a.push(r)});var o=e.default.fromJSON(t.outputConnector);n.push(o);var i=e.default.fromJSON(t.output);n.push(i),Object.assign(this,r,u),u.hiddenSizes&&(this.hiddenLayers=u.hiddenSizes),this.model={hiddenLayers:a,output:i,allMatrices:n,outputConnector:o,equations:[],equationConnections:[]},this.initialLayerInputs=this.hiddenLayers.map(function(t){return new e.default(t,1)}),this.bindEquation()}},{key:"toFunction",value:function(){var t=this.model,r=this.model.equations,e=this.inputSize,u=this.inputLookup,n=this.inputLookupLength,a=this.outputLookup,o=this.outputLookupLength,i=r[1].states,s=JSON.stringify(this.toJSON());function p(e){for(var u=t.equationConnections[0],n=r[0].states,a=0,o=n.length;a<o;a++)if(n[a].product===e)return a;return u.indexOf(e)}function l(r,e){if(!r||!r.rows||!r.columns)return"null";if(r===t.outputConnector)return"json.outputConnector";if(r===t.output)return"json.output";for(var u=0,n=t.hiddenLayers.length;u<n;u++){var a=t.hiddenLayers[u];for(var o in a)if(a.hasOwnProperty(o)&&a[o]===r)return"json.hiddenLayers["+u+"]."+o}return function(t,r){for(var e=0,u=i.length;e<u;e++){var n=i[e];if(e===r){var a=p(t);switch(t){case n.left:if(a>-1)return"typeof prevStates["+a+"] === 'object' ? prevStates["+a+"].product : new Matrix("+t.rows+", "+t.columns+")";case n.right:if(a>-1)return"typeof prevStates["+a+"] === 'object' ? prevStates["+a+"].product : new Matrix("+t.rows+", "+t.columns+")";case n.product:return"new Matrix("+t.rows+", "+t.columns+")";default:throw Error("unknown state")}}if(t===n.product)return"states["+e+"].product";if(t===n.right)return"states["+e+"].right";if(t===n.left)return"states["+e+"].left"}}(r,e)}function d(t){return"src/recurrent/matrix/"+t.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})+".js"}for(var v,b=[],k={},m=[],L=0,w=i.length;L<w;L++){var S=i[L];b.push("states["+L+"] = {\n      name: '"+S.forwardFn.name+"',\n      left: "+l(S.left,L)+",\n      right: "+l(S.right,L)+",\n      product: "+l(S.product,L)+"\n    }");var O=S.forwardFn.name;k[O]||(k[O]=!0,m.push("        case '"+O+"':"+("forwardFn"!==O?" //compiled from "+d(O):"")+"\n          "+((v=(v=S.forwardFn.toString()).toString().split("{")).shift(),(v=(v=v.join("{")).split("}")).pop(),v.join("}").split("\n").join("\n        ").replace("product.weights = _input.weights = _this.inputValue;",u&&1===e?"product.weights = _i < input.length ? input[_i]: prevStates[prevStates.length - 1].product.weights;":1===e?"product.weights = [input[_i]];":"product.weights = input[_i];").replace("product.deltas[i] = 0;","").replace("product.deltas[column] = 0;","").replace("left.deltas[leftIndex] = 0;","").replace("right.deltas[rightIndex] = 0;","").replace("product.deltas = left.deltas.slice(0);",""))+"\n          break;"))}var j=1===this.inputSize&&this.outputLookup,z="\n  var input = "+(this.inputLookup?"lookupInput(rawInput)":"rawInput")+";\n  var json = "+s+";\n  var output = [];\n  var states = [];\n  var prevStates;\n  var state;\n  var max = "+(j?u===a?n:"input.length + "+(o-1):"input.length")+";\n  for (var _i = 0; _i < max; _i++) {\n    prevStates = states;\n    states = [];\n    "+b.join(";\n    ")+";\n    for (var stateIndex = 0, stateMax = "+b.length+"; stateIndex < stateMax; stateIndex++) {\n      state = states[stateIndex];\n      var product = state.product;\n      var left = state.left;\n      var right = state.right;\n      \n      switch (state.name) {\n"+m.join("\n")+"\n      }\n    }\n    "+(1===e&&u?"if (_i >= input.length - 1) { output.push(state.product.weights); }":"output = state.product.weights;")+"\n  }\n  "+(a?a===u?"return lookupOutputPartial(output, input)":"return lookupOutput(output)":1===e?"return output[0]":"return output")+";\n  "+(u?1===e?u===a?"function lookupInput(input) {\n            var table = "+JSON.stringify(u)+";\n            var result = [];\n            for (var p in table) {\n              if (!input.hasOwnProperty(p)) break;\n              result.push(Float32Array.from([input[p]]));\n            }\n            return result;\n          }":"function lookupInput(input) {\n          var table = "+JSON.stringify(u)+";\n          var result = [];\n          for (var p in table) {\n            result.push(Float32Array.from([input[p]]));\n          }\n          return result;\n        }":"function lookupInput(rawInputs) {\n        var table = "+JSON.stringify(u)+";\n        var result = [];\n        for (var i = 0; i < rawInputs.length; i++) {\n          var rawInput = rawInputs[i];\n          var input = new Float32Array("+n+");\n          for (var p in table) {\n            input[table[p]] = rawInput.hasOwnProperty(p) ? rawInput[p] : 0;\n          }\n          result.push(input);\n        }\n        return result;\n      }":"")+"\n  "+(a?1===e?u===a?"function lookupOutputPartial(output, input) {\n            var table = "+JSON.stringify(a)+";\n            var offset = input.length;\n            var result = {};\n            var i = 0;\n            for (var p in table) {\n              if (i++ < offset) continue;\n              result[p] = output[table[p] - offset][0];\n            }\n            return result;\n          }":"function lookupOutput(output) {\n          var table = "+JSON.stringify(a)+";\n          var result = {};\n          for (var p in table) {\n            result[p] = output[table[p]][0];\n          }\n          return result;\n        }":"function lookupOutput(output) {\n        var table = "+JSON.stringify(a)+";\n        var result = {};\n        for (var p in table) {\n          result[p] = output[table[p]];\n        }\n        return result;\n      }":"")+"\n  \n  function Matrix(rows, columns) {\n    this.rows = rows;\n    this.columns = columns;\n    this.weights = zeros(rows * columns);\n  }\n  "+h.default.toString()+"\n  "+f.default.toString().replace("_2.default","Matrix")+"\n  "+c.randomF.toString()+"\n  "+g.default.toString()+"\n  "+y.default.toString();return new Function("rawInput",z)}}]),u}();exports.default=E,E.defaults={inputSize:1,hiddenLayers:[20],outputSize:1,learningRate:s.default.defaults.learningRate,decayRate:s.default.defaults.decayRate,smoothEps:s.default.defaults.smoothEps,regc:s.default.defaults.regc,clipval:s.default.defaults.clipval},E.trainDefaults=s.default.trainDefaults;
},{"./matrix":"5VZ1","./matrix/random-matrix":"QYqF","./matrix/equation":"+UBx","./rnn":"shri","../utilities/zeros":"+tZN","./matrix/softmax":"/hSy","../utilities/random":"jP/8","./matrix/sample-i":"MAFD","./matrix/max-i":"jQfN","../lookup":"yeLe","../utilities/lookup-table":"0FXz","../utilities/array-lookup-table":"HKVg","../utilities/cast":"e5ew"}],"ZR5/":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),e=require("./matrix"),n=a(e),i=require("./matrix/random-matrix"),r=a(i),u=require("./rnn"),o=a(u);function a(t){return t&&t.__esModule?t:{default:t}}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function d(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var c=function(e){function i(){return l(this,i),f(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return d(i,o.default),t(i,[{key:"getModel",value:function(t,e){return{inputMatrix:new r.default(t,e,.08),inputHidden:new r.default(t,t,.08),inputBias:new n.default(t,1),forgetMatrix:new r.default(t,e,.08),forgetHidden:new r.default(t,t,.08),forgetBias:new n.default(t,1),outputMatrix:new r.default(t,e,.08),outputHidden:new r.default(t,t,.08),outputBias:new n.default(t,1),cellActivationMatrix:new r.default(t,e,.08),cellActivationHidden:new r.default(t,t,.08),cellActivationBias:new n.default(t,1)}}},{key:"getEquation",value:function(t,e,n,i){var r=t.sigmoid.bind(t),u=t.add.bind(t),o=t.multiply.bind(t),a=t.multiplyElement.bind(t),l=t.tanh.bind(t),f=r(u(u(o(i.inputMatrix,e),o(i.inputHidden,n)),i.inputBias)),d=r(u(u(o(i.forgetMatrix,e),o(i.forgetHidden,n)),i.forgetBias)),c=r(u(u(o(i.outputMatrix,e),o(i.outputHidden,n)),i.outputBias)),p=l(u(u(o(i.cellActivationMatrix,e),o(i.cellActivationHidden,n)),i.cellActivationBias)),s=a(d,n),b=a(f,p);return a(c,l(u(s,b)))}}]),i}();exports.default=c;
},{"./matrix":"5VZ1","./matrix/random-matrix":"QYqF","./rnn":"shri"}],"4nuY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),t=require("./matrix"),r=a(t),n=require("./lstm"),o=a(n),u=require("./rnn-time-step"),i=a(u);function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var p=function(t){function r(){return l(this,r),f(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return c(r,i.default),e(r,[{key:"getModel",value:function(e,t){return o.default.prototype.getModel.call(this,e,t)}},{key:"getEquation",value:function(e,t,r,n){return o.default.prototype.getEquation.call(this,e,t,r,n)}}]),r}();exports.default=p;
},{"./matrix":"5VZ1","./lstm":"ZR5/","./rnn-time-step":"YhFz"}],"7k2v":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),t=require("./matrix"),n=o(t),r=require("./matrix/random-matrix"),a=o(r),i=require("./rnn"),u=o(i);function o(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=function(t){function r(){return l(this,r),d(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return f(r,u.default),e(r,[{key:"getModel",value:function(e,t){return{updateGateInputMatrix:new a.default(e,t,.08),updateGateHiddenMatrix:new a.default(e,e,.08),updateGateBias:new n.default(e,1),resetGateInputMatrix:new a.default(e,t,.08),resetGateHiddenMatrix:new a.default(e,e,.08),resetGateBias:new n.default(e,1),cellWriteInputMatrix:new a.default(e,t,.08),cellWriteHiddenMatrix:new a.default(e,e,.08),cellWriteBias:new n.default(e,1)}}},{key:"getEquation",value:function(e,t,n,r){var a=e.sigmoid.bind(e),i=e.add.bind(e),u=e.multiply.bind(e),o=e.multiplyElement.bind(e),l=e.tanh.bind(e),d=e.allOnes.bind(e),f=e.cloneNegative.bind(e),c=a(i(i(u(r.updateGateInputMatrix,t),u(r.updateGateHiddenMatrix,n)),r.updateGateBias)),p=a(i(i(u(r.resetGateInputMatrix,t),u(r.resetGateHiddenMatrix,n)),r.resetGateBias)),s=l(i(i(u(r.cellWriteInputMatrix,t),u(r.cellWriteHiddenMatrix,o(p,n))),r.cellWriteBias));return i(o(i(d(c.rows,c.columns),f(c)),s),o(n,c))}}]),r}();exports.default=c;
},{"./matrix":"5VZ1","./matrix/random-matrix":"QYqF","./rnn":"shri"}],"tvif":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),t=require("./matrix"),r=a(t),n=require("./gru"),o=a(n),u=require("./rnn-time-step"),i=a(u);function a(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var p=function(t){function r(){return f(this,r),c(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return l(r,i.default),e(r,[{key:"getModel",value:function(e,t){return o.default.prototype.getModel(e,t)}},{key:"getEquation",value:function(e,t,r,n){return o.default.prototype.getEquation(e,t,r,n)}}]),r}();exports.default=p;
},{"./matrix":"5VZ1","./gru":"7k2v","./rnn-time-step":"YhFz"}],"ZVUl":[function(require,module,exports) {
"use strict";function t(t){if(Array.isArray(t)){for(var i=0,e=Array(t.length);i<t.length;i++)e[i]=t[i];return e}return Array.from(t)}function i(i,e){var r="number"==typeof i.inputSize&&"number"==typeof i.outputSize&&i.inputSize>0&&i.outputSize>0&&[i.inputSize].concat(t(i.hiddenLayers),[i.outputSize]);if((e=Object.assign({line:{width:"0.5",color:"black"},inputs:{color:"rgba(0, 128, 0, 0.5)",label:!1},outputs:{color:"rgba(100, 149, 237, 0.5)"},hidden:{color:"rgba(255, 127, 80, 0.5)"},fontSize:"14px",radius:"8",width:"400",height:"250"},e)).inputs.label=e.inputs.label.length==i.inputSize&&e.inputs.label,r){var l='<svg  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="'+e.width+'" height="'+e.height+'">',o=e.width/r.length;return r.forEach(function(i,n){var s=e.height/i;[].concat(t(Array(i))).forEach(function(t,i){if(0==n)l+='<rect x="'+(o/2-e.radius)+'" y="'+(s/2+i*s-e.radius)+'" width="'+2*e.radius+'" height="'+2*e.radius+'" stroke="black" stroke-width="1" fill="'+e.inputs.color+'" />',l+='<line x1="'+o/4+'" y1="'+(s/2+i*s)+'" x2="'+(o/2-e.radius)+'" y2="'+(s/2+i*s)+'" style="stroke:'+e.line.color+";stroke-width:"+e.line.width+'" />',e.inputs.label&&(l+='<text x="'+o/8+'" y="'+(s/2+i*s-5)+'" fill="black" font-size= "'+e.fontSize+'">'+e.inputs.label[i]+"</text>");else{var u=e.height/r[n-1];n==r.length-1?(l+='<circle cx="'+(o/2+n*o)+'" cy="'+(s/2+i*s)+'" r="'+e.radius+'" stroke="black" stroke-width="1" fill="'+e.outputs.color+'" />',l+='<line x1="'+(o/2+n*o+e.radius)+'" y1="'+(s/2+i*s)+'" x2="'+(o/2+n*o+o/4)+'" y2="'+(s/2+i*s)+'" style="stroke:'+e.line.color+";stroke-width:"+e.line.width+'" />'):l+='<circle cx="'+(o/2+n*o)+'" cy="'+(s/2+i*s)+'" r="'+e.radius+'" stroke="black" stroke-width="1" fill="'+e.hidden.color+'" />';for(var a=0;a<r[n-1];a++)l+='<line x1="'+(o/2+(n-1)*o+e.radius)+'" y1="'+(u/2+a*u)+'" x2="'+(o/2+n*o-e.radius)+'" y2="'+(s/2+i*s)+'" style="stroke:'+e.line.color+";stroke-width:"+e.line.width+'" />'}})}),l+="</svg>"}return!1}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=i;
},{}],"SDL3":[function(require,module,exports) {
var e=require("./dist/cross-validate").default,t=require("./dist/likely").default,r=require("./dist/lookup").default,i=require("./dist/neural-network").default,u=require("./dist/neural-network-gpu").default,d=require("./dist/train-stream").default,a=require("./dist/recurrent/rnn-time-step").default,s=require("./dist/recurrent/lstm-time-step").default,l=require("./dist/recurrent/gru-time-step").default,n=require("./dist/recurrent/rnn").default,o=require("./dist/recurrent/lstm").default,f=require("./dist/recurrent/gru").default,q={max:require("./dist/utilities/max").default,mse:require("./dist/utilities/mse").default,ones:require("./dist/utilities/ones").default,random:require("./dist/utilities/random").default,randomWeight:require("./dist/utilities/random-weight").default,randos:require("./dist/utilities/randos").default,range:require("./dist/utilities/range").default,toArray:require("./dist/utilities/to-array").default,DataFormatter:require("./dist/utilities/data-formatter").default,zeros:require("./dist/utilities/zeros").default,toSVG:require("./dist/utilities/to-svg").default},m={CrossValidate:e,likely:t,lookup:r,NeuralNetwork:i,NeuralNetworkGPU:u,TrainStream:d,recurrent:{RNNTimeStep:a,LSTMTimeStep:s,GRUTimeStep:l,RNN:n,LSTM:o,GRU:f},utilities:q};"undefined"!=typeof window&&(window.brain=m),"undefined"!=typeof self&&(self.brain=m),"undefined"!=typeof module&&(module.exports=m);
},{"./dist/cross-validate":"Ebwv","./dist/likely":"qNqL","./dist/lookup":"yeLe","./dist/neural-network":"23dQ","./dist/neural-network-gpu":"b1xI","./dist/train-stream":"ANm2","./dist/recurrent/rnn-time-step":"YhFz","./dist/recurrent/lstm-time-step":"4nuY","./dist/recurrent/gru-time-step":"tvif","./dist/recurrent/rnn":"shri","./dist/recurrent/lstm":"ZR5/","./dist/recurrent/gru":"7k2v","./dist/utilities/max":"ZRo8","./dist/utilities/mse":"Ukn7","./dist/utilities/ones":"Kn+K","./dist/utilities/random":"jP/8","./dist/utilities/random-weight":"lbYT","./dist/utilities/randos":"wZ0Y","./dist/utilities/range":"zU45","./dist/utilities/to-array":"p2fr","./dist/utilities/data-formatter":"F1mg","./dist/utilities/zeros":"+tZN","./dist/utilities/to-svg":"ZVUl"}],"4HJa":[function(require,module,exports) {
var global = arguments[3];
var Buffer = require("buffer").Buffer;
var define;
var n,t=arguments[3],r=require("buffer").Buffer;(function(){var r,e=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",i="Expected a function",o="__lodash_hash_undefined__",f=500,a="__lodash_placeholder__",c=1,l=2,s=4,h=1,p=2,v=1,_=2,g=4,y=8,d=16,b=32,w=64,m=128,x=256,j=512,A=30,k="...",O=800,I=16,R=1,E=2,z=1/0,S=9007199254740991,L=1.7976931348623157e308,W=NaN,C=4294967295,B=C-1,U=C>>>1,T=[["ary",m],["bind",v],["bindKey",_],["curry",y],["curryRight",d],["flip",j],["partial",b],["partialRight",w],["rearg",x]],$="[object Arguments]",D="[object Array]",M="[object AsyncFunction]",F="[object Boolean]",N="[object Date]",P="[object DOMException]",q="[object Error]",Z="[object Function]",K="[object GeneratorFunction]",V="[object Map]",G="[object Number]",H="[object Null]",J="[object Object]",Y="[object Proxy]",Q="[object RegExp]",X="[object Set]",nn="[object String]",tn="[object Symbol]",rn="[object Undefined]",en="[object WeakMap]",un="[object WeakSet]",on="[object ArrayBuffer]",fn="[object DataView]",an="[object Float32Array]",cn="[object Float64Array]",ln="[object Int8Array]",sn="[object Int16Array]",hn="[object Int32Array]",pn="[object Uint8Array]",vn="[object Uint8ClampedArray]",_n="[object Uint16Array]",gn="[object Uint32Array]",yn=/\b__p \+= '';/g,dn=/\b(__p \+=) '' \+/g,bn=/(__e\(.*?\)|\b__t\)) \+\n'';/g,wn=/&(?:amp|lt|gt|quot|#39);/g,mn=/[&<>"']/g,xn=RegExp(wn.source),jn=RegExp(mn.source),An=/<%-([\s\S]+?)%>/g,kn=/<%([\s\S]+?)%>/g,On=/<%=([\s\S]+?)%>/g,In=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Rn=/^\w*$/,En=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,zn=/[\\^$.*+?()[\]{}|]/g,Sn=RegExp(zn.source),Ln=/^\s+|\s+$/g,Wn=/^\s+/,Cn=/\s+$/,Bn=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Un=/\{\n\/\* \[wrapped with (.+)\] \*/,Tn=/,? & /,$n=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Dn=/\\(\\)?/g,Mn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Fn=/\w*$/,Nn=/^[-+]0x[0-9a-f]+$/i,Pn=/^0b[01]+$/i,qn=/^\[object .+?Constructor\]$/,Zn=/^0o[0-7]+$/i,Kn=/^(?:0|[1-9]\d*)$/,Vn=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Gn=/($^)/,Hn=/['\n\r\u2028\u2029\\]/g,Jn="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Yn="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Qn="[\\ud800-\\udfff]",Xn="["+Yn+"]",nt="["+Jn+"]",tt="\\d+",rt="[\\u2700-\\u27bf]",et="[a-z\\xdf-\\xf6\\xf8-\\xff]",ut="[^\\ud800-\\udfff"+Yn+tt+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",it="\\ud83c[\\udffb-\\udfff]",ot="[^\\ud800-\\udfff]",ft="(?:\\ud83c[\\udde6-\\uddff]){2}",at="[\\ud800-\\udbff][\\udc00-\\udfff]",ct="[A-Z\\xc0-\\xd6\\xd8-\\xde]",lt="(?:"+et+"|"+ut+")",st="(?:"+ct+"|"+ut+")",ht="(?:"+nt+"|"+it+")"+"?",pt="[\\ufe0e\\ufe0f]?"+ht+("(?:\\u200d(?:"+[ot,ft,at].join("|")+")[\\ufe0e\\ufe0f]?"+ht+")*"),vt="(?:"+[rt,ft,at].join("|")+")"+pt,_t="(?:"+[ot+nt+"?",nt,ft,at,Qn].join("|")+")",gt=RegExp("['’]","g"),yt=RegExp(nt,"g"),dt=RegExp(it+"(?="+it+")|"+_t+pt,"g"),bt=RegExp([ct+"?"+et+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[Xn,ct,"$"].join("|")+")",st+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[Xn,ct+lt,"$"].join("|")+")",ct+"?"+lt+"+(?:['’](?:d|ll|m|re|s|t|ve))?",ct+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",tt,vt].join("|"),"g"),wt=RegExp("[\\u200d\\ud800-\\udfff"+Jn+"\\ufe0e\\ufe0f]"),mt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,xt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],jt=-1,At={};At[an]=At[cn]=At[ln]=At[sn]=At[hn]=At[pn]=At[vn]=At[_n]=At[gn]=!0,At[$]=At[D]=At[on]=At[F]=At[fn]=At[N]=At[q]=At[Z]=At[V]=At[G]=At[J]=At[Q]=At[X]=At[nn]=At[en]=!1;var kt={};kt[$]=kt[D]=kt[on]=kt[fn]=kt[F]=kt[N]=kt[an]=kt[cn]=kt[ln]=kt[sn]=kt[hn]=kt[V]=kt[G]=kt[J]=kt[Q]=kt[X]=kt[nn]=kt[tn]=kt[pn]=kt[vn]=kt[_n]=kt[gn]=!0,kt[q]=kt[Z]=kt[en]=!1;var Ot={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},It=parseFloat,Rt=parseInt,Et="object"==typeof t&&t&&t.Object===Object&&t,zt="object"==typeof self&&self&&self.Object===Object&&self,St=Et||zt||Function("return this")(),Lt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Wt=Lt&&"object"==typeof module&&module&&!module.nodeType&&module,Ct=Wt&&Wt.exports===Lt,Bt=Ct&&Et.process,Ut=function(){try{var n=Wt&&Wt.require&&Wt.require("util").types;return n||Bt&&Bt.binding&&Bt.binding("util")}catch(t){}}(),Tt=Ut&&Ut.isArrayBuffer,$t=Ut&&Ut.isDate,Dt=Ut&&Ut.isMap,Mt=Ut&&Ut.isRegExp,Ft=Ut&&Ut.isSet,Nt=Ut&&Ut.isTypedArray;function Pt(n,t,r){switch(r.length){case 0:return n.call(t);case 1:return n.call(t,r[0]);case 2:return n.call(t,r[0],r[1]);case 3:return n.call(t,r[0],r[1],r[2])}return n.apply(t,r)}function qt(n,t,r,e){for(var u=-1,i=null==n?0:n.length;++u<i;){var o=n[u];t(e,o,r(o),n)}return e}function Zt(n,t){for(var r=-1,e=null==n?0:n.length;++r<e&&!1!==t(n[r],r,n););return n}function Kt(n,t){for(var r=null==n?0:n.length;r--&&!1!==t(n[r],r,n););return n}function Vt(n,t){for(var r=-1,e=null==n?0:n.length;++r<e;)if(!t(n[r],r,n))return!1;return!0}function Gt(n,t){for(var r=-1,e=null==n?0:n.length,u=0,i=[];++r<e;){var o=n[r];t(o,r,n)&&(i[u++]=o)}return i}function Ht(n,t){return!!(null==n?0:n.length)&&ir(n,t,0)>-1}function Jt(n,t,r){for(var e=-1,u=null==n?0:n.length;++e<u;)if(r(t,n[e]))return!0;return!1}function Yt(n,t){for(var r=-1,e=null==n?0:n.length,u=Array(e);++r<e;)u[r]=t(n[r],r,n);return u}function Qt(n,t){for(var r=-1,e=t.length,u=n.length;++r<e;)n[u+r]=t[r];return n}function Xt(n,t,r,e){var u=-1,i=null==n?0:n.length;for(e&&i&&(r=n[++u]);++u<i;)r=t(r,n[u],u,n);return r}function nr(n,t,r,e){var u=null==n?0:n.length;for(e&&u&&(r=n[--u]);u--;)r=t(r,n[u],u,n);return r}function tr(n,t){for(var r=-1,e=null==n?0:n.length;++r<e;)if(t(n[r],r,n))return!0;return!1}var rr=cr("length");function er(n,t,r){var e;return r(n,function(n,r,u){if(t(n,r,u))return e=r,!1}),e}function ur(n,t,r,e){for(var u=n.length,i=r+(e?1:-1);e?i--:++i<u;)if(t(n[i],i,n))return i;return-1}function ir(n,t,r){return t==t?function(n,t,r){var e=r-1,u=n.length;for(;++e<u;)if(n[e]===t)return e;return-1}(n,t,r):ur(n,fr,r)}function or(n,t,r,e){for(var u=r-1,i=n.length;++u<i;)if(e(n[u],t))return u;return-1}function fr(n){return n!=n}function ar(n,t){var r=null==n?0:n.length;return r?hr(n,t)/r:W}function cr(n){return function(t){return null==t?r:t[n]}}function lr(n){return function(t){return null==n?r:n[t]}}function sr(n,t,r,e,u){return u(n,function(n,u,i){r=e?(e=!1,n):t(r,n,u,i)}),r}function hr(n,t){for(var e,u=-1,i=n.length;++u<i;){var o=t(n[u]);o!==r&&(e=e===r?o:e+o)}return e}function pr(n,t){for(var r=-1,e=Array(n);++r<n;)e[r]=t(r);return e}function vr(n){return function(t){return n(t)}}function _r(n,t){return Yt(t,function(t){return n[t]})}function gr(n,t){return n.has(t)}function yr(n,t){for(var r=-1,e=n.length;++r<e&&ir(t,n[r],0)>-1;);return r}function dr(n,t){for(var r=n.length;r--&&ir(t,n[r],0)>-1;);return r}var br=lr({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),wr=lr({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function mr(n){return"\\"+Ot[n]}function xr(n){return wt.test(n)}function jr(n){var t=-1,r=Array(n.size);return n.forEach(function(n,e){r[++t]=[e,n]}),r}function Ar(n,t){return function(r){return n(t(r))}}function kr(n,t){for(var r=-1,e=n.length,u=0,i=[];++r<e;){var o=n[r];o!==t&&o!==a||(n[r]=a,i[u++]=r)}return i}function Or(n){var t=-1,r=Array(n.size);return n.forEach(function(n){r[++t]=n}),r}function Ir(n){var t=-1,r=Array(n.size);return n.forEach(function(n){r[++t]=[n,n]}),r}function Rr(n){return xr(n)?function(n){var t=dt.lastIndex=0;for(;dt.test(n);)++t;return t}(n):rr(n)}function Er(n){return xr(n)?function(n){return n.match(dt)||[]}(n):function(n){return n.split("")}(n)}var zr=lr({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Sr=function n(t){var Jn,Yn=(t=null==t?St:Sr.defaults(St.Object(),t,Sr.pick(St,xt))).Array,Qn=t.Date,Xn=t.Error,nt=t.Function,tt=t.Math,rt=t.Object,et=t.RegExp,ut=t.String,it=t.TypeError,ot=Yn.prototype,ft=nt.prototype,at=rt.prototype,ct=t["__core-js_shared__"],lt=ft.toString,st=at.hasOwnProperty,ht=0,pt=(Jn=/[^.]+$/.exec(ct&&ct.keys&&ct.keys.IE_PROTO||""))?"Symbol(src)_1."+Jn:"",vt=at.toString,_t=lt.call(rt),dt=St._,wt=et("^"+lt.call(st).replace(zn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ot=Ct?t.Buffer:r,Et=t.Symbol,zt=t.Uint8Array,Lt=Ot?Ot.allocUnsafe:r,Wt=Ar(rt.getPrototypeOf,rt),Bt=rt.create,Ut=at.propertyIsEnumerable,rr=ot.splice,lr=Et?Et.isConcatSpreadable:r,Lr=Et?Et.iterator:r,Wr=Et?Et.toStringTag:r,Cr=function(){try{var n=$i(rt,"defineProperty");return n({},"",{}),n}catch(t){}}(),Br=t.clearTimeout!==St.clearTimeout&&t.clearTimeout,Ur=Qn&&Qn.now!==St.Date.now&&Qn.now,Tr=t.setTimeout!==St.setTimeout&&t.setTimeout,$r=tt.ceil,Dr=tt.floor,Mr=rt.getOwnPropertySymbols,Fr=Ot?Ot.isBuffer:r,Nr=t.isFinite,Pr=ot.join,qr=Ar(rt.keys,rt),Zr=tt.max,Kr=tt.min,Vr=Qn.now,Gr=t.parseInt,Hr=tt.random,Jr=ot.reverse,Yr=$i(t,"DataView"),Qr=$i(t,"Map"),Xr=$i(t,"Promise"),ne=$i(t,"Set"),te=$i(t,"WeakMap"),re=$i(rt,"create"),ee=te&&new te,ue={},ie=lo(Yr),oe=lo(Qr),fe=lo(Xr),ae=lo(ne),ce=lo(te),le=Et?Et.prototype:r,se=le?le.valueOf:r,he=le?le.toString:r;function pe(n){if(Ef(n)&&!df(n)&&!(n instanceof ye)){if(n instanceof ge)return n;if(st.call(n,"__wrapped__"))return so(n)}return new ge(n)}var ve=function(){function n(){}return function(t){if(!Rf(t))return{};if(Bt)return Bt(t);n.prototype=t;var e=new n;return n.prototype=r,e}}();function _e(){}function ge(n,t){this.__wrapped__=n,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}function ye(n){this.__wrapped__=n,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=C,this.__views__=[]}function de(n){var t=-1,r=null==n?0:n.length;for(this.clear();++t<r;){var e=n[t];this.set(e[0],e[1])}}function be(n){var t=-1,r=null==n?0:n.length;for(this.clear();++t<r;){var e=n[t];this.set(e[0],e[1])}}function we(n){var t=-1,r=null==n?0:n.length;for(this.clear();++t<r;){var e=n[t];this.set(e[0],e[1])}}function me(n){var t=-1,r=null==n?0:n.length;for(this.__data__=new we;++t<r;)this.add(n[t])}function xe(n){var t=this.__data__=new be(n);this.size=t.size}function je(n,t){var r=df(n),e=!r&&yf(n),u=!r&&!e&&xf(n),i=!r&&!e&&!u&&Tf(n),o=r||e||u||i,f=o?pr(n.length,ut):[],a=f.length;for(var c in n)!t&&!st.call(n,c)||o&&("length"==c||u&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Zi(c,a))||f.push(c);return f}function Ae(n){var t=n.length;return t?n[mu(0,t-1)]:r}function ke(n,t){return fo(ri(n),Ce(t,0,n.length))}function Oe(n){return fo(ri(n))}function Ie(n,t,e){(e===r||vf(n[t],e))&&(e!==r||t in n)||Le(n,t,e)}function Re(n,t,e){var u=n[t];st.call(n,t)&&vf(u,e)&&(e!==r||t in n)||Le(n,t,e)}function Ee(n,t){for(var r=n.length;r--;)if(vf(n[r][0],t))return r;return-1}function ze(n,t,r,e){return De(n,function(n,u,i){t(e,n,r(n),i)}),e}function Se(n,t){return n&&ei(t,ia(t),n)}function Le(n,t,r){"__proto__"==t&&Cr?Cr(n,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):n[t]=r}function We(n,t){for(var e=-1,u=t.length,i=Yn(u),o=null==n;++e<u;)i[e]=o?r:na(n,t[e]);return i}function Ce(n,t,e){return n==n&&(e!==r&&(n=n<=e?n:e),t!==r&&(n=n>=t?n:t)),n}function Be(n,t,e,u,i,o){var f,a=t&c,h=t&l,p=t&s;if(e&&(f=i?e(n,u,i,o):e(n)),f!==r)return f;if(!Rf(n))return n;var v=df(n);if(v){if(f=function(n){var t=n.length,r=new n.constructor(t);return t&&"string"==typeof n[0]&&st.call(n,"index")&&(r.index=n.index,r.input=n.input),r}(n),!a)return ri(n,f)}else{var _=Fi(n),g=_==Z||_==K;if(xf(n))return Ju(n,a);if(_==J||_==$||g&&!i){if(f=h||g?{}:Pi(n),!a)return h?function(n,t){return ei(n,Mi(n),t)}(n,function(n,t){return n&&ei(t,oa(t),n)}(f,n)):function(n,t){return ei(n,Di(n),t)}(n,Se(f,n))}else{if(!kt[_])return i?n:{};f=function(n,t,r){var e,u,i,o=n.constructor;switch(t){case on:return Yu(n);case F:case N:return new o(+n);case fn:return function(n,t){var r=t?Yu(n.buffer):n.buffer;return new n.constructor(r,n.byteOffset,n.byteLength)}(n,r);case an:case cn:case ln:case sn:case hn:case pn:case vn:case _n:case gn:return Qu(n,r);case V:return new o;case G:case nn:return new o(n);case Q:return(i=new(u=n).constructor(u.source,Fn.exec(u))).lastIndex=u.lastIndex,i;case X:return new o;case tn:return e=n,se?rt(se.call(e)):{}}}(n,_,a)}}o||(o=new xe);var y=o.get(n);if(y)return y;if(o.set(n,f),Cf(n))return n.forEach(function(r){f.add(Be(r,t,e,r,n,o))}),f;if(zf(n))return n.forEach(function(r,u){f.set(u,Be(r,t,e,u,n,o))}),f;var d=v?r:(p?h?Si:zi:h?oa:ia)(n);return Zt(d||n,function(r,u){d&&(r=n[u=r]),Re(f,u,Be(r,t,e,u,n,o))}),f}function Ue(n,t,e){var u=e.length;if(null==n)return!u;for(n=rt(n);u--;){var i=e[u],o=t[i],f=n[i];if(f===r&&!(i in n)||!o(f))return!1}return!0}function Te(n,t,e){if("function"!=typeof n)throw new it(i);return eo(function(){n.apply(r,e)},t)}function $e(n,t,r,u){var i=-1,o=Ht,f=!0,a=n.length,c=[],l=t.length;if(!a)return c;r&&(t=Yt(t,vr(r))),u?(o=Jt,f=!1):t.length>=e&&(o=gr,f=!1,t=new me(t));n:for(;++i<a;){var s=n[i],h=null==r?s:r(s);if(s=u||0!==s?s:0,f&&h==h){for(var p=l;p--;)if(t[p]===h)continue n;c.push(s)}else o(t,h,u)||c.push(s)}return c}pe.templateSettings={escape:An,evaluate:kn,interpolate:On,variable:"",imports:{_:pe}},pe.prototype=_e.prototype,pe.prototype.constructor=pe,ge.prototype=ve(_e.prototype),ge.prototype.constructor=ge,ye.prototype=ve(_e.prototype),ye.prototype.constructor=ye,de.prototype.clear=function(){this.__data__=re?re(null):{},this.size=0},de.prototype.delete=function(n){var t=this.has(n)&&delete this.__data__[n];return this.size-=t?1:0,t},de.prototype.get=function(n){var t=this.__data__;if(re){var e=t[n];return e===o?r:e}return st.call(t,n)?t[n]:r},de.prototype.has=function(n){var t=this.__data__;return re?t[n]!==r:st.call(t,n)},de.prototype.set=function(n,t){var e=this.__data__;return this.size+=this.has(n)?0:1,e[n]=re&&t===r?o:t,this},be.prototype.clear=function(){this.__data__=[],this.size=0},be.prototype.delete=function(n){var t=this.__data__,r=Ee(t,n);return!(r<0||(r==t.length-1?t.pop():rr.call(t,r,1),--this.size,0))},be.prototype.get=function(n){var t=this.__data__,e=Ee(t,n);return e<0?r:t[e][1]},be.prototype.has=function(n){return Ee(this.__data__,n)>-1},be.prototype.set=function(n,t){var r=this.__data__,e=Ee(r,n);return e<0?(++this.size,r.push([n,t])):r[e][1]=t,this},we.prototype.clear=function(){this.size=0,this.__data__={hash:new de,map:new(Qr||be),string:new de}},we.prototype.delete=function(n){var t=Ui(this,n).delete(n);return this.size-=t?1:0,t},we.prototype.get=function(n){return Ui(this,n).get(n)},we.prototype.has=function(n){return Ui(this,n).has(n)},we.prototype.set=function(n,t){var r=Ui(this,n),e=r.size;return r.set(n,t),this.size+=r.size==e?0:1,this},me.prototype.add=me.prototype.push=function(n){return this.__data__.set(n,o),this},me.prototype.has=function(n){return this.__data__.has(n)},xe.prototype.clear=function(){this.__data__=new be,this.size=0},xe.prototype.delete=function(n){var t=this.__data__,r=t.delete(n);return this.size=t.size,r},xe.prototype.get=function(n){return this.__data__.get(n)},xe.prototype.has=function(n){return this.__data__.has(n)},xe.prototype.set=function(n,t){var r=this.__data__;if(r instanceof be){var u=r.__data__;if(!Qr||u.length<e-1)return u.push([n,t]),this.size=++r.size,this;r=this.__data__=new we(u)}return r.set(n,t),this.size=r.size,this};var De=oi(Ve),Me=oi(Ge,!0);function Fe(n,t){var r=!0;return De(n,function(n,e,u){return r=!!t(n,e,u)}),r}function Ne(n,t,e){for(var u=-1,i=n.length;++u<i;){var o=n[u],f=t(o);if(null!=f&&(a===r?f==f&&!Uf(f):e(f,a)))var a=f,c=o}return c}function Pe(n,t){var r=[];return De(n,function(n,e,u){t(n,e,u)&&r.push(n)}),r}function qe(n,t,r,e,u){var i=-1,o=n.length;for(r||(r=qi),u||(u=[]);++i<o;){var f=n[i];t>0&&r(f)?t>1?qe(f,t-1,r,e,u):Qt(u,f):e||(u[u.length]=f)}return u}var Ze=fi(),Ke=fi(!0);function Ve(n,t){return n&&Ze(n,t,ia)}function Ge(n,t){return n&&Ke(n,t,ia)}function He(n,t){return Gt(t,function(t){return kf(n[t])})}function Je(n,t){for(var e=0,u=(t=Ku(t,n)).length;null!=n&&e<u;)n=n[co(t[e++])];return e&&e==u?n:r}function Ye(n,t,r){var e=t(n);return df(n)?e:Qt(e,r(n))}function Qe(n){return null==n?n===r?rn:H:Wr&&Wr in rt(n)?function(n){var t=st.call(n,Wr),e=n[Wr];try{n[Wr]=r;var u=!0}catch(o){}var i=vt.call(n);return u&&(t?n[Wr]=e:delete n[Wr]),i}(n):function(n){return vt.call(n)}(n)}function Xe(n,t){return n>t}function nu(n,t){return null!=n&&st.call(n,t)}function tu(n,t){return null!=n&&t in rt(n)}function ru(n,t,e){for(var u=e?Jt:Ht,i=n[0].length,o=n.length,f=o,a=Yn(o),c=1/0,l=[];f--;){var s=n[f];f&&t&&(s=Yt(s,vr(t))),c=Kr(s.length,c),a[f]=!e&&(t||i>=120&&s.length>=120)?new me(f&&s):r}s=n[0];var h=-1,p=a[0];n:for(;++h<i&&l.length<c;){var v=s[h],_=t?t(v):v;if(v=e||0!==v?v:0,!(p?gr(p,_):u(l,_,e))){for(f=o;--f;){var g=a[f];if(!(g?gr(g,_):u(n[f],_,e)))continue n}p&&p.push(_),l.push(v)}}return l}function eu(n,t,e){var u=null==(n=no(n,t=Ku(t,n)))?n:n[co(jo(t))];return null==u?r:Pt(u,n,e)}function uu(n){return Ef(n)&&Qe(n)==$}function iu(n,t,e,u,i){return n===t||(null==n||null==t||!Ef(n)&&!Ef(t)?n!=n&&t!=t:function(n,t,e,u,i,o){var f=df(n),a=df(t),c=f?D:Fi(n),l=a?D:Fi(t),s=(c=c==$?J:c)==J,v=(l=l==$?J:l)==J,_=c==l;if(_&&xf(n)){if(!xf(t))return!1;f=!0,s=!1}if(_&&!s)return o||(o=new xe),f||Tf(n)?Ri(n,t,e,u,i,o):function(n,t,r,e,u,i,o){switch(r){case fn:if(n.byteLength!=t.byteLength||n.byteOffset!=t.byteOffset)return!1;n=n.buffer,t=t.buffer;case on:return!(n.byteLength!=t.byteLength||!i(new zt(n),new zt(t)));case F:case N:case G:return vf(+n,+t);case q:return n.name==t.name&&n.message==t.message;case Q:case nn:return n==t+"";case V:var f=jr;case X:var a=e&h;if(f||(f=Or),n.size!=t.size&&!a)return!1;var c=o.get(n);if(c)return c==t;e|=p,o.set(n,t);var l=Ri(f(n),f(t),e,u,i,o);return o.delete(n),l;case tn:if(se)return se.call(n)==se.call(t)}return!1}(n,t,c,e,u,i,o);if(!(e&h)){var g=s&&st.call(n,"__wrapped__"),y=v&&st.call(t,"__wrapped__");if(g||y){var d=g?n.value():n,b=y?t.value():t;return o||(o=new xe),i(d,b,e,u,o)}}return!!_&&(o||(o=new xe),function(n,t,e,u,i,o){var f=e&h,a=zi(n),c=a.length,l=zi(t).length;if(c!=l&&!f)return!1;for(var s=c;s--;){var p=a[s];if(!(f?p in t:st.call(t,p)))return!1}var v=o.get(n);if(v&&o.get(t))return v==t;var _=!0;o.set(n,t),o.set(t,n);for(var g=f;++s<c;){p=a[s];var y=n[p],d=t[p];if(u)var b=f?u(d,y,p,t,n,o):u(y,d,p,n,t,o);if(!(b===r?y===d||i(y,d,e,u,o):b)){_=!1;break}g||(g="constructor"==p)}if(_&&!g){var w=n.constructor,m=t.constructor;w!=m&&"constructor"in n&&"constructor"in t&&!("function"==typeof w&&w instanceof w&&"function"==typeof m&&m instanceof m)&&(_=!1)}return o.delete(n),o.delete(t),_}(n,t,e,u,i,o))}(n,t,e,u,iu,i))}function ou(n,t,e,u){var i=e.length,o=i,f=!u;if(null==n)return!o;for(n=rt(n);i--;){var a=e[i];if(f&&a[2]?a[1]!==n[a[0]]:!(a[0]in n))return!1}for(;++i<o;){var c=(a=e[i])[0],l=n[c],s=a[1];if(f&&a[2]){if(l===r&&!(c in n))return!1}else{var v=new xe;if(u)var _=u(l,s,c,n,t,v);if(!(_===r?iu(s,l,h|p,u,v):_))return!1}}return!0}function fu(n){return!(!Rf(n)||(t=n,pt&&pt in t))&&(kf(n)?wt:qn).test(lo(n));var t}function au(n){return"function"==typeof n?n:null==n?Sa:"object"==typeof n?df(n)?vu(n[0],n[1]):pu(n):Ma(n)}function cu(n){if(!Ji(n))return qr(n);var t=[];for(var r in rt(n))st.call(n,r)&&"constructor"!=r&&t.push(r);return t}function lu(n){if(!Rf(n))return function(n){var t=[];if(null!=n)for(var r in rt(n))t.push(r);return t}(n);var t=Ji(n),r=[];for(var e in n)("constructor"!=e||!t&&st.call(n,e))&&r.push(e);return r}function su(n,t){return n<t}function hu(n,t){var r=-1,e=wf(n)?Yn(n.length):[];return De(n,function(n,u,i){e[++r]=t(n,u,i)}),e}function pu(n){var t=Ti(n);return 1==t.length&&t[0][2]?Qi(t[0][0],t[0][1]):function(r){return r===n||ou(r,n,t)}}function vu(n,t){return Vi(n)&&Yi(t)?Qi(co(n),t):function(e){var u=na(e,n);return u===r&&u===t?ta(e,n):iu(t,u,h|p)}}function _u(n,t,e,u,i){n!==t&&Ze(t,function(o,f){if(Rf(o))i||(i=new xe),function(n,t,e,u,i,o,f){var a=to(n,e),c=to(t,e),l=f.get(c);if(l)Ie(n,e,l);else{var s=o?o(a,c,e+"",n,t,f):r,h=s===r;if(h){var p=df(c),v=!p&&xf(c),_=!p&&!v&&Tf(c);s=c,p||v||_?df(a)?s=a:mf(a)?s=ri(a):v?(h=!1,s=Ju(c,!0)):_?(h=!1,s=Qu(c,!0)):s=[]:Lf(c)||yf(c)?(s=a,yf(a)?s=Zf(a):Rf(a)&&!kf(a)||(s=Pi(c))):h=!1}h&&(f.set(c,s),i(s,c,u,o,f),f.delete(c)),Ie(n,e,s)}}(n,t,f,e,_u,u,i);else{var a=u?u(to(n,f),o,f+"",n,t,i):r;a===r&&(a=o),Ie(n,f,a)}},oa)}function gu(n,t){var e=n.length;if(e)return Zi(t+=t<0?e:0,e)?n[t]:r}function yu(n,t,r){var e=-1;return t=Yt(t.length?t:[Sa],vr(Bi())),function(n,t){var r=n.length;for(n.sort(t);r--;)n[r]=n[r].value;return n}(hu(n,function(n,r,u){return{criteria:Yt(t,function(t){return t(n)}),index:++e,value:n}}),function(n,t){return function(n,t,r){for(var e=-1,u=n.criteria,i=t.criteria,o=u.length,f=r.length;++e<o;){var a=Xu(u[e],i[e]);if(a){if(e>=f)return a;var c=r[e];return a*("desc"==c?-1:1)}}return n.index-t.index}(n,t,r)})}function du(n,t,r){for(var e=-1,u=t.length,i={};++e<u;){var o=t[e],f=Je(n,o);r(f,o)&&Ou(i,Ku(o,n),f)}return i}function bu(n,t,r,e){var u=e?or:ir,i=-1,o=t.length,f=n;for(n===t&&(t=ri(t)),r&&(f=Yt(n,vr(r)));++i<o;)for(var a=0,c=t[i],l=r?r(c):c;(a=u(f,l,a,e))>-1;)f!==n&&rr.call(f,a,1),rr.call(n,a,1);return n}function wu(n,t){for(var r=n?t.length:0,e=r-1;r--;){var u=t[r];if(r==e||u!==i){var i=u;Zi(u)?rr.call(n,u,1):$u(n,u)}}return n}function mu(n,t){return n+Dr(Hr()*(t-n+1))}function xu(n,t){var r="";if(!n||t<1||t>S)return r;do{t%2&&(r+=n),(t=Dr(t/2))&&(n+=n)}while(t);return r}function ju(n,t){return uo(Xi(n,t,Sa),n+"")}function Au(n){return Ae(va(n))}function ku(n,t){var r=va(n);return fo(r,Ce(t,0,r.length))}function Ou(n,t,e,u){if(!Rf(n))return n;for(var i=-1,o=(t=Ku(t,n)).length,f=o-1,a=n;null!=a&&++i<o;){var c=co(t[i]),l=e;if(i!=f){var s=a[c];(l=u?u(s,c,a):r)===r&&(l=Rf(s)?s:Zi(t[i+1])?[]:{})}Re(a,c,l),a=a[c]}return n}var Iu=ee?function(n,t){return ee.set(n,t),n}:Sa,Ru=Cr?function(n,t){return Cr(n,"toString",{configurable:!0,enumerable:!1,value:Ra(t),writable:!0})}:Sa;function Eu(n){return fo(va(n))}function zu(n,t,r){var e=-1,u=n.length;t<0&&(t=-t>u?0:u+t),(r=r>u?u:r)<0&&(r+=u),u=t>r?0:r-t>>>0,t>>>=0;for(var i=Yn(u);++e<u;)i[e]=n[e+t];return i}function Su(n,t){var r;return De(n,function(n,e,u){return!(r=t(n,e,u))}),!!r}function Lu(n,t,r){var e=0,u=null==n?e:n.length;if("number"==typeof t&&t==t&&u<=U){for(;e<u;){var i=e+u>>>1,o=n[i];null!==o&&!Uf(o)&&(r?o<=t:o<t)?e=i+1:u=i}return u}return Wu(n,t,Sa,r)}function Wu(n,t,e,u){t=e(t);for(var i=0,o=null==n?0:n.length,f=t!=t,a=null===t,c=Uf(t),l=t===r;i<o;){var s=Dr((i+o)/2),h=e(n[s]),p=h!==r,v=null===h,_=h==h,g=Uf(h);if(f)var y=u||_;else y=l?_&&(u||p):a?_&&p&&(u||!v):c?_&&p&&!v&&(u||!g):!v&&!g&&(u?h<=t:h<t);y?i=s+1:o=s}return Kr(o,B)}function Cu(n,t){for(var r=-1,e=n.length,u=0,i=[];++r<e;){var o=n[r],f=t?t(o):o;if(!r||!vf(f,a)){var a=f;i[u++]=0===o?0:o}}return i}function Bu(n){return"number"==typeof n?n:Uf(n)?W:+n}function Uu(n){if("string"==typeof n)return n;if(df(n))return Yt(n,Uu)+"";if(Uf(n))return he?he.call(n):"";var t=n+"";return"0"==t&&1/n==-z?"-0":t}function Tu(n,t,r){var u=-1,i=Ht,o=n.length,f=!0,a=[],c=a;if(r)f=!1,i=Jt;else if(o>=e){var l=t?null:xi(n);if(l)return Or(l);f=!1,i=gr,c=new me}else c=t?[]:a;n:for(;++u<o;){var s=n[u],h=t?t(s):s;if(s=r||0!==s?s:0,f&&h==h){for(var p=c.length;p--;)if(c[p]===h)continue n;t&&c.push(h),a.push(s)}else i(c,h,r)||(c!==a&&c.push(h),a.push(s))}return a}function $u(n,t){return null==(n=no(n,t=Ku(t,n)))||delete n[co(jo(t))]}function Du(n,t,r,e){return Ou(n,t,r(Je(n,t)),e)}function Mu(n,t,r,e){for(var u=n.length,i=e?u:-1;(e?i--:++i<u)&&t(n[i],i,n););return r?zu(n,e?0:i,e?i+1:u):zu(n,e?i+1:0,e?u:i)}function Fu(n,t){var r=n;return r instanceof ye&&(r=r.value()),Xt(t,function(n,t){return t.func.apply(t.thisArg,Qt([n],t.args))},r)}function Nu(n,t,r){var e=n.length;if(e<2)return e?Tu(n[0]):[];for(var u=-1,i=Yn(e);++u<e;)for(var o=n[u],f=-1;++f<e;)f!=u&&(i[u]=$e(i[u]||o,n[f],t,r));return Tu(qe(i,1),t,r)}function Pu(n,t,e){for(var u=-1,i=n.length,o=t.length,f={};++u<i;){var a=u<o?t[u]:r;e(f,n[u],a)}return f}function qu(n){return mf(n)?n:[]}function Zu(n){return"function"==typeof n?n:Sa}function Ku(n,t){return df(n)?n:Vi(n,t)?[n]:ao(Kf(n))}var Vu=ju;function Gu(n,t,e){var u=n.length;return e=e===r?u:e,!t&&e>=u?n:zu(n,t,e)}var Hu=Br||function(n){return St.clearTimeout(n)};function Ju(n,t){if(t)return n.slice();var r=n.length,e=Lt?Lt(r):new n.constructor(r);return n.copy(e),e}function Yu(n){var t=new n.constructor(n.byteLength);return new zt(t).set(new zt(n)),t}function Qu(n,t){var r=t?Yu(n.buffer):n.buffer;return new n.constructor(r,n.byteOffset,n.length)}function Xu(n,t){if(n!==t){var e=n!==r,u=null===n,i=n==n,o=Uf(n),f=t!==r,a=null===t,c=t==t,l=Uf(t);if(!a&&!l&&!o&&n>t||o&&f&&c&&!a&&!l||u&&f&&c||!e&&c||!i)return 1;if(!u&&!o&&!l&&n<t||l&&e&&i&&!u&&!o||a&&e&&i||!f&&i||!c)return-1}return 0}function ni(n,t,r,e){for(var u=-1,i=n.length,o=r.length,f=-1,a=t.length,c=Zr(i-o,0),l=Yn(a+c),s=!e;++f<a;)l[f]=t[f];for(;++u<o;)(s||u<i)&&(l[r[u]]=n[u]);for(;c--;)l[f++]=n[u++];return l}function ti(n,t,r,e){for(var u=-1,i=n.length,o=-1,f=r.length,a=-1,c=t.length,l=Zr(i-f,0),s=Yn(l+c),h=!e;++u<l;)s[u]=n[u];for(var p=u;++a<c;)s[p+a]=t[a];for(;++o<f;)(h||u<i)&&(s[p+r[o]]=n[u++]);return s}function ri(n,t){var r=-1,e=n.length;for(t||(t=Yn(e));++r<e;)t[r]=n[r];return t}function ei(n,t,e,u){var i=!e;e||(e={});for(var o=-1,f=t.length;++o<f;){var a=t[o],c=u?u(e[a],n[a],a,e,n):r;c===r&&(c=n[a]),i?Le(e,a,c):Re(e,a,c)}return e}function ui(n,t){return function(r,e){var u=df(r)?qt:ze,i=t?t():{};return u(r,n,Bi(e,2),i)}}function ii(n){return ju(function(t,e){var u=-1,i=e.length,o=i>1?e[i-1]:r,f=i>2?e[2]:r;for(o=n.length>3&&"function"==typeof o?(i--,o):r,f&&Ki(e[0],e[1],f)&&(o=i<3?r:o,i=1),t=rt(t);++u<i;){var a=e[u];a&&n(t,a,u,o)}return t})}function oi(n,t){return function(r,e){if(null==r)return r;if(!wf(r))return n(r,e);for(var u=r.length,i=t?u:-1,o=rt(r);(t?i--:++i<u)&&!1!==e(o[i],i,o););return r}}function fi(n){return function(t,r,e){for(var u=-1,i=rt(t),o=e(t),f=o.length;f--;){var a=o[n?f:++u];if(!1===r(i[a],a,i))break}return t}}function ai(n){return function(t){var e=xr(t=Kf(t))?Er(t):r,u=e?e[0]:t.charAt(0),i=e?Gu(e,1).join(""):t.slice(1);return u[n]()+i}}function ci(n){return function(t){return Xt(ka(ya(t).replace(gt,"")),n,"")}}function li(n){return function(){var t=arguments;switch(t.length){case 0:return new n;case 1:return new n(t[0]);case 2:return new n(t[0],t[1]);case 3:return new n(t[0],t[1],t[2]);case 4:return new n(t[0],t[1],t[2],t[3]);case 5:return new n(t[0],t[1],t[2],t[3],t[4]);case 6:return new n(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new n(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=ve(n.prototype),e=n.apply(r,t);return Rf(e)?e:r}}function si(n){return function(t,e,u){var i=rt(t);if(!wf(t)){var o=Bi(e,3);t=ia(t),e=function(n){return o(i[n],n,i)}}var f=n(t,e,u);return f>-1?i[o?t[f]:f]:r}}function hi(n){return Ei(function(t){var e=t.length,u=e,o=ge.prototype.thru;for(n&&t.reverse();u--;){var f=t[u];if("function"!=typeof f)throw new it(i);if(o&&!a&&"wrapper"==Wi(f))var a=new ge([],!0)}for(u=a?u:e;++u<e;){var c=Wi(f=t[u]),l="wrapper"==c?Li(f):r;a=l&&Gi(l[0])&&l[1]==(m|y|b|x)&&!l[4].length&&1==l[9]?a[Wi(l[0])].apply(a,l[3]):1==f.length&&Gi(f)?a[c]():a.thru(f)}return function(){var n=arguments,r=n[0];if(a&&1==n.length&&df(r))return a.plant(r).value();for(var u=0,i=e?t[u].apply(this,n):r;++u<e;)i=t[u].call(this,i);return i}})}function pi(n,t,e,u,i,o,f,a,c,l){var s=t&m,h=t&v,p=t&_,g=t&(y|d),b=t&j,w=p?r:li(n);return function v(){for(var _=arguments.length,y=Yn(_),d=_;d--;)y[d]=arguments[d];if(g)var m=Ci(v),x=function(n,t){for(var r=n.length,e=0;r--;)n[r]===t&&++e;return e}(y,m);if(u&&(y=ni(y,u,i,g)),o&&(y=ti(y,o,f,g)),_-=x,g&&_<l){var j=kr(y,m);return wi(n,t,pi,v.placeholder,e,y,j,a,c,l-_)}var A=h?e:this,k=p?A[n]:n;return _=y.length,a?y=function(n,t){for(var e=n.length,u=Kr(t.length,e),i=ri(n);u--;){var o=t[u];n[u]=Zi(o,e)?i[o]:r}return n}(y,a):b&&_>1&&y.reverse(),s&&c<_&&(y.length=c),this&&this!==St&&this instanceof v&&(k=w||li(k)),k.apply(A,y)}}function vi(n,t){return function(r,e){return function(n,t,r,e){return Ve(n,function(n,u,i){t(e,r(n),u,i)}),e}(r,n,t(e),{})}}function _i(n,t){return function(e,u){var i;if(e===r&&u===r)return t;if(e!==r&&(i=e),u!==r){if(i===r)return u;"string"==typeof e||"string"==typeof u?(e=Uu(e),u=Uu(u)):(e=Bu(e),u=Bu(u)),i=n(e,u)}return i}}function gi(n){return Ei(function(t){return t=Yt(t,vr(Bi())),ju(function(r){var e=this;return n(t,function(n){return Pt(n,e,r)})})})}function yi(n,t){var e=(t=t===r?" ":Uu(t)).length;if(e<2)return e?xu(t,n):t;var u=xu(t,$r(n/Rr(t)));return xr(t)?Gu(Er(u),0,n).join(""):u.slice(0,n)}function di(n){return function(t,e,u){return u&&"number"!=typeof u&&Ki(t,e,u)&&(e=u=r),t=Ff(t),e===r?(e=t,t=0):e=Ff(e),function(n,t,r,e){for(var u=-1,i=Zr($r((t-n)/(r||1)),0),o=Yn(i);i--;)o[e?i:++u]=n,n+=r;return o}(t,e,u=u===r?t<e?1:-1:Ff(u),n)}}function bi(n){return function(t,r){return"string"==typeof t&&"string"==typeof r||(t=qf(t),r=qf(r)),n(t,r)}}function wi(n,t,e,u,i,o,f,a,c,l){var s=t&y;t|=s?b:w,(t&=~(s?w:b))&g||(t&=~(v|_));var h=[n,t,i,s?o:r,s?f:r,s?r:o,s?r:f,a,c,l],p=e.apply(r,h);return Gi(n)&&ro(p,h),p.placeholder=u,io(p,n,t)}function mi(n){var t=tt[n];return function(n,r){if(n=qf(n),r=null==r?0:Kr(Nf(r),292)){var e=(Kf(n)+"e").split("e");return+((e=(Kf(t(e[0]+"e"+(+e[1]+r)))+"e").split("e"))[0]+"e"+(+e[1]-r))}return t(n)}}var xi=ne&&1/Or(new ne([,-0]))[1]==z?function(n){return new ne(n)}:Ua;function ji(n){return function(t){var r=Fi(t);return r==V?jr(t):r==X?Ir(t):function(n,t){return Yt(t,function(t){return[t,n[t]]})}(t,n(t))}}function Ai(n,t,e,u,o,f,c,l){var s=t&_;if(!s&&"function"!=typeof n)throw new it(i);var h=u?u.length:0;if(h||(t&=~(b|w),u=o=r),c=c===r?c:Zr(Nf(c),0),l=l===r?l:Nf(l),h-=o?o.length:0,t&w){var p=u,j=o;u=o=r}var A=s?r:Li(n),k=[n,t,e,u,o,p,j,f,c,l];if(A&&function(n,t){var r=n[1],e=t[1],u=r|e,i=u<(v|_|m),o=e==m&&r==y||e==m&&r==x&&n[7].length<=t[8]||e==(m|x)&&t[7].length<=t[8]&&r==y;if(!i&&!o)return n;e&v&&(n[2]=t[2],u|=r&v?0:g);var f=t[3];if(f){var c=n[3];n[3]=c?ni(c,f,t[4]):f,n[4]=c?kr(n[3],a):t[4]}(f=t[5])&&(c=n[5],n[5]=c?ti(c,f,t[6]):f,n[6]=c?kr(n[5],a):t[6]),(f=t[7])&&(n[7]=f),e&m&&(n[8]=null==n[8]?t[8]:Kr(n[8],t[8])),null==n[9]&&(n[9]=t[9]),n[0]=t[0],n[1]=u}(k,A),n=k[0],t=k[1],e=k[2],u=k[3],o=k[4],!(l=k[9]=k[9]===r?s?0:n.length:Zr(k[9]-h,0))&&t&(y|d)&&(t&=~(y|d)),t&&t!=v)O=t==y||t==d?function(n,t,e){var u=li(n);return function i(){for(var o=arguments.length,f=Yn(o),a=o,c=Ci(i);a--;)f[a]=arguments[a];var l=o<3&&f[0]!==c&&f[o-1]!==c?[]:kr(f,c);return(o-=l.length)<e?wi(n,t,pi,i.placeholder,r,f,l,r,r,e-o):Pt(this&&this!==St&&this instanceof i?u:n,this,f)}}(n,t,l):t!=b&&t!=(v|b)||o.length?pi.apply(r,k):function(n,t,r,e){var u=t&v,i=li(n);return function t(){for(var o=-1,f=arguments.length,a=-1,c=e.length,l=Yn(c+f),s=this&&this!==St&&this instanceof t?i:n;++a<c;)l[a]=e[a];for(;f--;)l[a++]=arguments[++o];return Pt(s,u?r:this,l)}}(n,t,e,u);else var O=function(n,t,r){var e=t&v,u=li(n);return function t(){return(this&&this!==St&&this instanceof t?u:n).apply(e?r:this,arguments)}}(n,t,e);return io((A?Iu:ro)(O,k),n,t)}function ki(n,t,e,u){return n===r||vf(n,at[e])&&!st.call(u,e)?t:n}function Oi(n,t,e,u,i,o){return Rf(n)&&Rf(t)&&(o.set(t,n),_u(n,t,r,Oi,o),o.delete(t)),n}function Ii(n){return Lf(n)?r:n}function Ri(n,t,e,u,i,o){var f=e&h,a=n.length,c=t.length;if(a!=c&&!(f&&c>a))return!1;var l=o.get(n);if(l&&o.get(t))return l==t;var s=-1,v=!0,_=e&p?new me:r;for(o.set(n,t),o.set(t,n);++s<a;){var g=n[s],y=t[s];if(u)var d=f?u(y,g,s,t,n,o):u(g,y,s,n,t,o);if(d!==r){if(d)continue;v=!1;break}if(_){if(!tr(t,function(n,t){if(!gr(_,t)&&(g===n||i(g,n,e,u,o)))return _.push(t)})){v=!1;break}}else if(g!==y&&!i(g,y,e,u,o)){v=!1;break}}return o.delete(n),o.delete(t),v}function Ei(n){return uo(Xi(n,r,yo),n+"")}function zi(n){return Ye(n,ia,Di)}function Si(n){return Ye(n,oa,Mi)}var Li=ee?function(n){return ee.get(n)}:Ua;function Wi(n){for(var t=n.name+"",r=ue[t],e=st.call(ue,t)?r.length:0;e--;){var u=r[e],i=u.func;if(null==i||i==n)return u.name}return t}function Ci(n){return(st.call(pe,"placeholder")?pe:n).placeholder}function Bi(){var n=pe.iteratee||La;return n=n===La?au:n,arguments.length?n(arguments[0],arguments[1]):n}function Ui(n,t){var r,e,u=n.__data__;return("string"==(e=typeof(r=t))||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==r:null===r)?u["string"==typeof t?"string":"hash"]:u.map}function Ti(n){for(var t=ia(n),r=t.length;r--;){var e=t[r],u=n[e];t[r]=[e,u,Yi(u)]}return t}function $i(n,t){var e=function(n,t){return null==n?r:n[t]}(n,t);return fu(e)?e:r}var Di=Mr?function(n){return null==n?[]:(n=rt(n),Gt(Mr(n),function(t){return Ut.call(n,t)}))}:Pa,Mi=Mr?function(n){for(var t=[];n;)Qt(t,Di(n)),n=Wt(n);return t}:Pa,Fi=Qe;function Ni(n,t,r){for(var e=-1,u=(t=Ku(t,n)).length,i=!1;++e<u;){var o=co(t[e]);if(!(i=null!=n&&r(n,o)))break;n=n[o]}return i||++e!=u?i:!!(u=null==n?0:n.length)&&If(u)&&Zi(o,u)&&(df(n)||yf(n))}function Pi(n){return"function"!=typeof n.constructor||Ji(n)?{}:ve(Wt(n))}function qi(n){return df(n)||yf(n)||!!(lr&&n&&n[lr])}function Zi(n,t){var r=typeof n;return!!(t=null==t?S:t)&&("number"==r||"symbol"!=r&&Kn.test(n))&&n>-1&&n%1==0&&n<t}function Ki(n,t,r){if(!Rf(r))return!1;var e=typeof t;return!!("number"==e?wf(r)&&Zi(t,r.length):"string"==e&&t in r)&&vf(r[t],n)}function Vi(n,t){if(df(n))return!1;var r=typeof n;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=n&&!Uf(n))||Rn.test(n)||!In.test(n)||null!=t&&n in rt(t)}function Gi(n){var t=Wi(n),r=pe[t];if("function"!=typeof r||!(t in ye.prototype))return!1;if(n===r)return!0;var e=Li(r);return!!e&&n===e[0]}(Yr&&Fi(new Yr(new ArrayBuffer(1)))!=fn||Qr&&Fi(new Qr)!=V||Xr&&"[object Promise]"!=Fi(Xr.resolve())||ne&&Fi(new ne)!=X||te&&Fi(new te)!=en)&&(Fi=function(n){var t=Qe(n),e=t==J?n.constructor:r,u=e?lo(e):"";if(u)switch(u){case ie:return fn;case oe:return V;case fe:return"[object Promise]";case ae:return X;case ce:return en}return t});var Hi=ct?kf:qa;function Ji(n){var t=n&&n.constructor;return n===("function"==typeof t&&t.prototype||at)}function Yi(n){return n==n&&!Rf(n)}function Qi(n,t){return function(e){return null!=e&&e[n]===t&&(t!==r||n in rt(e))}}function Xi(n,t,e){return t=Zr(t===r?n.length-1:t,0),function(){for(var r=arguments,u=-1,i=Zr(r.length-t,0),o=Yn(i);++u<i;)o[u]=r[t+u];u=-1;for(var f=Yn(t+1);++u<t;)f[u]=r[u];return f[t]=e(o),Pt(n,this,f)}}function no(n,t){return t.length<2?n:Je(n,zu(t,0,-1))}function to(n,t){if("__proto__"!=t)return n[t]}var ro=oo(Iu),eo=Tr||function(n,t){return St.setTimeout(n,t)},uo=oo(Ru);function io(n,t,r){var e=t+"";return uo(n,function(n,t){var r=t.length;if(!r)return n;var e=r-1;return t[e]=(r>1?"& ":"")+t[e],t=t.join(r>2?", ":" "),n.replace(Bn,"{\n/* [wrapped with "+t+"] */\n")}(e,function(n,t){return Zt(T,function(r){var e="_."+r[0];t&r[1]&&!Ht(n,e)&&n.push(e)}),n.sort()}(function(n){var t=n.match(Un);return t?t[1].split(Tn):[]}(e),r)))}function oo(n){var t=0,e=0;return function(){var u=Vr(),i=I-(u-e);if(e=u,i>0){if(++t>=O)return arguments[0]}else t=0;return n.apply(r,arguments)}}function fo(n,t){var e=-1,u=n.length,i=u-1;for(t=t===r?u:t;++e<t;){var o=mu(e,i),f=n[o];n[o]=n[e],n[e]=f}return n.length=t,n}var ao=function(n){var t=af(n,function(n){return r.size===f&&r.clear(),n}),r=t.cache;return t}(function(n){var t=[];return 46===n.charCodeAt(0)&&t.push(""),n.replace(En,function(n,r,e,u){t.push(e?u.replace(Dn,"$1"):r||n)}),t});function co(n){if("string"==typeof n||Uf(n))return n;var t=n+"";return"0"==t&&1/n==-z?"-0":t}function lo(n){if(null!=n){try{return lt.call(n)}catch(t){}try{return n+""}catch(t){}}return""}function so(n){if(n instanceof ye)return n.clone();var t=new ge(n.__wrapped__,n.__chain__);return t.__actions__=ri(n.__actions__),t.__index__=n.__index__,t.__values__=n.__values__,t}var ho=ju(function(n,t){return mf(n)?$e(n,qe(t,1,mf,!0)):[]}),po=ju(function(n,t){var e=jo(t);return mf(e)&&(e=r),mf(n)?$e(n,qe(t,1,mf,!0),Bi(e,2)):[]}),vo=ju(function(n,t){var e=jo(t);return mf(e)&&(e=r),mf(n)?$e(n,qe(t,1,mf,!0),r,e):[]});function _o(n,t,r){var e=null==n?0:n.length;if(!e)return-1;var u=null==r?0:Nf(r);return u<0&&(u=Zr(e+u,0)),ur(n,Bi(t,3),u)}function go(n,t,e){var u=null==n?0:n.length;if(!u)return-1;var i=u-1;return e!==r&&(i=Nf(e),i=e<0?Zr(u+i,0):Kr(i,u-1)),ur(n,Bi(t,3),i,!0)}function yo(n){return null!=n&&n.length?qe(n,1):[]}function bo(n){return n&&n.length?n[0]:r}var wo=ju(function(n){var t=Yt(n,qu);return t.length&&t[0]===n[0]?ru(t):[]}),mo=ju(function(n){var t=jo(n),e=Yt(n,qu);return t===jo(e)?t=r:e.pop(),e.length&&e[0]===n[0]?ru(e,Bi(t,2)):[]}),xo=ju(function(n){var t=jo(n),e=Yt(n,qu);return(t="function"==typeof t?t:r)&&e.pop(),e.length&&e[0]===n[0]?ru(e,r,t):[]});function jo(n){var t=null==n?0:n.length;return t?n[t-1]:r}var Ao=ju(ko);function ko(n,t){return n&&n.length&&t&&t.length?bu(n,t):n}var Oo=Ei(function(n,t){var r=null==n?0:n.length,e=We(n,t);return wu(n,Yt(t,function(n){return Zi(n,r)?+n:n}).sort(Xu)),e});function Io(n){return null==n?n:Jr.call(n)}var Ro=ju(function(n){return Tu(qe(n,1,mf,!0))}),Eo=ju(function(n){var t=jo(n);return mf(t)&&(t=r),Tu(qe(n,1,mf,!0),Bi(t,2))}),zo=ju(function(n){var t=jo(n);return t="function"==typeof t?t:r,Tu(qe(n,1,mf,!0),r,t)});function So(n){if(!n||!n.length)return[];var t=0;return n=Gt(n,function(n){if(mf(n))return t=Zr(n.length,t),!0}),pr(t,function(t){return Yt(n,cr(t))})}function Lo(n,t){if(!n||!n.length)return[];var e=So(n);return null==t?e:Yt(e,function(n){return Pt(t,r,n)})}var Wo=ju(function(n,t){return mf(n)?$e(n,t):[]}),Co=ju(function(n){return Nu(Gt(n,mf))}),Bo=ju(function(n){var t=jo(n);return mf(t)&&(t=r),Nu(Gt(n,mf),Bi(t,2))}),Uo=ju(function(n){var t=jo(n);return t="function"==typeof t?t:r,Nu(Gt(n,mf),r,t)}),To=ju(So);var $o=ju(function(n){var t=n.length,e=t>1?n[t-1]:r;return e="function"==typeof e?(n.pop(),e):r,Lo(n,e)});function Do(n){var t=pe(n);return t.__chain__=!0,t}function Mo(n,t){return t(n)}var Fo=Ei(function(n){var t=n.length,e=t?n[0]:0,u=this.__wrapped__,i=function(t){return We(t,n)};return!(t>1||this.__actions__.length)&&u instanceof ye&&Zi(e)?((u=u.slice(e,+e+(t?1:0))).__actions__.push({func:Mo,args:[i],thisArg:r}),new ge(u,this.__chain__).thru(function(n){return t&&!n.length&&n.push(r),n})):this.thru(i)});var No=ui(function(n,t,r){st.call(n,r)?++n[r]:Le(n,r,1)});var Po=si(_o),qo=si(go);function Zo(n,t){return(df(n)?Zt:De)(n,Bi(t,3))}function Ko(n,t){return(df(n)?Kt:Me)(n,Bi(t,3))}var Vo=ui(function(n,t,r){st.call(n,r)?n[r].push(t):Le(n,r,[t])});var Go=ju(function(n,t,r){var e=-1,u="function"==typeof t,i=wf(n)?Yn(n.length):[];return De(n,function(n){i[++e]=u?Pt(t,n,r):eu(n,t,r)}),i}),Ho=ui(function(n,t,r){Le(n,r,t)});function Jo(n,t){return(df(n)?Yt:hu)(n,Bi(t,3))}var Yo=ui(function(n,t,r){n[r?0:1].push(t)},function(){return[[],[]]});var Qo=ju(function(n,t){if(null==n)return[];var r=t.length;return r>1&&Ki(n,t[0],t[1])?t=[]:r>2&&Ki(t[0],t[1],t[2])&&(t=[t[0]]),yu(n,qe(t,1),[])}),Xo=Ur||function(){return St.Date.now()};function nf(n,t,e){return t=e?r:t,t=n&&null==t?n.length:t,Ai(n,m,r,r,r,r,t)}function tf(n,t){var e;if("function"!=typeof t)throw new it(i);return n=Nf(n),function(){return--n>0&&(e=t.apply(this,arguments)),n<=1&&(t=r),e}}var rf=ju(function(n,t,r){var e=v;if(r.length){var u=kr(r,Ci(rf));e|=b}return Ai(n,e,t,r,u)}),ef=ju(function(n,t,r){var e=v|_;if(r.length){var u=kr(r,Ci(ef));e|=b}return Ai(t,e,n,r,u)});function uf(n,t,e){var u,o,f,a,c,l,s=0,h=!1,p=!1,v=!0;if("function"!=typeof n)throw new it(i);function _(t){var e=u,i=o;return u=o=r,s=t,a=n.apply(i,e)}function g(n){var e=n-l;return l===r||e>=t||e<0||p&&n-s>=f}function y(){var n=Xo();if(g(n))return d(n);c=eo(y,function(n){var r=t-(n-l);return p?Kr(r,f-(n-s)):r}(n))}function d(n){return c=r,v&&u?_(n):(u=o=r,a)}function b(){var n=Xo(),e=g(n);if(u=arguments,o=this,l=n,e){if(c===r)return function(n){return s=n,c=eo(y,t),h?_(n):a}(l);if(p)return c=eo(y,t),_(l)}return c===r&&(c=eo(y,t)),a}return t=qf(t)||0,Rf(e)&&(h=!!e.leading,f=(p="maxWait"in e)?Zr(qf(e.maxWait)||0,t):f,v="trailing"in e?!!e.trailing:v),b.cancel=function(){c!==r&&Hu(c),s=0,u=l=o=c=r},b.flush=function(){return c===r?a:d(Xo())},b}var of=ju(function(n,t){return Te(n,1,t)}),ff=ju(function(n,t,r){return Te(n,qf(t)||0,r)});function af(n,t){if("function"!=typeof n||null!=t&&"function"!=typeof t)throw new it(i);var r=function(){var e=arguments,u=t?t.apply(this,e):e[0],i=r.cache;if(i.has(u))return i.get(u);var o=n.apply(this,e);return r.cache=i.set(u,o)||i,o};return r.cache=new(af.Cache||we),r}function cf(n){if("function"!=typeof n)throw new it(i);return function(){var t=arguments;switch(t.length){case 0:return!n.call(this);case 1:return!n.call(this,t[0]);case 2:return!n.call(this,t[0],t[1]);case 3:return!n.call(this,t[0],t[1],t[2])}return!n.apply(this,t)}}af.Cache=we;var lf=Vu(function(n,t){var r=(t=1==t.length&&df(t[0])?Yt(t[0],vr(Bi())):Yt(qe(t,1),vr(Bi()))).length;return ju(function(e){for(var u=-1,i=Kr(e.length,r);++u<i;)e[u]=t[u].call(this,e[u]);return Pt(n,this,e)})}),sf=ju(function(n,t){var e=kr(t,Ci(sf));return Ai(n,b,r,t,e)}),hf=ju(function(n,t){var e=kr(t,Ci(hf));return Ai(n,w,r,t,e)}),pf=Ei(function(n,t){return Ai(n,x,r,r,r,t)});function vf(n,t){return n===t||n!=n&&t!=t}var _f=bi(Xe),gf=bi(function(n,t){return n>=t}),yf=uu(function(){return arguments}())?uu:function(n){return Ef(n)&&st.call(n,"callee")&&!Ut.call(n,"callee")},df=Yn.isArray,bf=Tt?vr(Tt):function(n){return Ef(n)&&Qe(n)==on};function wf(n){return null!=n&&If(n.length)&&!kf(n)}function mf(n){return Ef(n)&&wf(n)}var xf=Fr||qa,jf=$t?vr($t):function(n){return Ef(n)&&Qe(n)==N};function Af(n){if(!Ef(n))return!1;var t=Qe(n);return t==q||t==P||"string"==typeof n.message&&"string"==typeof n.name&&!Lf(n)}function kf(n){if(!Rf(n))return!1;var t=Qe(n);return t==Z||t==K||t==M||t==Y}function Of(n){return"number"==typeof n&&n==Nf(n)}function If(n){return"number"==typeof n&&n>-1&&n%1==0&&n<=S}function Rf(n){var t=typeof n;return null!=n&&("object"==t||"function"==t)}function Ef(n){return null!=n&&"object"==typeof n}var zf=Dt?vr(Dt):function(n){return Ef(n)&&Fi(n)==V};function Sf(n){return"number"==typeof n||Ef(n)&&Qe(n)==G}function Lf(n){if(!Ef(n)||Qe(n)!=J)return!1;var t=Wt(n);if(null===t)return!0;var r=st.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&lt.call(r)==_t}var Wf=Mt?vr(Mt):function(n){return Ef(n)&&Qe(n)==Q};var Cf=Ft?vr(Ft):function(n){return Ef(n)&&Fi(n)==X};function Bf(n){return"string"==typeof n||!df(n)&&Ef(n)&&Qe(n)==nn}function Uf(n){return"symbol"==typeof n||Ef(n)&&Qe(n)==tn}var Tf=Nt?vr(Nt):function(n){return Ef(n)&&If(n.length)&&!!At[Qe(n)]};var $f=bi(su),Df=bi(function(n,t){return n<=t});function Mf(n){if(!n)return[];if(wf(n))return Bf(n)?Er(n):ri(n);if(Lr&&n[Lr])return function(n){for(var t,r=[];!(t=n.next()).done;)r.push(t.value);return r}(n[Lr]());var t=Fi(n);return(t==V?jr:t==X?Or:va)(n)}function Ff(n){return n?(n=qf(n))===z||n===-z?(n<0?-1:1)*L:n==n?n:0:0===n?n:0}function Nf(n){var t=Ff(n),r=t%1;return t==t?r?t-r:t:0}function Pf(n){return n?Ce(Nf(n),0,C):0}function qf(n){if("number"==typeof n)return n;if(Uf(n))return W;if(Rf(n)){var t="function"==typeof n.valueOf?n.valueOf():n;n=Rf(t)?t+"":t}if("string"!=typeof n)return 0===n?n:+n;n=n.replace(Ln,"");var r=Pn.test(n);return r||Zn.test(n)?Rt(n.slice(2),r?2:8):Nn.test(n)?W:+n}function Zf(n){return ei(n,oa(n))}function Kf(n){return null==n?"":Uu(n)}var Vf=ii(function(n,t){if(Ji(t)||wf(t))ei(t,ia(t),n);else for(var r in t)st.call(t,r)&&Re(n,r,t[r])}),Gf=ii(function(n,t){ei(t,oa(t),n)}),Hf=ii(function(n,t,r,e){ei(t,oa(t),n,e)}),Jf=ii(function(n,t,r,e){ei(t,ia(t),n,e)}),Yf=Ei(We);var Qf=ju(function(n,t){n=rt(n);var e=-1,u=t.length,i=u>2?t[2]:r;for(i&&Ki(t[0],t[1],i)&&(u=1);++e<u;)for(var o=t[e],f=oa(o),a=-1,c=f.length;++a<c;){var l=f[a],s=n[l];(s===r||vf(s,at[l])&&!st.call(n,l))&&(n[l]=o[l])}return n}),Xf=ju(function(n){return n.push(r,Oi),Pt(aa,r,n)});function na(n,t,e){var u=null==n?r:Je(n,t);return u===r?e:u}function ta(n,t){return null!=n&&Ni(n,t,tu)}var ra=vi(function(n,t,r){null!=t&&"function"!=typeof t.toString&&(t=vt.call(t)),n[t]=r},Ra(Sa)),ea=vi(function(n,t,r){null!=t&&"function"!=typeof t.toString&&(t=vt.call(t)),st.call(n,t)?n[t].push(r):n[t]=[r]},Bi),ua=ju(eu);function ia(n){return wf(n)?je(n):cu(n)}function oa(n){return wf(n)?je(n,!0):lu(n)}var fa=ii(function(n,t,r){_u(n,t,r)}),aa=ii(function(n,t,r,e){_u(n,t,r,e)}),ca=Ei(function(n,t){var r={};if(null==n)return r;var e=!1;t=Yt(t,function(t){return t=Ku(t,n),e||(e=t.length>1),t}),ei(n,Si(n),r),e&&(r=Be(r,c|l|s,Ii));for(var u=t.length;u--;)$u(r,t[u]);return r});var la=Ei(function(n,t){return null==n?{}:function(n,t){return du(n,t,function(t,r){return ta(n,r)})}(n,t)});function sa(n,t){if(null==n)return{};var r=Yt(Si(n),function(n){return[n]});return t=Bi(t),du(n,r,function(n,r){return t(n,r[0])})}var ha=ji(ia),pa=ji(oa);function va(n){return null==n?[]:_r(n,ia(n))}var _a=ci(function(n,t,r){return t=t.toLowerCase(),n+(r?ga(t):t)});function ga(n){return Aa(Kf(n).toLowerCase())}function ya(n){return(n=Kf(n))&&n.replace(Vn,br).replace(yt,"")}var da=ci(function(n,t,r){return n+(r?"-":"")+t.toLowerCase()}),ba=ci(function(n,t,r){return n+(r?" ":"")+t.toLowerCase()}),wa=ai("toLowerCase");var ma=ci(function(n,t,r){return n+(r?"_":"")+t.toLowerCase()});var xa=ci(function(n,t,r){return n+(r?" ":"")+Aa(t)});var ja=ci(function(n,t,r){return n+(r?" ":"")+t.toUpperCase()}),Aa=ai("toUpperCase");function ka(n,t,e){return n=Kf(n),(t=e?r:t)===r?function(n){return mt.test(n)}(n)?function(n){return n.match(bt)||[]}(n):function(n){return n.match($n)||[]}(n):n.match(t)||[]}var Oa=ju(function(n,t){try{return Pt(n,r,t)}catch(e){return Af(e)?e:new Xn(e)}}),Ia=Ei(function(n,t){return Zt(t,function(t){t=co(t),Le(n,t,rf(n[t],n))}),n});function Ra(n){return function(){return n}}var Ea=hi(),za=hi(!0);function Sa(n){return n}function La(n){return au("function"==typeof n?n:Be(n,c))}var Wa=ju(function(n,t){return function(r){return eu(r,n,t)}}),Ca=ju(function(n,t){return function(r){return eu(n,r,t)}});function Ba(n,t,r){var e=ia(t),u=He(t,e);null!=r||Rf(t)&&(u.length||!e.length)||(r=t,t=n,n=this,u=He(t,ia(t)));var i=!(Rf(r)&&"chain"in r&&!r.chain),o=kf(n);return Zt(u,function(r){var e=t[r];n[r]=e,o&&(n.prototype[r]=function(){var t=this.__chain__;if(i||t){var r=n(this.__wrapped__);return(r.__actions__=ri(this.__actions__)).push({func:e,args:arguments,thisArg:n}),r.__chain__=t,r}return e.apply(n,Qt([this.value()],arguments))})}),n}function Ua(){}var Ta=gi(Yt),$a=gi(Vt),Da=gi(tr);function Ma(n){return Vi(n)?cr(co(n)):function(n){return function(t){return Je(t,n)}}(n)}var Fa=di(),Na=di(!0);function Pa(){return[]}function qa(){return!1}var Za=_i(function(n,t){return n+t},0),Ka=mi("ceil"),Va=_i(function(n,t){return n/t},1),Ga=mi("floor");var Ha,Ja=_i(function(n,t){return n*t},1),Ya=mi("round"),Qa=_i(function(n,t){return n-t},0);return pe.after=function(n,t){if("function"!=typeof t)throw new it(i);return n=Nf(n),function(){if(--n<1)return t.apply(this,arguments)}},pe.ary=nf,pe.assign=Vf,pe.assignIn=Gf,pe.assignInWith=Hf,pe.assignWith=Jf,pe.at=Yf,pe.before=tf,pe.bind=rf,pe.bindAll=Ia,pe.bindKey=ef,pe.castArray=function(){if(!arguments.length)return[];var n=arguments[0];return df(n)?n:[n]},pe.chain=Do,pe.chunk=function(n,t,e){t=(e?Ki(n,t,e):t===r)?1:Zr(Nf(t),0);var u=null==n?0:n.length;if(!u||t<1)return[];for(var i=0,o=0,f=Yn($r(u/t));i<u;)f[o++]=zu(n,i,i+=t);return f},pe.compact=function(n){for(var t=-1,r=null==n?0:n.length,e=0,u=[];++t<r;){var i=n[t];i&&(u[e++]=i)}return u},pe.concat=function(){var n=arguments.length;if(!n)return[];for(var t=Yn(n-1),r=arguments[0],e=n;e--;)t[e-1]=arguments[e];return Qt(df(r)?ri(r):[r],qe(t,1))},pe.cond=function(n){var t=null==n?0:n.length,r=Bi();return n=t?Yt(n,function(n){if("function"!=typeof n[1])throw new it(i);return[r(n[0]),n[1]]}):[],ju(function(r){for(var e=-1;++e<t;){var u=n[e];if(Pt(u[0],this,r))return Pt(u[1],this,r)}})},pe.conforms=function(n){return function(n){var t=ia(n);return function(r){return Ue(r,n,t)}}(Be(n,c))},pe.constant=Ra,pe.countBy=No,pe.create=function(n,t){var r=ve(n);return null==t?r:Se(r,t)},pe.curry=function n(t,e,u){var i=Ai(t,y,r,r,r,r,r,e=u?r:e);return i.placeholder=n.placeholder,i},pe.curryRight=function n(t,e,u){var i=Ai(t,d,r,r,r,r,r,e=u?r:e);return i.placeholder=n.placeholder,i},pe.debounce=uf,pe.defaults=Qf,pe.defaultsDeep=Xf,pe.defer=of,pe.delay=ff,pe.difference=ho,pe.differenceBy=po,pe.differenceWith=vo,pe.drop=function(n,t,e){var u=null==n?0:n.length;return u?zu(n,(t=e||t===r?1:Nf(t))<0?0:t,u):[]},pe.dropRight=function(n,t,e){var u=null==n?0:n.length;return u?zu(n,0,(t=u-(t=e||t===r?1:Nf(t)))<0?0:t):[]},pe.dropRightWhile=function(n,t){return n&&n.length?Mu(n,Bi(t,3),!0,!0):[]},pe.dropWhile=function(n,t){return n&&n.length?Mu(n,Bi(t,3),!0):[]},pe.fill=function(n,t,e,u){var i=null==n?0:n.length;return i?(e&&"number"!=typeof e&&Ki(n,t,e)&&(e=0,u=i),function(n,t,e,u){var i=n.length;for((e=Nf(e))<0&&(e=-e>i?0:i+e),(u=u===r||u>i?i:Nf(u))<0&&(u+=i),u=e>u?0:Pf(u);e<u;)n[e++]=t;return n}(n,t,e,u)):[]},pe.filter=function(n,t){return(df(n)?Gt:Pe)(n,Bi(t,3))},pe.flatMap=function(n,t){return qe(Jo(n,t),1)},pe.flatMapDeep=function(n,t){return qe(Jo(n,t),z)},pe.flatMapDepth=function(n,t,e){return e=e===r?1:Nf(e),qe(Jo(n,t),e)},pe.flatten=yo,pe.flattenDeep=function(n){return null!=n&&n.length?qe(n,z):[]},pe.flattenDepth=function(n,t){return null!=n&&n.length?qe(n,t=t===r?1:Nf(t)):[]},pe.flip=function(n){return Ai(n,j)},pe.flow=Ea,pe.flowRight=za,pe.fromPairs=function(n){for(var t=-1,r=null==n?0:n.length,e={};++t<r;){var u=n[t];e[u[0]]=u[1]}return e},pe.functions=function(n){return null==n?[]:He(n,ia(n))},pe.functionsIn=function(n){return null==n?[]:He(n,oa(n))},pe.groupBy=Vo,pe.initial=function(n){return null!=n&&n.length?zu(n,0,-1):[]},pe.intersection=wo,pe.intersectionBy=mo,pe.intersectionWith=xo,pe.invert=ra,pe.invertBy=ea,pe.invokeMap=Go,pe.iteratee=La,pe.keyBy=Ho,pe.keys=ia,pe.keysIn=oa,pe.map=Jo,pe.mapKeys=function(n,t){var r={};return t=Bi(t,3),Ve(n,function(n,e,u){Le(r,t(n,e,u),n)}),r},pe.mapValues=function(n,t){var r={};return t=Bi(t,3),Ve(n,function(n,e,u){Le(r,e,t(n,e,u))}),r},pe.matches=function(n){return pu(Be(n,c))},pe.matchesProperty=function(n,t){return vu(n,Be(t,c))},pe.memoize=af,pe.merge=fa,pe.mergeWith=aa,pe.method=Wa,pe.methodOf=Ca,pe.mixin=Ba,pe.negate=cf,pe.nthArg=function(n){return n=Nf(n),ju(function(t){return gu(t,n)})},pe.omit=ca,pe.omitBy=function(n,t){return sa(n,cf(Bi(t)))},pe.once=function(n){return tf(2,n)},pe.orderBy=function(n,t,e,u){return null==n?[]:(df(t)||(t=null==t?[]:[t]),df(e=u?r:e)||(e=null==e?[]:[e]),yu(n,t,e))},pe.over=Ta,pe.overArgs=lf,pe.overEvery=$a,pe.overSome=Da,pe.partial=sf,pe.partialRight=hf,pe.partition=Yo,pe.pick=la,pe.pickBy=sa,pe.property=Ma,pe.propertyOf=function(n){return function(t){return null==n?r:Je(n,t)}},pe.pull=Ao,pe.pullAll=ko,pe.pullAllBy=function(n,t,r){return n&&n.length&&t&&t.length?bu(n,t,Bi(r,2)):n},pe.pullAllWith=function(n,t,e){return n&&n.length&&t&&t.length?bu(n,t,r,e):n},pe.pullAt=Oo,pe.range=Fa,pe.rangeRight=Na,pe.rearg=pf,pe.reject=function(n,t){return(df(n)?Gt:Pe)(n,cf(Bi(t,3)))},pe.remove=function(n,t){var r=[];if(!n||!n.length)return r;var e=-1,u=[],i=n.length;for(t=Bi(t,3);++e<i;){var o=n[e];t(o,e,n)&&(r.push(o),u.push(e))}return wu(n,u),r},pe.rest=function(n,t){if("function"!=typeof n)throw new it(i);return ju(n,t=t===r?t:Nf(t))},pe.reverse=Io,pe.sampleSize=function(n,t,e){return t=(e?Ki(n,t,e):t===r)?1:Nf(t),(df(n)?ke:ku)(n,t)},pe.set=function(n,t,r){return null==n?n:Ou(n,t,r)},pe.setWith=function(n,t,e,u){return u="function"==typeof u?u:r,null==n?n:Ou(n,t,e,u)},pe.shuffle=function(n){return(df(n)?Oe:Eu)(n)},pe.slice=function(n,t,e){var u=null==n?0:n.length;return u?(e&&"number"!=typeof e&&Ki(n,t,e)?(t=0,e=u):(t=null==t?0:Nf(t),e=e===r?u:Nf(e)),zu(n,t,e)):[]},pe.sortBy=Qo,pe.sortedUniq=function(n){return n&&n.length?Cu(n):[]},pe.sortedUniqBy=function(n,t){return n&&n.length?Cu(n,Bi(t,2)):[]},pe.split=function(n,t,e){return e&&"number"!=typeof e&&Ki(n,t,e)&&(t=e=r),(e=e===r?C:e>>>0)?(n=Kf(n))&&("string"==typeof t||null!=t&&!Wf(t))&&!(t=Uu(t))&&xr(n)?Gu(Er(n),0,e):n.split(t,e):[]},pe.spread=function(n,t){if("function"!=typeof n)throw new it(i);return t=null==t?0:Zr(Nf(t),0),ju(function(r){var e=r[t],u=Gu(r,0,t);return e&&Qt(u,e),Pt(n,this,u)})},pe.tail=function(n){var t=null==n?0:n.length;return t?zu(n,1,t):[]},pe.take=function(n,t,e){return n&&n.length?zu(n,0,(t=e||t===r?1:Nf(t))<0?0:t):[]},pe.takeRight=function(n,t,e){var u=null==n?0:n.length;return u?zu(n,(t=u-(t=e||t===r?1:Nf(t)))<0?0:t,u):[]},pe.takeRightWhile=function(n,t){return n&&n.length?Mu(n,Bi(t,3),!1,!0):[]},pe.takeWhile=function(n,t){return n&&n.length?Mu(n,Bi(t,3)):[]},pe.tap=function(n,t){return t(n),n},pe.throttle=function(n,t,r){var e=!0,u=!0;if("function"!=typeof n)throw new it(i);return Rf(r)&&(e="leading"in r?!!r.leading:e,u="trailing"in r?!!r.trailing:u),uf(n,t,{leading:e,maxWait:t,trailing:u})},pe.thru=Mo,pe.toArray=Mf,pe.toPairs=ha,pe.toPairsIn=pa,pe.toPath=function(n){return df(n)?Yt(n,co):Uf(n)?[n]:ri(ao(Kf(n)))},pe.toPlainObject=Zf,pe.transform=function(n,t,r){var e=df(n),u=e||xf(n)||Tf(n);if(t=Bi(t,4),null==r){var i=n&&n.constructor;r=u?e?new i:[]:Rf(n)&&kf(i)?ve(Wt(n)):{}}return(u?Zt:Ve)(n,function(n,e,u){return t(r,n,e,u)}),r},pe.unary=function(n){return nf(n,1)},pe.union=Ro,pe.unionBy=Eo,pe.unionWith=zo,pe.uniq=function(n){return n&&n.length?Tu(n):[]},pe.uniqBy=function(n,t){return n&&n.length?Tu(n,Bi(t,2)):[]},pe.uniqWith=function(n,t){return t="function"==typeof t?t:r,n&&n.length?Tu(n,r,t):[]},pe.unset=function(n,t){return null==n||$u(n,t)},pe.unzip=So,pe.unzipWith=Lo,pe.update=function(n,t,r){return null==n?n:Du(n,t,Zu(r))},pe.updateWith=function(n,t,e,u){return u="function"==typeof u?u:r,null==n?n:Du(n,t,Zu(e),u)},pe.values=va,pe.valuesIn=function(n){return null==n?[]:_r(n,oa(n))},pe.without=Wo,pe.words=ka,pe.wrap=function(n,t){return sf(Zu(t),n)},pe.xor=Co,pe.xorBy=Bo,pe.xorWith=Uo,pe.zip=To,pe.zipObject=function(n,t){return Pu(n||[],t||[],Re)},pe.zipObjectDeep=function(n,t){return Pu(n||[],t||[],Ou)},pe.zipWith=$o,pe.entries=ha,pe.entriesIn=pa,pe.extend=Gf,pe.extendWith=Hf,Ba(pe,pe),pe.add=Za,pe.attempt=Oa,pe.camelCase=_a,pe.capitalize=ga,pe.ceil=Ka,pe.clamp=function(n,t,e){return e===r&&(e=t,t=r),e!==r&&(e=(e=qf(e))==e?e:0),t!==r&&(t=(t=qf(t))==t?t:0),Ce(qf(n),t,e)},pe.clone=function(n){return Be(n,s)},pe.cloneDeep=function(n){return Be(n,c|s)},pe.cloneDeepWith=function(n,t){return Be(n,c|s,t="function"==typeof t?t:r)},pe.cloneWith=function(n,t){return Be(n,s,t="function"==typeof t?t:r)},pe.conformsTo=function(n,t){return null==t||Ue(n,t,ia(t))},pe.deburr=ya,pe.defaultTo=function(n,t){return null==n||n!=n?t:n},pe.divide=Va,pe.endsWith=function(n,t,e){n=Kf(n),t=Uu(t);var u=n.length,i=e=e===r?u:Ce(Nf(e),0,u);return(e-=t.length)>=0&&n.slice(e,i)==t},pe.eq=vf,pe.escape=function(n){return(n=Kf(n))&&jn.test(n)?n.replace(mn,wr):n},pe.escapeRegExp=function(n){return(n=Kf(n))&&Sn.test(n)?n.replace(zn,"\\$&"):n},pe.every=function(n,t,e){var u=df(n)?Vt:Fe;return e&&Ki(n,t,e)&&(t=r),u(n,Bi(t,3))},pe.find=Po,pe.findIndex=_o,pe.findKey=function(n,t){return er(n,Bi(t,3),Ve)},pe.findLast=qo,pe.findLastIndex=go,pe.findLastKey=function(n,t){return er(n,Bi(t,3),Ge)},pe.floor=Ga,pe.forEach=Zo,pe.forEachRight=Ko,pe.forIn=function(n,t){return null==n?n:Ze(n,Bi(t,3),oa)},pe.forInRight=function(n,t){return null==n?n:Ke(n,Bi(t,3),oa)},pe.forOwn=function(n,t){return n&&Ve(n,Bi(t,3))},pe.forOwnRight=function(n,t){return n&&Ge(n,Bi(t,3))},pe.get=na,pe.gt=_f,pe.gte=gf,pe.has=function(n,t){return null!=n&&Ni(n,t,nu)},pe.hasIn=ta,pe.head=bo,pe.identity=Sa,pe.includes=function(n,t,r,e){n=wf(n)?n:va(n),r=r&&!e?Nf(r):0;var u=n.length;return r<0&&(r=Zr(u+r,0)),Bf(n)?r<=u&&n.indexOf(t,r)>-1:!!u&&ir(n,t,r)>-1},pe.indexOf=function(n,t,r){var e=null==n?0:n.length;if(!e)return-1;var u=null==r?0:Nf(r);return u<0&&(u=Zr(e+u,0)),ir(n,t,u)},pe.inRange=function(n,t,e){return t=Ff(t),e===r?(e=t,t=0):e=Ff(e),function(n,t,r){return n>=Kr(t,r)&&n<Zr(t,r)}(n=qf(n),t,e)},pe.invoke=ua,pe.isArguments=yf,pe.isArray=df,pe.isArrayBuffer=bf,pe.isArrayLike=wf,pe.isArrayLikeObject=mf,pe.isBoolean=function(n){return!0===n||!1===n||Ef(n)&&Qe(n)==F},pe.isBuffer=xf,pe.isDate=jf,pe.isElement=function(n){return Ef(n)&&1===n.nodeType&&!Lf(n)},pe.isEmpty=function(n){if(null==n)return!0;if(wf(n)&&(df(n)||"string"==typeof n||"function"==typeof n.splice||xf(n)||Tf(n)||yf(n)))return!n.length;var t=Fi(n);if(t==V||t==X)return!n.size;if(Ji(n))return!cu(n).length;for(var r in n)if(st.call(n,r))return!1;return!0},pe.isEqual=function(n,t){return iu(n,t)},pe.isEqualWith=function(n,t,e){var u=(e="function"==typeof e?e:r)?e(n,t):r;return u===r?iu(n,t,r,e):!!u},pe.isError=Af,pe.isFinite=function(n){return"number"==typeof n&&Nr(n)},pe.isFunction=kf,pe.isInteger=Of,pe.isLength=If,pe.isMap=zf,pe.isMatch=function(n,t){return n===t||ou(n,t,Ti(t))},pe.isMatchWith=function(n,t,e){return e="function"==typeof e?e:r,ou(n,t,Ti(t),e)},pe.isNaN=function(n){return Sf(n)&&n!=+n},pe.isNative=function(n){if(Hi(n))throw new Xn(u);return fu(n)},pe.isNil=function(n){return null==n},pe.isNull=function(n){return null===n},pe.isNumber=Sf,pe.isObject=Rf,pe.isObjectLike=Ef,pe.isPlainObject=Lf,pe.isRegExp=Wf,pe.isSafeInteger=function(n){return Of(n)&&n>=-S&&n<=S},pe.isSet=Cf,pe.isString=Bf,pe.isSymbol=Uf,pe.isTypedArray=Tf,pe.isUndefined=function(n){return n===r},pe.isWeakMap=function(n){return Ef(n)&&Fi(n)==en},pe.isWeakSet=function(n){return Ef(n)&&Qe(n)==un},pe.join=function(n,t){return null==n?"":Pr.call(n,t)},pe.kebabCase=da,pe.last=jo,pe.lastIndexOf=function(n,t,e){var u=null==n?0:n.length;if(!u)return-1;var i=u;return e!==r&&(i=(i=Nf(e))<0?Zr(u+i,0):Kr(i,u-1)),t==t?function(n,t,r){for(var e=r+1;e--;)if(n[e]===t)return e;return e}(n,t,i):ur(n,fr,i,!0)},pe.lowerCase=ba,pe.lowerFirst=wa,pe.lt=$f,pe.lte=Df,pe.max=function(n){return n&&n.length?Ne(n,Sa,Xe):r},pe.maxBy=function(n,t){return n&&n.length?Ne(n,Bi(t,2),Xe):r},pe.mean=function(n){return ar(n,Sa)},pe.meanBy=function(n,t){return ar(n,Bi(t,2))},pe.min=function(n){return n&&n.length?Ne(n,Sa,su):r},pe.minBy=function(n,t){return n&&n.length?Ne(n,Bi(t,2),su):r},pe.stubArray=Pa,pe.stubFalse=qa,pe.stubObject=function(){return{}},pe.stubString=function(){return""},pe.stubTrue=function(){return!0},pe.multiply=Ja,pe.nth=function(n,t){return n&&n.length?gu(n,Nf(t)):r},pe.noConflict=function(){return St._===this&&(St._=dt),this},pe.noop=Ua,pe.now=Xo,pe.pad=function(n,t,r){n=Kf(n);var e=(t=Nf(t))?Rr(n):0;if(!t||e>=t)return n;var u=(t-e)/2;return yi(Dr(u),r)+n+yi($r(u),r)},pe.padEnd=function(n,t,r){n=Kf(n);var e=(t=Nf(t))?Rr(n):0;return t&&e<t?n+yi(t-e,r):n},pe.padStart=function(n,t,r){n=Kf(n);var e=(t=Nf(t))?Rr(n):0;return t&&e<t?yi(t-e,r)+n:n},pe.parseInt=function(n,t,r){return r||null==t?t=0:t&&(t=+t),Gr(Kf(n).replace(Wn,""),t||0)},pe.random=function(n,t,e){if(e&&"boolean"!=typeof e&&Ki(n,t,e)&&(t=e=r),e===r&&("boolean"==typeof t?(e=t,t=r):"boolean"==typeof n&&(e=n,n=r)),n===r&&t===r?(n=0,t=1):(n=Ff(n),t===r?(t=n,n=0):t=Ff(t)),n>t){var u=n;n=t,t=u}if(e||n%1||t%1){var i=Hr();return Kr(n+i*(t-n+It("1e-"+((i+"").length-1))),t)}return mu(n,t)},pe.reduce=function(n,t,r){var e=df(n)?Xt:sr,u=arguments.length<3;return e(n,Bi(t,4),r,u,De)},pe.reduceRight=function(n,t,r){var e=df(n)?nr:sr,u=arguments.length<3;return e(n,Bi(t,4),r,u,Me)},pe.repeat=function(n,t,e){return t=(e?Ki(n,t,e):t===r)?1:Nf(t),xu(Kf(n),t)},pe.replace=function(){var n=arguments,t=Kf(n[0]);return n.length<3?t:t.replace(n[1],n[2])},pe.result=function(n,t,e){var u=-1,i=(t=Ku(t,n)).length;for(i||(i=1,n=r);++u<i;){var o=null==n?r:n[co(t[u])];o===r&&(u=i,o=e),n=kf(o)?o.call(n):o}return n},pe.round=Ya,pe.runInContext=n,pe.sample=function(n){return(df(n)?Ae:Au)(n)},pe.size=function(n){if(null==n)return 0;if(wf(n))return Bf(n)?Rr(n):n.length;var t=Fi(n);return t==V||t==X?n.size:cu(n).length},pe.snakeCase=ma,pe.some=function(n,t,e){var u=df(n)?tr:Su;return e&&Ki(n,t,e)&&(t=r),u(n,Bi(t,3))},pe.sortedIndex=function(n,t){return Lu(n,t)},pe.sortedIndexBy=function(n,t,r){return Wu(n,t,Bi(r,2))},pe.sortedIndexOf=function(n,t){var r=null==n?0:n.length;if(r){var e=Lu(n,t);if(e<r&&vf(n[e],t))return e}return-1},pe.sortedLastIndex=function(n,t){return Lu(n,t,!0)},pe.sortedLastIndexBy=function(n,t,r){return Wu(n,t,Bi(r,2),!0)},pe.sortedLastIndexOf=function(n,t){if(null!=n&&n.length){var r=Lu(n,t,!0)-1;if(vf(n[r],t))return r}return-1},pe.startCase=xa,pe.startsWith=function(n,t,r){return n=Kf(n),r=null==r?0:Ce(Nf(r),0,n.length),t=Uu(t),n.slice(r,r+t.length)==t},pe.subtract=Qa,pe.sum=function(n){return n&&n.length?hr(n,Sa):0},pe.sumBy=function(n,t){return n&&n.length?hr(n,Bi(t,2)):0},pe.template=function(n,t,e){var u=pe.templateSettings;e&&Ki(n,t,e)&&(t=r),n=Kf(n),t=Hf({},t,u,ki);var i,o,f=Hf({},t.imports,u.imports,ki),a=ia(f),c=_r(f,a),l=0,s=t.interpolate||Gn,h="__p += '",p=et((t.escape||Gn).source+"|"+s.source+"|"+(s===On?Mn:Gn).source+"|"+(t.evaluate||Gn).source+"|$","g"),v="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++jt+"]")+"\n";n.replace(p,function(t,r,e,u,f,a){return e||(e=u),h+=n.slice(l,a).replace(Hn,mr),r&&(i=!0,h+="' +\n__e("+r+") +\n'"),f&&(o=!0,h+="';\n"+f+";\n__p += '"),e&&(h+="' +\n((__t = ("+e+")) == null ? '' : __t) +\n'"),l=a+t.length,t}),h+="';\n";var _=t.variable;_||(h="with (obj) {\n"+h+"\n}\n"),h=(o?h.replace(yn,""):h).replace(dn,"$1").replace(bn,"$1;"),h="function("+(_||"obj")+") {\n"+(_?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var g=Oa(function(){return nt(a,v+"return "+h).apply(r,c)});if(g.source=h,Af(g))throw g;return g},pe.times=function(n,t){if((n=Nf(n))<1||n>S)return[];var r=C,e=Kr(n,C);t=Bi(t),n-=C;for(var u=pr(e,t);++r<n;)t(r);return u},pe.toFinite=Ff,pe.toInteger=Nf,pe.toLength=Pf,pe.toLower=function(n){return Kf(n).toLowerCase()},pe.toNumber=qf,pe.toSafeInteger=function(n){return n?Ce(Nf(n),-S,S):0===n?n:0},pe.toString=Kf,pe.toUpper=function(n){return Kf(n).toUpperCase()},pe.trim=function(n,t,e){if((n=Kf(n))&&(e||t===r))return n.replace(Ln,"");if(!n||!(t=Uu(t)))return n;var u=Er(n),i=Er(t);return Gu(u,yr(u,i),dr(u,i)+1).join("")},pe.trimEnd=function(n,t,e){if((n=Kf(n))&&(e||t===r))return n.replace(Cn,"");if(!n||!(t=Uu(t)))return n;var u=Er(n);return Gu(u,0,dr(u,Er(t))+1).join("")},pe.trimStart=function(n,t,e){if((n=Kf(n))&&(e||t===r))return n.replace(Wn,"");if(!n||!(t=Uu(t)))return n;var u=Er(n);return Gu(u,yr(u,Er(t))).join("")},pe.truncate=function(n,t){var e=A,u=k;if(Rf(t)){var i="separator"in t?t.separator:i;e="length"in t?Nf(t.length):e,u="omission"in t?Uu(t.omission):u}var o=(n=Kf(n)).length;if(xr(n)){var f=Er(n);o=f.length}if(e>=o)return n;var a=e-Rr(u);if(a<1)return u;var c=f?Gu(f,0,a).join(""):n.slice(0,a);if(i===r)return c+u;if(f&&(a+=c.length-a),Wf(i)){if(n.slice(a).search(i)){var l,s=c;for(i.global||(i=et(i.source,Kf(Fn.exec(i))+"g")),i.lastIndex=0;l=i.exec(s);)var h=l.index;c=c.slice(0,h===r?a:h)}}else if(n.indexOf(Uu(i),a)!=a){var p=c.lastIndexOf(i);p>-1&&(c=c.slice(0,p))}return c+u},pe.unescape=function(n){return(n=Kf(n))&&xn.test(n)?n.replace(wn,zr):n},pe.uniqueId=function(n){var t=++ht;return Kf(n)+t},pe.upperCase=ja,pe.upperFirst=Aa,pe.each=Zo,pe.eachRight=Ko,pe.first=bo,Ba(pe,(Ha={},Ve(pe,function(n,t){st.call(pe.prototype,t)||(Ha[t]=n)}),Ha),{chain:!1}),pe.VERSION="4.17.11",Zt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(n){pe[n].placeholder=pe}),Zt(["drop","take"],function(n,t){ye.prototype[n]=function(e){e=e===r?1:Zr(Nf(e),0);var u=this.__filtered__&&!t?new ye(this):this.clone();return u.__filtered__?u.__takeCount__=Kr(e,u.__takeCount__):u.__views__.push({size:Kr(e,C),type:n+(u.__dir__<0?"Right":"")}),u},ye.prototype[n+"Right"]=function(t){return this.reverse()[n](t).reverse()}}),Zt(["filter","map","takeWhile"],function(n,t){var r=t+1,e=r==R||3==r;ye.prototype[n]=function(n){var t=this.clone();return t.__iteratees__.push({iteratee:Bi(n,3),type:r}),t.__filtered__=t.__filtered__||e,t}}),Zt(["head","last"],function(n,t){var r="take"+(t?"Right":"");ye.prototype[n]=function(){return this[r](1).value()[0]}}),Zt(["initial","tail"],function(n,t){var r="drop"+(t?"":"Right");ye.prototype[n]=function(){return this.__filtered__?new ye(this):this[r](1)}}),ye.prototype.compact=function(){return this.filter(Sa)},ye.prototype.find=function(n){return this.filter(n).head()},ye.prototype.findLast=function(n){return this.reverse().find(n)},ye.prototype.invokeMap=ju(function(n,t){return"function"==typeof n?new ye(this):this.map(function(r){return eu(r,n,t)})}),ye.prototype.reject=function(n){return this.filter(cf(Bi(n)))},ye.prototype.slice=function(n,t){n=Nf(n);var e=this;return e.__filtered__&&(n>0||t<0)?new ye(e):(n<0?e=e.takeRight(-n):n&&(e=e.drop(n)),t!==r&&(e=(t=Nf(t))<0?e.dropRight(-t):e.take(t-n)),e)},ye.prototype.takeRightWhile=function(n){return this.reverse().takeWhile(n).reverse()},ye.prototype.toArray=function(){return this.take(C)},Ve(ye.prototype,function(n,t){var e=/^(?:filter|find|map|reject)|While$/.test(t),u=/^(?:head|last)$/.test(t),i=pe[u?"take"+("last"==t?"Right":""):t],o=u||/^find/.test(t);i&&(pe.prototype[t]=function(){var t=this.__wrapped__,f=u?[1]:arguments,a=t instanceof ye,c=f[0],l=a||df(t),s=function(n){var t=i.apply(pe,Qt([n],f));return u&&h?t[0]:t};l&&e&&"function"==typeof c&&1!=c.length&&(a=l=!1);var h=this.__chain__,p=!!this.__actions__.length,v=o&&!h,_=a&&!p;if(!o&&l){t=_?t:new ye(this);var g=n.apply(t,f);return g.__actions__.push({func:Mo,args:[s],thisArg:r}),new ge(g,h)}return v&&_?n.apply(this,f):(g=this.thru(s),v?u?g.value()[0]:g.value():g)})}),Zt(["pop","push","shift","sort","splice","unshift"],function(n){var t=ot[n],r=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",e=/^(?:pop|shift)$/.test(n);pe.prototype[n]=function(){var n=arguments;if(e&&!this.__chain__){var u=this.value();return t.apply(df(u)?u:[],n)}return this[r](function(r){return t.apply(df(r)?r:[],n)})}}),Ve(ye.prototype,function(n,t){var r=pe[t];if(r){var e=r.name+"";(ue[e]||(ue[e]=[])).push({name:t,func:r})}}),ue[pi(r,_).name]=[{name:"wrapper",func:r}],ye.prototype.clone=function(){var n=new ye(this.__wrapped__);return n.__actions__=ri(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=ri(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=ri(this.__views__),n},ye.prototype.reverse=function(){if(this.__filtered__){var n=new ye(this);n.__dir__=-1,n.__filtered__=!0}else(n=this.clone()).__dir__*=-1;return n},ye.prototype.value=function(){var n=this.__wrapped__.value(),t=this.__dir__,r=df(n),e=t<0,u=r?n.length:0,i=function(n,t,r){for(var e=-1,u=r.length;++e<u;){var i=r[e],o=i.size;switch(i.type){case"drop":n+=o;break;case"dropRight":t-=o;break;case"take":t=Kr(t,n+o);break;case"takeRight":n=Zr(n,t-o)}}return{start:n,end:t}}(0,u,this.__views__),o=i.start,f=i.end,a=f-o,c=e?f:o-1,l=this.__iteratees__,s=l.length,h=0,p=Kr(a,this.__takeCount__);if(!r||!e&&u==a&&p==a)return Fu(n,this.__actions__);var v=[];n:for(;a--&&h<p;){for(var _=-1,g=n[c+=t];++_<s;){var y=l[_],d=y.iteratee,b=y.type,w=d(g);if(b==E)g=w;else if(!w){if(b==R)continue n;break n}}v[h++]=g}return v},pe.prototype.at=Fo,pe.prototype.chain=function(){return Do(this)},pe.prototype.commit=function(){return new ge(this.value(),this.__chain__)},pe.prototype.next=function(){this.__values__===r&&(this.__values__=Mf(this.value()));var n=this.__index__>=this.__values__.length;return{done:n,value:n?r:this.__values__[this.__index__++]}},pe.prototype.plant=function(n){for(var t,e=this;e instanceof _e;){var u=so(e);u.__index__=0,u.__values__=r,t?i.__wrapped__=u:t=u;var i=u;e=e.__wrapped__}return i.__wrapped__=n,t},pe.prototype.reverse=function(){var n=this.__wrapped__;if(n instanceof ye){var t=n;return this.__actions__.length&&(t=new ye(this)),(t=t.reverse()).__actions__.push({func:Mo,args:[Io],thisArg:r}),new ge(t,this.__chain__)}return this.thru(Io)},pe.prototype.toJSON=pe.prototype.valueOf=pe.prototype.value=function(){return Fu(this.__wrapped__,this.__actions__)},pe.prototype.first=pe.prototype.head,Lr&&(pe.prototype[Lr]=function(){return this}),pe}();"function"==typeof n&&"object"==typeof n.amd&&n.amd?(St._=Sr,n(function(){return Sr})):Wt?((Wt.exports=Sr)._=Sr,Lt._=Sr):St._=Sr}).call(this);
},{"buffer":"e1kl"}],"M8jz":[function(require,module,exports) {
var r=function(r,n){return r.map(function(r,u){var o=!0,i=!1,f=void 0;try{for(var a,c=n[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var l=a.value,g=[(l=l.split(":").map(function(r){return r.trim()}))[0],l[1]],m=g[1];if(r===g[0]){var y=e(r);return t(m,y[0],y[1])}}}catch(v){i=!0,f=v}finally{try{o||null==c.return||c.return()}finally{if(i)throw f}}return 0})},t=function(r,t,n){return 0!=r?1*(r-t)/(n-t):0},n=function(r,n){return t(r,n[0],n[1])},e=function(r){return{"Общий белок":[48,100],"Альбумин":[20,40],"Креатинин":[50,177],"Мочевина":[2.8,10.9],"Билирубин общий":[3,53],"Глюкоза":[2.8,20.8],"АСТ":[0,700],"АЛТ":[0,80],"Билирубин прямой":[0,15],"Билирубин непрямой":[0,20],"Альфа-Амилаза":[0,100],"Лактатдегидрогеназа":[10,300]}[r]},u=function(r){return null===r?0:parseFloat(r)},o=function(r,t,e){return n(e,[0,210])},i=function(r,t){return n(t,[3,6])},f=function(r){return n(r,[0,20])},a=function(r){return"М"===r?2:3},c=function(r){return t(r,32,42)};module.exports={getBio:r,getSex:a,getNormal:u,getHemoglobin:o,getErythrocyte:i,getleukocyte:f,getTemperature:c};
},{}],"epB2":[function(require,module,exports) {
function e(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var r=require("brain.js"),t=require("lodash"),o=require("./analysis"),a=function(e,r){console.log(r);var a={age:(parseInt(e.age)/120).toFixed(2),sex:o.getSex(e.sex),stomach:o.getNormal(e.stomach),s_irritation:o.getNormal(e.s_irritation),nausea:o.getNormal(e.nausea),pain_upper:o.getNormal(e.pain_upper),temperature:o.getTemperature(o.getNormal(e.temperature)),gall_bladder:o.getNormal(e.gall_bladder),alcohol:o.getNormal(e.alcohol),vomitting:o.getNormal(e.vomitting),dry_mouth:o.getNormal(e.dry_mouth),weakness:o.getNormal(e.weakness),hemoglobin:o.getHemoglobin(e.sex,e.age,o.getNormal(e.hemoglobin)),"erythrocyte:":o.getErythrocyte(e.age,o.getNormal(e.erythrocyte)),leukocyte:o.getleukocyte(e.age,o.getNormal(e.leukocyte)),biochemistry:o.getBio(r,e.biochemistry_raw)},n=new Array;return Object.keys(a).forEach(function(e){n.push(a[e])}),t.flatten(n)},n=function(r){return e({},r.hid,1)},i=function(e,r){return{input:a(e,r),output:n(e)}},l={errorThresh:.005,iterations:5e4,log:!0,logPeriod:50,learningRate:.2},u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l,o=e.biochemistry_types,a=e.list.map(function(e){return i(e,o)}),n=new r.NeuralNetwork,u=n.train(a,t);return JSON.stringify(n.toJSON(u))},g=function(e,t,o){var n=new r.NeuralNetwork;return n.fromJSON(JSON.parse(t)),n.run(a(e,o))};
},{"brain.js":"SDL3","lodash":"4HJa","./analysis":"M8jz"}]},{},["epB2"], null)
//# sourceMappingURL=/main.map